<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Route 52 ‚Äì CANAL WINCHESTER | MetroFeed Portland</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #0d0d0d;
      color: #cccccc;
    }
    header {
      background-color: #0d0d0d;
      border-bottom: 3px solid #4dd0e1;
      padding: 1rem;
      text-align: center;
    }
    header img {
      max-height: 60px;
    }
    .ad-banner {
      text-align: center;
      margin: 1rem auto;
      background-color: #222;
      color: #888;
      padding: 1rem;
      border: 2px dashed #4dd0e1;
      font-size: 0.9rem;
      border-radius: 8px;
    }
    h1 {
      text-align: center;
      margin: 1rem 0;
      font-size: 2rem;
      color: #f0f0f0;
    }
    .content-box {
      border: 2px solid #4dd0e1;
      border-radius: 12px;
      padding: 1rem;
      margin: 1rem;
      background-color: #1e1e1e;
    }
    #map {
      width: 100%;
      height: 400px;
      border-radius: 8px;
    }
    .button-bar {
      display: flex;
      justify-content: center;
      margin: 1rem 0;
    }
    .button-bar a {
      background: #4dd0e1;
      color: #0d0d0d;
      padding: 0.5rem 1rem;
      text-decoration: none;
      border-radius: 8px;
      font-weight: bold;
    }

.back-button {
  background-color: #4dd0e1;
  color: #0d0d0d;
  border: none;
  padding: 0.6rem 1.2rem;
  font-size: 1rem;
  font-weight: bold;
  border-radius: 8px;
  cursor: pointer;
  box-shadow: 0 0 10px #4dd0e1;
  text-decoration: none;
}
.back-button:hover {
  background-color: #35c0d6;
}
.site-footer {
      text-align: center;
      margin-top: 3rem;
      margin-bottom: 120px;
      font-size: 0.85rem;
      color: #aaa;
    }
    .site-footer a {
      color: #00BFFF;
      text-decoration: none;
    }
    .site-footer a:hover {
      text-decoration: underline;
    }

  </style>
</head>
<body>
  <header>
    <img src="MetroFeedPortlandLogo.png" alt="MetroFeed Portland">
  </header>

  <div class="ad-banner">
    [Ad Banner Placeholder ‚Äî 300x250]
  </div>

  <div class="disclaimer" style="margin: 1rem auto 0.5rem; max-width: 600px; font-size: 0.8rem; color: #bbb; text-align: center; padding: 0.5rem 1rem; background-color: #111; border: 1px dashed #444; border-radius: 6px;">
    ‚ö†Ô∏è This is a Beta program, work in progress. Please REPORT bugs and pretend to be impressed.
  </div>
  <div class="disclaimer" style="margin: 0 auto 1rem; max-width: 600px; font-size: 0.75rem; color: #888; text-align: center; padding: 0.25rem 1rem;">
    This tool is not affiliated with or endorsed by TriMet. For official schedules and service alerts, visit <a href="https://trimet.org" style="color:#4dd0e1;">trimet.org</a>.
  </div>

  <div style="margin: 2rem 0; text-align: center;">
  <button class="back-button" onclick="history.back()">‚¨Ö Back</button>
  </div>

  <h1>Route 52 ‚Äì CANAL WINCHESTER</h1>

  <div class="content-box">
    <div id="map"></div>
    <div style="text-align:right; font-size: 0.7rem; color: #777; margin-top: 0.5rem;">
      Data courtesy of TriMet.
    </div>
  </div>

  
  <script>
  const apiKey = "2C4447D4A42083BCD84DE3B8E";
  const routeNumber = 52;
  const direction = parseInt(0);

  const map = L.map('map').setView([45.6, -122.7], 12);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19
  }).addTo(map);

  const shapeOutbound = [
  [39.86053, -82.826489],
  [39.860489, -82.82562],
  [39.86051, -82.825459],
  [39.86071, -82.825629],
  [39.861, -82.82588],
  [39.861309, -82.82615],
  [39.861819, -82.82657],
  [39.86199, -82.826709],
  [39.86208, -82.82678],
  [39.862109, -82.826799],
  [39.862179, -82.826859],
  [39.862559, -82.827169],
  [39.862639, -82.827259],
  [39.86289, -82.827529],
  [39.86216, -82.82759],
  [39.862019, -82.8276],
  [39.861819, -82.827619],
  [39.8616, -82.82764],
  [39.861459, -82.82765],
  [39.861379, -82.827659],
  [39.86132, -82.827669],
  [39.86118, -82.82768],
  [39.86078, -82.827709],
  [39.860119, -82.827759],
  [39.859659, -82.827969],
  [39.859399, -82.82814],
  [39.85928, -82.82826],
  [39.85919, -82.82841],
  [39.859109, -82.82858],
  [39.85908, -82.82877],
  [39.85907, -82.828969],
  [39.85909, -82.829189],
  [39.859149, -82.829459],
  [39.859309, -82.83016],
  [39.85952, -82.83098],
  [39.85979, -82.832109],
  [39.860379, -82.833519],
  [39.86169, -82.836669],
  [39.8618, -82.836929],
  [39.862279, -82.83808],
  [39.862459, -82.838499],
  [39.863629, -82.841289],
  [39.86432, -82.84294],
  [39.864519, -82.843419],
  [39.86523, -82.84511],
  [39.86683, -82.84892],
  [39.867059, -82.84946],
  [39.867309, -82.849989],
  [39.86756, -82.8505],
  [39.867949, -82.85121],
  [39.868199, -82.851639],
  [39.86844, -82.85203],
  [39.86871, -82.85243],
  [39.868929, -82.85276],
  [39.869199, -82.85312],
  [39.8697, -82.85375],
  [39.87033, -82.85455],
  [39.87095, -82.85532],
  [39.87152, -82.85604],
  [39.87277, -82.857589],
  [39.873099, -82.85802],
  [39.873429, -82.858449],
  [39.87376, -82.858889],
  [39.874239, -82.859569],
  [39.874709, -82.86026],
  [39.877489, -82.864509],
  [39.877659, -82.86476],
  [39.878479, -82.866009],
  [39.88049, -82.86908],
  [39.882369, -82.87196],
  [39.88346, -82.87363],
  [39.88364, -82.87391],
  [39.88382, -82.87418],
  [39.88436, -82.87502],
  [39.88455, -82.875309],
  [39.885579, -82.87688],
  [39.88562, -82.876939],
  [39.887049, -82.87913],
  [39.88717, -82.879319],
  [39.88818, -82.88087],
  [39.8888, -82.88182],
  [39.88925, -82.882509],
  [39.889549, -82.882969],
  [39.889639, -82.88309],
  [39.889709, -82.883199],
  [39.89059, -82.88453],
  [39.89176, -82.88631],
  [39.89232, -82.887159],
  [39.89264, -82.887649],
  [39.89327, -82.888589],
  [39.89348, -82.88889],
  [39.893709, -82.88921],
  [39.893889, -82.889449],
  [39.8941, -82.889709],
  [39.894329, -82.889989],
  [39.894569, -82.890269],
  [39.894949, -82.89068],
  [39.89563, -82.89137],
  [39.896229, -82.891929],
  [39.89654, -82.89221],
  [39.89733, -82.892909],
  [39.89787, -82.89339],
  [39.89804, -82.893539],
  [39.898379, -82.89384],
  [39.89849, -82.893939],
  [39.898749, -82.894169],
  [39.898889, -82.89429],
  [39.899169, -82.89455],
  [39.89941, -82.89477],
  [39.899739, -82.895079],
  [39.900159, -82.895519],
  [39.90069, -82.896109],
  [39.90105, -82.89658],
  [39.9014, -82.89707],
  [39.90157, -82.897329],
  [39.902, -82.898039],
  [39.902049, -82.898129],
  [39.9022, -82.89842],
  [39.90248, -82.898979],
  [39.902759, -82.899579],
  [39.902949, -82.9],
  [39.903129, -82.900509],
  [39.90329, -82.90099],
  [39.903419, -82.901429],
  [39.903509, -82.90171],
  [39.903869, -82.90298],
  [39.903949, -82.90328],
  [39.904119, -82.90387],
  [39.90418, -82.904079],
  [39.904759, -82.90621],
  [39.905499, -82.90887],
  [39.90609, -82.911009],
  [39.90626, -82.911589],
  [39.90644, -82.91216],
  [39.906579, -82.912539],
  [39.906759, -82.913],
  [39.906909, -82.91336],
  [39.90713, -82.91385],
  [39.907459, -82.914509],
  [39.90769, -82.9149],
  [39.907989, -82.91539],
  [39.90832, -82.91588],
  [39.908619, -82.91629],
  [39.908899, -82.916639],
  [39.909089, -82.91688],
  [39.9094, -82.91723],
  [39.909449, -82.91728],
  [39.90986, -82.91769],
  [39.910249, -82.91804],
  [39.91075, -82.91845],
  [39.91128, -82.91882],
  [39.91163, -82.91904],
  [39.91182, -82.919159],
  [39.91201, -82.91926],
  [39.91226, -82.9194],
  [39.912599, -82.919559],
  [39.912859, -82.919679],
  [39.913029, -82.91975],
  [39.913589, -82.91984],
  [39.91379, -82.919869],
  [39.91416, -82.919869],
  [39.914299, -82.919869],
  [39.914479, -82.919829],
  [39.91478, -82.91971],
  [39.9149, -82.919639],
  [39.91523, -82.919409],
  [39.9155, -82.919159],
  [39.915839, -82.91886],
  [39.91624, -82.9185],
  [39.916619, -82.918159],
  [39.91685, -82.918],
  [39.916989, -82.917929],
  [39.917179, -82.917849],
  [39.91742, -82.91782],
  [39.91759, -82.917799],
  [39.917649, -82.91805],
  [39.91766, -82.91822],
  [39.91768, -82.918799],
  [39.9177, -82.919159],
  [39.917719, -82.919459],
  [39.91776, -82.920219],
  [39.91777, -82.920539],
  [39.917829, -82.92159],
  [39.91786, -82.92222],
  [39.917899, -82.92276],
  [39.917999, -82.92377],
  [39.91804, -82.924139],
  [39.918069, -82.924329],
  [39.918159, -82.92489],
  [39.91821, -82.925129],
  [39.918259, -82.925409],
  [39.91831, -82.92565],
  [39.918359, -82.92583],
  [39.91856, -82.92659],
  [39.91875, -82.927199],
  [39.918899, -82.927649],
  [39.918969, -82.927839],
  [39.91921, -82.928589],
  [39.919439, -82.929269],
  [39.91958, -82.92975],
  [39.919709, -82.930269],
  [39.919789, -82.930659],
  [39.91986, -82.93101],
  [39.91992, -82.931379],
  [39.91993, -82.931529],
  [39.919979, -82.93199],
  [39.92001, -82.932469],
  [39.919969, -82.93339],
  [39.91995, -82.93379],
  [39.91986, -82.934669],
  [39.919779, -82.93515],
  [39.91968, -82.935619],
  [39.919509, -82.936259],
  [39.919339, -82.936799],
  [39.919179, -82.93727],
  [39.918989, -82.937859],
  [39.91883, -82.938309],
  [39.918609, -82.938949],
  [39.91841, -82.93955],
  [39.91805, -82.94055],
  [39.91715, -82.9432],
  [39.916629, -82.94473],
  [39.91633, -82.945599],
  [39.91615, -82.946149],
  [39.91604, -82.946509],
  [39.91597, -82.946769],
  [39.915919, -82.947009],
  [39.915909, -82.947089],
  [39.91588, -82.94724],
  [39.91581, -82.947579],
  [39.915759, -82.947999],
  [39.915729, -82.94829],
  [39.91572, -82.94856],
  [39.91571, -82.948839],
  [39.91571, -82.94915],
  [39.91572, -82.94949],
  [39.915749, -82.95021],
  [39.9158, -82.951189],
  [39.91596, -82.95423],
  [39.91606, -82.956409],
  [39.91613, -82.957749],
  [39.916179, -82.958919],
  [39.916199, -82.959559],
  [39.916199, -82.96011],
  [39.916189, -82.96039],
  [39.916179, -82.960649],
  [39.91616, -82.96097],
  [39.916109, -82.96161],
  [39.91595, -82.963349],
  [39.915839, -82.96454],
  [39.91581, -82.964959],
  [39.9158, -82.96543],
  [39.91579, -82.965949],
  [39.9158, -82.9665],
  [39.915849, -82.96723],
  [39.915899, -82.967799],
  [39.91598, -82.968429],
  [39.91604, -82.968829],
  [39.91607, -82.96907],
  [39.916259, -82.970179],
  [39.916369, -82.97088],
  [39.91643, -82.971309],
  [39.916549, -82.972079],
  [39.91679, -82.97371],
  [39.91686, -82.9743],
  [39.91687, -82.974409],
  [39.916899, -82.97466],
  [39.916929, -82.97507],
  [39.91696, -82.975539],
  [39.91697, -82.97622],
  [39.91697, -82.976289],
  [39.91696, -82.97672],
  [39.91695, -82.977249],
  [39.916919, -82.97763],
  [39.916899, -82.97793],
  [39.916839, -82.978419],
  [39.916709, -82.97933],
  [39.916639, -82.9797],
  [39.916549, -82.98014],
  [39.91634, -82.980989],
  [39.915919, -82.98244],
  [39.915489, -82.98389],
  [39.91534, -82.984389],
  [39.91525, -82.98468],
  [39.915109, -82.98513],
  [39.915029, -82.985379],
  [39.91496, -82.985609],
  [39.91487, -82.985879],
  [39.914749, -82.98631],
  [39.914739, -82.98635],
  [39.91469, -82.98663],
  [39.914669, -82.98672],
  [39.914649, -82.98685],
  [39.91461, -82.98708],
  [39.9146, -82.987199],
  [39.914569, -82.987459],
  [39.914559, -82.98779],
  [39.914569, -82.98816],
  [39.914579, -82.988349],
  [39.91461, -82.988639],
  [39.914679, -82.989079],
  [39.91473, -82.98932],
  [39.91479, -82.98956],
  [39.914859, -82.98983],
  [39.91499, -82.990249],
  [39.915109, -82.99063],
  [39.91526, -82.99107],
  [39.91552, -82.991649],
  [39.915819, -82.99234],
  [39.915899, -82.992539],
  [39.916029, -82.99279],
  [39.91615, -82.99297],
  [39.91624, -82.993089],
  [39.91641, -82.993219],
  [39.916539, -82.99329],
  [39.916809, -82.993389],
  [39.916899, -82.99343],
  [39.91704, -82.993529],
  [39.91715, -82.993619],
  [39.91724, -82.99373],
  [39.91731, -82.99388],
  [39.917369, -82.9941],
  [39.9174, -82.99427],
  [39.91741, -82.99441],
  [39.91742, -82.994709],
  [39.917429, -82.995369],
  [39.917979, -82.995369],
  [39.91804, -82.995369],
  [39.918439, -82.99536],
  [39.91874, -82.995369],
  [39.91886, -82.995369],
  [39.91896, -82.995369],
  [39.919069, -82.995369],
  [39.919169, -82.995369],
  [39.9193, -82.995369],
  [39.91986, -82.99539],
  [39.92118, -82.99541],
  [39.921419, -82.99541],
  [39.921659, -82.995419],
  [39.921759, -82.995429],
  [39.921859, -82.995429],
  [39.921929, -82.995429],
  [39.92236, -82.995429],
  [39.92254, -82.995429],
  [39.92282, -82.995429],
  [39.922859, -82.995429],
  [39.92292, -82.995429],
  [39.9231, -82.995429],
  [39.92333, -82.99544],
  [39.923479, -82.99544],
  [39.92378, -82.995459],
  [39.92382, -82.995459],
  [39.92399, -82.995469],
  [39.92427, -82.99548],
  [39.924559, -82.9955],
  [39.92469, -82.995509],
  [39.924929, -82.995519],
  [39.92513, -82.99553],
  [39.92531, -82.99554],
  [39.925529, -82.995549],
  [39.925729, -82.99557],
  [39.925889, -82.99557],
  [39.92632, -82.995599],
  [39.92738, -82.995649],
  [39.92769, -82.99566],
  [39.927799, -82.99567],
  [39.92813, -82.995689],
  [39.928249, -82.995699],
  [39.92848, -82.99571],
  [39.929529, -82.99577],
  [39.930209, -82.99581],
  [39.93028, -82.99581],
  [39.930489, -82.995819],
  [39.930679, -82.995829],
  [39.93147, -82.995869],
  [39.932039, -82.99589],
  [39.932479, -82.995909],
  [39.932919, -82.995929],
  [39.933219, -82.99595],
  [39.93327, -82.99595],
  [39.93332, -82.99595],
  [39.93342, -82.995959],
  [39.933479, -82.995959],
  [39.93351, -82.995959],
  [39.933659, -82.995969],
  [39.933829, -82.99598],
  [39.933899, -82.99598],
  [39.93398, -82.99598],
  [39.934079, -82.99599],
  [39.93424, -82.995999],
  [39.934439, -82.996009],
  [39.93486, -82.99603],
  [39.93522, -82.996049],
  [39.935619, -82.996059],
  [39.93575, -82.996059],
  [39.935919, -82.99607],
  [39.93603, -82.99607],
  [39.93678, -82.996109],
  [39.93684, -82.996109],
  [39.937329, -82.996099],
  [39.93775, -82.996099],
  [39.938079, -82.99612],
  [39.938339, -82.99613],
  [39.93846, -82.996139],
  [39.938499, -82.996139],
  [39.93865, -82.996149],
  [39.93892, -82.99616],
  [39.939069, -82.99616],
  [39.93955, -82.996229],
  [39.939779, -82.996279],
  [39.939869, -82.9963],
  [39.940059, -82.99634],
  [39.94028, -82.996379],
  [39.940499, -82.99644],
  [39.940599, -82.996459],
  [39.940669, -82.99648],
  [39.94073, -82.99649],
  [39.94091, -82.99653],
  [39.941039, -82.996559],
  [39.941499, -82.996649],
  [39.941849, -82.996719],
  [39.941939, -82.996739],
  [39.942019, -82.99676],
  [39.942719, -82.99689],
  [39.94316, -82.99698],
  [39.943279, -82.996999],
  [39.94349, -82.997039],
  [39.943709, -82.997079],
  [39.94386, -82.99711],
  [39.94396, -82.997129],
  [39.94407, -82.99715],
  [39.94467, -82.997269],
  [39.945159, -82.997359],
  [39.94547, -82.99742],
  [39.94568, -82.997459],
  [39.945899, -82.997499],
  [39.94612, -82.997539],
  [39.94628, -82.99757],
  [39.94658, -82.997629],
  [39.94694, -82.9977],
  [39.94709, -82.997729],
  [39.947589, -82.99783],
  [39.947859, -82.99788],
  [39.948119, -82.99793],
  [39.948329, -82.99797],
  [39.948499, -82.99801],
  [39.948599, -82.998029],
  [39.94875, -82.99806],
  [39.948959, -82.9981],
  [39.949059, -82.998119],
  [39.94925, -82.998159],
  [39.949589, -82.998219],
  [39.94988, -82.99828],
  [39.950479, -82.998399],
  [39.95078, -82.99846],
  [39.95108, -82.99851],
  [39.9517, -82.998609],
  [39.952289, -82.998709],
  [39.95258, -82.998759],
  [39.952749, -82.998789],
  [39.95297, -82.998839],
  [39.953099, -82.99886],
  [39.95348, -82.998939],
  [39.953719, -82.998989],
  [39.95406, -82.999059],
  [39.954349, -82.999109],
  [39.95466, -82.999169],
  [39.954809, -82.999199],
  [39.955089, -82.999259],
  [39.955449, -82.999339],
  [39.95558, -82.99937],
  [39.956169, -82.999519],
  [39.956249, -82.998749],
  [39.95627, -82.998569],
  [39.95629, -82.99838],
  [39.956309, -82.998179],
  [39.956329, -82.998029],
  [39.95638, -82.997579],
  [39.95639, -82.99751],
  [39.956399, -82.997359],
  [39.95646, -82.996819],
  [39.956499, -82.996459],
  [39.95656, -82.99594],
  [39.95666, -82.995069],
  [39.957319, -82.995189],
  [39.95799, -82.99532],
  [39.958859, -82.995509],
  [39.958939, -82.99553],
  [39.959299, -82.995599],
  [39.959999, -82.995729],
  [39.960659, -82.995869],
  [39.961269, -82.99598],
  [39.96131, -82.99599],
  [39.96141, -82.996009],
  [39.96168, -82.996059],
  [39.96178, -82.99608],
  [39.962009, -82.99613],
  [39.962719, -82.996229],
  [39.96297, -82.996279],
  [39.963439, -82.996369],
  [39.96413, -82.996499],
  [39.964779, -82.99661],
  [39.965499, -82.996739],
  [39.965849, -82.996809],
  [39.966, -82.99684],
  [39.96611, -82.996859],
  [39.966319, -82.996899],
  [39.966489, -82.99693],
  [39.96654, -82.99694],
  [39.966779, -82.996989],
  [39.966759, -82.997309],
  [39.96673, -82.99751],
  [39.966679, -82.997899],
  [39.96665, -82.998169],
  [39.966589, -82.99877],
  [39.96656, -82.99909],
  [39.966509, -82.99953],
  [39.96644, -83.000189],
  [39.966399, -83.00052],
  [39.966339, -83.001009],
  [39.96629, -83.00142],
  [39.96617, -83.00233],
  [39.966139, -83.00259],
  [39.965579, -83.00247]
];

const stopNames = {
  "NORTER5": "SPRING ST TERMINAL BAY 5",
  "4THTOWN": "S 4TH ST &amp; E TOWN ST",
  "MAIHIGE": "E MAIN ST &amp; S HIGH ST",
  "4THATHN": "N 4TH ST &amp; E GAY ST",
  "HIGMOUN": "S HIGH ST &amp; E MOUND ST",
  "SPR4THW": "E SPRING ST &amp; N 4TH ST",
  "4THCAPN": "S 4TH ST &amp; E CAPITAL ST",
  "CANWIPR": "CANAL WINCHESTER PARK &amp; RIDE"
};

const stops = [
  { stop_id: "CANWIPR", name: "CANAL WINCHESTER PARK &amp; RIDE", lat: 39.860402, lon: -82.825778, times: ["6:42 AM"] },
  { stop_id: "HIGMOUN", name: "S HIGH ST &amp; E MOUND ST", lat: 39.954203, lon: -82.998985, times: ["7:08 AM"] },
  { stop_id: "MAIHIGE", name: "E MAIN ST &amp; S HIGH ST", lat: 39.956175, lon: -82.998467, times: ["7:09 AM"] },
  { stop_id: "4THTOWN", name: "S 4TH ST &amp; E TOWN ST", lat: 39.958965, lon: -82.995424, times: ["7:10 AM"] },
  { stop_id: "4THCAPN", name: "S 4TH ST &amp; E CAPITAL ST", lat: 39.961951, lon: -82.995987, times: ["7:12 AM"] },
  { stop_id: "4THATHN", name: "N 4TH ST &amp; E GAY ST", lat: 39.963808, lon: -82.996336, times: ["7:12 AM"] },
  { stop_id: "SPR4THW", name: "E SPRING ST &amp; N 4TH ST", lat: 39.966769, lon: -82.997738, times: ["7:13 AM"] },
  { stop_id: "NORTER5", name: "SPRING ST TERMINAL BAY 5", lat: 39.96563, lon: -83.002372, times: ["7:15 AM"] },
]

  const polylineOut = L.polyline(shapeOutbound, {
    color: 'blue',
    weight: 4,
    opacity: 0.7
  }).addTo(map);

  map.fitBounds(polylineOut.getBounds());

  stops.forEach(stop => {
    const marker = L.circleMarker([stop.lat, stop.lon], {
      radius: 6,
      color: '#4dd0e1',
      fillColor: '#4dd0e1',
      fillOpacity: 0.9,
      weight: 1
    });

    const popupContent = `
      <strong>${stop.name}</strong><br>
      ${stop.times && stop.times.length ? stop.times.join("<br>") : "No scheduled times"}
    `;

    marker.bindPopup(popupContent);
    marker.addTo(map);
  });

  let busMarkers = {};

  async function fetchAndDisplay() {
    const res = await fetch(`https://developer.trimet.org/ws/v2/vehicles?route=${routeNumber}&appID=${apiKey}&json=true`);
    const data = await res.json();
    const buses = (data.resultSet.vehicle || []).filter(v =>
      v.routeNumber == routeNumber && v.direction == direction
    );

    Object.values(busMarkers).forEach(m => map.removeLayer(m));
    busMarkers = {};

    if (buses.length === 0) return;

    buses.forEach(bus => {
      if (!bus.latitude || !bus.longitude || !bus.blockID) return;

      const icon = L.divIcon({
        className: '',
        html: `
          <div style="text-align:center;">
            <div style="background:#0071CE;color:#fff;padding:2px 6px;border-radius:6px;font-weight:bold;">${bus.vehicleID}</div>
            <div style="width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-top:10px solid #00bfff;margin:auto;"></div>
          </div>
        `,
        iconSize: [40, 30],
        iconAnchor: [20, 30]
      });

      const marker = L.marker([bus.latitude, bus.longitude], { icon }).addTo(map);
      busMarkers[bus.vehicleID] = marker;
    });
  }

  fetchAndDisplay();
  setInterval(fetchAndDisplay, 15000);
  </script>

<footer class="site-footer">
  <a href="terms.html">Terms of Use</a> &nbsp;|&nbsp;
  <a href="contact.html">Contact Us</a> &nbsp;|&nbsp;
  <a href="report.html">Report a Problem</a> &nbsp;|&nbsp;
  <a href="privacy.html">Privacy Policy</a>
</footer>

<div id="cookie-banner" style="display: none; position: fixed; bottom: 0; width: 100%; background: #333; color: #fff; text-align: center; padding: 1rem; z-index: 1000; font-size: 0.9rem;">
  üì¢ We use cookies for personalized ads and analytics. By using MetroFeed, you agree to our 
  <a href="privacy.html" style="color: #4dd0e1; text-decoration: underline;">Privacy Policy</a>.
  <button onclick="acceptCookies()" style="margin-left: 1rem; background: #4dd0e1; color: #000; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer;">OK</button>
</div>

<script>
  function acceptCookies() {
    localStorage.setItem('cookieConsent', 'true');
    document.getElementById('cookie-banner').style.display = 'none';
  }

  window.onload = function() {
    if (!localStorage.getItem('cookieConsent')) {
      document.getElementById('cookie-banner').style.display = 'block';
    }
  }
</script>


</body>
</html>