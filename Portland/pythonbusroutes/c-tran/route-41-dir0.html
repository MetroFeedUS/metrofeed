<!DOCTYPE html>
<html lang="en">
<head>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EL337T4JX4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-EL337T4JX4');
</script>

<meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Route 41 - Direction 0 | MetroFeed Portland</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #0d0d0d;
      color: #cccccc;
      overflow-y: auto;
    }

    body {
      padding-top: 120px;
    }

    .ad-banner {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: #222;
      padding: 0;
      z-index: 1000;
      box-shadow: 0 2px 2px rgba(0,0,0,0.5);
      text-align: center;
    }

    .ad-banner img {
      width: 100%;
      max-width: 728px;
      max-height: 120px;
      display: block;
      margin: 0 auto;
    }
    .home-button {
      position: fixed;
      top: 120px;
      left: 10px;
      background-color: #4dd0e1;
      color: #0d0d0d;
      padding: 0.5rem 1rem;
      font-weight: bold;
      border-radius: 8px;
      text-decoration: none;
      z-index: 1001;
      box-shadow: 0 0 10px #4dd0e1;
    }

    .home-button:hover {
      background-color: #00bcd4;
      color: #ffffff;
    }

    header {
      background-color: #0d0d0d;
      border-top: 4px solid #4dd0e1;
      border-bottom: 3px solid #4dd0e1;
      padding: 1rem;
      text-align: center;
    }

    header img {
      max-height: 60px;
    }

    h1 {
      text-align: center;
      margin: 1rem 0;
      font-size: 2rem;
      color: #f0f0f0;
    }

    .content-box {
      border-radius: 12px;
      padding: 0;
      margin: 0;
      background-color: #1e1e1e;
    }

    #map {
      width: 100%;
      height: 85vh;
      border: none;
      margin: 0 auto;
      display: block;
      border-radius: 8px;
    }

    .button-bar {
      display: flex;
      justify-content: center;
      margin: 1rem 0;
    }

    .button-bar a, .back-button {
      background: #4dd0e1;
      color: #0d0d0d;
      padding: 0.6rem 1.2rem;
      text-decoration: none;
      border-radius: 8px;
      font-weight: bold;
      border: none;
      cursor: pointer;
      box-shadow: 0 0 10px #4dd0e1;
    }

    .back-button:hover {
      background-color: #35c0d6;
    }

    .site-footer {
      text-align: center;
      margin-top: 3rem;
      margin-bottom: 120px;
      font-size: 0.85rem;
      color: #aaa;
    }

    .site-footer a {
      color: #00BFFF;
      text-decoration: none;
    }

    .site-footer a:hover {
      text-decoration: underline;
    }

    @media (max-width: 600px) {
      .ad-banner {
        padding-top: 1rem;
        padding-bottom: 0rem;
      }
    }
  </style>
</head>

<body>
  <div class="ad-banner">
    <iframe src="https://metrofeedus.com/portland/Ads/route-41-dir0-ad.html" style="border:none; width:100%; max-width: 728px; height:90px;"></iframe>
  </div>

  <header>
    <img src="MetroFeedPortlandLogo.png" alt="MetroFeed Portland">
  </header>

  <div class="disclaimer" style="margin: 1rem auto 0.5rem; max-width: 600px; font-size: 0.8rem; color: #bbb; text-align: center; padding: 0.5rem 1rem; background-color: #111; border: 1px dashed #444; border-radius: 6px;">
    ⚠️ This is a Beta program, work in progress. Please REPORT bugs and pretend to be impressed.
  </div>
  <div class="disclaimer" style="margin: 0 auto 1rem; max-width: 600px; font-size: 0.75rem; color: #888; text-align: center; padding: 0.25rem 1rem;">
    This tool is not affiliated with or endorsed by TriMet. For official schedules and service alerts, visit <a href="https://trimet.org" style="color:#4dd0e1;">trimet.org</a>.
  </div>

  <div style="margin: 2rem 0; text-align: center;">
    <button class="back-button" onclick="history.back()">Back</button>
  </div>

  <h1>Route 41 - Direction 0</h1>

  <div class="content-box">
    <div id="map"></div>
    <div style="text-align:right; font-size: 0.7rem; color: #777; margin-top: 0.5rem;">
      Data courtesy of TriMet.
    </div>
  </div>

  <script>
    if (document.referrer === "" && performance.navigation.type === 0) {
      window.location.href = "/index.html";
    }

    const apiKey = "2C4447D4A42083BCD84DE3B8E";
    const routeNumber = 41;
    const direction = parseInt(0);

    const map = L.map('map', {
      center: [45.6, -122.7],
      zoom: 12,
      minZoom: 12,
      maxZoom: 18,
      maxBounds: [[45.3, -123.1], [45.9, -122.3]],
      maxBoundsViscosity: 1.0
    });
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);

    const shapeOutbound = [
  [45.57316530337289, -122.32156355344314],
  [45.57317, -122.321725],
  [45.573182, -122.32187299999998],
  [45.573208, -122.322008],
  [45.573222, -122.322048],
  [45.573245, -122.322109],
  [45.573305, -122.32224399999998],
  [45.573392, -122.32241299999998],
  [45.573419, -122.322458],
  [45.573459, -122.32254099999999],
  [45.573487, -122.322598],
  [45.573705, -122.32303899999998],
  [45.573755, -122.323162],
  [45.573779, -122.32327499999998],
  [45.573793, -122.32339899999998],
  [45.573785, -122.323507],
  [45.573775, -122.32360499999999],
  [45.573751, -122.323709],
  [45.573716, -122.32383299999998],
  [45.573648, -122.32397199999998],
  [45.573579, -122.32408499999998],
  [45.573489, -122.32423099999998],
  [45.573426, -122.32435199999999],
  [45.573365, -122.32448999999998],
  [45.573328, -122.32463199999998],
  [45.573317, -122.324716],
  [45.573318, -122.324807],
  [45.573329, -122.32497099999999],
  [45.573354, -122.325165],
  [45.573384, -122.32534999999999],
  [45.573406, -122.32551199999999],
  [45.573603698250565, -122.32689505004953],
  [45.57360369827403, -122.32689505021368],
  [45.573642, -122.32716300000001],
  [45.573672, -122.327331],
  [45.573723, -122.327475],
  [45.573782, -122.32759500000002],
  [45.573881, -122.32770300000001],
  [45.573973, -122.32777200000001],
  [45.574009, -122.32779500000001],
  [45.574101, -122.32785300000002],
  [45.574214, -122.32791100000001],
  [45.574284, -122.32796800000001],
  [45.574337, -122.32803800000002],
  [45.574381, -122.32811900000002],
  [45.574427, -122.32822300000001],
  [45.574459, -122.328353],
  [45.574482, -122.328474],
  [45.574499, -122.328558],
  [45.574533389746584, -122.32879509353742],
  [45.57453338982289, -122.32879509406347],
  [45.574622, -122.32940599999999],
  [45.574638, -122.32954899999999],
  [45.574635, -122.329687],
  [45.574612, -122.329838],
  [45.574567, -122.329968],
  [45.5745, -122.330084],
  [45.574424, -122.33019299999998],
  [45.574339, -122.330297],
  [45.574266, -122.33043699999999],
  [45.574212, -122.33061199999999],
  [45.574189, -122.33079499999998],
  [45.574189, -122.33091699999999],
  [45.574206, -122.33106199999999],
  [45.574227, -122.331206],
  [45.57424067866586, -122.33129909092042],
  [45.57424067864528, -122.33129909078042],
  [45.574263, -122.33145100000002],
  [45.574321, -122.33185800000001],
  [45.574466, -122.33289200000002],
  [45.574553, -122.33342500000002],
  [45.57458, -122.33355100000001],
  [45.574616, -122.333648],
  [45.574659, -122.333717],
  [45.574712, -122.33380100000001],
  [45.574772, -122.33386000000002],
  [45.574818, -122.333913],
  [45.574869, -122.33395100000001],
  [45.574955, -122.333989],
  [45.575046, -122.33400000000002],
  [45.575136, -122.33400500000002],
  [45.575241, -122.334008],
  [45.575325, -122.334021],
  [45.575343509476625, -122.33402524175506],
  [45.575373, -122.33403200000001],
  [45.575447, -122.334066],
  [45.575515, -122.334112],
  [45.575575, -122.33417400000002],
  [45.575611, -122.33421200000001],
  [45.575652, -122.334275],
  [45.575708, -122.33439999999999],
  [45.575741, -122.334512],
  [45.575772, -122.334661],
  [45.575787, -122.334793],
  [45.575815, -122.33505900000002],
  [45.575857, -122.335486],
  [45.575974, -122.336669],
  [45.575996, -122.33692400000001],
  [45.576691, -122.336925],
  [45.57735, -122.336912],
  [45.57756724088007, -122.3387478142355],
  [45.57756724103402, -122.33874781553645],
  [45.577603, -122.33905000000001],
  [45.577717, -122.34015400000001],
  [45.577887, -122.34164100000001],
  [45.5779134090805, -122.34189512511428],
  [45.57791340910797, -122.34189512537863],
  [45.578046, -122.343171],
  [45.578111, -122.34377600000002],
  [45.578254, -122.34504000000001],
  [45.57843137096246, -122.34653537365274],
  [45.57843137098715, -122.34653537386086],
  [45.578449, -122.34668400000001],
  [45.578467, -122.347125],
  [45.57847, -122.34751000000001],
  [45.578475, -122.34839],
  [45.57847892007643, -122.34900780404476],
  [45.57847892007646, -122.34900780405106],
  [45.57848, -122.349178],
  [45.578484, -122.350123],
  [45.579196, -122.35009],
  [45.579189, -122.351049],
  [45.579179, -122.35182000000002],
  [45.579195, -122.35279199999998],
  [45.579213, -122.353813],
  [45.57921859294246, -122.35411408673573],
  [45.579218592943974, -122.35411408681684],
  [45.579231, -122.35478199999999],
  [45.578511, -122.35482499999999],
  [45.578516, -122.35525699999998],
  [45.578522, -122.355789],
  [45.578246, -122.355789],
  [45.577816, -122.35579999999999],
  [45.577472, -122.35582899999999],
  [45.5774, -122.35583799999999],
  [45.577338, -122.35585],
  [45.577258, -122.35588299999999],
  [45.577159, -122.35593699999998],
  [45.576891, -122.35609599999998],
  [45.576896, -122.356124],
  [45.576898, -122.356152],
  [45.576898, -122.356183],
  [45.576893, -122.35621799999998],
  [45.576886, -122.35624999999999],
  [45.576878, -122.356275],
  [45.57686, -122.35631199999999],
  [45.576842, -122.35633999999999],
  [45.576825, -122.356358],
  [45.576807, -122.356375],
  [45.576783, -122.356389],
  [45.576845, -122.356613],
  [45.576928, -122.357019],
  [45.577007, -122.35732699999998],
  [45.577072, -122.357536],
  [45.577182, -122.35793],
  [45.577311, -122.35856],
  [45.577506, -122.359569],
  [45.577698, -122.36074],
  [45.578047, -122.36298799999999],
  [45.578378, -122.365155],
  [45.578629, -122.36672199999998],
  [45.578826, -122.36787899999999],
  [45.578904, -122.368109],
  [45.579075, -122.36878299999998],
  [45.579287, -122.36957699999999],
  [45.57942, -122.37005],
  [45.579738, -122.37093899999999],
  [45.580044, -122.37183699999999],
  [45.580172, -122.37227699999998],
  [45.580292, -122.37270899999999],
  [45.580439, -122.373331],
  [45.580547, -122.373974],
  [45.580626, -122.374643],
  [45.580713, -122.37549899999999],
  [45.580761, -122.37621899999999],
  [45.580779, -122.377055],
  [45.580787, -122.37717199999999],
  [45.580794, -122.377286],
  [45.580813, -122.377369],
  [45.580862, -122.377451],
  [45.580899, -122.37749],
  [45.580959, -122.37756999999999],
  [45.580978, -122.37756599999999],
  [45.580998, -122.37756599999999],
  [45.581018, -122.37756799999998],
  [45.581037, -122.37757399999998],
  [45.581055, -122.377582],
  [45.581088, -122.377613],
  [45.581117, -122.377647],
  [45.58114, -122.37768599999998],
  [45.581157, -122.377728],
  [45.581167, -122.37777199999998],
  [45.581171, -122.377817],
  [45.581168, -122.37786199999998],
  [45.581159, -122.37790599999998],
  [45.581143, -122.37794799999999],
  [45.581134, -122.37797199999999],
  [45.581121, -122.37799499999998],
  [45.581105, -122.37801499999999],
  [45.581086, -122.37803299999999],
  [45.581067, -122.378046],
  [45.58104, -122.378058],
  [45.581015, -122.378064],
  [45.58099, -122.37806699999999],
  [45.580964, -122.378066],
  [45.580938, -122.3783],
  [45.580899, -122.37858999999999],
  [45.580832, -122.378856],
  [45.580807, -122.378969],
  [45.580796, -122.379077],
  [45.580788, -122.379203],
  [45.580788, -122.37939499999999],
  [45.580788, -122.379615],
  [45.580795, -122.379833],
  [45.580799, -122.37996699999998],
  [45.580847, -122.382394],
  [45.580868, -122.38556599999998],
  [45.580893, -122.385569],
  [45.580917, -122.38557599999999],
  [45.58094, -122.38558699999999],
  [45.580962, -122.385601],
  [45.58098, -122.38561899999999],
  [45.580996, -122.385639],
  [45.581008, -122.385662],
  [45.581016, -122.38568599999999],
  [45.581015, -122.38570399999999],
  [45.581022, -122.385737],
  [45.5821, -122.38552799999998],
  [45.582465, -122.38543799999998],
  [45.582518, -122.385436],
  [45.582582, -122.385449],
  [45.582647, -122.38547799999999],
  [45.58271, -122.38552399999999],
  [45.582756, -122.385575],
  [45.582829, -122.38569699999998],
  [45.582869, -122.385827],
  [45.582903, -122.385992],
  [45.582921, -122.38618599999998],
  [45.582933, -122.38639399999998],
  [45.583026, -122.38743099999999],
  [45.583116, -122.388437],
  [45.58335, -122.390894],
  [45.583452, -122.39218499999998],
  [45.583583, -122.393395],
  [45.583725, -122.394494],
  [45.583796, -122.395083],
  [45.583862, -122.395613],
  [45.583882, -122.395768],
  [45.583931, -122.39616699999999],
  [45.584083, -122.39758499999999],
  [45.584103, -122.39777299999999],
  [45.584127, -122.398024],
  [45.584145, -122.398204],
  [45.584164, -122.39843199999999],
  [45.584177, -122.398809],
  [45.584191, -122.399151],
  [45.584198, -122.39935899999999],
  [45.584197, -122.399563],
  [45.584189, -122.399767],
  [45.584192, -122.399975],
  [45.584196, -122.40007699999998],
  [45.58419, -122.400194],
  [45.584191, -122.40031599999999],
  [45.584184, -122.400441],
  [45.58419, -122.40054999999998],
  [45.584196, -122.40062699999999],
  [45.58421, -122.40073499999998],
  [45.584233, -122.400843],
  [45.584264, -122.40095199999999],
  [45.584293, -122.401038],
  [45.58432, -122.401113],
  [45.584361, -122.40120699999999],
  [45.584408, -122.401285],
  [45.58446, -122.401359],
  [45.584517, -122.401432],
  [45.584554, -122.40148599999999],
  [45.584899, -122.401849],
  [45.585075, -122.402034],
  [45.585684, -122.40266499999998],
  [45.585246, -122.40349899999998],
  [45.584805, -122.404352],
  [45.58444, -122.405049],
  [45.58437, -122.405194],
  [45.584465, -122.405296],
  [45.584967, -122.405832],
  [45.585546, -122.40645399999998],
  [45.58581164223949, -122.40672626123217],
  [45.5858116503359, -122.40672626953031],
  [45.586148, -122.407071],
  [45.586024, -122.40731900000002],
  [45.585712, -122.40791200000001],
  [45.585621, -122.408089],
  [45.585549, -122.40824],
  [45.585469, -122.408383],
  [45.585381, -122.40855200000001],
  [45.585309, -122.40870000000001],
  [45.585234, -122.408853],
  [45.585187, -122.40896600000002],
  [45.58514, -122.40907700000001],
  [45.585099, -122.4092],
  [45.585072, -122.40927900000001],
  [45.585027, -122.409493],
  [45.585001, -122.409635],
  [45.584984, -122.409812],
  [45.584978, -122.409906],
  [45.584974, -122.409998],
  [45.584974, -122.410109],
  [45.585015, -122.41079500000001],
  [45.585027, -122.41100800000001],
  [45.585039, -122.41115000000002],
  [45.585062, -122.411433],
  [45.585073, -122.41164700000002],
  [45.585096, -122.411899],
  [45.585105, -122.412057],
  [45.585108, -122.412228],
  [45.585108, -122.41237300000002],
  [45.585099, -122.41256000000001],
  [45.585081, -122.41271900000001],
  [45.585062, -122.412888],
  [45.58505033830973, -122.41297429650801],
  [45.58505033826097, -122.4129742968688],
  [45.585027, -122.413147],
  [45.585006, -122.41325],
  [45.584845, -122.414141],
  [45.584499, -122.415972],
  [45.583755, -122.419602],
  [45.583597, -122.42027100000001],
  [45.583480823974966, -122.42073407926061],
  [45.5834808235698, -122.42073408087565],
  [45.583454, -122.420841],
  [45.583354, -122.421254],
  [45.583148, -122.42226199999999],
  [45.582897, -122.423401],
  [45.58265916969212, -122.42444141076055],
  [45.58265916952425, -122.4244414114949],
  [45.58259, -122.42474399999999],
  [45.582413, -122.42558399999999],
  [45.582217, -122.426584],
  [45.582274, -122.426625],
  [45.58232, -122.42670199999999],
  [45.582348, -122.426785],
  [45.58235, -122.426895],
  [45.58232, -122.42696899999999],
  [45.582277, -122.427035],
  [45.582217, -122.42706699999998],
  [45.582167, -122.42707199999998],
  [45.582142, -122.427075],
  [45.582118, -122.427465],
  [45.582029, -122.42804599999998],
  [45.581877, -122.428901],
  [45.581761, -122.429447],
  [45.581505, -122.43055999999999],
  [45.581315, -122.431416],
  [45.580968, -122.432959],
  [45.580752, -122.433869],
  [45.58046, -122.43493499999998],
  [45.580301, -122.435563],
  [45.578955, -122.441274],
  [45.578803, -122.441995],
  [45.578712, -122.442567],
  [45.578638, -122.443198],
  [45.578583, -122.44416799999999],
  [45.578565, -122.444777],
  [45.578586, -122.445541],
  [45.578646, -122.446306],
  [45.578746, -122.447072],
  [45.578836, -122.447605],
  [45.578962, -122.44818799999999],
  [45.579168, -122.449051],
  [45.579896, -122.45204699999998],
  [45.580355, -122.453975],
  [45.580712, -122.45526],
  [45.581583, -122.45810799999998],
  [45.582069, -122.459734],
  [45.582581, -122.46147],
  [45.583493, -122.464503],
  [45.583745, -122.46541],
  [45.583918, -122.46608],
  [45.584158, -122.46720099999999],
  [45.584218, -122.467478],
  [45.584388, -122.468531],
  [45.584436, -122.46885199999998],
  [45.584494, -122.46929999999999],
  [45.584523, -122.469547],
  [45.584549, -122.469751],
  [45.584593, -122.470124],
  [45.584633, -122.47050799999998],
  [45.58499, -122.47357899999999],
  [45.585108, -122.47465999999999],
  [45.585217, -122.4756],
  [45.585251, -122.47589499999998],
  [45.585318, -122.47649799999999],
  [45.585387, -122.47708199999998],
  [45.585435, -122.477451],
  [45.585468, -122.47769999999998],
  [45.585601, -122.478419],
  [45.585759, -122.47922],
  [45.585912, -122.48000599999999],
  [45.586251, -122.481375],
  [45.586619, -122.482597],
  [45.587131, -122.484299],
  [45.587255, -122.484808],
  [45.587465, -122.485689],
  [45.587476, -122.485734],
  [45.587493, -122.485826],
  [45.58762, -122.486498],
  [45.587789, -122.48740199999999],
  [45.587912, -122.488234],
  [45.588042, -122.489188],
  [45.588045, -122.489219],
  [45.588176, -122.490196],
  [45.588299, -122.49094099999999],
  [45.588461, -122.49167699999998],
  [45.58877, -122.492867],
  [45.589122, -122.494132],
  [45.589519, -122.495553],
  [45.590047, -122.497494],
  [45.590714, -122.499493],
  [45.590954, -122.500264],
  [45.591108, -122.500735],
  [45.591435, -122.501656],
  [45.591963, -122.50288299999998],
  [45.592036, -122.503113],
  [45.592075, -122.503297],
  [45.592115, -122.50348199999999],
  [45.592149, -122.50364399999998],
  [45.592182, -122.503871],
  [45.594216, -122.503867],
  [45.594207, -122.50431099999999],
  [45.594203, -122.50437399999998],
  [45.594194, -122.50441899999998],
  [45.59418, -122.50446499999998],
  [45.594163, -122.504503],
  [45.594145, -122.504548],
  [45.594105, -122.50465],
  [45.594096, -122.504681],
  [45.59409, -122.504713],
  [45.594089, -122.504747],
  [45.594091, -122.50477999999998],
  [45.594097, -122.504806],
  [45.594133, -122.504891],
  [45.594368, -122.505428],
  [45.59458029443224, -122.50595072496995]
];

const stopNames = {
  "2345": "Addy St 3900 Block",
  "2347": "Addy St 3500 Block",
  "2346": "Addy St 3700 Block",
  "1178": "C St &amp; Pendleton",
  "2348": "Addy St 3300 Block",
  "1176": "Main St &amp; 24th St",
  "6046": "E 15th St &amp; Broadway",
  "2125": "NW 6th Ave 400 Block",
  "9008": "Fisher&#x27;s Landing Transit Center: Bay I",
  "9001": "Fisher&#x27;s Landing Transit Center: Bay B",
  "2353": "Main &amp; 22nd St",
  "579": "Washington &amp; 13th St",
  "252": "Addy St &amp; Addy Loop",
  "964": "NW 6th Ave &amp; Norwood",
  "963": "NW 6th Ave &amp; Ivy",
  "6053": "Washington &amp; 9th St",
  "2350": "Main St 3000 Block",
  "2351": "Main &amp; 28th St",
  "3385": "Adams &amp; 5th Ave"
};

const stops = [
  { stop_id: "252", name: "Addy St &amp; Addy Loop", lat: 45.573242, lon: -122.321559, times: ["6:50 AM", "7:20 AM", "8:01 AM", "5:47 PM", "6:15 PM"] },
  { stop_id: "2345", name: "Addy St 3900 Block", lat: 45.573669, lon: -122.326876, times: ["6:50 AM", "7:20 AM", "8:01 AM", "5:47 PM", "6:15 PM"] },
  { stop_id: "2346", name: "Addy St 3700 Block", lat: 45.574581, lon: -122.328781, times: ["6:51 AM", "7:21 AM", "8:02 AM", "5:48 PM", "6:16 PM"] },
  { stop_id: "2347", name: "Addy St 3500 Block", lat: 45.574291, lon: -122.331284, times: ["6:51 AM", "7:21 AM", "8:02 AM", "5:48 PM", "6:16 PM"] },
  { stop_id: "2348", name: "Addy St 3300 Block", lat: 45.575356, lon: -122.333914, times: ["6:52 AM", "7:22 AM", "8:03 AM", "5:49 PM", "6:17 PM"] },
  { stop_id: "2350", name: "Main St 3000 Block", lat: 45.577641, lon: -122.33873, times: ["6:53 AM", "7:23 AM", "8:04 AM", "5:50 PM", "6:18 PM"] },
  { stop_id: "2351", name: "Main &amp; 28th St", lat: 45.57798, lon: -122.341881, times: ["6:53 AM", "7:23 AM", "8:04 AM", "5:50 PM", "6:18 PM"] },
  { stop_id: "1176", name: "Main St &amp; 24th St", lat: 45.578499, lon: -122.346519, times: ["6:54 AM", "7:24 AM", "8:05 AM", "5:51 PM", "6:19 PM"] },
  { stop_id: "2353", name: "Main &amp; 22nd St", lat: 45.578541, lon: -122.349007, times: ["6:54 AM", "7:24 AM", "8:05 AM", "5:51 PM", "6:19 PM"] },
  { stop_id: "1178", name: "C St &amp; Pendleton", lat: 45.5793, lon: -122.354111, times: ["6:55 AM", "7:25 AM", "8:06 AM", "5:52 PM", "6:20 PM"] },
  { stop_id: "3385", name: "Adams &amp; 5th Ave", lat: 45.585866, lon: -122.406618, times: ["7:04 AM", "7:34 AM", "8:16 AM", "6:02 PM", "6:29 PM"] },
  { stop_id: "2125", name: "NW 6th Ave 400 Block", lat: 45.585129, lon: -122.412996, times: ["7:04 AM", "7:34 AM", "8:16 AM", "6:02 PM", "6:29 PM"] },
  { stop_id: "963", name: "NW 6th Ave &amp; Ivy", lat: 45.583549, lon: -122.420769, times: ["7:05 AM", "7:35 AM", "8:17 AM", "6:03 PM", "6:30 PM"] },
  { stop_id: "964", name: "NW 6th Ave &amp; Norwood", lat: 45.582729, lon: -122.424474, times: ["7:06 AM", "7:36 AM", "8:17 AM", "6:03 PM", "6:30 PM"] },
  { stop_id: "9008", name: "Fisher&#x27;s Landing Transit Center: Bay I", lat: 45.594627, lon: -122.505912, times: ["8:25 AM", "6:11 PM"] },
  { stop_id: "9001", name: "Fisher&#x27;s Landing Transit Center: Bay B", lat: 45.594377, lon: -122.504921, times: ["7:16 AM", "7:46 AM", "6:40 PM"] },
  { stop_id: "6046", name: "E 15th St &amp; Broadway", lat: 45.632668, lon: -122.670036, times: ["7:29 AM", "7:59 AM"] },
  { stop_id: "579", name: "Washington &amp; 13th St", lat: 45.63084, lon: -122.672821, times: ["7:30 AM", "8:00 AM"] },
  { stop_id: "6053", name: "Washington &amp; 9th St", lat: 45.627689, lon: -122.672782, times: ["7:32 AM", "8:02 AM"] },
]

    const polylineOut = L.polyline(shapeOutbound, { color: 'blue', weight: 4, opacity: 0.7 }).addTo(map);
    map.fitBounds(polylineOut.getBounds());

    const nowPT = new Date(new Date().toLocaleString('en-US', { timeZone: 'America/Los_Angeles' }));
    const nowMins = nowPT.getHours() * 60 + nowPT.getMinutes();

    stops.forEach(stop => {
      let highlightedTimes = [];
      let foundNext = false;
      stop.times.forEach(timeStr => {
        let cleanTime = timeStr.trim();
        let [h, m] = cleanTime.split(":");
        let schedMins = parseInt(h, 10) * 60 + parseInt(m, 10);
        if (schedMins < nowMins && nowMins - schedMins > 720) {
          schedMins += 1440;
        }
        if (!foundNext && schedMins >= nowMins) {
          highlightedTimes.push(`<span style="background:#4dd0e1; color:#000; padding:2px 6px; border-radius:6px; font-weight:bold;">${cleanTime}</span>`);
          foundNext = true;
        } else {
          highlightedTimes.push(cleanTime);
        }
      });

      L.circleMarker([stop.lat, stop.lon], {
        radius: 6,
        color: '#4dd0e1',
        fillColor: '#4dd0e1',
        fillOpacity: 0.9,
        weight: 1
      })
      .bindPopup(`<strong>${stop.name}</strong><br>${highlightedTimes.join("<br>") || 'No scheduled times'}`)
      .addTo(map);
    });

    let busMarkers = {};
    async function fetchAndDisplay() {
      const res = await fetch(`https://developer.trimet.org/ws/v2/vehicles?route=${routeNumber}&appID=${apiKey}&json=true`);
      const data = await res.json();
      const buses = (data.resultSet.vehicle || []).filter(v => v.routeNumber == routeNumber && v.direction == direction);

      Object.values(busMarkers).forEach(m => map.removeLayer(m));
      busMarkers = {};
      if (!buses.length) return;

      buses.forEach(bus => {
        if (!bus.latitude || !bus.longitude || !bus.blockID) return;
        const icon = L.divIcon({    
           className: '',
           html: `
            <div style="text-align:center;">
              <div style="background:#0071CE;color:#fff;padding:2px 6px;border-radius:6px;font-weight:bold;">${bus.vehicleID}</div>
              <div style="width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-top:10px solid #00bfff;margin:auto;"></div>
            </div>
          `,
          iconSize: [40, 30], iconAnchor: [20, 30]
        });
        const marker = L.marker([bus.latitude, bus.longitude], { icon }).addTo(map);
        busMarkers[bus.vehicleID] = marker;
      });
    }
    fetchAndDisplay();
    setInterval(fetchAndDisplay, 15000);
  </script>

  <footer class="site-footer">
    <a href="terms.html">Terms of Use</a> &nbsp;|&nbsp;
    <a href="contact.html">Contact Us</a> &nbsp;|&nbsp;
    <a href="report.html">Report a Problem</a> &nbsp;|&nbsp;
    <a href="dmca.html">DMCA</a> &nbsp;|&nbsp;
    <a href="privacy.html">Privacy Policy</a>
  </footer>

  <script>
    if (!localStorage.getItem('cookieConsent')) {
      document.write(`
        <div id="cookie-banner" style="position: fixed; bottom: 0; left: 0; right: 0; background: #333; color: #fff; padding: 1rem; z-index: 1000; font-size: 0.9rem; line-height: 1.4; text-align: center; box-sizing: border-box;">
          📢 We use cookies to improve functionality and analyze traffic.
          By using MetroFeed, you agree to our 
          <a href='privacy.html' style='color: #4dd0e1; text-decoration: underline;'>Privacy Policy</a>.<br>
          <button onclick='localStorage.setItem("cookieConsent", "true"); document.getElementById("cookie-banner").remove();' style='margin-top: 0.5rem; background: #4dd0e1; color: #000; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer; font-weight: bold;'>OK</button>
        </div>
      `);
    }
  </script>
</body>
</html>