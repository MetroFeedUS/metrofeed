<!DOCTYPE html>
<html lang="en">
<head>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EL337T4JX4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-EL337T4JX4');
</script>

<meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Route 80 - Direction 0 | MetroFeed Portland</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #0d0d0d;
      color: #cccccc;
      overflow-y: auto;
    }

    body {
      padding-top: 120px;
    }

    .ad-banner {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: #222;
      padding: 0;
      z-index: 1000;
      box-shadow: 0 2px 2px rgba(0,0,0,0.5);
      text-align: center;
    }

    .ad-banner img {
      width: 100%;
      max-width: 728px;
      max-height: 120px;
      display: block;
      margin: 0 auto;
    }
    .home-button {
      position: fixed;
      top: 120px;
      left: 10px;
      background-color: #4dd0e1;
      color: #0d0d0d;
      padding: 0.5rem 1rem;
      font-weight: bold;
      border-radius: 8px;
      text-decoration: none;
      z-index: 1001;
      box-shadow: 0 0 10px #4dd0e1;
    }

    .home-button:hover {
      background-color: #00bcd4;
      color: #ffffff;
    }

    header {
      background-color: #0d0d0d;
      border-top: 4px solid #4dd0e1;
      border-bottom: 3px solid #4dd0e1;
      padding: 1rem;
      text-align: center;
    }

    header img {
      max-height: 60px;
    }

    h1 {
      text-align: center;
      margin: 1rem 0;
      font-size: 2rem;
      color: #f0f0f0;
    }

    .content-box {
      border-radius: 12px;
      padding: 0;
      margin: 0;
      background-color: #1e1e1e;
    }

    #map {
      width: 100%;
      height: 85vh;
      border: none;
      margin: 0 auto;
      display: block;
      border-radius: 8px;
    }

    .button-bar {
      display: flex;
      justify-content: center;
      margin: 1rem 0;
    }

    .button-bar a, .back-button {
      background: #4dd0e1;
      color: #0d0d0d;
      padding: 0.6rem 1.2rem;
      text-decoration: none;
      border-radius: 8px;
      font-weight: bold;
      border: none;
      cursor: pointer;
      box-shadow: 0 0 10px #4dd0e1;
    }

    .back-button:hover {
      background-color: #35c0d6;
    }

    .site-footer {
      text-align: center;
      margin-top: 3rem;
      margin-bottom: 120px;
      font-size: 0.85rem;
      color: #aaa;
    }

    .site-footer a {
      color: #00BFFF;
      text-decoration: none;
    }

    .site-footer a:hover {
      text-decoration: underline;
    }

    @media (max-width: 600px) {
      .ad-banner {
        padding-top: 1rem;
        padding-bottom: 0rem;
      }
    }
  </style>
</head>

<body>
  <div class="ad-banner">
    <iframe src="https://metrofeedus.com/portland/Ads/route-80-dir0-ad.html" style="border:none; width:100%; max-width: 728px; height:90px;"></iframe>
  </div>

  <header>
    <img src="MetroFeedPortlandLogo.png" alt="MetroFeed Portland">
  </header>

  <div class="disclaimer" style="margin: 1rem auto 0.5rem; max-width: 600px; font-size: 0.8rem; color: #bbb; text-align: center; padding: 0.5rem 1rem; background-color: #111; border: 1px dashed #444; border-radius: 6px;">
    ⚠️ This is a Beta program, work in progress. Please REPORT bugs and pretend to be impressed.
  </div>
  <div class="disclaimer" style="margin: 0 auto 1rem; max-width: 600px; font-size: 0.75rem; color: #888; text-align: center; padding: 0.25rem 1rem;">
    This tool is not affiliated with or endorsed by TriMet. For official schedules and service alerts, visit <a href="https://trimet.org" style="color:#4dd0e1;">trimet.org</a>.
  </div>

  <div style="margin: 2rem 0; text-align: center;">
    <button class="back-button" onclick="history.back()">Back</button>
  </div>

  <h1>Route 80 - Direction 0</h1>

  <div class="content-box">
    <div id="map"></div>
    <div style="text-align:right; font-size: 0.7rem; color: #777; margin-top: 0.5rem;">
      Data courtesy of TriMet.
    </div>
  </div>

  <script>
    if (document.referrer === "" && performance.navigation.type === 0) {
      window.location.href = "/index.html";
    }

    const apiKey = "2C4447D4A42083BCD84DE3B8E";
    const routeNumber = 80;
    const direction = parseInt(0);

    const map = L.map('map', {
      center: [45.6, -122.7],
      zoom: 12,
      minZoom: 12,
      maxZoom: 18,
      maxBounds: [[45.3, -123.1], [45.9, -122.3]],
      maxBoundsViscosity: 1.0
    });
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);

    const shapeOutbound = [
  [45.594513462256806, -122.50508735664616],
  [45.594377, -122.50474399999999],
  [45.594306, -122.50456799999999],
  [45.594286, -122.504554],
  [45.594262, -122.50454399999998],
  [45.59424, -122.50454],
  [45.594216, -122.504541],
  [45.594194, -122.504548],
  [45.594171, -122.50455899999999],
  [45.594151, -122.504576],
  [45.594133, -122.50459599999999],
  [45.594117, -122.50462199999998],
  [45.594105, -122.50464999999998],
  [45.594096, -122.50468099999999],
  [45.59409, -122.50471299999998],
  [45.594089, -122.504747],
  [45.594091, -122.50478],
  [45.594097, -122.50480599999999],
  [45.594133, -122.50489099999999],
  [45.594368, -122.505428],
  [45.594686, -122.50621099999998],
  [45.594702, -122.506223],
  [45.594717, -122.50623199999998],
  [45.594734, -122.50623799999998],
  [45.59475, -122.50623999999999],
  [45.594767, -122.50623999999999],
  [45.594783, -122.506236],
  [45.594801, -122.506229],
  [45.594815, -122.50621899999999],
  [45.59483, -122.50620599999999],
  [45.594843, -122.50619099999999],
  [45.594855, -122.506174],
  [45.594864, -122.50615299999998],
  [45.594873, -122.50613299999999],
  [45.594879, -122.50611],
  [45.594882, -122.506087],
  [45.594883, -122.50606199999999],
  [45.594882, -122.506037],
  [45.59488, -122.50601299999998],
  [45.594911, -122.50609299999999],
  [45.59492, -122.506157],
  [45.594938, -122.506207],
  [45.594961, -122.50624699999999],
  [45.594991, -122.506274],
  [45.595151, -122.506349],
  [45.595193, -122.50637599999999],
  [45.595211, -122.50640999999999],
  [45.595214, -122.506475],
  [45.595248, -122.50652399999998],
  [45.595391, -122.50642299999998],
  [45.5956, -122.506264],
  [45.595699, -122.50619699999999],
  [45.595774, -122.50613399999999],
  [45.595854, -122.50607499999998],
  [45.595928, -122.50602099999999],
  [45.59599, -122.50597099999999],
  [45.596037, -122.50592799999998],
  [45.596084, -122.50588599999999],
  [45.596124, -122.50585599999998],
  [45.596147, -122.505832],
  [45.596211, -122.50577899999999],
  [45.596285, -122.50569999999999],
  [45.596442, -122.50547199999998],
  [45.596453, -122.50545899999999],
  [45.59655, -122.50554399999999],
  [45.59664, -122.505621],
  [45.596734, -122.505685],
  [45.596824, -122.50572899999999],
  [45.5969, -122.505759],
  [45.596986, -122.50579199999999],
  [45.597072, -122.50581399999999],
  [45.597159, -122.505838],
  [45.59724, -122.50585099999999],
  [45.597293, -122.50586399999999],
  [45.597474, -122.505869],
  [45.598951, -122.505903],
  [45.59947413881491, -122.50592194833503],
  [45.59947413909504, -122.50592194834518],
  [45.599586, -122.505926],
  [45.600218, -122.50593399999998],
  [45.600183, -122.506916],
  [45.600184, -122.506996],
  [45.600189, -122.50707700000001],
  [45.600193, -122.50715599999998],
  [45.600201, -122.507237],
  [45.600211, -122.507316],
  [45.600222, -122.50739400000002],
  [45.600237, -122.507473],
  [45.600252, -122.507551],
  [45.600269, -122.507628],
  [45.600289, -122.507703],
  [45.600309, -122.50777700000002],
  [45.600329, -122.507853],
  [45.600372, -122.507997],
  [45.600404, -122.508092],
  [45.600455, -122.508204],
  [45.600522, -122.50832400000002],
  [45.600649, -122.50854],
  [45.600715, -122.50863100000001],
  [45.600796, -122.508731],
  [45.6009, -122.50884999999998],
  [45.600995, -122.508946],
  [45.601092, -122.509019],
  [45.601182, -122.50908],
  [45.601278, -122.50912699999999],
  [45.601371, -122.509167],
  [45.601457, -122.509207],
  [45.601544, -122.50924400000001],
  [45.601685, -122.50925300000002],
  [45.601742313622935, -122.50924702983095],
  [45.601742312816896, -122.50924702991492],
  [45.601781, -122.50924300000001],
  [45.601873, -122.50923],
  [45.601962, -122.509208],
  [45.602021, -122.509194],
  [45.602088, -122.509181],
  [45.602154, -122.50915800000001],
  [45.602202, -122.509136],
  [45.602614, -122.508956],
  [45.602736, -122.50889500000001],
  [45.603023, -122.508784],
  [45.603469, -122.508559],
  [45.603527669477785, -122.50853544656002],
  [45.60352766808256, -122.50853544712014],
  [45.603606, -122.508504],
  [45.603867, -122.508411],
  [45.604611, -122.50810099999998],
  [45.604662, -122.50830799999999],
  [45.60471, -122.50851699999998],
  [45.604788, -122.508856],
  [45.604856, -122.509163],
  [45.604949, -122.50960399999998],
  [45.605026, -122.51000199999999],
  [45.605066, -122.510243],
  [45.605094, -122.51042999999999],
  [45.605124, -122.51065099999998],
  [45.605142, -122.51080499999999],
  [45.605153, -122.51090899999998],
  [45.605163, -122.510998],
  [45.605175, -122.511114],
  [45.605181, -122.511186],
  [45.605192, -122.51130399999998],
  [45.605197, -122.51137599999998],
  [45.605212, -122.511566],
  [45.605223, -122.511755],
  [45.605231, -122.511908],
  [45.605239, -122.51211499999998],
  [45.605241, -122.512194],
  [45.605256, -122.51348099999998],
  [45.605295169506675, -122.51384427797363],
  [45.605295169689704, -122.51384427967119],
  [45.605307, -122.513954],
  [45.605347, -122.514325],
  [45.605395, -122.514684],
  [45.605457, -122.515047],
  [45.605543, -122.515459],
  [45.605735, -122.516236],
  [45.605967, -122.51690300000001],
  [45.606101053393026, -122.51728973810731],
  [45.60610105404727, -122.51728973999481],
  [45.606645, -122.51885900000002],
  [45.607553, -122.52138900000001],
  [45.60774794942062, -122.5220034516924],
  [45.60774795042435, -122.522003454856],
  [45.607823, -122.52224],
  [45.607899, -122.522522],
  [45.607933, -122.522666],
  [45.607969, -122.522859],
  [45.607977, -122.522945],
  [45.607982, -122.52300900000002],
  [45.607984, -122.523088],
  [45.607978, -122.523901],
  [45.607982, -122.523991],
  [45.607964, -122.525061],
  [45.607946, -122.52532699999999],
  [45.607928, -122.525428],
  [45.607908, -122.52551599999998],
  [45.607883, -122.525615],
  [45.607862, -122.525698],
  [45.607845, -122.525781],
  [45.60783, -122.525866],
  [45.607816, -122.525952],
  [45.607806, -122.52603800000001],
  [45.607797, -122.52612399999998],
  [45.607789, -122.52621200000002],
  [45.607768, -122.52643200000001],
  [45.607782, -122.526549],
  [45.607787, -122.526627],
  [45.607793, -122.526704],
  [45.6078, -122.526781],
  [45.607811, -122.526857],
  [45.607824, -122.526942],
  [45.607839, -122.527057],
  [45.607857, -122.527172],
  [45.607878, -122.527285],
  [45.607902, -122.527399],
  [45.607929, -122.52751],
  [45.607958, -122.52761999999998],
  [45.607989, -122.52772900000001],
  [45.608024, -122.527836],
  [45.608061, -122.527941],
  [45.608102, -122.528044],
  [45.608168, -122.52821400000002],
  [45.608466, -122.528745],
  [45.608589, -122.52889300000001],
  [45.608632, -122.528947],
  [45.608673, -122.52900200000002],
  [45.608715, -122.52905700000001],
  [45.608756, -122.529115],
  [45.608796, -122.529173],
  [45.608834, -122.529232],
  [45.608874, -122.529291],
  [45.608912, -122.529353],
  [45.608948, -122.529415],
  [45.608985, -122.529478],
  [45.60902, -122.52954099999998],
  [45.609055, -122.529606],
  [45.609089, -122.52967],
  [45.609121, -122.52973700000001],
  [45.609158, -122.529798],
  [45.609185, -122.529872],
  [45.609216, -122.52994],
  [45.609246, -122.53000999999999],
  [45.609274, -122.530079],
  [45.609302, -122.530151],
  [45.609329, -122.530222],
  [45.609355, -122.530294],
  [45.609381, -122.53036700000001],
  [45.609406, -122.53044099999998],
  [45.609429, -122.530515],
  [45.609452, -122.530588],
  [45.609488, -122.530718],
  [45.609515, -122.530816],
  [45.609534, -122.530893],
  [45.609552, -122.53097],
  [45.609569, -122.531046],
  [45.609585, -122.531126],
  [45.609599, -122.531204],
  [45.609615, -122.53128300000002],
  [45.609627, -122.531361],
  [45.60964, -122.53144100000002],
  [45.609651, -122.53152099999998],
  [45.609661, -122.5316],
  [45.60967, -122.531681],
  [45.609679, -122.53176100000002],
  [45.609687, -122.531842],
  [45.609693, -122.53192200000001],
  [45.609703, -122.532072],
  [45.60973, -122.532508],
  [45.61013794475002, -122.53250837948349],
  [45.61013794472092, -122.53250837948347],
  [45.610805, -122.53250899999999],
  [45.610884, -122.53251599999999],
  [45.612003, -122.53251699999998],
  [45.61266, -122.532503],
  [45.61313898950539, -122.53250978455388],
  [45.61313898960907, -122.53250978455537],
  [45.613719, -122.532518],
  [45.61392, -122.532518],
  [45.614934, -122.532523],
  [45.616271, -122.532507],
  [45.61708411696054, -122.53251818573598],
  [45.61708411707332, -122.53251818573753],
  [45.617216, -122.53252],
  [45.6173, -122.532521],
  [45.617448, -122.53254],
  [45.617523, -122.53255],
  [45.617596, -122.53256599999999],
  [45.617646, -122.532579],
  [45.617883, -122.53263499999998],
  [45.617983, -122.532643],
  [45.618065, -122.532653],
  [45.618147, -122.532662],
  [45.618229, -122.532667],
  [45.618312, -122.53267099999998],
  [45.618396, -122.53267499999998],
  [45.618624, -122.53268399999999],
  [45.619517, -122.532707],
  [45.619572, -122.53271799999999],
  [45.619626, -122.53272999999999],
  [45.61968, -122.532746],
  [45.619733, -122.53276399999999],
  [45.61975675568033, -122.5327723584801],
  [45.61975676001657, -122.53277236000582],
  [45.619787, -122.532783],
  [45.619839, -122.532806],
  [45.619892, -122.53283200000001],
  [45.619943, -122.53286],
  [45.619993, -122.53289100000002],
  [45.620013, -122.532896],
  [45.620044, -122.532925],
  [45.620092, -122.532961],
  [45.620148, -122.533006],
  [45.621052, -122.53400500000001],
  [45.621227, -122.534159],
  [45.621323, -122.534255],
  [45.621432, -122.534345],
  [45.621576, -122.53444400000001],
  [45.621664, -122.53450900000001],
  [45.621834, -122.534568],
  [45.621942, -122.53458700000002],
  [45.62195, -122.53458800000001],
  [45.622044, -122.53460400000002],
  [45.622248, -122.534611],
  [45.623087, -122.534614],
  [45.623237, -122.53461300000001],
  [45.623538468211336, -122.5346158293591],
  [45.62353846828046, -122.53461582935974],
  [45.625368, -122.534633],
  [45.62715, -122.53463699999999],
  [45.628041, -122.53463699999999],
  [45.6284, -122.53462899999998],
  [45.62862290198336, -122.53463246374197],
  [45.62862290218618, -122.53463246374511],
  [45.629494, -122.534646],
  [45.630393, -122.53466699999998],
  [45.631161, -122.534649],
  [45.63145241228267, -122.53465235599559],
  [45.63145241234088, -122.53465235599626],
  [45.631682, -122.53465500000001],
  [45.631821, -122.53463500000001],
  [45.631931, -122.534613],
  [45.632031, -122.53457699999998],
  [45.632134, -122.534538],
  [45.632247, -122.53447500000001],
  [45.632342, -122.534404],
  [45.632423, -122.53434700000001],
  [45.632504, -122.534281],
  [45.632581, -122.534214],
  [45.632651, -122.534132],
  [45.632703, -122.534068],
  [45.63278, -122.533961],
  [45.632859, -122.53384000000001],
  [45.632942, -122.533693],
  [45.633008, -122.533544],
  [45.633061, -122.533416],
  [45.633107, -122.533265],
  [45.63316, -122.53309200000001],
  [45.633418, -122.532244],
  [45.633443, -122.532162],
  [45.633465, -122.532081],
  [45.633485, -122.53201],
  [45.633508, -122.531941],
  [45.633533, -122.531873],
  [45.633558, -122.531806],
  [45.633587, -122.531739],
  [45.633616, -122.531675],
  [45.633646, -122.531612],
  [45.633679, -122.53154999999998],
  [45.633713, -122.53149100000002],
  [45.633749, -122.531432],
  [45.633785, -122.53137500000001],
  [45.633824, -122.531321],
  [45.633862, -122.53127],
  [45.633904, -122.53121799999998],
  [45.633945, -122.53117],
  [45.633988, -122.531123],
  [45.634032, -122.53108],
  [45.634077, -122.53103700000001],
  [45.634123, -122.530997],
  [45.63417, -122.53096100000002],
  [45.634219, -122.530925],
  [45.634267, -122.530893],
  [45.634318, -122.530864],
  [45.634367, -122.530835],
  [45.634419, -122.530811],
  [45.634471, -122.530788],
  [45.634523, -122.530767],
  [45.634575, -122.53075],
  [45.634628, -122.530736],
  [45.634681, -122.53072300000001],
  [45.634731, -122.53070799999999],
  [45.634782, -122.530695],
  [45.634856, -122.530678],
  [45.634921, -122.530672],
  [45.635236, -122.53066400000002],
  [45.63549, -122.530668],
  [45.635667, -122.530684],
  [45.636053904258006, -122.53068930892722],
  [45.63605390443263, -122.53068930892964],
  [45.638655, -122.530725],
  [45.639086199214944, -122.5307342731014],
  [45.63908619940685, -122.53073427310555],
  [45.639771, -122.53074900000001],
  [45.640333, -122.53072899999998],
  [45.642951, -122.530708],
  [45.642947638460356, -122.53199462929872],
  [45.642947638460505, -122.53199462924186],
  [45.642947, -122.532239],
  [45.642945, -122.53266],
  [45.642941, -122.53396100000002],
  [45.64293619904195, -122.53468306409056],
  [45.64293619904195, -122.5346830640909],
  [45.642931, -122.535465],
  [45.642925, -122.537184],
  [45.642908370627254, -122.54012914943672],
  [45.642908370627254, -122.54012914943722],
  [45.642906, -122.540549],
  [45.642894, -122.54192200000001],
  [45.642893, -122.54246300000001],
  [45.64289, -122.543525],
  [45.64289, -122.54361400000002],
  [45.642886, -122.544977],
  [45.64287140080577, -122.54535657905002],
  [45.64287140080543, -122.54535657905893],
  [45.642864, -122.54554900000001],
  [45.642871, -122.54715],
  [45.642873, -122.54771900000001],
  [45.64286664094649, -122.54821636882865],
  [45.64286664094648, -122.54821636882939],
  [45.642859, -122.548814],
  [45.642848, -122.54968399999998],
  [45.642844, -122.549896],
  [45.642804, -122.551125],
  [45.6428042487989, -122.55150615992157],
  [45.6428042487989, -122.55150615992119],
  [45.642806, -122.554189],
  [45.642786, -122.555522],
  [45.64277805979476, -122.55673933271619],
  [45.64277805979475, -122.55673933271724],
  [45.64277, -122.55797499999998],
  [45.64333330433874, -122.55797297226658],
  [45.64333330433874, -122.55797297226658],
  [45.645548, -122.557965],
  [45.645806, -122.557987],
  [45.645906, -122.55799499999999],
  [45.64609, -122.558022],
  [45.646235, -122.55805099999999],
  [45.646356, -122.558081],
  [45.646442, -122.558104],
  [45.646584, -122.558143],
  [45.646696, -122.558167],
  [45.646811, -122.55819099999998],
  [45.646904, -122.558211],
  [45.64699, -122.558226],
  [45.647096, -122.558251],
  [45.647124542057554, -122.5582530811917],
  [45.64712454274445, -122.55825308124177],
  [45.647192, -122.558258],
  [45.647316, -122.558271],
  [45.647427, -122.55826699999999],
  [45.647541, -122.55827499999998],
  [45.648603, -122.55826699999999],
  [45.649916, -122.558287],
  [45.650102, -122.558285],
  [45.650256, -122.558283],
  [45.650363, -122.55827499999998],
  [45.650429, -122.55826499999999],
  [45.650543, -122.55824499999999],
  [45.65071, -122.55819],
  [45.650818, -122.558157],
  [45.650894, -122.55812699999998],
  [45.65093287199869, -122.55811559754703],
  [45.6509328692826, -122.55811559834378],
  [45.650969, -122.558105],
  [45.651031, -122.558081],
  [45.651166, -122.55804],
  [45.651309, -122.55800500000001],
  [45.651457, -122.557978],
  [45.651594, -122.557965],
  [45.651713, -122.557959],
  [45.651857, -122.557938],
  [45.652188, -122.55796],
  [45.653648, -122.557963],
  [45.654363, -122.557961],
  [45.654741, -122.557963],
  [45.655126, -122.55796],
  [45.65527761284011, -122.55796507066353],
  [45.655277613200724, -122.5579650706756],
  [45.655425, -122.55797],
  [45.655929, -122.557983],
  [45.656424, -122.557996],
  [45.65665, -122.557996],
  [45.65699646106623, -122.55799041191828],
  [45.65699646098801, -122.55799041191955],
  [45.657208, -122.557987],
  [45.659001, -122.55798800000001],
  [45.65899, -122.558348],
  [45.65899, -122.558532],
  [45.658988, -122.558645],
  [45.65898, -122.55875100000002],
  [45.658973, -122.558834],
  [45.658942, -122.558982],
  [45.658902, -122.559109],
  [45.658854, -122.559216],
  [45.65879701906606, -122.55933900646058],
  [45.65879702091554, -122.55933900246804],
  [45.658791, -122.55935199999999],
  [45.658755, -122.55946599999999],
  [45.658725, -122.559584],
  [45.658698, -122.55968699999998],
  [45.658671, -122.55977799999998],
  [45.658644, -122.559881],
  [45.658598, -122.560084],
  [45.658584, -122.56020199999999],
  [45.658566, -122.560313],
  [45.658556, -122.56049399999999],
  [45.658548, -122.56074599999998],
  [45.658548, -122.560985],
  [45.658555, -122.56123999999998],
  [45.658566, -122.56155199999999],
  [45.658573, -122.56186899999999],
  [45.658582, -122.562069],
  [45.658567, -122.562312],
  [45.658546, -122.56254499999999],
  [45.658503, -122.562779],
  [45.658465, -122.56299],
  [45.658397, -122.56321999999999],
  [45.658317, -122.56347099999999],
  [45.65823011069709, -122.56366720165171],
  [45.6582301102801, -122.56366720259332],
  [45.658224, -122.56368100000002],
  [45.658104, -122.563924],
  [45.658011, -122.564089],
  [45.657971, -122.564138],
  [45.657899, -122.56421500000002],
  [45.657971, -122.564138],
  [45.658011, -122.564089],
  [45.658104, -122.563924],
  [45.658224, -122.56368100000002],
  [45.658317, -122.56347100000002],
  [45.658397, -122.56322000000002],
  [45.658465, -122.56299],
  [45.658503, -122.56277900000002],
  [45.658546, -122.56254500000001],
  [45.658567, -122.562312],
  [45.658582, -122.56206900000001],
  [45.658573, -122.561869],
  [45.658566, -122.561552],
  [45.658555, -122.56124000000001],
  [45.658548, -122.56098500000002],
  [45.658548, -122.560746],
  [45.658556, -122.560494],
  [45.658566, -122.56031300000001],
  [45.658566, -122.560313],
  [45.658584, -122.560202],
  [45.658598, -122.560084],
  [45.658644, -122.559881],
  [45.658671, -122.559778],
  [45.658698, -122.559687],
  [45.658725, -122.559584],
  [45.658755, -122.55946599999999],
  [45.658791, -122.559352],
  [45.658854, -122.559216],
  [45.658902, -122.55910900000002],
  [45.658942, -122.558982],
  [45.658973, -122.558834],
  [45.65898, -122.55875100000002],
  [45.658988, -122.558645],
  [45.65899, -122.55853200000001],
  [45.65899, -122.558348],
  [45.659001, -122.55798800000001],
  [45.659639, -122.55799099999999],
  [45.65969, -122.55799099999999],
  [45.659725, -122.55799700000001],
  [45.660086, -122.558065],
  [45.660285, -122.558131],
  [45.660987, -122.55852400000002],
  [45.661592, -122.55894500000001],
  [45.661662, -122.55899],
  [45.66173, -122.55903099999999],
  [45.662051, -122.559246],
  [45.662837, -122.559796],
  [45.663053, -122.559941],
  [45.66329683248898, -122.56011638828154],
  [45.663296838408655, -122.56011639253957],
  [45.663452, -122.56022799999998],
  [45.664396, -122.560988],
  [45.664938, -122.561403],
  [45.664715, -122.56190500000001],
  [45.664619, -122.562124],
  [45.66440142731169, -122.56267704789488],
  [45.664401428530994, -122.56267704479556],
  [45.664082, -122.563489],
  [45.663711, -122.564467],
  [45.66355275244067, -122.5648692850043],
  [45.66355275169729, -122.56486928689408],
  [45.663438, -122.56516100000002],
  [45.662879, -122.566344],
  [45.66232, -122.567528],
  [45.661843, -122.568491],
  [45.66160888580648, -122.56896979604161],
  [45.66160888404952, -122.56896979963481],
  [45.661555, -122.56908],
  [45.660906, -122.570551],
  [45.6602, -122.57187999999998],
  [45.660104, -122.572058],
  [45.660017, -122.572217],
  [45.659939, -122.572343],
  [45.659869, -122.572454],
  [45.659709, -122.57269900000001],
  [45.659572, -122.572912],
  [45.659478, -122.57305599999998],
  [45.659376, -122.573209],
  [45.659273, -122.573371],
  [45.659169, -122.57352599999999],
  [45.659037, -122.57372399999998],
  [45.658983, -122.573794],
  [45.658855, -122.573961],
  [45.658685, -122.574179],
  [45.658551, -122.574359],
  [45.658454, -122.574471],
  [45.658197, -122.574769],
  [45.657532, -122.575471],
  [45.657894, -122.57609999999998],
  [45.657954, -122.57619899999999],
  [45.657977, -122.576244],
  [45.65799, -122.576271],
  [45.658041, -122.57636099999999],
  [45.658076, -122.57645],
  [45.658108, -122.57654399999998],
  [45.658132, -122.57665],
  [45.658148, -122.57675700000001],
  [45.658171, -122.576964],
  [45.65817204279233, -122.57698305992635],
  [45.65817204273484, -122.57698305887565],
  [45.658189, -122.577293],
  [45.658305, -122.579084],
  [45.658137, -122.57909699999999],
  [45.658036, -122.579105],
  [45.657847, -122.579113],
  [45.657704, -122.57913799999999],
  [45.657595, -122.579165],
  [45.657489, -122.57920199999998],
  [45.657435, -122.579244],
  [45.657359, -122.57931099999999],
  [45.657261, -122.579411],
  [45.657196, -122.57948599999999],
  [45.65712, -122.579611],
  [45.657052, -122.57974399999999],
  [45.656983, -122.57991499999999],
  [45.65691, -122.58016499999998],
  [45.656812, -122.580465],
  [45.656704, -122.58085],
  [45.656631, -122.581093],
  [45.65659, -122.58124699999999],
  [45.656551, -122.581383],
  [45.65651, -122.581517],
  [45.656455, -122.581718],
  [45.656408, -122.58189699999998],
  [45.656376, -122.582094],
  [45.656331, -122.582338],
  [45.656299, -122.5826],
  [45.656241, -122.582978],
  [45.656062, -122.58405699999999],
  [45.65617, -122.58410799999999],
  [45.656036237821866, -122.58486193227677]
];

const stopNames = {
  "2172": "Gher Rd &amp; Coxley Dr",
  "1060": "NE 28th St 13400 Block",
  "1063": "NE 28th St &amp; 124th Ave",
  "1062": "NE 28th St &amp; 129th Ave",
  "1065": "NE 28th St &amp; 112th Ave",
  "1064": "NE 28th St at Cascadia Technical Academy",
  "1103": "Fourth Plain &amp; 105th Ave",
  "9024": "Van Mall Transit Center: Bay E",
  "2862": "NE 28th St &amp; 119th Ave",
  "1283": "McGillivray &amp; Park Crest Ave",
  "1282": "McGillivray &amp; Briarwood Dr",
  "1306": "NE 136th Ave &amp; Mill Plain",
  "933": "NE 112th Ave &amp; 39th St",
  "6190": "NE 51st Cir &amp; 110th Ave",
  "3307": "NE 112th Ave &amp; 28th St",
  "2273": "Fourth Plain &amp; 102nd Ave",
  "329": "NE 138th Ave &amp; 22nd St",
  "2237": "NE 28th St &amp; 137th Ct",
  "318": "NE 136th Ave &amp; 9th St",
  "311": "Village Loop &amp; McGillivray",
  "310": "Village Loop &amp; Fernwood",
  "317": "NE 136th Ave &amp; 4th St",
  "9003": "Fisher&#x27;s Landing Transit Center: Bay D",
  "934": "NE 112th Ave &amp; 46th St",
  "6224": "NE 136th Ave &amp; LeRoy Haagen Memorial Dr",
  "6225": "NE 138th Ave &amp; 18th St",
  "1102": "Fourth Plain 10700 Block",
  "6129": "SE 136th Ave &amp; McGillivray",
  "6128": "McGillivray &amp; Blairmont Dr",
  "701_merged_670686": "Van Mall Dr &amp; 94th Ave",
  "305": "SE 162nd Ave &amp; Village Loop",
  "2203": "NE 112th Ave 3300 Block",
  "6130": "SE 136th Ave 1200 Block",
  "6131": "SE 136th Ave &amp; 7th St",
  "935": "NE 112th Ave &amp; 49th St",
  "6185": "NE 51st Cir &amp; 10600 Block",
  "6184": "NE 51st Cir &amp; 112th Ave"
};

const stops = [
  { stop_id: "9003", name: "Fisher&#x27;s Landing Transit Center: Bay D", lat: 45.594456, lon: -122.505134, times: ["5:58 AM", "6:28 AM", "6:58 AM", "7:28 AM", "7:58 AM", "8:28 AM", "8:58 AM", "9:28 AM"] },
  { stop_id: "305", name: "SE 162nd Ave &amp; Village Loop", lat: 45.599476, lon: -122.505817, times: ["5:59 AM", "6:29 AM", "6:59 AM", "7:29 AM", "7:59 AM", "8:29 AM", "8:59 AM", "9:29 AM"] },
  { stop_id: "310", name: "Village Loop &amp; Fernwood", lat: 45.601734, lon: -122.509084, times: ["6:00 AM", "6:30 AM", "7:00 AM", "7:30 AM", "8:00 AM", "8:30 AM", "9:00 AM", "9:30 AM"] },
  { stop_id: "311", name: "Village Loop &amp; McGillivray", lat: 45.603504, lon: -122.508415, times: ["6:01 AM", "6:31 AM", "7:01 AM", "7:31 AM", "8:01 AM", "8:31 AM", "9:01 AM", "9:31 AM"] },
  { stop_id: "1282", name: "McGillivray &amp; Briarwood Dr", lat: 45.605419, lon: -122.513817, times: ["6:02 AM", "6:32 AM", "7:02 AM", "7:32 AM", "8:02 AM", "8:32 AM", "9:02 AM", "9:32 AM"] },
  { stop_id: "1283", name: "McGillivray &amp; Park Crest Ave", lat: 45.606232, lon: -122.517197, times: ["6:02 AM", "6:32 AM", "7:02 AM", "7:32 AM", "8:02 AM", "8:32 AM", "9:02 AM", "9:32 AM"] },
  { stop_id: "6128", name: "McGillivray &amp; Blairmont Dr", lat: 45.607852, lon: -122.521936, times: ["6:03 AM", "6:33 AM", "7:03 AM", "7:33 AM", "8:03 AM", "8:33 AM", "9:03 AM", "9:33 AM"] },
  { stop_id: "6129", name: "SE 136th Ave &amp; McGillivray", lat: 45.610138, lon: -122.532387, times: ["6:05 AM", "6:35 AM", "7:05 AM", "7:35 AM", "8:05 AM", "8:35 AM", "9:05 AM", "9:35 AM"] },
  { stop_id: "6130", name: "SE 136th Ave 1200 Block", lat: 45.61314, lon: -122.532364, times: ["6:06 AM", "6:36 AM", "7:06 AM", "7:36 AM", "8:06 AM", "8:36 AM", "9:06 AM", "9:36 AM"] },
  { stop_id: "6131", name: "SE 136th Ave &amp; 7th St", lat: 45.617085, lon: -122.532387, times: ["6:07 AM", "6:37 AM", "7:07 AM", "7:37 AM", "8:07 AM", "8:37 AM", "9:07 AM", "9:37 AM"] },
  { stop_id: "1306", name: "NE 136th Ave &amp; Mill Plain", lat: 45.619794, lon: -122.532556, times: ["6:08 AM", "6:38 AM", "7:08 AM", "7:38 AM", "8:08 AM", "8:38 AM", "9:08 AM", "9:38 AM"] },
  { stop_id: "317", name: "NE 136th Ave &amp; 4th St", lat: 45.623539, lon: -122.5345, times: ["6:08 AM", "6:38 AM", "7:08 AM", "7:38 AM", "8:08 AM", "8:38 AM", "9:08 AM", "9:38 AM"] },
  { stop_id: "318", name: "NE 136th Ave &amp; 9th St", lat: 45.628624, lon: -122.534488, times: ["6:09 AM", "6:39 AM", "7:09 AM", "7:40 AM", "8:10 AM", "8:40 AM", "9:09 AM", "9:39 AM"] },
  { stop_id: "6224", name: "NE 136th Ave &amp; LeRoy Haagen Memorial Dr", lat: 45.631453, lon: -122.534548, times: ["6:10 AM", "6:40 AM", "7:10 AM", "7:40 AM", "8:10 AM", "8:40 AM", "9:10 AM", "9:40 AM"] },
  { stop_id: "6225", name: "NE 138th Ave &amp; 18th St", lat: 45.636055, lon: -122.530526, times: ["6:11 AM", "6:41 AM", "7:11 AM", "7:42 AM", "8:12 AM", "8:42 AM", "9:11 AM", "9:41 AM"] },
  { stop_id: "329", name: "NE 138th Ave &amp; 22nd St", lat: 45.639088, lon: -122.530563, times: ["6:11 AM", "6:41 AM", "7:12 AM", "7:42 AM", "8:12 AM", "8:42 AM", "9:12 AM", "9:42 AM"] },
  { stop_id: "2237", name: "NE 28th St &amp; 137th Ct", lat: 45.643017, lon: -122.531995, times: ["6:12 AM", "6:42 AM", "7:13 AM", "7:43 AM", "8:13 AM", "8:43 AM", "9:13 AM", "9:43 AM"] },
  { stop_id: "1060", name: "NE 28th St 13400 Block", lat: 45.643005, lon: -122.534684, times: ["6:13 AM", "6:43 AM", "7:13 AM", "7:44 AM", "8:14 AM", "8:44 AM", "9:13 AM", "9:43 AM"] },
  { stop_id: "1062", name: "NE 28th St &amp; 129th Ave", lat: 45.642982, lon: -122.54013, times: ["6:13 AM", "6:43 AM", "7:14 AM", "7:45 AM", "8:15 AM", "8:45 AM", "9:14 AM", "9:44 AM"] },
  { stop_id: "1063", name: "NE 28th St &amp; 124th Ave", lat: 45.642953, lon: -122.545363, times: ["6:14 AM", "6:44 AM", "7:15 AM", "7:46 AM", "8:16 AM", "8:46 AM", "9:15 AM", "9:45 AM"] },
  { stop_id: "1064", name: "NE 28th St at Cascadia Technical Academy", lat: 45.642929, lon: -122.548218, times: ["6:14 AM", "6:44 AM", "7:15 AM", "7:46 AM", "8:16 AM", "8:46 AM", "9:15 AM", "9:45 AM"] },
  { stop_id: "2862", name: "NE 28th St &amp; 119th Ave", lat: 45.642924, lon: -122.551506, times: ["6:15 AM", "6:45 AM", "7:16 AM", "7:47 AM", "8:17 AM", "8:47 AM", "9:16 AM", "9:46 AM"] },
  { stop_id: "1065", name: "NE 28th St &amp; 112th Ave", lat: 45.642903, lon: -122.556741, times: ["6:16 AM", "6:46 AM", "7:17 AM", "7:48 AM", "8:18 AM", "8:48 AM", "9:17 AM", "9:47 AM"] },
  { stop_id: "3307", name: "NE 112th Ave &amp; 28th St", lat: 45.643333, lon: -122.5578, times: ["6:16 AM", "6:46 AM", "7:17 AM", "7:48 AM", "8:18 AM", "8:48 AM", "9:17 AM", "9:47 AM"] },
  { stop_id: "2203", name: "NE 112th Ave 3300 Block", lat: 45.647129, lon: -122.558128, times: ["6:17 AM", "6:47 AM", "7:18 AM", "7:49 AM", "8:19 AM", "8:49 AM", "9:18 AM", "9:48 AM"] },
  { stop_id: "933", name: "NE 112th Ave &amp; 39th St", lat: 45.650912, lon: -122.55797, times: ["6:18 AM", "6:48 AM", "7:19 AM", "7:50 AM", "8:20 AM", "8:50 AM", "9:19 AM", "9:49 AM"] },
  { stop_id: "934", name: "NE 112th Ave &amp; 46th St", lat: 45.65528, lon: -122.557819, times: ["6:19 AM", "6:49 AM", "7:20 AM", "7:51 AM", "8:21 AM", "8:51 AM", "9:20 AM", "9:50 AM"] },
  { stop_id: "935", name: "NE 112th Ave &amp; 49th St", lat: 45.656995, lon: -122.557805, times: ["6:19 AM", "6:49 AM", "7:20 AM", "7:51 AM", "8:21 AM", "8:51 AM", "9:20 AM", "9:50 AM"] },
  { stop_id: "6184", name: "NE 51st Cir &amp; 112th Ave", lat: 45.658874, lon: -122.559412, times: ["6:20 AM", "6:50 AM", "7:21 AM", "7:52 AM", "8:22 AM", "8:52 AM", "9:21 AM", "9:51 AM"] },
  { stop_id: "6185", name: "NE 51st Cir &amp; 10600 Block", lat: 45.658306, lon: -122.563736, times: ["6:21 AM", "6:51 AM", "7:22 AM", "7:53 AM", "8:23 AM", "8:53 AM", "9:22 AM", "9:52 AM"] },
  { stop_id: "6190", name: "NE 51st Cir &amp; 110th Ave", lat: 45.658467, lon: -122.560295, times: ["6:22 AM", "6:52 AM", "7:23 AM", "7:54 AM", "8:24 AM", "8:54 AM", "9:23 AM", "9:53 AM"] },
  { stop_id: "2172", name: "Gher Rd &amp; Coxley Dr", lat: 45.663343, lon: -122.559985, times: ["6:24 AM", "6:54 AM", "7:25 AM", "7:56 AM", "8:26 AM", "8:56 AM", "9:25 AM", "9:55 AM"] },
  { stop_id: "1102", name: "Fourth Plain 10700 Block", lat: 45.664492, lon: -122.56275, times: ["6:25 AM", "6:55 AM", "7:26 AM", "7:58 AM", "8:28 AM", "8:58 AM", "9:27 AM", "9:57 AM"] },
  { stop_id: "1103", name: "Fourth Plain &amp; 105th Ave", lat: 45.663648, lon: -122.564946, times: ["6:25 AM", "6:56 AM", "7:27 AM", "7:58 AM", "8:28 AM", "8:58 AM", "9:27 AM", "9:57 AM"] },
  { stop_id: "2273", name: "Fourth Plain &amp; 102nd Ave", lat: 45.661689, lon: -122.56905, times: ["6:27 AM", "6:57 AM", "7:28 AM", "8:00 AM", "8:30 AM", "9:00 AM", "9:29 AM", "9:59 AM"] },
  { stop_id: "701_merged_670686", name: "Van Mall Dr &amp; 94th Ave", lat: 45.658244, lon: -122.576975, times: ["6:29 AM", "7:00 AM", "7:31 AM", "8:03 AM", "8:33 AM", "9:03 AM", "9:32 AM", "10:02 AM"] },
  { stop_id: "9024", name: "Van Mall Transit Center: Bay E", lat: 45.656097, lon: -122.584884, times: ["6:32 AM", "7:03 AM", "7:34 AM", "8:06 AM", "8:36 AM", "9:06 AM", "9:35 AM", "10:05 AM"] },
]

    const polylineOut = L.polyline(shapeOutbound, { color: 'blue', weight: 4, opacity: 0.7 }).addTo(map);
    map.fitBounds(polylineOut.getBounds());

    const nowPT = new Date(new Date().toLocaleString('en-US', { timeZone: 'America/Los_Angeles' }));
    const nowMins = nowPT.getHours() * 60 + nowPT.getMinutes();

    stops.forEach(stop => {
      let highlightedTimes = [];
      let foundNext = false;
      stop.times.forEach(timeStr => {
        let cleanTime = timeStr.trim();
        let [h, m] = cleanTime.split(":");
        let schedMins = parseInt(h, 10) * 60 + parseInt(m, 10);
        if (schedMins < nowMins && nowMins - schedMins > 720) {
          schedMins += 1440;
        }
        if (!foundNext && schedMins >= nowMins) {
          highlightedTimes.push(`<span style="background:#4dd0e1; color:#000; padding:2px 6px; border-radius:6px; font-weight:bold;">${cleanTime}</span>`);
          foundNext = true;
        } else {
          highlightedTimes.push(cleanTime);
        }
      });

      L.circleMarker([stop.lat, stop.lon], {
        radius: 6,
        color: '#4dd0e1',
        fillColor: '#4dd0e1',
        fillOpacity: 0.9,
        weight: 1
      })
      .bindPopup(`<strong>${stop.name}</strong><br>${highlightedTimes.join("<br>") || 'No scheduled times'}`)
      .addTo(map);
    });

    let busMarkers = {};
    async function fetchAndDisplay() {
      const res = await fetch(`https://developer.trimet.org/ws/v2/vehicles?route=${routeNumber}&appID=${apiKey}&json=true`);
      const data = await res.json();
      const buses = (data.resultSet.vehicle || []).filter(v => v.routeNumber == routeNumber && v.direction == direction);

      Object.values(busMarkers).forEach(m => map.removeLayer(m));
      busMarkers = {};
      if (!buses.length) return;

      buses.forEach(bus => {
        if (!bus.latitude || !bus.longitude || !bus.blockID) return;
        const icon = L.divIcon({    
           className: '',
           html: `
            <div style="text-align:center;">
              <div style="background:#0071CE;color:#fff;padding:2px 6px;border-radius:6px;font-weight:bold;">${bus.vehicleID}</div>
              <div style="width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-top:10px solid #00bfff;margin:auto;"></div>
            </div>
          `,
          iconSize: [40, 30], iconAnchor: [20, 30]
        });
        const marker = L.marker([bus.latitude, bus.longitude], { icon }).addTo(map);
        busMarkers[bus.vehicleID] = marker;
      });
    }
    fetchAndDisplay();
    setInterval(fetchAndDisplay, 15000);
  </script>

  <footer class="site-footer">
    <a href="terms.html">Terms of Use</a> &nbsp;|&nbsp;
    <a href="contact.html">Contact Us</a> &nbsp;|&nbsp;
    <a href="report.html">Report a Problem</a> &nbsp;|&nbsp;
    <a href="dmca.html">DMCA</a> &nbsp;|&nbsp;
    <a href="privacy.html">Privacy Policy</a>
  </footer>

  <script>
    if (!localStorage.getItem('cookieConsent')) {
      document.write(`
        <div id="cookie-banner" style="position: fixed; bottom: 0; left: 0; right: 0; background: #333; color: #fff; padding: 1rem; z-index: 1000; font-size: 0.9rem; line-height: 1.4; text-align: center; box-sizing: border-box;">
          📢 We use cookies to improve functionality and analyze traffic.
          By using MetroFeed, you agree to our 
          <a href='privacy.html' style='color: #4dd0e1; text-decoration: underline;'>Privacy Policy</a>.<br>
          <button onclick='localStorage.setItem("cookieConsent", "true"); document.getElementById("cookie-banner").remove();' style='margin-top: 0.5rem; background: #4dd0e1; color: #000; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer; font-weight: bold;'>OK</button>
        </div>
      `);
    }
  </script>
</body>
</html>