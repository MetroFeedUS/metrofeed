<!DOCTYPE html>
<html lang="en">
<head>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EL337T4JX4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-EL337T4JX4');
</script>

<meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Route 80 - Direction 1 | MetroFeed Portland</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #0d0d0d;
      color: #cccccc;
      overflow-y: auto;
    }

    body {
      padding-top: 120px;
    }

    .ad-banner {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: #222;
      padding: 0;
      z-index: 1000;
      box-shadow: 0 2px 2px rgba(0,0,0,0.5);
      text-align: center;
    }

    .ad-banner img {
      width: 100%;
      max-width: 728px;
      max-height: 120px;
      display: block;
      margin: 0 auto;
    }
    .home-button {
      position: fixed;
      top: 120px;
      left: 10px;
      background-color: #4dd0e1;
      color: #0d0d0d;
      padding: 0.5rem 1rem;
      font-weight: bold;
      border-radius: 8px;
      text-decoration: none;
      z-index: 1001;
      box-shadow: 0 0 10px #4dd0e1;
    }

    .home-button:hover {
      background-color: #00bcd4;
      color: #ffffff;
    }

    header {
      background-color: #0d0d0d;
      border-top: 4px solid #4dd0e1;
      border-bottom: 3px solid #4dd0e1;
      padding: 1rem;
      text-align: center;
    }

    header img {
      max-height: 60px;
    }

    h1 {
      text-align: center;
      margin: 1rem 0;
      font-size: 2rem;
      color: #f0f0f0;
    }

    .content-box {
      border-radius: 12px;
      padding: 0;
      margin: 0;
      background-color: #1e1e1e;
    }

    #map {
      width: 100%;
      height: 85vh;
      border: none;
      margin: 0 auto;
      display: block;
      border-radius: 8px;
    }

    .button-bar {
      display: flex;
      justify-content: center;
      margin: 1rem 0;
    }

    .button-bar a, .back-button {
      background: #4dd0e1;
      color: #0d0d0d;
      padding: 0.6rem 1.2rem;
      text-decoration: none;
      border-radius: 8px;
      font-weight: bold;
      border: none;
      cursor: pointer;
      box-shadow: 0 0 10px #4dd0e1;
    }

    .back-button:hover {
      background-color: #35c0d6;
    }

    .site-footer {
      text-align: center;
      margin-top: 3rem;
      margin-bottom: 120px;
      font-size: 0.85rem;
      color: #aaa;
    }

    .site-footer a {
      color: #00BFFF;
      text-decoration: none;
    }

    .site-footer a:hover {
      text-decoration: underline;
    }

    @media (max-width: 600px) {
      .ad-banner {
        padding-top: 1rem;
        padding-bottom: 0rem;
      }
    }
  </style>
</head>

<body>
  <div class="ad-banner">
    <iframe src="https://metrofeedus.com/portland/Ads/route-80-dir1-ad.html" style="border:none; width:100%; max-width: 728px; height:90px;"></iframe>
  </div>

  <header>
    <img src="MetroFeedPortlandLogo.png" alt="MetroFeed Portland">
  </header>

  <div class="disclaimer" style="margin: 1rem auto 0.5rem; max-width: 600px; font-size: 0.8rem; color: #bbb; text-align: center; padding: 0.5rem 1rem; background-color: #111; border: 1px dashed #444; border-radius: 6px;">
    ⚠️ This is a Beta program, work in progress. Please REPORT bugs and pretend to be impressed.
  </div>
  <div class="disclaimer" style="margin: 0 auto 1rem; max-width: 600px; font-size: 0.75rem; color: #888; text-align: center; padding: 0.25rem 1rem;">
    This tool is not affiliated with or endorsed by TriMet. For official schedules and service alerts, visit <a href="https://trimet.org" style="color:#4dd0e1;">trimet.org</a>.
  </div>

  <div style="margin: 2rem 0; text-align: center;">
    <button class="back-button" onclick="history.back()">Back</button>
  </div>

  <h1>Route 80 - Direction 1</h1>

  <div class="content-box">
    <div id="map"></div>
    <div style="text-align:right; font-size: 0.7rem; color: #777; margin-top: 0.5rem;">
      Data courtesy of TriMet.
    </div>
  </div>

  <script>
    if (document.referrer === "" && performance.navigation.type === 0) {
      window.location.href = "/index.html";
    }

    const apiKey = "2C4447D4A42083BCD84DE3B8E";
    const routeNumber = 80;
    const direction = parseInt(1);

    const map = L.map('map', {
      center: [45.6, -122.7],
      zoom: 12,
      minZoom: 12,
      maxZoom: 18,
      maxBounds: [[45.3, -123.1], [45.9, -122.3]],
      maxBoundsViscosity: 1.0
    });
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);

    const shapeOutbound = [
  [45.65603623755899, -122.58486193375842],
  [45.655972, -122.585224],
  [45.656179, -122.585276],
  [45.656395, -122.58421100000001],
  [45.656062, -122.584057],
  [45.656241, -122.582978],
  [45.656299, -122.5826],
  [45.656331, -122.582338],
  [45.656376, -122.582094],
  [45.656408, -122.581897],
  [45.656455, -122.581718],
  [45.65651, -122.58151700000002],
  [45.656551, -122.581383],
  [45.65659, -122.58124700000002],
  [45.656631, -122.58109300000001],
  [45.656704, -122.58085000000001],
  [45.656812, -122.58046500000002],
  [45.65691, -122.580165],
  [45.656983, -122.579915],
  [45.657052, -122.57974400000002],
  [45.65712, -122.57961100000001],
  [45.657196, -122.57948600000002],
  [45.657261, -122.57941100000001],
  [45.657359, -122.57931100000002],
  [45.657435, -122.57924400000002],
  [45.657489, -122.579201],
  [45.657595, -122.579165],
  [45.657704, -122.57913800000001],
  [45.657847, -122.57911300000002],
  [45.658036, -122.579105],
  [45.658137, -122.579097],
  [45.658305, -122.57908400000001],
  [45.658189, -122.577293],
  [45.658171, -122.576964],
  [45.65816610202663, -122.57691991823961],
  [45.658148, -122.576757],
  [45.658132, -122.57665],
  [45.658108, -122.57654399999998],
  [45.658076, -122.57645],
  [45.658041, -122.57636099999999],
  [45.65799, -122.57627099999999],
  [45.657977, -122.576244],
  [45.657954, -122.57619899999999],
  [45.657894, -122.57609999999998],
  [45.657532, -122.575471],
  [45.658197, -122.57476899999999],
  [45.658454, -122.57447099999999],
  [45.658551, -122.574359],
  [45.658685, -122.574179],
  [45.65886, -122.57395699999998],
  [45.658983, -122.57379399999999],
  [45.659037, -122.573724],
  [45.659169, -122.57352599999999],
  [45.659273, -122.57337099999998],
  [45.659376, -122.57320899999999],
  [45.659478, -122.57305599999998],
  [45.659572, -122.57291199999999],
  [45.659709, -122.572698],
  [45.65987, -122.57245399999998],
  [45.659939, -122.572343],
  [45.660017, -122.57221699999998],
  [45.660105, -122.572058],
  [45.660201, -122.57187999999998],
  [45.660906, -122.57055099999998],
  [45.661555, -122.56907999999999],
  [45.661843, -122.568491],
  [45.662018906638366, -122.56813586773008],
  [45.66201890363145, -122.56813587380066],
  [45.66232, -122.567528],
  [45.662879, -122.566344],
  [45.663438, -122.565161],
  [45.663711, -122.564467],
  [45.66405045568517, -122.563572154555],
  [45.66405045450892, -122.56357215765574],
  [45.664082, -122.563489],
  [45.664619, -122.562124],
  [45.664715, -122.561905],
  [45.664938, -122.561403],
  [45.664594796331784, -122.56114021490349],
  [45.66459479480528, -122.56114021373466],
  [45.664396, -122.560988],
  [45.663452, -122.560228],
  [45.663053, -122.559941],
  [45.662837, -122.559796],
  [45.662051, -122.55924600000002],
  [45.66173, -122.559031],
  [45.661662, -122.55899000000001],
  [45.661592, -122.558945],
  [45.660987, -122.55852399999999],
  [45.660285, -122.558131],
  [45.660086, -122.558065],
  [45.659725, -122.557997],
  [45.65969, -122.557991],
  [45.659639, -122.557991],
  [45.659001, -122.557988],
  [45.65899, -122.558348],
  [45.65899, -122.558532],
  [45.658988, -122.55864500000001],
  [45.65898, -122.55875100000002],
  [45.658973, -122.558834],
  [45.658942, -122.558982],
  [45.658902, -122.55910900000002],
  [45.658854, -122.559216],
  [45.65879702602196, -122.55933899144466],
  [45.65879702091554, -122.55933900246804],
  [45.658791, -122.55935199999999],
  [45.658755, -122.55946599999999],
  [45.658725, -122.559584],
  [45.658698, -122.55968699999998],
  [45.658671, -122.55977799999998],
  [45.658644, -122.559881],
  [45.658598, -122.560084],
  [45.658584, -122.56020199999999],
  [45.658566, -122.560313],
  [45.658556, -122.56049399999999],
  [45.658548, -122.56074599999998],
  [45.658548, -122.560985],
  [45.658555, -122.56123999999998],
  [45.658566, -122.56155199999999],
  [45.658573, -122.56186899999999],
  [45.658582, -122.562069],
  [45.658567, -122.562312],
  [45.658546, -122.56254499999999],
  [45.658503, -122.562779],
  [45.658465, -122.56299],
  [45.658397, -122.56321999999999],
  [45.658317, -122.56347099999999],
  [45.65823011069709, -122.56366720165171],
  [45.6582301102801, -122.56366720259332],
  [45.658224, -122.56368100000002],
  [45.658104, -122.563924],
  [45.658011, -122.564089],
  [45.657971, -122.564138],
  [45.657899, -122.56421500000002],
  [45.657971, -122.564138],
  [45.658011, -122.564089],
  [45.658104, -122.563924],
  [45.658224, -122.56368100000002],
  [45.658317, -122.56347100000002],
  [45.658397, -122.56322000000002],
  [45.658465, -122.56299],
  [45.658503, -122.56277900000002],
  [45.658546, -122.56254500000001],
  [45.658567, -122.562312],
  [45.658582, -122.56206900000001],
  [45.658573, -122.561869],
  [45.658566, -122.561552],
  [45.658555, -122.56124000000001],
  [45.658548, -122.56098500000002],
  [45.658548, -122.560746],
  [45.658556, -122.560494],
  [45.658566, -122.56031300000001],
  [45.658566, -122.560313],
  [45.658584, -122.560202],
  [45.658598, -122.560084],
  [45.658644, -122.559881],
  [45.658671, -122.559778],
  [45.658698, -122.559687],
  [45.658725, -122.559584],
  [45.658755, -122.55946599999999],
  [45.658791, -122.559352],
  [45.658854, -122.559216],
  [45.658902, -122.55910900000002],
  [45.658942, -122.558982],
  [45.658973, -122.558834],
  [45.65898, -122.55875100000002],
  [45.658988, -122.558645],
  [45.65899, -122.55853200000001],
  [45.65899, -122.558348],
  [45.659001, -122.55798800000001],
  [45.6584080439643, -122.5579876692939],
  [45.6584080439352, -122.55798766929388],
  [45.657208, -122.557987],
  [45.65696379402834, -122.55799093880599],
  [45.656963793951036, -122.55799093880725],
  [45.65665, -122.557996],
  [45.656424, -122.557996],
  [45.655929, -122.55798300000001],
  [45.655425, -122.55797],
  [45.655126, -122.55796000000001],
  [45.654741, -122.55796300000002],
  [45.654363, -122.55796100000002],
  [45.653648, -122.55796300000002],
  [45.652188, -122.55796000000001],
  [45.651857, -122.557938],
  [45.651713, -122.557959],
  [45.651594, -122.55796500000001],
  [45.651457, -122.557978],
  [45.651309, -122.558005],
  [45.651166, -122.55804000000002],
  [45.651031, -122.55808100000002],
  [45.650969, -122.55810500000001],
  [45.650894, -122.558127],
  [45.650827799067315, -122.55815313194711],
  [45.650818, -122.55815700000001],
  [45.65071, -122.55819],
  [45.650543, -122.558245],
  [45.650429, -122.55826500000002],
  [45.650363, -122.558275],
  [45.650256, -122.55828300000002],
  [45.650102, -122.558285],
  [45.649916, -122.55828700000002],
  [45.648603, -122.558267],
  [45.647541, -122.558275],
  [45.647427, -122.558267],
  [45.647316, -122.558271],
  [45.647192, -122.55825800000001],
  [45.647096, -122.55825100000001],
  [45.647081905980656, -122.55824767593884],
  [45.64699, -122.558226],
  [45.646904, -122.558211],
  [45.646811, -122.558191],
  [45.646696, -122.55816700000001],
  [45.646584, -122.558143],
  [45.646442, -122.558104],
  [45.646356, -122.558081],
  [45.646235, -122.55805100000002],
  [45.64609, -122.55802200000001],
  [45.645906, -122.55799500000002],
  [45.645806, -122.557987],
  [45.645548, -122.55796500000001],
  [45.64277, -122.557975],
  [45.642779559588874, -122.55650939553017],
  [45.642779559590316, -122.55650939530987],
  [45.642786, -122.55552199999998],
  [45.642806, -122.554189],
  [45.642804, -122.551125],
  [45.642822410026895, -122.55055935192361],
  [45.642822410026604, -122.55055935193249],
  [45.642844, -122.549896],
  [45.642847, -122.54968399999998],
  [45.642859, -122.54881399999998],
  [45.642873, -122.547719],
  [45.642871, -122.54714999999999],
  [45.642864, -122.545549],
  [45.64288549321088, -122.54499017651693],
  [45.64288549321038, -122.54499017653012],
  [45.642886, -122.54497700000002],
  [45.64289, -122.54361400000002],
  [45.64289, -122.543525],
  [45.642893, -122.542463],
  [45.642894, -122.54192200000001],
  [45.642906, -122.54054800000002],
  [45.64291018521934, -122.53980699590113],
  [45.642910185219336, -122.53980699590261],
  [45.642925, -122.53718400000001],
  [45.642932, -122.53546500000002],
  [45.642941, -122.533961],
  [45.64294231718066, -122.53353258699009],
  [45.642942317180655, -122.5335325869908],
  [45.642945, -122.53266],
  [45.642947, -122.532239],
  [45.642951, -122.530708],
  [45.641786507329016, -122.5307173408503],
  [45.641786507329016, -122.53071734085032],
  [45.640333, -122.530729],
  [45.639771, -122.53074900000001],
  [45.638655, -122.53072500000002],
  [45.638409525599855, -122.53072163171005],
  [45.63840952568353, -122.53072163171117],
  [45.635667, -122.530684],
  [45.63549, -122.53066799999999],
  [45.635236, -122.530664],
  [45.63503767878683, -122.53066903672924],
  [45.63503767850307, -122.53066903673643],
  [45.634921, -122.530672],
  [45.634856, -122.530678],
  [45.634782, -122.53069500000001],
  [45.634731, -122.53070800000002],
  [45.634681, -122.53072300000001],
  [45.634628, -122.530736],
  [45.634575, -122.53075000000001],
  [45.634523, -122.53076700000001],
  [45.634471, -122.53078800000002],
  [45.634419, -122.530811],
  [45.634367, -122.53083500000001],
  [45.634318, -122.53086400000001],
  [45.634267, -122.530893],
  [45.634219, -122.53092500000001],
  [45.63417, -122.53096100000002],
  [45.634123, -122.53099700000001],
  [45.634077, -122.53103700000001],
  [45.634032, -122.53108],
  [45.633988, -122.531123],
  [45.633945, -122.53117000000002],
  [45.633904, -122.53121800000001],
  [45.633862, -122.53127000000002],
  [45.633824, -122.531321],
  [45.633785, -122.53137500000001],
  [45.633749, -122.531432],
  [45.633713, -122.531491],
  [45.633679, -122.53155000000001],
  [45.633646, -122.531612],
  [45.633616, -122.53167500000002],
  [45.633587, -122.531739],
  [45.633558, -122.531806],
  [45.633533, -122.531873],
  [45.633508, -122.531941],
  [45.633485, -122.53201],
  [45.633465, -122.532081],
  [45.633443, -122.532162],
  [45.633418, -122.532244],
  [45.63316, -122.533092],
  [45.633107, -122.533265],
  [45.633061, -122.53341600000002],
  [45.633008, -122.53354400000002],
  [45.632942, -122.53369300000001],
  [45.632859, -122.53384000000001],
  [45.63278, -122.53396100000002],
  [45.632703, -122.53406800000002],
  [45.632651, -122.53413200000001],
  [45.632581, -122.534214],
  [45.632504, -122.53428100000001],
  [45.632423, -122.53434700000001],
  [45.632342, -122.534404],
  [45.632247, -122.53447500000001],
  [45.632134, -122.534538],
  [45.632031, -122.534577],
  [45.631931, -122.534613],
  [45.631821, -122.53463500000001],
  [45.631682, -122.53465500000001],
  [45.631161, -122.53464900000002],
  [45.6308815281036, -122.53465555012261],
  [45.63088152788896, -122.53465555012761],
  [45.630393, -122.53466700000001],
  [45.629494, -122.534646],
  [45.6284, -122.534629],
  [45.628137559994684, -122.53463484824523],
  [45.62813755985371, -122.53463484824837],
  [45.628041, -122.53463699999999],
  [45.62715, -122.53463699999999],
  [45.62539020522672, -122.53463304984336],
  [45.625390205219446, -122.53463304984336],
  [45.625368, -122.53463299999999],
  [45.62355464267239, -122.53461598116068],
  [45.623554642714225, -122.53461598116108],
  [45.623237, -122.534613],
  [45.623087, -122.534614],
  [45.622248, -122.534611],
  [45.622044, -122.534604],
  [45.62195, -122.534588],
  [45.621942, -122.534587],
  [45.621834, -122.534568],
  [45.621664, -122.534509],
  [45.621576, -122.534444],
  [45.621432, -122.53434500000002],
  [45.621323, -122.534255],
  [45.621227, -122.534159],
  [45.621052, -122.53400500000001],
  [45.620148, -122.53300600000001],
  [45.620092, -122.53296100000001],
  [45.620044, -122.53292500000002],
  [45.620013, -122.53289600000001],
  [45.619993, -122.532891],
  [45.619943, -122.53286],
  [45.619892, -122.53283200000001],
  [45.619839, -122.532806],
  [45.619787, -122.532783],
  [45.619733, -122.532764],
  [45.61968, -122.53274600000002],
  [45.619626, -122.53273],
  [45.619572, -122.532718],
  [45.619517, -122.532707],
  [45.618624, -122.53268400000002],
  [45.618396, -122.532675],
  [45.618312, -122.53267100000001],
  [45.618229, -122.53266700000002],
  [45.61816764456421, -122.5326632588149],
  [45.618167645745416, -122.53266325888693],
  [45.618147, -122.532662],
  [45.618065, -122.53265300000001],
  [45.617983, -122.532643],
  [45.617883, -122.53263500000001],
  [45.617646, -122.53257900000001],
  [45.617596, -122.53256600000002],
  [45.617523, -122.53255],
  [45.617448, -122.53254],
  [45.6173, -122.532521],
  [45.617216, -122.53252],
  [45.616271, -122.532507],
  [45.614934, -122.53252300000001],
  [45.61392, -122.53251800000001],
  [45.613719, -122.53251800000001],
  [45.61266, -122.532503],
  [45.612003, -122.53251700000001],
  [45.61176905254251, -122.53251679093171],
  [45.61176905254251, -122.53251679093168],
  [45.610884, -122.53251599999999],
  [45.610805, -122.53250899999999],
  [45.60973, -122.53250799999999],
  [45.609703, -122.532072],
  [45.609693, -122.53192199999998],
  [45.60969261160498, -122.53191682139968],
  [45.609687, -122.531842],
  [45.609679, -122.53176100000002],
  [45.60967, -122.53168099999999],
  [45.609661, -122.5316],
  [45.609651, -122.53152100000001],
  [45.60964, -122.53144099999999],
  [45.609627, -122.53136099999999],
  [45.609615, -122.531283],
  [45.609599, -122.531204],
  [45.609585, -122.53112600000001],
  [45.609569, -122.53104599999999],
  [45.609552, -122.53097],
  [45.609534, -122.53089299999999],
  [45.609515, -122.530816],
  [45.609488, -122.530718],
  [45.609452, -122.530588],
  [45.609429, -122.530515],
  [45.609406, -122.530441],
  [45.609381, -122.530367],
  [45.609355, -122.530294],
  [45.609329, -122.530222],
  [45.609302, -122.53015100000002],
  [45.609274, -122.530079],
  [45.609246, -122.53001],
  [45.609216, -122.52993999999998],
  [45.609185, -122.52987200000001],
  [45.609158, -122.529798],
  [45.609121, -122.52973699999998],
  [45.609089, -122.52967],
  [45.609055, -122.529606],
  [45.60902, -122.529541],
  [45.608985, -122.529478],
  [45.608948, -122.52941499999999],
  [45.608912, -122.529353],
  [45.608874, -122.529291],
  [45.608834, -122.52923199999998],
  [45.608796, -122.52917299999999],
  [45.608756, -122.529115],
  [45.608715, -122.529057],
  [45.608673, -122.52900199999999],
  [45.608632, -122.52894699999999],
  [45.608589, -122.528893],
  [45.608466, -122.528745],
  [45.608168, -122.52821399999999],
  [45.608102, -122.528044],
  [45.608061, -122.527941],
  [45.608024, -122.527836],
  [45.607989, -122.527729],
  [45.607958, -122.52762000000001],
  [45.607929, -122.52751],
  [45.607902, -122.527399],
  [45.607878, -122.527285],
  [45.607857, -122.52717199999998],
  [45.607839, -122.527057],
  [45.607824, -122.52694200000002],
  [45.607811, -122.526857],
  [45.6078, -122.526781],
  [45.607793, -122.52670400000001],
  [45.607787, -122.52662700000002],
  [45.607782, -122.52654899999999],
  [45.607768, -122.526432],
  [45.607789, -122.526212],
  [45.607797, -122.52612400000001],
  [45.607806, -122.526038],
  [45.607816, -122.525952],
  [45.60783, -122.52586600000001],
  [45.607845, -122.52578099999998],
  [45.607862, -122.525698],
  [45.607883, -122.52561500000002],
  [45.607908, -122.525516],
  [45.607928, -122.52542800000002],
  [45.607946, -122.52532699999999],
  [45.607964, -122.525061],
  [45.607982, -122.52399100000001],
  [45.607978, -122.523901],
  [45.607984, -122.523088],
  [45.607982, -122.52300900000002],
  [45.607977, -122.52294499999999],
  [45.607969, -122.522859],
  [45.607933, -122.52266599999999],
  [45.607899, -122.52252199999998],
  [45.607823, -122.52224],
  [45.60769584969578, -122.52183924107817],
  [45.6076958510321, -122.52183924529004],
  [45.607553, -122.52138899999999],
  [45.606645, -122.51885899999999],
  [45.605967, -122.51690299999999],
  [45.605878193720756, -122.51664768194715],
  [45.60587819516607, -122.51664768610246],
  [45.605735, -122.51623600000002],
  [45.605543, -122.51545900000002],
  [45.605457, -122.51504700000001],
  [45.605395, -122.51468400000002],
  [45.605347, -122.51432500000001],
  [45.605307, -122.51395400000001],
  [45.605256, -122.51348100000001],
  [45.605250633518835, -122.51302055591628],
  [45.60525063351956, -122.5130205559782],
  [45.605241, -122.512194],
  [45.605239, -122.512115],
  [45.605231, -122.511908],
  [45.605223, -122.51175500000001],
  [45.605212, -122.511566],
  [45.605197, -122.51137600000001],
  [45.605192, -122.51130400000001],
  [45.605181, -122.511186],
  [45.605175, -122.51111400000002],
  [45.605163, -122.51099800000001],
  [45.605153, -122.510909],
  [45.605142, -122.510805],
  [45.605124, -122.51065100000001],
  [45.605094, -122.51043000000001],
  [45.605066, -122.51024300000002],
  [45.605026, -122.51000200000001],
  [45.604949, -122.509604],
  [45.604856, -122.509163],
  [45.604788, -122.508856],
  [45.60471, -122.50851700000001],
  [45.604662, -122.508308],
  [45.604611, -122.508101],
  [45.604157669829306, -122.50828988757112],
  [45.60415766927122, -122.50828988780363],
  [45.603867, -122.50841099999998],
  [45.603606, -122.508504],
  [45.603469, -122.508559],
  [45.603023, -122.50878399999999],
  [45.602736, -122.50889499999998],
  [45.602614, -122.50895599999998],
  [45.602202, -122.50913599999998],
  [45.602154, -122.509158],
  [45.602088, -122.509181],
  [45.602021, -122.50919399999998],
  [45.601962, -122.50920799999999],
  [45.601873, -122.50923],
  [45.601781, -122.50924299999998],
  [45.601685, -122.509253],
  [45.601544, -122.50924399999998],
  [45.601457, -122.50920699999999],
  [45.601371, -122.50916699999999],
  [45.60131554617479, -122.50914314889238],
  [45.601315549092334, -122.50914315014724],
  [45.601278, -122.509127],
  [45.601182, -122.50908],
  [45.601092, -122.50901899999998],
  [45.600995, -122.50894599999998],
  [45.6009, -122.50885],
  [45.600796, -122.508731],
  [45.600715, -122.50863099999998],
  [45.600649, -122.50853999999998],
  [45.600522, -122.50832399999999],
  [45.600455, -122.508204],
  [45.600404, -122.508092],
  [45.600372, -122.507997],
  [45.600329, -122.50785299999998],
  [45.600309, -122.507777],
  [45.600289, -122.50770299999999],
  [45.600269, -122.50762799999998],
  [45.600252, -122.50755099999999],
  [45.600237, -122.50747299999999],
  [45.600222, -122.507394],
  [45.600211, -122.50731599999999],
  [45.600201, -122.507237],
  [45.600193, -122.507156],
  [45.600189, -122.50707699999998],
  [45.600184, -122.506996],
  [45.600183, -122.506916],
  [45.600210052159554, -122.50615699369476],
  [45.60021005217008, -122.50615699339942],
  [45.600218, -122.505934],
  [45.599586, -122.505926],
  [45.598951, -122.50590299999999],
  [45.597474, -122.505869],
  [45.597293, -122.505864],
  [45.59724, -122.50585100000002],
  [45.597159, -122.50583800000001],
  [45.597072, -122.505814],
  [45.596986, -122.505792],
  [45.5969, -122.50575900000001],
  [45.596824, -122.505729],
  [45.596734, -122.505685],
  [45.59664, -122.505621],
  [45.59655, -122.50554400000001],
  [45.596453, -122.50545899999999],
  [45.596442, -122.505472],
  [45.596285, -122.5057],
  [45.596211, -122.505779],
  [45.596147, -122.505833],
  [45.596124, -122.505856],
  [45.596084, -122.505886],
  [45.596037, -122.505928],
  [45.59599, -122.505971],
  [45.595927, -122.506021],
  [45.595854, -122.50607499999998],
  [45.595774, -122.506134],
  [45.595699, -122.506197],
  [45.5956, -122.506264],
  [45.595391, -122.506423],
  [45.595248, -122.506524],
  [45.595214, -122.50647500000001],
  [45.5951, -122.506449],
  [45.595001, -122.5064],
  [45.594933, -122.506364],
  [45.594871, -122.506328],
  [45.594825, -122.506291],
  [45.594767, -122.50624],
  [45.594783, -122.506236],
  [45.594801, -122.506229],
  [45.594815, -122.506219],
  [45.59483, -122.506206],
  [45.594843, -122.506191],
  [45.594855, -122.50617400000002],
  [45.594864, -122.50615300000001],
  [45.594873, -122.506133],
  [45.594879, -122.50610999999999],
  [45.594882, -122.506087],
  [45.594883, -122.506062],
  [45.594882, -122.50603700000002],
  [45.59488, -122.506013],
  [45.594776, -122.50575200000002],
  [45.594718, -122.50560200000001],
  [45.594377, -122.504744],
  [45.594306, -122.504568],
  [45.594286, -122.504554],
  [45.594262, -122.50454399999998],
  [45.59424, -122.50454],
  [45.594216, -122.504541],
  [45.594194, -122.504548],
  [45.594171, -122.504559],
  [45.594151, -122.504576],
  [45.594133, -122.504596],
  [45.594117, -122.50462199999998],
  [45.594105, -122.50465000000001],
  [45.594096, -122.504681],
  [45.59409, -122.504713],
  [45.594089, -122.504747],
  [45.594091, -122.50477999999998],
  [45.594097, -122.504806],
  [45.594133, -122.504891],
  [45.59435041348022, -122.50538781293139]
];

const stopNames = {
  "1083": "Fourth Plain 10700 Block",
  "2161": "Gher Rd &amp; Fourth Plain Blvd",
  "330": "NE 138th Ave &amp; 28th St",
  "9024": "Van Mall Transit Center: Bay E",
  "1278": "McGillivray &amp; Park Crest Ave",
  "1279": "McGillivray &amp; Briarwood Dr",
  "939": "NE 112th Ave &amp; 34th Cir",
  "932": "NE 112th Ave &amp; 39th St",
  "936": "NE 112th Ave &amp; 51st Cir",
  "6190": "NE 51st Cir &amp; 110th Ave",
  "702": "Van Mall Dr &amp; 94th Ave",
  "2274": "Fourth Plain 10200 Block",
  "323": "Village Loop &amp; McGillivray",
  "324": "NE 136th Ave at Firstenburg Center",
  "325": "NE 138th Ave &amp; 18th St",
  "3322": "NE 28th St &amp; 135th Ave",
  "3319": "NE 28th St 12400 Block",
  "9004": "Fisher&#x27;s Landing Transit Center: Bay E",
  "9003": "Fisher&#x27;s Landing Transit Center: Bay D",
  "3317": "NE 28th St &amp; 119th Ave",
  "6193": "SE 136th Ave &amp; 14th St",
  "6223": "NE 136th Ave &amp; LeRoy Haagen Memorial Dr",
  "3320": "NE 28th St &amp; 129th Ave",
  "6124": "SE 136th Ave &amp; Mill Plain",
  "6127": "McGillivray &amp; Blairmont Dr",
  "6126": "McGillivray &amp; 136th Ave",
  "2179": "NE 112th Ave &amp; 49th St",
  "308": "Village Loop &amp; 162nd Ave",
  "300": "NE 138th Ave &amp; 22nd St",
  "301": "NE 136th Ave &amp; 9th St",
  "302": "NE 136th Ave &amp; 4th St",
  "307": "Village Loop &amp; Fernwood",
  "3316": "NE 28th St &amp; 114th Ave",
  "6185": "NE 51st Cir &amp; 10600 Block",
  "6184": "NE 51st Cir &amp; 112th Ave"
};

const stops = [
  { stop_id: "9024", name: "Van Mall Transit Center: Bay E", lat: 45.656097, lon: -122.584884, times: ["6:20 AM", "6:50 AM", "7:20 AM", "7:50 AM", "8:20 AM", "8:50 AM", "9:20 AM", "9:50 AM"] },
  { stop_id: "702", name: "Van Mall Dr &amp; 94th Ave", lat: 45.658091, lon: -122.576937, times: ["6:21 AM", "6:51 AM", "7:21 AM", "7:51 AM", "8:21 AM", "8:51 AM", "9:21 AM", "9:51 AM"] },
  { stop_id: "2274", name: "Fourth Plain 10200 Block", lat: 45.66195, lon: -122.568066, times: ["6:23 AM", "6:53 AM", "7:23 AM", "7:53 AM", "8:23 AM", "8:53 AM", "9:23 AM", "9:53 AM"] },
  { stop_id: "1083", name: "Fourth Plain 10700 Block", lat: 45.663973, lon: -122.563512, times: ["6:24 AM", "6:54 AM", "7:24 AM", "7:54 AM", "8:24 AM", "8:54 AM", "9:24 AM", "9:54 AM"] },
  { stop_id: "2161", name: "Gher Rd &amp; Fourth Plain Blvd", lat: 45.66455, lon: -122.56126, times: ["6:24 AM", "6:54 AM", "7:25 AM", "7:55 AM", "8:25 AM", "8:55 AM", "9:25 AM", "9:55 AM"] },
  { stop_id: "6184", name: "NE 51st Cir &amp; 112th Ave", lat: 45.658874, lon: -122.559412, times: ["6:26 AM", "6:56 AM", "7:27 AM", "7:57 AM", "8:27 AM", "8:57 AM", "9:27 AM", "9:57 AM"] },
  { stop_id: "6185", name: "NE 51st Cir &amp; 10600 Block", lat: 45.658306, lon: -122.563736, times: ["6:27 AM", "6:57 AM", "7:28 AM", "7:58 AM", "8:28 AM", "8:58 AM", "9:28 AM", "9:58 AM"] },
  { stop_id: "6190", name: "NE 51st Cir &amp; 110th Ave", lat: 45.658467, lon: -122.560295, times: ["6:27 AM", "6:57 AM", "7:28 AM", "7:58 AM", "8:28 AM", "8:58 AM", "9:28 AM", "9:58 AM"] },
  { stop_id: "936", name: "NE 112th Ave &amp; 51st Cir", lat: 45.658408, lon: -122.558149, times: ["6:28 AM", "6:58 AM", "7:29 AM", "7:59 AM", "8:29 AM", "8:59 AM", "9:29 AM", "9:59 AM"] },
  { stop_id: "2179", name: "NE 112th Ave &amp; 49th St", lat: 45.656965, lon: -122.558144, times: ["6:28 AM", "6:58 AM", "7:29 AM", "7:59 AM", "8:29 AM", "8:59 AM", "9:29 AM", "9:59 AM"] },
  { stop_id: "932", name: "NE 112th Ave &amp; 39th St", lat: 45.650854, lon: -122.558289, times: ["6:29 AM", "6:59 AM", "7:31 AM", "8:01 AM", "8:30 AM", "9:00 AM", "9:30 AM", "10:00 AM"] },
  { stop_id: "939", name: "NE 112th Ave &amp; 34th Cir", lat: 45.647067, lon: -122.558377, times: ["6:30 AM", "7:00 AM", "7:32 AM", "8:02 AM", "8:31 AM", "9:01 AM", "9:31 AM", "10:01 AM"] },
  { stop_id: "3316", name: "NE 28th St &amp; 114th Ave", lat: 45.642675, lon: -122.556508, times: ["6:32 AM", "7:02 AM", "7:34 AM", "8:04 AM", "8:33 AM", "9:03 AM", "9:33 AM", "10:03 AM"] },
  { stop_id: "3317", name: "NE 28th St &amp; 119th Ave", lat: 45.642712, lon: -122.550552, times: ["6:32 AM", "7:02 AM", "7:34 AM", "8:04 AM", "8:34 AM", "9:04 AM", "9:34 AM", "10:04 AM"] },
  { stop_id: "3319", name: "NE 28th St 12400 Block", lat: 45.642807, lon: -122.544984, times: ["6:33 AM", "7:03 AM", "7:35 AM", "8:05 AM", "8:34 AM", "9:04 AM", "9:34 AM", "10:04 AM"] },
  { stop_id: "3320", name: "NE 28th St &amp; 129th Ave", lat: 45.642824, lon: -122.539806, times: ["6:34 AM", "7:04 AM", "7:36 AM", "8:06 AM", "8:35 AM", "9:05 AM", "9:35 AM", "10:05 AM"] },
  { stop_id: "3322", name: "NE 28th St &amp; 135th Ave", lat: 45.642849, lon: -122.533532, times: ["6:35 AM", "7:05 AM", "7:37 AM", "8:07 AM", "8:36 AM", "9:06 AM", "9:36 AM", "10:06 AM"] },
  { stop_id: "330", name: "NE 138th Ave &amp; 28th St", lat: 45.641787, lon: -122.530843, times: ["6:35 AM", "7:06 AM", "7:38 AM", "8:08 AM", "8:37 AM", "9:07 AM", "9:37 AM", "10:07 AM"] },
  { stop_id: "300", name: "NE 138th Ave &amp; 22nd St", lat: 45.638409, lon: -122.5308, times: ["6:36 AM", "7:07 AM", "7:39 AM", "8:09 AM", "8:38 AM", "9:08 AM", "9:38 AM", "10:08 AM"] },
  { stop_id: "325", name: "NE 138th Ave &amp; 18th St", lat: 45.63504, lon: -122.530856, times: ["6:37 AM", "7:07 AM", "7:39 AM", "8:09 AM", "8:39 AM", "9:09 AM", "9:39 AM", "10:09 AM"] },
  { stop_id: "6223", name: "NE 136th Ave &amp; LeRoy Haagen Memorial Dr", lat: 45.630883, lon: -122.534784, times: ["6:38 AM", "7:09 AM", "7:41 AM", "8:11 AM", "8:40 AM", "9:10 AM", "9:40 AM", "10:10 AM"] },
  { stop_id: "301", name: "NE 136th Ave &amp; 9th St", lat: 45.628139, lon: -122.534767, times: ["6:38 AM", "7:09 AM", "7:41 AM", "8:11 AM", "8:41 AM", "9:11 AM", "9:41 AM", "10:11 AM"] },
  { stop_id: "324", name: "NE 136th Ave at Firstenburg Center", lat: 45.62539, lon: -122.53482, times: ["6:39 AM", "7:10 AM", "7:42 AM", "8:12 AM", "8:42 AM", "9:12 AM", "9:42 AM", "10:12 AM"] },
  { stop_id: "302", name: "NE 136th Ave &amp; 4th St", lat: 45.623554, lon: -122.534756, times: ["6:39 AM", "7:10 AM", "7:42 AM", "8:12 AM", "8:42 AM", "9:12 AM", "9:42 AM", "10:12 AM"] },
  { stop_id: "6124", name: "SE 136th Ave &amp; Mill Plain", lat: 45.618163, lon: -122.532819, times: ["6:41 AM", "7:12 AM", "7:44 AM", "8:14 AM", "8:44 AM", "9:14 AM", "9:44 AM", "10:14 AM"] },
  { stop_id: "6193", name: "SE 136th Ave &amp; 14th St", lat: 45.611769, lon: -122.532637, times: ["6:42 AM", "7:13 AM", "7:45 AM", "8:15 AM", "8:45 AM", "9:15 AM", "9:45 AM", "10:15 AM"] },
  { stop_id: "6126", name: "McGillivray &amp; 136th Ave", lat: 45.609574, lon: -122.531935, times: ["6:43 AM", "7:14 AM", "7:46 AM", "8:16 AM", "8:46 AM", "9:16 AM", "9:46 AM", "10:16 AM"] },
  { stop_id: "6127", name: "McGillivray &amp; Blairmont Dr", lat: 45.607579, lon: -122.521915, times: ["6:45 AM", "7:16 AM", "7:48 AM", "8:18 AM", "8:48 AM", "9:18 AM", "9:48 AM", "10:18 AM"] },
  { stop_id: "1278", name: "McGillivray &amp; Park Crest Ave", lat: 45.605768, lon: -122.516726, times: ["6:46 AM", "7:17 AM", "7:49 AM", "8:19 AM", "8:49 AM", "9:19 AM", "9:49 AM", "10:19 AM"] },
  { stop_id: "1279", name: "McGillivray &amp; Briarwood Dr", lat: 45.605148, lon: -122.513023, times: ["6:46 AM", "7:17 AM", "7:50 AM", "8:20 AM", "8:50 AM", "9:20 AM", "9:50 AM", "10:20 AM"] },
  { stop_id: "323", name: "Village Loop &amp; McGillivray", lat: 45.604184, lon: -122.508419, times: ["6:47 AM", "7:18 AM", "7:51 AM", "8:21 AM", "8:51 AM", "9:21 AM", "9:51 AM", "10:21 AM"] },
  { stop_id: "307", name: "Village Loop &amp; Fernwood", lat: 45.601288, lon: -122.509274, times: ["6:48 AM", "7:19 AM", "7:52 AM", "8:22 AM", "8:52 AM", "9:22 AM", "9:52 AM", "10:22 AM"] },
  { stop_id: "308", name: "Village Loop &amp; 162nd Ave", lat: 45.600114, lon: -122.50615, times: ["6:49 AM", "7:20 AM", "7:52 AM", "8:22 AM", "8:52 AM", "9:22 AM", "9:52 AM", "10:22 AM"] },
  { stop_id: "9004", name: "Fisher&#x27;s Landing Transit Center: Bay E", lat: 45.594386, lon: -122.505356, times: ["6:51 AM", "7:22 AM", "7:55 AM", "8:25 AM", "8:55 AM", "9:25 AM", "9:55 AM", "10:25 AM"] },
  { stop_id: "9003", name: "Fisher&#x27;s Landing Transit Center: Bay D", lat: 45.594456, lon: -122.505134, times: ["5:28 PM", "5:56 PM", "6:25 PM", "9:20 PM"] },
]

    const polylineOut = L.polyline(shapeOutbound, { color: 'blue', weight: 4, opacity: 0.7 }).addTo(map);
    map.fitBounds(polylineOut.getBounds());

    const nowPT = new Date(new Date().toLocaleString('en-US', { timeZone: 'America/Los_Angeles' }));
    const nowMins = nowPT.getHours() * 60 + nowPT.getMinutes();

    stops.forEach(stop => {
      let highlightedTimes = [];
      let foundNext = false;
      stop.times.forEach(timeStr => {
        let cleanTime = timeStr.trim();
        let [h, m] = cleanTime.split(":");
        let schedMins = parseInt(h, 10) * 60 + parseInt(m, 10);
        if (schedMins < nowMins && nowMins - schedMins > 720) {
          schedMins += 1440;
        }
        if (!foundNext && schedMins >= nowMins) {
          highlightedTimes.push(`<span style="background:#4dd0e1; color:#000; padding:2px 6px; border-radius:6px; font-weight:bold;">${cleanTime}</span>`);
          foundNext = true;
        } else {
          highlightedTimes.push(cleanTime);
        }
      });

      L.circleMarker([stop.lat, stop.lon], {
        radius: 6,
        color: '#4dd0e1',
        fillColor: '#4dd0e1',
        fillOpacity: 0.9,
        weight: 1
      })
      .bindPopup(`<strong>${stop.name}</strong><br>${highlightedTimes.join("<br>") || 'No scheduled times'}`)
      .addTo(map);
    });

    let busMarkers = {};
    async function fetchAndDisplay() {
      const res = await fetch(`https://developer.trimet.org/ws/v2/vehicles?route=${routeNumber}&appID=${apiKey}&json=true`);
      const data = await res.json();
      const buses = (data.resultSet.vehicle || []).filter(v => v.routeNumber == routeNumber && v.direction == direction);

      Object.values(busMarkers).forEach(m => map.removeLayer(m));
      busMarkers = {};
      if (!buses.length) return;

      buses.forEach(bus => {
        if (!bus.latitude || !bus.longitude || !bus.blockID) return;
        const icon = L.divIcon({    
           className: '',
           html: `
            <div style="text-align:center;">
              <div style="background:#0071CE;color:#fff;padding:2px 6px;border-radius:6px;font-weight:bold;">${bus.vehicleID}</div>
              <div style="width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-top:10px solid #00bfff;margin:auto;"></div>
            </div>
          `,
          iconSize: [40, 30], iconAnchor: [20, 30]
        });
        const marker = L.marker([bus.latitude, bus.longitude], { icon }).addTo(map);
        busMarkers[bus.vehicleID] = marker;
      });
    }
    fetchAndDisplay();
    setInterval(fetchAndDisplay, 15000);
  </script>

  <footer class="site-footer">
    <a href="terms.html">Terms of Use</a> &nbsp;|&nbsp;
    <a href="contact.html">Contact Us</a> &nbsp;|&nbsp;
    <a href="report.html">Report a Problem</a> &nbsp;|&nbsp;
    <a href="dmca.html">DMCA</a> &nbsp;|&nbsp;
    <a href="privacy.html">Privacy Policy</a>
  </footer>

  <script>
    if (!localStorage.getItem('cookieConsent')) {
      document.write(`
        <div id="cookie-banner" style="position: fixed; bottom: 0; left: 0; right: 0; background: #333; color: #fff; padding: 1rem; z-index: 1000; font-size: 0.9rem; line-height: 1.4; text-align: center; box-sizing: border-box;">
          📢 We use cookies to improve functionality and analyze traffic.
          By using MetroFeed, you agree to our 
          <a href='privacy.html' style='color: #4dd0e1; text-decoration: underline;'>Privacy Policy</a>.<br>
          <button onclick='localStorage.setItem("cookieConsent", "true"); document.getElementById("cookie-banner").remove();' style='margin-top: 0.5rem; background: #4dd0e1; color: #000; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer; font-weight: bold;'>OK</button>
        </div>
      `);
    }
  </script>
</body>
</html>