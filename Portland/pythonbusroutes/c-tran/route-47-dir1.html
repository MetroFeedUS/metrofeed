<!DOCTYPE html>
<html lang="en">
<head>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EL337T4JX4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-EL337T4JX4');
</script>

<meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Route 47 - Direction 1 | MetroFeed Portland</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #0d0d0d;
      color: #cccccc;
      overflow-y: auto;
    }

    body {
      padding-top: 120px;
    }

    .ad-banner {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: #222;
      padding: 0;
      z-index: 1000;
      box-shadow: 0 2px 2px rgba(0,0,0,0.5);
      text-align: center;
    }

    .ad-banner img {
      width: 100%;
      max-width: 728px;
      max-height: 120px;
      display: block;
      margin: 0 auto;
    }
    .home-button {
      position: fixed;
      top: 120px;
      left: 10px;
      background-color: #4dd0e1;
      color: #0d0d0d;
      padding: 0.5rem 1rem;
      font-weight: bold;
      border-radius: 8px;
      text-decoration: none;
      z-index: 1001;
      box-shadow: 0 0 10px #4dd0e1;
    }

    .home-button:hover {
      background-color: #00bcd4;
      color: #ffffff;
    }

    header {
      background-color: #0d0d0d;
      border-top: 4px solid #4dd0e1;
      border-bottom: 3px solid #4dd0e1;
      padding: 1rem;
      text-align: center;
    }

    header img {
      max-height: 60px;
    }

    h1 {
      text-align: center;
      margin: 1rem 0;
      font-size: 2rem;
      color: #f0f0f0;
    }

    .content-box {
      border-radius: 12px;
      padding: 0;
      margin: 0;
      background-color: #1e1e1e;
    }

    #map {
      width: 100%;
      height: 85vh;
      border: none;
      margin: 0 auto;
      display: block;
      border-radius: 8px;
    }

    .button-bar {
      display: flex;
      justify-content: center;
      margin: 1rem 0;
    }

    .button-bar a, .back-button {
      background: #4dd0e1;
      color: #0d0d0d;
      padding: 0.6rem 1.2rem;
      text-decoration: none;
      border-radius: 8px;
      font-weight: bold;
      border: none;
      cursor: pointer;
      box-shadow: 0 0 10px #4dd0e1;
    }

    .back-button:hover {
      background-color: #35c0d6;
    }

    .site-footer {
      text-align: center;
      margin-top: 3rem;
      margin-bottom: 120px;
      font-size: 0.85rem;
      color: #aaa;
    }

    .site-footer a {
      color: #00BFFF;
      text-decoration: none;
    }

    .site-footer a:hover {
      text-decoration: underline;
    }

    @media (max-width: 600px) {
      .ad-banner {
        padding-top: 1rem;
        padding-bottom: 0rem;
      }
    }
  </style>
</head>

<body>
  <div class="ad-banner">
    <iframe src="https://metrofeedus.com/portland/Ads/route-47-dir1-ad.html" style="border:none; width:100%; max-width: 728px; height:90px;"></iframe>
  </div>

  <header>
    <img src="MetroFeedPortlandLogo.png" alt="MetroFeed Portland">
  </header>

  <div class="disclaimer" style="margin: 1rem auto 0.5rem; max-width: 600px; font-size: 0.8rem; color: #bbb; text-align: center; padding: 0.5rem 1rem; background-color: #111; border: 1px dashed #444; border-radius: 6px;">
    ⚠️ This is a Beta program, work in progress. Please REPORT bugs and pretend to be impressed.
  </div>
  <div class="disclaimer" style="margin: 0 auto 1rem; max-width: 600px; font-size: 0.75rem; color: #888; text-align: center; padding: 0.25rem 1rem;">
    This tool is not affiliated with or endorsed by TriMet. For official schedules and service alerts, visit <a href="https://trimet.org" style="color:#4dd0e1;">trimet.org</a>.
  </div>

  <div style="margin: 2rem 0; text-align: center;">
    <button class="back-button" onclick="history.back()">Back</button>
  </div>

  <h1>Route 47 - Direction 1</h1>

  <div class="content-box">
    <div id="map"></div>
    <div style="text-align:right; font-size: 0.7rem; color: #777; margin-top: 0.5rem;">
      Data courtesy of TriMet.
    </div>
  </div>

  <script>
    if (document.referrer === "" && performance.navigation.type === 0) {
      window.location.href = "/index.html";
    }

    const apiKey = "2C4447D4A42083BCD84DE3B8E";
    const routeNumber = 47;
    const direction = parseInt(1);

    const map = L.map('map', {
      center: [45.6, -122.7],
      zoom: 12,
      minZoom: 12,
      maxZoom: 18,
      maxBounds: [[45.3, -123.1], [45.9, -122.3]],
      maxBoundsViscosity: 1.0
    });
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);

    const shapeOutbound = [
  [45.866795824308255, -122.40835081691672],
  [45.8668, -122.40865500000001],
  [45.866799, -122.409306],
  [45.865906, -122.40933500000001],
  [45.865902, -122.409046],
  [45.865891, -122.408416],
  [45.865892, -122.407946],
  [45.865897, -122.407135],
  [45.864973, -122.406558],
  [45.864099, -122.405969],
  [45.863177, -122.405379],
  [45.862277, -122.40479400000001],
  [45.86195, -122.40458300000002],
  [45.860324, -122.403526],
  [45.858393, -122.402265],
  [45.857397, -122.401618],
  [45.856888, -122.40129200000001],
  [45.856377, -122.400951],
  [45.855585, -122.40043400000002],
  [45.855141, -122.400148],
  [45.854825, -122.399935],
  [45.85431, -122.399602],
  [45.853292, -122.39894300000002],
  [45.852897, -122.39869100000001],
  [45.852612, -122.398516],
  [45.852003, -122.39809800000002],
  [45.850899, -122.397385],
  [45.849843, -122.396688],
  [45.849354, -122.39637],
  [45.848781, -122.39601000000002],
  [45.847702, -122.395294],
  [45.847089, -122.394913],
  [45.846372, -122.39444400000001],
  [45.846055, -122.394251],
  [45.845991, -122.39421300000001],
  [45.845935, -122.394172],
  [45.845876, -122.394128],
  [45.845822, -122.39408000000002],
  [45.84577, -122.394027],
  [45.845727, -122.393963],
  [45.845692, -122.393903],
  [45.845658, -122.39383200000002],
  [45.845638, -122.393772],
  [45.845622, -122.39371400000002],
  [45.845587, -122.393565],
  [45.845573, -122.393508],
  [45.845552, -122.39345200000001],
  [45.84552, -122.39338199999999],
  [45.845483, -122.393324],
  [45.845445, -122.39327800000001],
  [45.845409, -122.393241],
  [45.845372, -122.393209],
  [45.845323, -122.393166],
  [45.845242, -122.39311100000002],
  [45.845083, -122.393009],
  [45.844884, -122.392882],
  [45.844689, -122.392757],
  [45.844389, -122.39255500000002],
  [45.844127, -122.392382],
  [45.843882, -122.39222],
  [45.843596, -122.392033],
  [45.843275, -122.391819],
  [45.842986, -122.391632],
  [45.842546, -122.391344],
  [45.842113, -122.391059],
  [45.841686, -122.39078],
  [45.841382, -122.390579],
  [45.840987, -122.39031300000002],
  [45.840641, -122.39008700000001],
  [45.84006, -122.389699],
  [45.839766, -122.389502],
  [45.839391, -122.38922300000002],
  [45.838978, -122.388901],
  [45.83881, -122.388772],
  [45.838725, -122.388705],
  [45.838484, -122.38851600000001],
  [45.838285, -122.388338],
  [45.837999, -122.388059],
  [45.83786, -122.387908],
  [45.837742, -122.38776800000001],
  [45.837679, -122.387687],
  [45.837598, -122.387572],
  [45.837567, -122.387523],
  [45.837531, -122.387464],
  [45.837467, -122.38734600000001],
  [45.837415, -122.38724900000001],
  [45.837358, -122.387127],
  [45.837251, -122.386882],
  [45.837131, -122.38660600000001],
  [45.837089, -122.38650900000002],
  [45.837061, -122.38644399999998],
  [45.837026, -122.38637],
  [45.83699, -122.386291],
  [45.836951, -122.386209],
  [45.836907, -122.38611900000001],
  [45.836858, -122.38603900000001],
  [45.836808, -122.38596],
  [45.836742, -122.38587100000001],
  [45.83667, -122.38578],
  [45.83661, -122.385712],
  [45.83654, -122.38564699999999],
  [45.83648, -122.385592],
  [45.836397, -122.38553000000002],
  [45.83631, -122.38547],
  [45.836234, -122.385426],
  [45.836155, -122.385385],
  [45.836076, -122.38534900000002],
  [45.835999, -122.38531200000001],
  [45.835914, -122.385274],
  [45.835817, -122.38523200000002],
  [45.835694, -122.38518800000001],
  [45.835585, -122.385152],
  [45.835485, -122.385125],
  [45.83539, -122.385106],
  [45.835274, -122.385088],
  [45.835158, -122.38508399999999],
  [45.835039, -122.38508],
  [45.834931, -122.385083],
  [45.83475, -122.385089],
  [45.834507, -122.385106],
  [45.834344, -122.385116],
  [45.834156, -122.38512700000001],
  [45.834003, -122.385143],
  [45.833847, -122.385168],
  [45.833685, -122.385213],
  [45.833508, -122.385264],
  [45.833447, -122.385283],
  [45.833313, -122.38532200000002],
  [45.833214, -122.385355],
  [45.833144, -122.385382],
  [45.833069, -122.385412],
  [45.832957, -122.38547],
  [45.832857, -122.38553000000002],
  [45.832779, -122.385592],
  [45.8327, -122.38566400000002],
  [45.832632, -122.38573400000001],
  [45.832554, -122.385844],
  [45.832491, -122.385934],
  [45.832433, -122.38604499999998],
  [45.832383, -122.38615000000001],
  [45.832317, -122.38629700000001],
  [45.832274, -122.386429],
  [45.832241, -122.38655900000002],
  [45.832218, -122.386662],
  [45.832136, -122.387054],
  [45.832095, -122.387247],
  [45.832087, -122.387288],
  [45.832008, -122.387679],
  [45.831908, -122.388151],
  [45.831858, -122.388413],
  [45.831836, -122.388561],
  [45.831821, -122.38870999999999],
  [45.831815, -122.38883800000002],
  [45.831814, -122.38894800000001],
  [45.831816, -122.389067],
  [45.831824, -122.38917900000001],
  [45.831844, -122.389353],
  [45.831871, -122.389544],
  [45.831897, -122.389674],
  [45.831917, -122.38975600000002],
  [45.831994, -122.390029],
  [45.832053, -122.390201],
  [45.832114, -122.390361],
  [45.832177, -122.390505],
  [45.832231, -122.390608],
  [45.832286, -122.39070400000001],
  [45.832329, -122.390781],
  [45.832407, -122.39092500000001],
  [45.832434, -122.390984],
  [45.832463, -122.391047],
  [45.8325, -122.391142],
  [45.832519, -122.391201],
  [45.83255, -122.391295],
  [45.832579, -122.391403],
  [45.832596, -122.39146900000001],
  [45.832662, -122.391779],
  [45.832692, -122.39195400000001],
  [45.832757, -122.392314],
  [45.832877, -122.392982],
  [45.832979, -122.39355300000001],
  [45.833076, -122.394111],
  [45.833182, -122.39462900000001],
  [45.833229, -122.394933],
  [45.833254, -122.395137],
  [45.833265, -122.395284],
  [45.83327, -122.395439],
  [45.833264, -122.395587],
  [45.833248, -122.39576200000002],
  [45.833219, -122.39601300000001],
  [45.83316, -122.396364],
  [45.833082, -122.396823],
  [45.833006, -122.397257],
  [45.832899, -122.397874],
  [45.832778, -122.39858000000001],
  [45.832685, -122.39914300000001],
  [45.83262, -122.39950200000001],
  [45.832587, -122.399726],
  [45.832554, -122.399939],
  [45.832533, -122.400164],
  [45.832527, -122.400362],
  [45.832532, -122.400486],
  [45.832537, -122.40064500000001],
  [45.832552, -122.400825],
  [45.832575, -122.401035],
  [45.832608, -122.40127500000001],
  [45.832665, -122.401787],
  [45.832757, -122.402633],
  [45.832815, -122.40321900000002],
  [45.83284, -122.403431],
  [45.832869, -122.403713],
  [45.83289, -122.403962],
  [45.832906, -122.404128],
  [45.832932, -122.40438499999999],
  [45.832957, -122.404595],
  [45.832983, -122.404833],
  [45.833007, -122.40502600000002],
  [45.833031, -122.40517300000002],
  [45.833058, -122.405334],
  [45.833087, -122.40548700000001],
  [45.833113, -122.40560500000001],
  [45.833145, -122.405731],
  [45.83318, -122.405864],
  [45.833218, -122.405985],
  [45.833266, -122.406136],
  [45.833313, -122.40626600000002],
  [45.833356, -122.406374],
  [45.833407, -122.406499],
  [45.834681, -122.409688],
  [45.835103, -122.410752],
  [45.83519, -122.410973],
  [45.835285, -122.411213],
  [45.835327, -122.41132000000002],
  [45.835569, -122.41193],
  [45.835763, -122.41245200000002],
  [45.836062, -122.41326300000001],
  [45.836354, -122.41404399999999],
  [45.836535, -122.414531],
  [45.836671, -122.414909],
  [45.836917, -122.415571],
  [45.837086, -122.416031],
  [45.837206, -122.416328],
  [45.837326, -122.416589],
  [45.837432, -122.416783],
  [45.83753, -122.416961],
  [45.837612, -122.417096],
  [45.837709, -122.417232],
  [45.83778, -122.417327],
  [45.837866, -122.417435],
  [45.837951, -122.41753000000001],
  [45.838078, -122.41768],
  [45.838691, -122.418359],
  [45.839078, -122.418788],
  [45.83966, -122.41943700000002],
  [45.839733, -122.41953000000001],
  [45.839858, -122.41969],
  [45.839976, -122.419841],
  [45.840066, -122.42000000000002],
  [45.840155, -122.42015100000002],
  [45.840232, -122.42029],
  [45.840319, -122.42045],
  [45.840382, -122.420587],
  [45.840447, -122.420736],
  [45.840508, -122.42088],
  [45.840562, -122.42102900000002],
  [45.840615, -122.42119300000002],
  [45.840892, -122.42209800000002],
  [45.840999, -122.42245600000001],
  [45.841032, -122.422576],
  [45.841058, -122.422682],
  [45.841077, -122.422803],
  [45.841088, -122.42290300000002],
  [45.841095, -122.423008],
  [45.841096, -122.42311300000001],
  [45.841093, -122.423229],
  [45.841084, -122.423332],
  [45.841069, -122.423436],
  [45.841049, -122.423551],
  [45.84102, -122.423685],
  [45.840987, -122.42382400000001],
  [45.840907, -122.42413600000002],
  [45.84081, -122.42450100000002],
  [45.840721, -122.424811],
  [45.84056, -122.425337],
  [45.840403, -122.425853],
  [45.840297, -122.42623300000001],
  [45.840189, -122.426652],
  [45.840128, -122.426896],
  [45.840115, -122.42695100000002],
  [45.840062, -122.42716200000001],
  [45.839994, -122.42747000000001],
  [45.839802, -122.428411],
  [45.839785, -122.428494],
  [45.839769, -122.42856900000001],
  [45.839621, -122.429284],
  [45.839529, -122.42972],
  [45.839502, -122.42986700000002],
  [45.839471, -122.43007],
  [45.839458, -122.430183],
  [45.839451, -122.430308],
  [45.839448, -122.43042],
  [45.839452, -122.43054100000002],
  [45.839464, -122.430679],
  [45.839478, -122.43079099999999],
  [45.839499, -122.430912],
  [45.83952, -122.431018],
  [45.839543, -122.431109],
  [45.839573, -122.43121699999999],
  [45.8396, -122.431302],
  [45.839637, -122.43139800000002],
  [45.839674, -122.43148600000002],
  [45.83972, -122.43157900000001],
  [45.839768, -122.431668],
  [45.839826, -122.43177000000001],
  [45.840004, -122.43206200000002],
  [45.840113, -122.43226],
  [45.840211, -122.432449],
  [45.840311, -122.432645],
  [45.840404, -122.43283300000002],
  [45.840471, -122.43297599999998],
  [45.840536, -122.43313],
  [45.840576, -122.433243],
  [45.840617, -122.433363],
  [45.840663, -122.43354],
  [45.840705, -122.43373400000002],
  [45.840742, -122.43393200000001],
  [45.84077, -122.43409600000001],
  [45.840797, -122.434273],
  [45.840822, -122.434435],
  [45.840842, -122.43459200000001],
  [45.840872, -122.43489000000001],
  [45.840912, -122.435268],
  [45.840942, -122.435533],
  [45.840971, -122.435753],
  [45.840995, -122.435884],
  [45.841039, -122.436092],
  [45.841089, -122.43629],
  [45.841148, -122.43645500000001],
  [45.841215, -122.436699],
  [45.841294, -122.43696],
  [45.841344, -122.43712],
  [45.841381, -122.437275],
  [45.841407, -122.437428],
  [45.841418, -122.437604],
  [45.841424, -122.43777],
  [45.841424, -122.43779000000002],
  [45.841426, -122.43788300000001],
  [45.841417, -122.43801400000001],
  [45.841394, -122.43824600000002],
  [45.841358, -122.43852400000002],
  [45.841336, -122.438705],
  [45.841325, -122.43879100000001],
  [45.841284, -122.43906600000001],
  [45.841239, -122.439323],
  [45.841187, -122.439574],
  [45.840985, -122.440352],
  [45.840942, -122.440545],
  [45.840886, -122.440861],
  [45.840827, -122.44123399999998],
  [45.840761, -122.44170800000002],
  [45.840659, -122.442441],
  [45.840533, -122.443292],
  [45.840522, -122.443398],
  [45.840477, -122.443714],
  [45.840452, -122.443917],
  [45.840435, -122.44412800000002],
  [45.840426, -122.444343],
  [45.840421, -122.44456600000001],
  [45.840428, -122.444776],
  [45.840438, -122.444983],
  [45.840453, -122.44515],
  [45.840475, -122.445304],
  [45.840503, -122.445473],
  [45.840542, -122.44565900000002],
  [45.840581, -122.445835],
  [45.840623, -122.446037],
  [45.840664, -122.44624],
  [45.840694, -122.44642900000001],
  [45.840715, -122.44661],
  [45.840729, -122.44677],
  [45.840737, -122.446959],
  [45.840755, -122.447868],
  [45.84077, -122.448564],
  [45.840789, -122.449358],
  [45.840788, -122.44952700000002],
  [45.840781, -122.449698],
  [45.840768, -122.449911],
  [45.840753, -122.450068],
  [45.840654, -122.45097800000002],
  [45.840634, -122.451188],
  [45.84062, -122.451428],
  [45.840611, -122.451858],
  [45.840657, -122.452695],
  [45.840668, -122.453155],
  [45.840672, -122.45428499999998],
  [45.840669, -122.454997],
  [45.840661, -122.45548200000002],
  [45.840647, -122.45586],
  [45.840627, -122.456288],
  [45.840608, -122.456563],
  [45.840583, -122.456832],
  [45.840537, -122.45725],
  [45.840516, -122.45743600000002],
  [45.840479, -122.457681],
  [45.840428, -122.457926],
  [45.84039, -122.45810000000002],
  [45.840308, -122.458406],
  [45.840208, -122.45873900000001],
  [45.840105, -122.45903],
  [45.839956, -122.4595],
  [45.839701, -122.460239],
  [45.839438, -122.460987],
  [45.839209, -122.46162200000002],
  [45.839077, -122.462002],
  [45.839044, -122.462093],
  [45.838818, -122.462716],
  [45.838738, -122.462883],
  [45.838665, -122.463034],
  [45.838549, -122.463245],
  [45.838348, -122.46358900000001],
  [45.83808, -122.464071],
  [45.837953, -122.464282],
  [45.837767, -122.464573],
  [45.837272, -122.46523800000001],
  [45.837025, -122.465576],
  [45.836881, -122.465794],
  [45.836837, -122.465891],
  [45.836802, -122.466011],
  [45.836766, -122.46615000000001],
  [45.836744, -122.466322],
  [45.836728, -122.46648],
  [45.83669, -122.467016],
  [45.836672, -122.467253],
  [45.836646, -122.467505],
  [45.836625, -122.46763500000002],
  [45.836605, -122.46775900000002],
  [45.83655, -122.468037],
  [45.836472, -122.46836800000001],
  [45.836379, -122.46881800000001],
  [45.836318, -122.46910300000002],
  [45.836263, -122.469295],
  [45.836211, -122.469466],
  [45.836139, -122.469673],
  [45.836027, -122.46995400000002],
  [45.835863, -122.47033600000002],
  [45.83576, -122.470575],
  [45.835668, -122.47078200000001],
  [45.835603, -122.47098600000001],
  [45.835564, -122.47116700000001],
  [45.835527, -122.471362],
  [45.835491, -122.471604],
  [45.835463, -122.471849],
  [45.835434, -122.47209200000002],
  [45.835398, -122.472398],
  [45.835364, -122.47266800000001],
  [45.835313, -122.473139],
  [45.835296, -122.473333],
  [45.835284, -122.473613],
  [45.835284, -122.47367700000001],
  [45.835288, -122.47420000000001],
  [45.835289, -122.47445399999998],
  [45.835281, -122.47495800000002],
  [45.835299, -122.47566500000002],
  [45.835297, -122.475965],
  [45.835296, -122.47625400000001],
  [45.835298, -122.47696799999999],
  [45.835305, -122.477814],
  [45.835311, -122.478273],
  [45.835311, -122.478729],
  [45.835307, -122.47889],
  [45.83529, -122.479105],
  [45.835275, -122.47925100000002],
  [45.835259, -122.479394],
  [45.835233, -122.479562],
  [45.835096, -122.48029600000001],
  [45.835017, -122.480731],
  [45.834976, -122.480958],
  [45.834918, -122.481327],
  [45.834888, -122.48153300000001],
  [45.83484, -122.481857],
  [45.834777, -122.482249],
  [45.834678, -122.482836],
  [45.834636, -122.483126],
  [45.834606, -122.483328],
  [45.834583, -122.48353],
  [45.834567, -122.483721],
  [45.834561, -122.48392],
  [45.834566, -122.484377],
  [45.834576, -122.484851],
  [45.834581, -122.485151],
  [45.834618, -122.48608],
  [45.834618, -122.48612800000001],
  [45.834621, -122.48639300000002],
  [45.834607, -122.48658100000002],
  [45.834582, -122.486775],
  [45.834544, -122.48698199999998],
  [45.834495, -122.487183],
  [45.834408, -122.487473],
  [45.834276, -122.487909],
  [45.83421, -122.48812900000001],
  [45.834153, -122.48833000000002],
  [45.834116, -122.48847100000002],
  [45.834086, -122.488602],
  [45.834067, -122.48872799999998],
  [45.834047, -122.488884],
  [45.834037, -122.489055],
  [45.834033, -122.489246],
  [45.83404, -122.489538],
  [45.834063, -122.489948],
  [45.834089, -122.49042500000002],
  [45.834109, -122.490738],
  [45.834147, -122.491193],
  [45.834181, -122.491552],
  [45.834226, -122.491891],
  [45.834291, -122.492336],
  [45.834515, -122.493584],
  [45.834536, -122.493721],
  [45.834555, -122.493868],
  [45.834564, -122.494008],
  [45.83456, -122.494124],
  [45.834548, -122.494318],
  [45.834435, -122.494298],
  [45.834048, -122.494308],
  [45.833945, -122.494327],
  [45.833828, -122.494358],
  [45.833736, -122.494398],
  [45.833635, -122.49445000000001],
  [45.833599, -122.49448299999999],
  [45.833515, -122.49455700000001],
  [45.833349, -122.494745],
  [45.833203, -122.494921],
  [45.833015, -122.495134],
  [45.832929, -122.495215],
  [45.832809, -122.495289],
  [45.832695, -122.495342],
  [45.832581, -122.495386],
  [45.832447, -122.495424],
  [45.83232, -122.495464],
  [45.832131, -122.495514],
  [45.832032, -122.495533],
  [45.831903, -122.495558],
  [45.831824, -122.495568],
  [45.831773, -122.495573],
  [45.831675, -122.495573],
  [45.831333, -122.495594],
  [45.830095, -122.495591],
  [45.828142, -122.495571],
  [45.827316, -122.495573],
  [45.824784, -122.495573],
  [45.824561, -122.495567],
  [45.824544, -122.500123],
  [45.824541, -122.501373],
  [45.824538, -122.50308299999999],
  [45.824536, -122.503846],
  [45.824529, -122.504103],
  [45.824523, -122.50419300000001],
  [45.824515, -122.504267],
  [45.824504, -122.504347],
  [45.824482, -122.504433],
  [45.824463, -122.504509],
  [45.824433, -122.504596],
  [45.8244, -122.504671],
  [45.824367, -122.50474],
  [45.824328, -122.50481000000002],
  [45.824288, -122.504872],
  [45.824235, -122.504938],
  [45.824183, -122.50500000000001],
  [45.824122, -122.50505800000002],
  [45.824059, -122.505109],
  [45.823964, -122.505175],
  [45.823536, -122.505423],
  [45.823447, -122.505473],
  [45.823329, -122.505557],
  [45.823248, -122.505622],
  [45.823202, -122.505669],
  [45.823154, -122.50572700000001],
  [45.823113, -122.505782],
  [45.82308, -122.505845],
  [45.823052, -122.50591200000001],
  [45.823032, -122.50597200000001],
  [45.823012, -122.50605199999998],
  [45.822999, -122.506124],
  [45.822994, -122.50619700000001],
  [45.822993, -122.506255],
  [45.822995, -122.506324],
  [45.822999, -122.506393],
  [45.823011, -122.50645800000001],
  [45.823021, -122.506511],
  [45.823041, -122.506578],
  [45.823064, -122.50664199999999],
  [45.823094, -122.50671],
  [45.823131, -122.50678700000002],
  [45.823171, -122.50686],
  [45.823395, -122.507213],
  [45.823446, -122.507298],
  [45.823498, -122.507385],
  [45.823541, -122.507462],
  [45.823577, -122.50753399999999],
  [45.823615, -122.50762],
  [45.823653, -122.507721],
  [45.823683, -122.507813],
  [45.82371, -122.50790599999999],
  [45.823739, -122.508013],
  [45.823764, -122.508139],
  [45.823779, -122.50823],
  [45.823793, -122.508333],
  [45.823802, -122.50843200000001],
  [45.823804, -122.508545],
  [45.823804, -122.50866299999998],
  [45.8238, -122.50877],
  [45.823795, -122.50888400000001],
  [45.823787, -122.508974],
  [45.823764, -122.50913200000001],
  [45.82374, -122.509285],
  [45.823697, -122.50954099999998],
  [45.823655, -122.50978000000002],
  [45.823557, -122.510338],
  [45.823517, -122.510615],
  [45.823501, -122.51071100000001],
  [45.823491, -122.510801],
  [45.82348, -122.510885],
  [45.823473, -122.510961],
  [45.823471, -122.511037],
  [45.82347, -122.511106],
  [45.82347, -122.51117],
  [45.823473, -122.511246],
  [45.823479, -122.511316],
  [45.823487, -122.51138800000001],
  [45.823497, -122.51145200000002],
  [45.82351, -122.511537],
  [45.823524, -122.5116],
  [45.823541, -122.51166700000002],
  [45.823561, -122.511732],
  [45.823582, -122.511796],
  [45.823613, -122.511865],
  [45.823644, -122.51193400000001],
  [45.823712, -122.512061],
  [45.823748, -122.51211900000001],
  [45.82382, -122.512228],
  [45.823904, -122.512344],
  [45.824005, -122.51247400000001],
  [45.824077, -122.512573],
  [45.824138, -122.512659],
  [45.824207, -122.512765],
  [45.824263, -122.512862],
  [45.824291, -122.512911],
  [45.824319, -122.512965],
  [45.824349, -122.513023],
  [45.824379, -122.51308],
  [45.824403, -122.51314],
  [45.824428, -122.513199],
  [45.824456, -122.513276],
  [45.824478, -122.51334300000002],
  [45.824497, -122.51341600000002],
  [45.824516, -122.51350300000001],
  [45.824529, -122.51357999999999],
  [45.824544, -122.51368100000002],
  [45.824558, -122.51378],
  [45.824563, -122.513901],
  [45.82457, -122.514082],
  [45.824569, -122.514323],
  [45.824565, -122.514928],
  [45.824571, -122.516551],
  [45.824564, -122.516682],
  [45.824567, -122.517378],
  [45.824565, -122.517842],
  [45.824567, -122.51799700000001],
  [45.824568, -122.518676],
  [45.824573, -122.519041],
  [45.824576, -122.519182],
  [45.824568, -122.520159],
  [45.824564, -122.520623],
  [45.824551, -122.52077300000002],
  [45.824533, -122.520921],
  [45.824505, -122.521026],
  [45.824478, -122.52111100000002],
  [45.824439, -122.52120800000002],
  [45.8244, -122.52129500000001],
  [45.824346, -122.52139],
  [45.824279, -122.521479],
  [45.824219, -122.521545],
  [45.824148, -122.521609],
  [45.824124, -122.521626],
  [45.824085, -122.52165400000001],
  [45.824031, -122.521686],
  [45.823968, -122.521716],
  [45.823884, -122.521747],
  [45.823798, -122.521766],
  [45.823691, -122.521779],
  [45.823595, -122.521781],
  [45.82273, -122.52177400000001],
  [45.822646, -122.52177500000002],
  [45.822454, -122.521776],
  [45.820982, -122.52178],
  [45.820906, -122.521779],
  [45.820419, -122.521785],
  [45.819611, -122.521795],
  [45.818681, -122.521795],
  [45.817332, -122.521794],
  [45.817157, -122.52179800000002],
  [45.816315, -122.521794],
  [45.81545, -122.521793],
  [45.815065, -122.521797],
  [45.814672, -122.521797],
  [45.81441, -122.521786],
  [45.813583, -122.52179200000002],
  [45.813211, -122.521786],
  [45.812718, -122.521785],
  [45.810042, -122.521772],
  [45.809913, -122.52178],
  [45.809871, -122.521785],
  [45.809826, -122.52179200000002],
  [45.809766, -122.52179800000002],
  [45.809711, -122.521806],
  [45.809661, -122.521814],
  [45.809596, -122.52183],
  [45.809538, -122.52185099999998],
  [45.809478, -122.521869],
  [45.809424, -122.521894],
  [45.809369, -122.52192],
  [45.809307, -122.52195600000002],
  [45.809247, -122.521995],
  [45.809184, -122.522038],
  [45.809128, -122.522082],
  [45.809074, -122.522127],
  [45.809024, -122.52217300000001],
  [45.808976, -122.52222],
  [45.808926, -122.52227400000001],
  [45.808875, -122.52233400000001],
  [45.808827, -122.522396],
  [45.808774, -122.52246500000001],
  [45.808721, -122.52254200000002],
  [45.808623, -122.52267600000002],
  [45.808451, -122.52295100000002],
  [45.808247, -122.52325900000001],
  [45.808122, -122.523451],
  [45.807895, -122.523795],
  [45.807742, -122.524033],
  [45.807625, -122.52423100000001],
  [45.807584, -122.524296],
  [45.807518, -122.524404],
  [45.807282, -122.524836],
  [45.806893, -122.52556500000001],
  [45.806691, -122.525939],
  [45.806628, -122.526043],
  [45.80658, -122.526122],
  [45.806515, -122.526217],
  [45.806447, -122.526303],
  [45.806385, -122.526375],
  [45.806327, -122.526441],
  [45.806263, -122.526502],
  [45.806194, -122.526564],
  [45.806131, -122.526616],
  [45.806058, -122.52666800000002],
  [45.805975, -122.52672200000002],
  [45.805863, -122.526772],
  [45.805815, -122.526799],
  [45.805717, -122.526823],
  [45.805625, -122.52684200000002],
  [45.805534, -122.52686200000001],
  [45.80535, -122.52687],
  [45.805263, -122.52686900000002],
  [45.804601, -122.52685],
  [45.803687, -122.526821],
  [45.80289, -122.526826],
  [45.802752, -122.52682499999999],
  [45.801842, -122.52681],
  [45.800917, -122.52678500000002],
  [45.800495, -122.52677100000001],
  [45.800262, -122.52676500000001],
  [45.799844, -122.526751],
  [45.799304, -122.52673800000001],
  [45.799131, -122.526734],
  [45.798293, -122.526717],
  [45.797894, -122.526715],
  [45.797365, -122.526717],
  [45.796483, -122.526706],
  [45.796233, -122.526697],
  [45.795998, -122.52669500000002],
  [45.795842, -122.526688],
  [45.795493, -122.526685],
  [45.795238, -122.526686],
  [45.794618, -122.526689],
  [45.794304, -122.52669100000001],
  [45.793726, -122.5267],
  [45.793248, -122.52671],
  [45.793133, -122.526713],
  [45.792405, -122.52672200000002],
  [45.791904, -122.526729],
  [45.791741, -122.52673100000001],
  [45.790663, -122.52674500000002],
  [45.789441, -122.52676100000001],
  [45.788252, -122.526767],
  [45.787949, -122.52679],
  [45.787302, -122.526806],
  [45.786994, -122.52681],
  [45.786948, -122.52681],
  [45.786465, -122.52681900000002],
  [45.786112, -122.526823],
  [45.785936, -122.526823],
  [45.785833, -122.52682800000001],
  [45.785755, -122.526843],
  [45.785699, -122.526864],
  [45.785646, -122.526888],
  [45.785593, -122.52692200000001],
  [45.78552, -122.526982],
  [45.785484, -122.527022],
  [45.785446, -122.527068],
  [45.785401, -122.52713000000001],
  [45.785352, -122.527195],
  [45.785291, -122.527289],
  [45.785205, -122.52740099999998],
  [45.785039, -122.527618],
  [45.784919, -122.527749],
  [45.784834, -122.527845],
  [45.784742, -122.52794100000001],
  [45.784657, -122.52802],
  [45.784566, -122.528101],
  [45.784485, -122.52816600000001],
  [45.784413, -122.528227],
  [45.784311, -122.528306],
  [45.784286, -122.528326],
  [45.78416, -122.52841400000001],
  [45.784041, -122.52849],
  [45.783933, -122.52855100000001],
  [45.783831, -122.528607],
  [45.783669, -122.52868200000002],
  [45.783514, -122.52875],
  [45.783475, -122.52876600000002],
  [45.783366, -122.528811],
  [45.783255, -122.528857],
  [45.783126, -122.52891299999999],
  [45.782763, -122.52906100000001],
  [45.782514, -122.529163],
  [45.782388, -122.529199],
  [45.782279, -122.52921800000001],
  [45.782159, -122.529229],
  [45.782021, -122.52923500000001],
  [45.781882, -122.529229],
  [45.781684, -122.529215],
  [45.78119361661902, -122.52919869916738],
  [45.78119362156576, -122.52919869933183],
  [45.780962, -122.52919100000001],
  [45.780948, -122.530218],
  [45.780935, -122.53168500000001],
  [45.78093, -122.532135],
  [45.780919, -122.53302700000002],
  [45.780903, -122.534294],
  [45.780885, -122.53530600000002],
  [45.780873, -122.536341],
  [45.780872, -122.53674300000002],
  [45.780878, -122.53691700000002],
  [45.780876, -122.537349],
  [45.780869, -122.53789800000001],
  [45.78086, -122.53827100000001],
  [45.780846, -122.538745],
  [45.780834, -122.539016],
  [45.78082058397434, -122.54005350598408],
  [45.78082058397297, -122.54005350609059],
  [45.780813, -122.54064],
  [45.780771, -122.54321000000002],
  [45.780762020861154, -122.54453172923849],
  [45.780762020861125, -122.54453172924138],
  [45.780761, -122.54468200000001],
  [45.78075, -122.54536],
  [45.780737, -122.547577],
  [45.775737, -122.54751700000001],
  [45.775328, -122.54751],
  [45.770295, -122.54742200000001],
  [45.766233, -122.54737500000002],
  [45.762498, -122.54734300000001],
  [45.761247, -122.547332],
  [45.760507, -122.547319],
  [45.760362, -122.54732300000002],
  [45.759062, -122.547318],
  [45.758942, -122.54732300000002],
  [45.758905, -122.547322],
  [45.758195, -122.54730500000001],
  [45.757016, -122.547296],
  [45.756843, -122.54729],
  [45.756312, -122.54729200000001],
  [45.756182, -122.547287],
  [45.756009, -122.54728200000001],
  [45.755272, -122.54728500000002],
  [45.754524, -122.54727300000002],
  [45.754143, -122.547265],
  [45.753685, -122.54727500000001],
  [45.753405, -122.54730100000002],
  [45.753045, -122.54735500000001],
  [45.752811, -122.547399],
  [45.752545, -122.547471],
  [45.751957, -122.54765200000001],
  [45.751625, -122.54779],
  [45.751316, -122.54791900000001],
  [45.75117, -122.547993],
  [45.750701, -122.54825900000002],
  [45.750364, -122.548487],
  [45.750011, -122.54875300000002],
  [45.749892, -122.54884900000002],
  [45.749091, -122.54946000000001],
  [45.748745, -122.54971700000002],
  [45.748528, -122.54988700000001],
  [45.748029, -122.55026600000001],
  [45.748019, -122.55027400000002],
  [45.747464, -122.55066600000002],
  [45.74718, -122.55082900000001],
  [45.746975, -122.55093100000002],
  [45.746709, -122.55105800000001],
  [45.746289, -122.551232],
  [45.746061, -122.551312],
  [45.745713, -122.551422],
  [45.745551, -122.551467],
  [45.745362, -122.551506],
  [45.74469, -122.551605],
  [45.744354, -122.55162],
  [45.743994, -122.55161800000002],
  [45.743634, -122.55160200000002],
  [45.743397, -122.55161000000001],
  [45.742376, -122.55159600000002],
  [45.74223, -122.551583],
  [45.742102, -122.55158700000001],
  [45.741545, -122.55158000000002],
  [45.74136, -122.551578],
  [45.740256, -122.55156700000002],
  [45.73986, -122.55156400000001],
  [45.738929, -122.55154400000002],
  [45.73721, -122.55152100000001],
  [45.737153, -122.55152000000001],
  [45.737103, -122.55152000000001],
  [45.735569, -122.551502],
  [45.734634, -122.55153500000002],
  [45.73398, -122.551579],
  [45.733634, -122.55161500000001],
  [45.732515, -122.55176300000001],
  [45.73137, -122.55198500000002],
  [45.730359, -122.552186],
  [45.729767, -122.552314],
  [45.728942, -122.552394],
  [45.728068, -122.55245300000001],
  [45.726457, -122.552455],
  [45.726183, -122.55246000000001],
  [45.725867, -122.55246200000002],
  [45.72533, -122.55247500000002],
  [45.724953, -122.552501],
  [45.723187, -122.552524],
  [45.722523, -122.55252900000002],
  [45.720699, -122.55253900000001],
  [45.719779, -122.552546],
  [45.718902, -122.55256100000001],
  [45.718857, -122.55256100000001],
  [45.718656, -122.552566],
  [45.717063, -122.552597],
  [45.71658, -122.55260900000002],
  [45.715668, -122.55262200000001],
  [45.715058, -122.55262900000001],
  [45.714445, -122.55263500000001],
  [45.713566, -122.552646],
  [45.712969, -122.55265700000001],
  [45.712823, -122.552658],
  [45.712294, -122.552662],
  [45.711707, -122.552671],
  [45.711142, -122.552677],
  [45.710817, -122.55268200000002],
  [45.710202, -122.55269100000001],
  [45.70986, -122.55269400000002],
  [45.709729, -122.55269500000001],
  [45.70923, -122.55270100000001],
  [45.708506, -122.552719],
  [45.707966, -122.552713],
  [45.707357, -122.55273000000001],
  [45.706442, -122.552776],
  [45.705994, -122.552799],
  [45.705654, -122.552817],
  [45.705278, -122.55282200000002],
  [45.704891, -122.55282800000002],
  [45.704648, -122.55283],
  [45.704255, -122.55283400000002],
  [45.704083, -122.552836],
  [45.703708, -122.55284],
  [45.703181, -122.55283500000002],
  [45.701834, -122.55276700000002],
  [45.701658, -122.552763],
  [45.700896, -122.552763],
  [45.699969, -122.552764],
  [45.699277, -122.55277100000002],
  [45.699026, -122.55277100000002],
  [45.698905, -122.552779],
  [45.697916, -122.55278000000001],
  [45.697433, -122.55278300000002],
  [45.696164, -122.552792],
  [45.696068, -122.55279300000001],
  [45.695786, -122.55279000000002],
  [45.695311, -122.552798],
  [45.694334, -122.552794],
  [45.693432, -122.55279000000002],
  [45.69257, -122.55280300000001],
  [45.692534, -122.55280300000001],
  [45.69235, -122.55280400000001],
  [45.692254, -122.55280000000002],
  [45.691364, -122.55278100000001],
  [45.690525, -122.552734],
  [45.688644, -122.552624],
  [45.687771, -122.55257600000002],
  [45.687648, -122.552569],
  [45.687401, -122.552556],
  [45.685661, -122.552579],
  [45.683315, -122.55256800000001],
  [45.682824, -122.55256300000002],
  [45.682183, -122.55255500000001],
  [45.682041, -122.552556],
  [45.681354, -122.55256100000001],
  [45.680807, -122.552566],
  [45.680468, -122.552569],
  [45.679091, -122.55257400000002],
  [45.677838, -122.55253900000001],
  [45.676694, -122.55255500000001],
  [45.676649, -122.55255500000001],
  [45.674589, -122.55257700000001],
  [45.670635, -122.55256500000002],
  [45.669921, -122.55256800000001],
  [45.668734, -122.55259600000001],
  [45.668214, -122.55259600000001],
  [45.667882, -122.55259000000001],
  [45.667458, -122.552581],
  [45.667279, -122.55257000000002],
  [45.667262, -122.552632],
  [45.666951, -122.553878],
  [45.666689, -122.55492900000002],
  [45.666351, -122.55630100000002],
  [45.666187, -122.557042],
  [45.666079, -122.55749500000002],
  [45.665938, -122.55808100000002],
  [45.665791, -122.55872900000001],
  [45.665679, -122.55921900000001],
  [45.665589, -122.559567],
  [45.665532, -122.55979500000001],
  [45.665377, -122.56028800000001],
  [45.665163, -122.56084500000001],
  [45.665111, -122.560975],
  [45.665074, -122.56106500000001],
  [45.664938, -122.56140300000001],
  [45.664715, -122.561905],
  [45.664619, -122.562124],
  [45.664082, -122.563489],
  [45.663711, -122.56446700000001],
  [45.663438, -122.565161],
  [45.662879, -122.56634400000002],
  [45.66232, -122.567528],
  [45.661843, -122.56849100000001],
  [45.661555, -122.56908000000001],
  [45.660906, -122.57055100000001],
  [45.6602, -122.57188],
  [45.660104, -122.572058],
  [45.660017, -122.572217],
  [45.659939, -122.57234300000002],
  [45.659869, -122.57245400000001],
  [45.659709, -122.57269900000001],
  [45.659572, -122.57291200000002],
  [45.659478, -122.57305600000001],
  [45.659376, -122.57320900000002],
  [45.659273, -122.57337100000001],
  [45.659169, -122.573526],
  [45.659037, -122.57372400000001],
  [45.658983, -122.57379400000002],
  [45.658855, -122.57396100000001],
  [45.658685, -122.57417900000002],
  [45.658551, -122.574359],
  [45.658454, -122.574471],
  [45.658197, -122.57476900000002],
  [45.657532, -122.575471],
  [45.657894, -122.57610000000001],
  [45.657954, -122.57619900000002],
  [45.657977, -122.576244],
  [45.65799, -122.57627100000002],
  [45.658041, -122.57636100000002],
  [45.658076, -122.57645000000001],
  [45.658108, -122.576544],
  [45.658132, -122.57665000000001],
  [45.658148, -122.576757],
  [45.658171, -122.576964],
  [45.658189, -122.577293],
  [45.658305, -122.57908400000001],
  [45.658137, -122.579097],
  [45.658036, -122.57910500000001],
  [45.657847, -122.579113],
  [45.657704, -122.57913800000001],
  [45.657595, -122.57916500000002],
  [45.657489, -122.57920200000001],
  [45.657435, -122.579244],
  [45.657359, -122.579311],
  [45.657261, -122.57941100000001],
  [45.657196, -122.579486],
  [45.65712, -122.57961100000001],
  [45.657052, -122.579744],
  [45.656983, -122.57991500000001],
  [45.65691, -122.580165],
  [45.656812, -122.58046500000002],
  [45.656704, -122.58085000000001],
  [45.656631, -122.58109300000001],
  [45.65659, -122.58124700000002],
  [45.656551, -122.581383],
  [45.65651, -122.581517],
  [45.656455, -122.581718],
  [45.656408, -122.58189700000001],
  [45.656376, -122.582094],
  [45.656331, -122.58233800000001],
  [45.656299, -122.5826],
  [45.656241, -122.58297800000001],
  [45.656062, -122.58405700000002],
  [45.65617, -122.58410800000001],
  [45.656077117276055, -122.58463152080772]
];

const stopNames = {
  "9022": "Van Mall Transit Center: Bay C",
  "3741": "Yacolt Rd &amp; Railroad Ave",
  "836": "W Main St 600 Block",
  "835": "W Main &amp; 3rd Ave",
  "6201": "NE Grace Ave &amp; E Main St"
};

const stops = [
  { stop_id: "3741", name: "Yacolt Rd &amp; Railroad Ave", lat: 45.86686, lon: -122.408349, times: ["6:04 AM", "12:44 PM", "6:45 PM"] },
  { stop_id: "6201", name: "NE Grace Ave &amp; E Main St", lat: 45.781192, lon: -122.529299, times: ["6:30 AM", "1:10 PM", "7:11 PM"] },
  { stop_id: "835", name: "W Main &amp; 3rd Ave", lat: 45.780952, lon: -122.540057, times: ["1:11 PM", "7:12 PM"] },
  { stop_id: "836", name: "W Main St 600 Block", lat: 45.780853, lon: -122.544533, times: ["1:12 PM", "7:12 PM"] },
  { stop_id: "9022", name: "Van Mall Transit Center: Bay C", lat: 45.656136, lon: -122.584653, times: ["1:42 PM", "7:34 PM"] },
]

    const polylineOut = L.polyline(shapeOutbound, { color: 'blue', weight: 4, opacity: 0.7 }).addTo(map);
    map.fitBounds(polylineOut.getBounds());

    const nowPT = new Date(new Date().toLocaleString('en-US', { timeZone: 'America/Los_Angeles' }));
    const nowMins = nowPT.getHours() * 60 + nowPT.getMinutes();

    stops.forEach(stop => {
      let highlightedTimes = [];
      let foundNext = false;
      stop.times.forEach(timeStr => {
        let cleanTime = timeStr.trim();
        let [h, m] = cleanTime.split(":");
        let schedMins = parseInt(h, 10) * 60 + parseInt(m, 10);
        if (schedMins < nowMins && nowMins - schedMins > 720) {
          schedMins += 1440;
        }
        if (!foundNext && schedMins >= nowMins) {
          highlightedTimes.push(`<span style="background:#4dd0e1; color:#000; padding:2px 6px; border-radius:6px; font-weight:bold;">${cleanTime}</span>`);
          foundNext = true;
        } else {
          highlightedTimes.push(cleanTime);
        }
      });

      L.circleMarker([stop.lat, stop.lon], {
        radius: 6,
        color: '#4dd0e1',
        fillColor: '#4dd0e1',
        fillOpacity: 0.9,
        weight: 1
      })
      .bindPopup(`<strong>${stop.name}</strong><br>${highlightedTimes.join("<br>") || 'No scheduled times'}`)
      .addTo(map);
    });

    let busMarkers = {};
    async function fetchAndDisplay() {
      const res = await fetch(`https://developer.trimet.org/ws/v2/vehicles?route=${routeNumber}&appID=${apiKey}&json=true`);
      const data = await res.json();
      const buses = (data.resultSet.vehicle || []).filter(v => v.routeNumber == routeNumber && v.direction == direction);

      Object.values(busMarkers).forEach(m => map.removeLayer(m));
      busMarkers = {};
      if (!buses.length) return;

      buses.forEach(bus => {
        if (!bus.latitude || !bus.longitude || !bus.blockID) return;
        const icon = L.divIcon({    
           className: '',
           html: `
            <div style="text-align:center;">
              <div style="background:#0071CE;color:#fff;padding:2px 6px;border-radius:6px;font-weight:bold;">${bus.vehicleID}</div>
              <div style="width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-top:10px solid #00bfff;margin:auto;"></div>
            </div>
          `,
          iconSize: [40, 30], iconAnchor: [20, 30]
        });
        const marker = L.marker([bus.latitude, bus.longitude], { icon }).addTo(map);
        busMarkers[bus.vehicleID] = marker;
      });
    }
    fetchAndDisplay();
    setInterval(fetchAndDisplay, 15000);
  </script>

  <footer class="site-footer">
    <a href="terms.html">Terms of Use</a> &nbsp;|&nbsp;
    <a href="contact.html">Contact Us</a> &nbsp;|&nbsp;
    <a href="report.html">Report a Problem</a> &nbsp;|&nbsp;
    <a href="dmca.html">DMCA</a> &nbsp;|&nbsp;
    <a href="privacy.html">Privacy Policy</a>
  </footer>

  <script>
    if (!localStorage.getItem('cookieConsent')) {
      document.write(`
        <div id="cookie-banner" style="position: fixed; bottom: 0; left: 0; right: 0; background: #333; color: #fff; padding: 1rem; z-index: 1000; font-size: 0.9rem; line-height: 1.4; text-align: center; box-sizing: border-box;">
          📢 We use cookies to improve functionality and analyze traffic.
          By using MetroFeed, you agree to our 
          <a href='privacy.html' style='color: #4dd0e1; text-decoration: underline;'>Privacy Policy</a>.<br>
          <button onclick='localStorage.setItem("cookieConsent", "true"); document.getElementById("cookie-banner").remove();' style='margin-top: 0.5rem; background: #4dd0e1; color: #000; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer; font-weight: bold;'>OK</button>
        </div>
      `);
    }
  </script>
</body>
</html>