<!DOCTYPE html>
<html lang="en">
<head>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EL337T4JX4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-EL337T4JX4');
</script>

<meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Route 48 - Direction 1 | MetroFeed Portland</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #0d0d0d;
      color: #cccccc;
      overflow-y: auto;
    }

    body {
      padding-top: 120px;
    }

    .ad-banner {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: #222;
      padding: 0;
      z-index: 1000;
      box-shadow: 0 2px 2px rgba(0,0,0,0.5);
      text-align: center;
    }

    .ad-banner img {
      width: 100%;
      max-width: 728px;
      max-height: 120px;
      display: block;
      margin: 0 auto;
    }
    .home-button {
      position: fixed;
      top: 120px;
      left: 10px;
      background-color: #4dd0e1;
      color: #0d0d0d;
      padding: 0.5rem 1rem;
      font-weight: bold;
      border-radius: 8px;
      text-decoration: none;
      z-index: 1001;
      box-shadow: 0 0 10px #4dd0e1;
    }

    .home-button:hover {
      background-color: #00bcd4;
      color: #ffffff;
    }

    header {
      background-color: #0d0d0d;
      border-top: 4px solid #4dd0e1;
      border-bottom: 3px solid #4dd0e1;
      padding: 1rem;
      text-align: center;
    }

    header img {
      max-height: 60px;
    }

    h1 {
      text-align: center;
      margin: 1rem 0;
      font-size: 2rem;
      color: #f0f0f0;
    }

    .content-box {
      border-radius: 12px;
      padding: 0;
      margin: 0;
      background-color: #1e1e1e;
    }

    #map {
      width: 100%;
      height: 85vh;
      border: none;
      margin: 0 auto;
      display: block;
      border-radius: 8px;
    }

    .button-bar {
      display: flex;
      justify-content: center;
      margin: 1rem 0;
    }

    .button-bar a, .back-button {
      background: #4dd0e1;
      color: #0d0d0d;
      padding: 0.6rem 1.2rem;
      text-decoration: none;
      border-radius: 8px;
      font-weight: bold;
      border: none;
      cursor: pointer;
      box-shadow: 0 0 10px #4dd0e1;
    }

    .back-button:hover {
      background-color: #35c0d6;
    }

    .site-footer {
      text-align: center;
      margin-top: 3rem;
      margin-bottom: 120px;
      font-size: 0.85rem;
      color: #aaa;
    }

    .site-footer a {
      color: #00BFFF;
      text-decoration: none;
    }

    .site-footer a:hover {
      text-decoration: underline;
    }

    @media (max-width: 600px) {
      .ad-banner {
        padding-top: 1rem;
        padding-bottom: 0rem;
      }
    }
  </style>
</head>

<body>
  <div class="ad-banner">
    <iframe src="https://metrofeedus.com/portland/Ads/route-48-dir1-ad.html" style="border:none; width:100%; max-width: 728px; height:90px;"></iframe>
  </div>

  <header>
    <img src="MetroFeedPortlandLogo.png" alt="MetroFeed Portland">
  </header>

  <div class="disclaimer" style="margin: 1rem auto 0.5rem; max-width: 600px; font-size: 0.8rem; color: #bbb; text-align: center; padding: 0.5rem 1rem; background-color: #111; border: 1px dashed #444; border-radius: 6px;">
    ‚ö†Ô∏è This is a Beta program, work in progress. Please REPORT bugs and pretend to be impressed.
  </div>
  <div class="disclaimer" style="margin: 0 auto 1rem; max-width: 600px; font-size: 0.75rem; color: #888; text-align: center; padding: 0.25rem 1rem;">
    This tool is not affiliated with or endorsed by TriMet. For official schedules and service alerts, visit <a href="https://trimet.org" style="color:#4dd0e1;">trimet.org</a>.
  </div>

  <div style="margin: 2rem 0; text-align: center;">
    <button class="back-button" onclick="history.back()">Back</button>
  </div>

  <h1>Route 48 - Direction 1</h1>

  <div class="content-box">
    <div id="map"></div>
    <div style="text-align:right; font-size: 0.7rem; color: #777; margin-top: 0.5rem;">
      Data courtesy of TriMet.
    </div>
  </div>

  <script>
    if (document.referrer === "" && performance.navigation.type === 0) {
      window.location.href = "/index.html";
    }

    const apiKey = "2C4447D4A42083BCD84DE3B8E";
    const routeNumber = 48;
    const direction = parseInt(1);

    const map = L.map('map', {
      center: [45.6, -122.7],
      zoom: 12,
      minZoom: 12,
      maxZoom: 18,
      maxBounds: [[45.3, -123.1], [45.9, -122.3]],
      maxBoundsViscosity: 1.0
    });
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);

    const shapeOutbound = [
  [45.690588295461765, -122.6636424177623],
  [45.689709, -122.664089],
  [45.689748, -122.664233],
  [45.689757, -122.664256],
  [45.689768, -122.664276],
  [45.68979, -122.66429799999999],
  [45.689814, -122.664311],
  [45.689841, -122.664313],
  [45.689867, -122.66430499999998],
  [45.690904, -122.66376699999999],
  [45.690917, -122.66375599999999],
  [45.690926, -122.663742],
  [45.690934, -122.66372599999998],
  [45.69094, -122.66370899999998],
  [45.690948, -122.663683],
  [45.690953, -122.663656],
  [45.690955, -122.663632],
  [45.690956, -122.663585],
  [45.690959, -122.66353499999998],
  [45.690966, -122.66348499999998],
  [45.690977, -122.663445],
  [45.691021, -122.66338599999999],
  [45.691046, -122.66333799999998],
  [45.691061, -122.66330399999998],
  [45.691074, -122.66324499999999],
  [45.691134, -122.663266],
  [45.691212, -122.66330399999998],
  [45.691272, -122.66334199999999],
  [45.691398, -122.66346199999998],
  [45.691525, -122.66358999999999],
  [45.691664, -122.66376099999998],
  [45.691686, -122.66378699999999],
  [45.69176, -122.663882],
  [45.691839, -122.66398499999998],
  [45.69194, -122.664089],
  [45.692029, -122.664174],
  [45.692109, -122.664226],
  [45.692186, -122.664267],
  [45.692265, -122.664313],
  [45.692376, -122.66432199999998],
  [45.693007, -122.66429899999999],
  [45.692998, -122.663738],
  [45.693, -122.663422],
  [45.693006, -122.66312999999998],
  [45.692993, -122.66283399999999],
  [45.693015, -122.66147799999999],
  [45.693014, -122.66143799999999],
  [45.693014, -122.66133499999998],
  [45.693015, -122.66123599999999],
  [45.693014, -122.66118599999999],
  [45.693118, -122.66109099999998],
  [45.693222, -122.660884],
  [45.693263, -122.660812],
  [45.693305, -122.66076099999998],
  [45.69334, -122.66072599999998],
  [45.693408, -122.660663],
  [45.694112, -122.66027599999998],
  [45.694665, -122.66002799999998],
  [45.695181, -122.65984599999999],
  [45.695548, -122.659688],
  [45.697992, -122.65842599999999],
  [45.699965, -122.65746499999999],
  [45.70055, -122.65729299999998],
  [45.701316, -122.65688399999999],
  [45.70352, -122.65570599999998],
  [45.703594, -122.655667],
  [45.70385, -122.65553],
  [45.705268, -122.654814],
  [45.705624, -122.65463499999998],
  [45.706472, -122.65414899999999],
  [45.706813, -122.65395399999998],
  [45.707725, -122.65349499999999],
  [45.708681, -122.653152],
  [45.709446, -122.652941],
  [45.709946, -122.652842],
  [45.710652, -122.652751],
  [45.711135, -122.65271799999998],
  [45.712477, -122.65283799999999],
  [45.712691, -122.652873],
  [45.713151, -122.65293599999998],
  [45.713528, -122.65302399999999],
  [45.713967, -122.65314299999999],
  [45.714336, -122.653258],
  [45.714644, -122.65337],
  [45.714815, -122.65344599999999],
  [45.715652, -122.65382699999999],
  [45.715987, -122.653973],
  [45.716528, -122.65420999999999],
  [45.717453, -122.65460099999999],
  [45.717903, -122.65475799999999],
  [45.718259, -122.654882],
  [45.71889, -122.65500999999999],
  [45.719301, -122.65507199999999],
  [45.719763, -122.65510299999998],
  [45.720267, -122.655114],
  [45.72071, -122.65509299999998],
  [45.72091, -122.655074],
  [45.721314, -122.655015],
  [45.721589, -122.65497199999999],
  [45.721717, -122.65495199999998],
  [45.721836, -122.65493199999999],
  [45.722027, -122.6549],
  [45.722366, -122.654845],
  [45.722783, -122.654777],
  [45.722951, -122.65475099999999],
  [45.723122, -122.654722],
  [45.723279, -122.65469999999999],
  [45.723437, -122.65467999999998],
  [45.723609, -122.65465899999998],
  [45.723768, -122.65465999999999],
  [45.723936, -122.65465199999998],
  [45.724078, -122.654648],
  [45.724275, -122.65464299999998],
  [45.724426, -122.65465199999998],
  [45.72459, -122.65466599999999],
  [45.724773, -122.65467699999999],
  [45.724964, -122.654705],
  [45.725992, -122.65489099999999],
  [45.727128, -122.655246],
  [45.728656, -122.655724],
  [45.729648, -122.656034],
  [45.7305, -122.656306],
  [45.732454, -122.65692799999998],
  [45.732721, -122.65700999999999],
  [45.734008, -122.65740499999998],
  [45.734903, -122.65768099999998],
  [45.736253, -122.658092],
  [45.746649, -122.66125299999999],
  [45.747016, -122.661371],
  [45.750538, -122.662518],
  [45.750717, -122.662577],
  [45.750863, -122.66262199999998],
  [45.754463, -122.66372299999999],
  [45.757944, -122.66480299999999],
  [45.765133, -122.667032],
  [45.765176, -122.667046],
  [45.765336, -122.66709499999999],
  [45.767592, -122.66779199999999],
  [45.769344, -122.66833499999998],
  [45.771822, -122.66904699999999],
  [45.772856, -122.66942399999999],
  [45.773588, -122.669624],
  [45.777627, -122.670847],
  [45.77941, -122.671436],
  [45.779803, -122.67155699999999],
  [45.780816, -122.67186999999998],
  [45.782418, -122.67236699999998],
  [45.78354, -122.67270699999999],
  [45.786921, -122.673755],
  [45.788029, -122.67410099999998],
  [45.790508, -122.67488],
  [45.791676, -122.67525599999999],
  [45.79382, -122.67589899999999],
  [45.793833, -122.675902],
  [45.794701, -122.67614499999999],
  [45.795491, -122.676422],
  [45.796467, -122.676774],
  [45.797498, -122.67721099999999],
  [45.799217, -122.678006],
  [45.801367, -122.679011],
  [45.805696, -122.68101199999998],
  [45.807573, -122.68188499999998],
  [45.808253, -122.68219699999999],
  [45.809047, -122.68257799999999],
  [45.811365, -122.68365599999998],
  [45.811876, -122.683881],
  [45.812393, -122.684127],
  [45.81306, -122.684434],
  [45.813327, -122.684563],
  [45.814034, -122.684648],
  [45.814323, -122.68469399999998],
  [45.81468, -122.68477499999999],
  [45.814851, -122.68480099999998],
  [45.8154, -122.68490899999999],
  [45.815675, -122.684788],
  [45.815786, -122.68473799999998],
  [45.815938, -122.684447],
  [45.815964, -122.683837],
  [45.815981, -122.683122],
  [45.815988, -122.68302499999999],
  [45.815942, -122.68278999999998],
  [45.815866, -122.682547],
  [45.815823, -122.68247999999998],
  [45.815799, -122.68240399999999],
  [45.815791, -122.682322],
  [45.815799, -122.68225799999999],
  [45.815828, -122.68217399999999],
  [45.815841, -122.68214699999999],
  [45.815865, -122.682107],
  [45.815909, -122.68205099999999],
  [45.815958, -122.682022],
  [45.816, -122.68201699999999],
  [45.816042, -122.682019],
  [45.816094, -122.68204799999998],
  [45.816138, -122.68210099999999],
  [45.816155, -122.68212899999999],
  [45.816354, -122.682322],
  [45.81642, -122.682331],
  [45.8165, -122.68235399999999],
  [45.816545, -122.682366],
  [45.816998, -122.682359],
  [45.816986, -122.68271399999999],
  [45.816977, -122.682911],
  [45.81698032408936, -122.68302401903823],
  [45.81698032408936, -122.68302401903823],
  [45.816981, -122.683047],
  [45.816984, -122.68320899999999],
  [45.817002, -122.68329699999998],
  [45.817015, -122.68338899999999],
  [45.817023, -122.68347799999998],
  [45.817027, -122.683561],
  [45.817027, -122.68364199999999],
  [45.81702, -122.68373999999999],
  [45.81701, -122.68383899999999],
  [45.816994, -122.683943],
  [45.816967, -122.68408499999998],
  [45.816911, -122.684342],
  [45.816872, -122.684495],
  [45.816872, -122.684495],
  [45.816911, -122.684342],
  [45.816967, -122.68408499999998],
  [45.816994, -122.683943],
  [45.81701, -122.68383899999999],
  [45.81702, -122.68373999999999],
  [45.817027, -122.68364199999999],
  [45.817026, -122.683561],
  [45.817023, -122.68347799999998],
  [45.817016, -122.68338899999999],
  [45.817002, -122.68329699999998],
  [45.816984, -122.68320899999999],
  [45.816981, -122.683047],
  [45.816977, -122.682911],
  [45.816986, -122.68271399999999],
  [45.816998, -122.682359],
  [45.816545, -122.682366],
  [45.8165, -122.68235399999999],
  [45.81642, -122.682331],
  [45.816354, -122.682322],
  [45.816156, -122.68254099999999],
  [45.816055, -122.682805],
  [45.815988, -122.68302499999999],
  [45.815981, -122.683122],
  [45.815964, -122.683837],
  [45.815938, -122.684447],
  [45.816021, -122.68456899999998],
  [45.816101, -122.684689],
  [45.816276, -122.68502499999998],
  [45.81648, -122.68522899999999],
  [45.816658, -122.685418],
  [45.816719, -122.68548399999999],
  [45.816971, -122.68574599999998],
  [45.817196, -122.68593099999998],
  [45.817685, -122.68627],
  [45.818453, -122.68672399999998],
  [45.819564, -122.687461],
  [45.819775, -122.68756299999998],
  [45.820185, -122.68774999999998],
  [45.820833, -122.688047],
  [45.821446, -122.688333],
  [45.82259, -122.688871],
  [45.822996, -122.689069],
  [45.823227, -122.68918199999999],
  [45.827152, -122.690976],
  [45.828781, -122.691719],
  [45.829591, -122.692113],
  [45.837403, -122.69573999999999],
  [45.83835, -122.696174],
  [45.839052, -122.696529],
  [45.842517, -122.698143],
  [45.844713, -122.699165],
  [45.848673, -122.70099799999998],
  [45.849307, -122.701153],
  [45.849836, -122.701314],
  [45.850082, -122.70141499999998],
  [45.850196, -122.70145],
  [45.85035, -122.70147299999998],
  [45.8505, -122.70147899999999],
  [45.85061, -122.70146599999998],
  [45.850694, -122.70144199999999],
  [45.85083, -122.70141399999999],
  [45.85106, -122.701348],
  [45.85121, -122.70132999999998],
  [45.851341, -122.70133199999998],
  [45.85141, -122.70133799999999],
  [45.851495, -122.70136199999999],
  [45.85158, -122.701403],
  [45.85167, -122.701454],
  [45.851722, -122.70149],
  [45.851783, -122.70150299999999],
  [45.851855, -122.70148499999999],
  [45.851929, -122.701461],
  [45.851977, -122.70148599999999],
  [45.851982, -122.70145599999998],
  [45.851993, -122.701427],
  [45.852008, -122.70139999999999],
  [45.852027, -122.701376],
  [45.85205, -122.70135499999999],
  [45.852076, -122.70133899999999],
  [45.852104, -122.701327],
  [45.852134, -122.70131999999998],
  [45.852165, -122.70131799999999],
  [45.852196, -122.701321],
  [45.852211, -122.70123999999998],
  [45.852228, -122.70117199999999],
  [45.85226, -122.701085],
  [45.852298, -122.701011],
  [45.852342, -122.70093799999998],
  [45.852385, -122.700875],
  [45.852459, -122.70074899999999],
  [45.852498, -122.700677],
  [45.852544, -122.700578],
  [45.852578, -122.700496],
  [45.852622, -122.70037499999998],
  [45.852651, -122.70027399999998],
  [45.85268, -122.700142],
  [45.852712, -122.699955],
  [45.852712, -122.69973299999998],
  [45.852707, -122.699365],
  [45.852694, -122.699086],
  [45.852661, -122.698807],
  [45.852618, -122.698501],
  [45.85255, -122.69817],
  [45.852456, -122.697765],
  [45.852411, -122.69754199999998],
  [45.852291, -122.69701299999998],
  [45.852226, -122.69673999999999],
  [45.852166, -122.69647099999999],
  [45.852116, -122.69622999999999],
  [45.852069, -122.696004],
  [45.852028, -122.69578399999999],
  [45.851985, -122.69550699999999],
  [45.851942, -122.69523799999999],
  [45.851923, -122.695084],
  [45.851922, -122.69506899999999],
  [45.851892, -122.69476],
  [45.851877, -122.694607],
  [45.851866, -122.694499],
  [45.851857, -122.694369],
  [45.85185, -122.69424699999999],
  [45.851843, -122.69412],
  [45.851838, -122.69403199999999],
  [45.851838, -122.69390099999998],
  [45.851834, -122.693756],
  [45.851832, -122.69362499999998],
  [45.85183, -122.69344699999999],
  [45.851826, -122.693164],
  [45.851829, -122.692983],
  [45.851832, -122.692605],
  [45.851831, -122.691075],
  [45.851829, -122.68951699999998],
  [45.851824, -122.688797],
  [45.851826, -122.687451],
  [45.851831, -122.684982],
  [45.851832, -122.68463999999999],
  [45.851842, -122.68336999999998],
  [45.851849, -122.68307899999999],
  [45.851869, -122.682741],
  [45.851904, -122.68228],
  [45.851927, -122.682008],
  [45.851954, -122.681787],
  [45.851991, -122.68150899999999],
  [45.852022, -122.68128199999998],
  [45.852059, -122.681058],
  [45.852101, -122.68083099999998],
  [45.852146, -122.68059399999999],
  [45.852199, -122.680343],
  [45.852254, -122.68010299999999],
  [45.852296, -122.67992799999999],
  [45.852336, -122.679768],
  [45.852387, -122.67958099999998],
  [45.852434, -122.679409],
  [45.852499, -122.679195],
  [45.852555, -122.67901599999999],
  [45.852608, -122.67885199999999],
  [45.852667, -122.678681],
  [45.852732, -122.67850599999998],
  [45.852814, -122.67828399999999],
  [45.852896, -122.678077],
  [45.852968, -122.67790299999999],
  [45.853038, -122.67774499999999],
  [45.85309, -122.677622],
  [45.85316, -122.677471],
  [45.853229, -122.677326],
  [45.853295, -122.67719499999998],
  [45.853386, -122.67700299999998],
  [45.853488, -122.676811],
  [45.853569, -122.676661],
  [45.853674, -122.67647599999998],
  [45.853756, -122.67633799999999],
  [45.853839, -122.676207],
  [45.85393, -122.676059],
  [45.854003, -122.67594699999998],
  [45.854091, -122.67581199999998],
  [45.85419, -122.675672],
  [45.854278, -122.67555299999998],
  [45.854392, -122.675401],
  [45.854497, -122.67526299999999],
  [45.854606, -122.675128],
  [45.854711, -122.675008],
  [45.854805, -122.674897],
  [45.854879, -122.674815],
  [45.855279, -122.67439699999998],
  [45.855518, -122.67417399999998],
  [45.855762, -122.67396599999998],
  [45.855937, -122.673826],
  [45.856112, -122.67369599999999],
  [45.85636, -122.67352599999998],
  [45.856517, -122.673429],
  [45.856684, -122.673327],
  [45.857226, -122.673016],
  [45.857572, -122.67282699999998],
  [45.857834, -122.67268399999999],
  [45.857981, -122.67259899999999],
  [45.858174, -122.67249699999999],
  [45.858344, -122.67239699999999],
  [45.858496, -122.67232099999998],
  [45.858517, -122.67231099999998],
  [45.858755, -122.672209],
  [45.858798, -122.67219099999998],
  [45.858947, -122.67213299999999],
  [45.859203, -122.67206199999998],
  [45.85944, -122.672012],
  [45.859664, -122.671987],
  [45.859842, -122.67198299999998],
  [45.860083, -122.671991],
  [45.8602, -122.67201299999999],
  [45.860348, -122.67203999999998],
  [45.860637, -122.67210199999998],
  [45.861035, -122.67220099999999],
  [45.861191, -122.67225499999999],
  [45.861404, -122.67236699999998],
  [45.861505, -122.672417],
  [45.861666, -122.67241499999999],
  [45.861725, -122.67242899999998],
  [45.861796, -122.67241],
  [45.861889, -122.67238099999999],
  [45.862043, -122.672219],
  [45.862093, -122.67213299999999],
  [45.862141, -122.67200699999998],
  [45.86222, -122.671852],
  [45.862231, -122.67181199999999],
  [45.862353, -122.67126099999999],
  [45.862381, -122.67109999999998],
  [45.862404, -122.670963],
  [45.862432, -122.670735],
  [45.862451, -122.67051],
  [45.862495, -122.670067],
  [45.863146, -122.670183],
  [45.86337, -122.67021899999999],
  [45.863478, -122.67023299999998],
  [45.864009029906924, -122.67033079556298]
];

const stopNames = {
  "6257": "E.Birch Ave &amp; 6th St",
  "6051": "Junction Park &amp; Ride",
  "9010": "99th Street Transit Center: Bay A"
};

const stops = [
  { stop_id: "9010", name: "99th Street Transit Center: Bay A", lat: 45.69061, lon: -122.66373, times: ["6:20 AM", "8:20 AM", "10:20 AM", "12:20 PM", "2:20 PM", "4:20 PM", "6:20 PM", "7:50 PM"] },
  { stop_id: "6051", name: "Junction Park &amp; Ride", lat: 45.817047, lon: -122.68302, times: ["6:34 AM", "8:34 AM", "10:34 AM", "12:34 PM", "2:34 PM", "4:34 PM", "6:34 PM", "8:04 PM"] },
  { stop_id: "6257", name: "E.Birch Ave &amp; 6th St", lat: 45.86401, lon: -122.67032, times: ["6:43 AM", "8:43 AM", "10:43 AM", "12:43 PM", "2:43 PM", "4:43 PM", "6:43 PM", "8:13 PM"] },
]

    const polylineOut = L.polyline(shapeOutbound, { color: 'blue', weight: 4, opacity: 0.7 }).addTo(map);
    map.fitBounds(polylineOut.getBounds());

    const nowPT = new Date(new Date().toLocaleString('en-US', { timeZone: 'America/Los_Angeles' }));
    const nowMins = nowPT.getHours() * 60 + nowPT.getMinutes();

    stops.forEach(stop => {
      let highlightedTimes = [];
      let foundNext = false;
      stop.times.forEach(timeStr => {
        let cleanTime = timeStr.trim();
        let [h, m] = cleanTime.split(":");
        let schedMins = parseInt(h, 10) * 60 + parseInt(m, 10);
        if (schedMins < nowMins && nowMins - schedMins > 720) {
          schedMins += 1440;
        }
        if (!foundNext && schedMins >= nowMins) {
          highlightedTimes.push(`<span style="background:#4dd0e1; color:#000; padding:2px 6px; border-radius:6px; font-weight:bold;">${cleanTime}</span>`);
          foundNext = true;
        } else {
          highlightedTimes.push(cleanTime);
        }
      });

      L.circleMarker([stop.lat, stop.lon], {
        radius: 6,
        color: '#4dd0e1',
        fillColor: '#4dd0e1',
        fillOpacity: 0.9,
        weight: 1
      })
      .bindPopup(`<strong>${stop.name}</strong><br>${highlightedTimes.join("<br>") || 'No scheduled times'}`)
      .addTo(map);
    });

    let busMarkers = {};
    async function fetchAndDisplay() {
      const res = await fetch(`https://developer.trimet.org/ws/v2/vehicles?route=${routeNumber}&appID=${apiKey}&json=true`);
      const data = await res.json();
      const buses = (data.resultSet.vehicle || []).filter(v => v.routeNumber == routeNumber && v.direction == direction);

      Object.values(busMarkers).forEach(m => map.removeLayer(m));
      busMarkers = {};
      if (!buses.length) return;

      buses.forEach(bus => {
        if (!bus.latitude || !bus.longitude || !bus.blockID) return;
        const icon = L.divIcon({    
           className: '',
           html: `
            <div style="text-align:center;">
              <div style="background:#0071CE;color:#fff;padding:2px 6px;border-radius:6px;font-weight:bold;">${bus.vehicleID}</div>
              <div style="width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-top:10px solid #00bfff;margin:auto;"></div>
            </div>
          `,
          iconSize: [40, 30], iconAnchor: [20, 30]
        });
        const marker = L.marker([bus.latitude, bus.longitude], { icon }).addTo(map);
        busMarkers[bus.vehicleID] = marker;
      });
    }
    fetchAndDisplay();
    setInterval(fetchAndDisplay, 15000);
  </script>

  <footer class="site-footer">
    <a href="terms.html">Terms of Use</a> &nbsp;|&nbsp;
    <a href="contact.html">Contact Us</a> &nbsp;|&nbsp;
    <a href="report.html">Report a Problem</a> &nbsp;|&nbsp;
    <a href="dmca.html">DMCA</a> &nbsp;|&nbsp;
    <a href="privacy.html">Privacy Policy</a>
  </footer>

  <script>
    if (!localStorage.getItem('cookieConsent')) {
      document.write(`
        <div id="cookie-banner" style="position: fixed; bottom: 0; left: 0; right: 0; background: #333; color: #fff; padding: 1rem; z-index: 1000; font-size: 0.9rem; line-height: 1.4; text-align: center; box-sizing: border-box;">
          üì¢ We use cookies to improve functionality and analyze traffic.
          By using MetroFeed, you agree to our 
          <a href='privacy.html' style='color: #4dd0e1; text-decoration: underline;'>Privacy Policy</a>.<br>
          <button onclick='localStorage.setItem("cookieConsent", "true"); document.getElementById("cookie-banner").remove();' style='margin-top: 0.5rem; background: #4dd0e1; color: #000; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer; font-weight: bold;'>OK</button>
        </div>
      `);
    }
  </script>
</body>
</html>