<!DOCTYPE html>
<html lang="en">
<head>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EL337T4JX4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-EL337T4JX4');
</script>

<meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Route 30 - Direction 0 | MetroFeed Portland</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #0d0d0d;
      color: #cccccc;
      overflow-y: auto;
    }

    body {
      padding-top: 120px;
    }

    .ad-banner {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: #222;
      padding: 0;
      z-index: 1000;
      box-shadow: 0 2px 2px rgba(0,0,0,0.5);
      text-align: center;
    }

    .ad-banner img {
      width: 100%;
      max-width: 728px;
      max-height: 120px;
      display: block;
      margin: 0 auto;
    }
    .home-button {
      position: fixed;
      top: 120px;
      left: 10px;
      background-color: #4dd0e1;
      color: #0d0d0d;
      padding: 0.5rem 1rem;
      font-weight: bold;
      border-radius: 8px;
      text-decoration: none;
      z-index: 1001;
      box-shadow: 0 0 10px #4dd0e1;
    }

    .home-button:hover {
      background-color: #00bcd4;
      color: #ffffff;
    }

    header {
      background-color: #0d0d0d;
      border-top: 4px solid #4dd0e1;
      border-bottom: 3px solid #4dd0e1;
      padding: 1rem;
      text-align: center;
    }

    header img {
      max-height: 60px;
    }

    h1 {
      text-align: center;
      margin: 1rem 0;
      font-size: 2rem;
      color: #f0f0f0;
    }

    .content-box {
      border-radius: 12px;
      padding: 0;
      margin: 0;
      background-color: #1e1e1e;
    }

    #map {
      width: 100%;
      height: 85vh;
      border: none;
      margin: 0 auto;
      display: block;
      border-radius: 8px;
    }

    .button-bar {
      display: flex;
      justify-content: center;
      margin: 1rem 0;
    }

    .button-bar a, .back-button {
      background: #4dd0e1;
      color: #0d0d0d;
      padding: 0.6rem 1.2rem;
      text-decoration: none;
      border-radius: 8px;
      font-weight: bold;
      border: none;
      cursor: pointer;
      box-shadow: 0 0 10px #4dd0e1;
    }

    .back-button:hover {
      background-color: #35c0d6;
    }

    .site-footer {
      text-align: center;
      margin-top: 3rem;
      margin-bottom: 120px;
      font-size: 0.85rem;
      color: #aaa;
    }

    .site-footer a {
      color: #00BFFF;
      text-decoration: none;
    }

    .site-footer a:hover {
      text-decoration: underline;
    }

    @media (max-width: 600px) {
      .ad-banner {
        padding-top: 1rem;
        padding-bottom: 0rem;
      }
    }
  </style>
</head>

<body>
  <div class="ad-banner">
    <iframe src="https://metrofeedus.com/portland/Ads/route-30-dir0-ad.html" style="border:none; width:100%; max-width: 728px; height:90px;"></iframe>
  </div>

  <header>
    <img src="MetroFeedPortlandLogo.png" alt="MetroFeed Portland">
  </header>

  <div class="disclaimer" style="margin: 1rem auto 0.5rem; max-width: 600px; font-size: 0.8rem; color: #bbb; text-align: center; padding: 0.5rem 1rem; background-color: #111; border: 1px dashed #444; border-radius: 6px;">
    ⚠️ This is a Beta program, work in progress. Please REPORT bugs and pretend to be impressed.
  </div>
  <div class="disclaimer" style="margin: 0 auto 1rem; max-width: 600px; font-size: 0.75rem; color: #888; text-align: center; padding: 0.25rem 1rem;">
    This tool is not affiliated with or endorsed by TriMet. For official schedules and service alerts, visit <a href="https://trimet.org" style="color:#4dd0e1;">trimet.org</a>.
  </div>

  <div style="margin: 2rem 0; text-align: center;">
    <button class="back-button" onclick="history.back()">Back</button>
  </div>

  <h1>Route 30 - Direction 0</h1>

  <div class="content-box">
    <div id="map"></div>
    <div style="text-align:right; font-size: 0.7rem; color: #777; margin-top: 0.5rem;">
      Data courtesy of TriMet.
    </div>
  </div>

  <script>
    if (document.referrer === "" && performance.navigation.type === 0) {
      window.location.href = "/index.html";
    }

    const apiKey = "2C4447D4A42083BCD84DE3B8E";
    const routeNumber = 30;
    const direction = parseInt(0);

    const map = L.map('map', {
      center: [45.6, -122.7],
      zoom: 12,
      minZoom: 12,
      maxZoom: 18,
      maxBounds: [[45.3, -123.1], [45.9, -122.3]],
      maxBoundsViscosity: 1.0
    });
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);

    const shapeOutbound = [
  [45.628513590805824, -122.6705196558455],
  [45.628767, -122.670496],
  [45.629535, -122.670483],
  [45.630305, -122.67046999999998],
  [45.631065, -122.670492],
  [45.63133262281008, -122.670497503811],
  [45.631332622851005, -122.67049750381187],
  [45.631843, -122.67050800000001],
  [45.632595, -122.67048100000001],
  [45.633369, -122.67047600000001],
  [45.633579355459005, -122.6704743798039],
  [45.6335793554299, -122.6704743798041],
  [45.634148, -122.67047],
  [45.634903, -122.670437],
  [45.634888, -122.669334],
  [45.634887, -122.668247],
  [45.634876, -122.667153],
  [45.63485955370208, -122.66622248577568],
  [45.63485955369969, -122.66622248564056],
  [45.634857, -122.666078],
  [45.634844, -122.66523800000002],
  [45.634831, -122.66507500000002],
  [45.634815, -122.665002],
  [45.634644, -122.66348000000002],
  [45.634617, -122.66327700000001],
  [45.634571, -122.66303200000002],
  [45.63454, -122.662868],
  [45.634501, -122.66263600000002],
  [45.6345, -122.66263],
  [45.634203, -122.66164900000001],
  [45.63396029733948, -122.66084750059191],
  [45.633960297716136, -122.66084750183578],
  [45.633158, -122.658198],
  [45.633135, -122.65812],
  [45.633096, -122.657983],
  [45.63302112154797, -122.65774741467673],
  [45.63302112215762, -122.65774741659486],
  [45.632631, -122.65652],
  [45.632583, -122.65632900000001],
  [45.632534, -122.656156],
  [45.632503, -122.65600700000002],
  [45.632473, -122.65584900000002],
  [45.632448, -122.65568500000002],
  [45.632421, -122.65552800000002],
  [45.632396, -122.655363],
  [45.632381, -122.65520800000002],
  [45.632368, -122.655057],
  [45.632354, -122.65484600000002],
  [45.632347, -122.654684],
  [45.632331, -122.653107],
  [45.632336, -122.652393],
  [45.63233859935634, -122.65195040050757],
  [45.632338599356565, -122.6519504004696],
  [45.632347, -122.65052],
  [45.632361, -122.650254],
  [45.632345, -122.647456],
  [45.632345, -122.647136],
  [45.632345, -122.647136],
  [45.632345, -122.647056],
  [45.632348, -122.64571500000001],
  [45.632394, -122.645522],
  [45.632413, -122.64543700000002],
  [45.632435, -122.645354],
  [45.632457, -122.645272],
  [45.632478, -122.64519800000001],
  [45.632493, -122.645126],
  [45.632504, -122.64505300000002],
  [45.632514, -122.644978],
  [45.632511, -122.644899],
  [45.632511, -122.644813],
  [45.632512, -122.64374500000001],
  [45.632509, -122.641703],
  [45.632517327268374, -122.6413835897773],
  [45.63251732726783, -122.6413835897983],
  [45.632523, -122.641166],
  [45.632534, -122.640792],
  [45.632824, -122.640889],
  [45.632903, -122.640913],
  [45.633395, -122.64121399999999],
  [45.633798, -122.64148499999999],
  [45.634012, -122.641629],
  [45.634184, -122.641707],
  [45.634448, -122.641794],
  [45.634725, -122.641852],
  [45.635223, -122.641845],
  [45.635868, -122.641836],
  [45.635864, -122.64117499999999],
  [45.63586023293544, -122.64098156123511],
  [45.63586023292976, -122.64098156094333],
  [45.635844, -122.640148],
  [45.63584, -122.640075],
  [45.635828, -122.640001],
  [45.635796, -122.63989700000002],
  [45.635766, -122.63981500000001],
  [45.635735, -122.63973300000002],
  [45.635702, -122.639652],
  [45.635667, -122.639573],
  [45.63563, -122.63949600000001],
  [45.63559, -122.639422],
  [45.63555, -122.63934800000001],
  [45.635508, -122.639278],
  [45.635463, -122.639209],
  [45.635418, -122.639143],
  [45.63537, -122.63907800000001],
  [45.63532, -122.639017],
  [45.635271, -122.63895700000002],
  [45.635234, -122.638893],
  [45.63522080330908, -122.63887609173977],
  [45.635106, -122.638729],
  [45.635046, -122.638614],
  [45.635011, -122.63854],
  [45.634977, -122.638469],
  [45.634947, -122.63840300000001],
  [45.634923, -122.638335],
  [45.634901, -122.63826200000001],
  [45.634885, -122.63819600000001],
  [45.634865, -122.63809700000002],
  [45.634848, -122.638016],
  [45.634842, -122.637926],
  [45.634833, -122.6378],
  [45.634832, -122.63753299999999],
  [45.634836800804194, -122.6367619908471],
  [45.63483680080429, -122.63676199083162],
  [45.634842, -122.63592700000001],
  [45.634854, -122.63346500000002],
  [45.634849, -122.633308],
  [45.634851, -122.633217],
  [45.63485, -122.63308],
  [45.634842, -122.632948],
  [45.63484099646878, -122.63293350454904],
  [45.634833, -122.63281799999999],
  [45.634822, -122.63270199999998],
  [45.634811, -122.63257499999999],
  [45.634795, -122.63241199999999],
  [45.634773, -122.63223799999999],
  [45.634763, -122.63216399999999],
  [45.634737, -122.63180899999999],
  [45.634737, -122.631557],
  [45.634736, -122.630601],
  [45.634737, -122.63033399999999],
  [45.63473730301864, -122.63028167878244],
  [45.63473730301865, -122.63028167877968],
  [45.63474, -122.629816],
  [45.634739, -122.628951],
  [45.634745, -122.628354],
  [45.634747, -122.627641],
  [45.634748, -122.62737],
  [45.634748, -122.627132],
  [45.63475, -122.626831],
  [45.63475, -122.62638299999999],
  [45.63475, -122.62638299999999],
  [45.63475, -122.626174],
  [45.634757, -122.625108],
  [45.634761, -122.62452899999998],
  [45.634771, -122.62414499999998],
  [45.63478, -122.623646],
  [45.634789, -122.62270499999998],
  [45.634798, -122.62191899999999],
  [45.63479035127888, -122.6212584286301],
  [45.63479035127885, -122.62125842862746],
  [45.634787, -122.620969],
  [45.634798, -122.62067999999998],
  [45.634799, -122.62038299999999],
  [45.634797, -122.61962699999998],
  [45.634797, -122.61947599999999],
  [45.634797, -122.619454],
  [45.634797, -122.619371],
  [45.63480389000895, -122.6180496493944],
  [45.63480389000895, -122.61804964939437],
  [45.634806, -122.617645],
  [45.63482, -122.616981],
  [45.63484, -122.616619],
  [45.634862, -122.61643400000001],
  [45.6349, -122.616215],
  [45.634948, -122.615997],
  [45.634991, -122.615803],
  [45.635015164991195, -122.61568653816745],
  [45.63501516493899, -122.61568653841903],
  [45.635063, -122.615456],
  [45.635104, -122.615192],
  [45.635123, -122.61511599999999],
  [45.635137, -122.61502799999998],
  [45.635156, -122.614902],
  [45.635166, -122.61478],
  [45.635177, -122.61466999999999],
  [45.635185, -122.61456099999998],
  [45.635187, -122.61445],
  [45.635186, -122.61432099999999],
  [45.635196, -122.614085],
  [45.635204, -122.613914],
  [45.635208, -122.613758],
  [45.635235, -122.61124999999998],
  [45.635238, -122.61096499999998],
  [45.635258, -122.61069199999999],
  [45.635282, -122.61048499999998],
  [45.635317, -122.610182],
  [45.635367, -122.609869],
  [45.635419, -122.609575],
  [45.635466, -122.60935599999999],
  [45.635544, -122.60903399999998],
  [45.635624, -122.60874299999999],
  [45.635715, -122.608428],
  [45.635848, -122.608051],
  [45.635981, -122.60768999999999],
  [45.636105, -122.60737299999998],
  [45.636181, -122.607164],
  [45.636224, -122.60700199999998],
  [45.636275, -122.60682499999999],
  [45.636316, -122.60665899999998],
  [45.636331, -122.606583],
  [45.636349, -122.606485],
  [45.63639, -122.60618299999999],
  [45.636435, -122.60489799999999],
  [45.63645598565931, -122.60408506802254],
  [45.636455985652574, -122.60408506828337],
  [45.636515, -122.60179900000001],
  [45.636527, -122.60153],
  [45.636552, -122.601291],
  [45.636579, -122.601071],
  [45.636611, -122.60080100000002],
  [45.636648, -122.6005],
  [45.63668, -122.60025600000002],
  [45.636706, -122.600129],
  [45.63712785698681, -122.60014169228059],
  [45.63712785700773, -122.60014169228121],
  [45.638667, -122.60018799999999],
  [45.63922520057258, -122.60020443868522],
  [45.639225200768124, -122.60020443869102],
  [45.639448, -122.60021100000002],
  [45.639523, -122.600212],
  [45.639619, -122.600216],
  [45.639714, -122.600219],
  [45.63981, -122.600234],
  [45.639905, -122.60025],
  [45.639998, -122.60027700000002],
  [45.640091, -122.60030400000001],
  [45.640186, -122.600331],
  [45.640278, -122.600371],
  [45.640368, -122.600412],
  [45.640677, -122.600526],
  [45.640709, -122.60031],
  [45.640712, -122.600249],
  [45.6407, -122.599979],
  [45.64068800707892, -122.59934337518317],
  [45.64068795715527, -122.59934163531632],
  [45.640661, -122.59848299999999],
  [45.640621, -122.59749499999998],
  [45.640607, -122.597267],
  [45.640494, -122.595495],
  [45.64034717232504, -122.59344523391215],
  [45.640347172328575, -122.59344523396139],
  [45.640267, -122.592326],
  [45.640144, -122.59048],
  [45.640121, -122.590126],
  [45.640026, -122.588847],
  [45.63996, -122.58796700000002],
  [45.63993876149507, -122.58758640599156],
  [45.63993876150204, -122.58758640611651],
  [45.63991, -122.58707100000001],
  [45.639826, -122.58535099999999],
  [45.6397311233088, -122.5840397325226],
  [45.63973112331266, -122.5840397325759],
  [45.63972, -122.583886],
  [45.639576, -122.582157],
  [45.639561, -122.58198],
  [45.639432, -122.58042],
  [45.639543, -122.578533],
  [45.63957165583571, -122.57810749416053],
  [45.639571655841436, -122.57810749407551],
  [45.639629, -122.577256],
  [45.639746, -122.575612],
  [45.639835, -122.57439700000002],
  [45.639893, -122.573634],
  [45.639901, -122.57350700000002],
  [45.639911, -122.57338],
  [45.639925, -122.573253],
  [45.639941, -122.57312800000001],
  [45.639962, -122.57300400000001],
  [45.63998, -122.57290000000002],
  [45.640031, -122.57266200000001],
  [45.640181, -122.57194900000002],
  [45.640258706668845, -122.57158035119059],
  [45.64025870653089, -122.57158035184506],
  [45.640478, -122.57053999999998],
  [45.640758, -122.56921799999999],
  [45.640908, -122.568508],
  [45.640961, -122.568255],
  [45.640978, -122.568175],
  [45.64119, -122.567161],
  [45.64126602762714, -122.56682205064646],
  [45.64126602738506, -122.56682205172581],
  [45.641633, -122.56518600000001],
  [45.641958, -122.563754],
  [45.642025, -122.56344100000001],
  [45.642029, -122.56342600000002],
  [45.642093, -122.56312700000001],
  [45.642146, -122.56285200000002],
  [45.64237834228043, -122.56165958622508],
  [45.64237834201149, -122.56165958760533],
  [45.642426, -122.56141499999998],
  [45.642558, -122.560339],
  [45.64269, -122.55903000000002],
  [45.642735, -122.55862000000002],
  [45.642765, -122.55823400000001],
  [45.64277, -122.55797500000001],
  [45.64277955959052, -122.55650939527884],
  [45.642779559590316, -122.55650939530987],
  [45.642786, -122.55552199999998],
  [45.642806, -122.554189],
  [45.642804, -122.551125],
  [45.642822410026895, -122.55055935192361],
  [45.642822410026604, -122.55055935193249],
  [45.642844, -122.549896],
  [45.642847, -122.54968399999998],
  [45.642859, -122.54881399999998],
  [45.642873, -122.547719],
  [45.642871, -122.54714999999999],
  [45.642864, -122.545549],
  [45.64288549321088, -122.54499017651693],
  [45.64288549321038, -122.54499017653012],
  [45.642886, -122.54497700000002],
  [45.64289, -122.54361400000002],
  [45.64289, -122.543525],
  [45.642893, -122.542463],
  [45.642894, -122.54192200000001],
  [45.642906, -122.54054800000002],
  [45.64291018521934, -122.53980699590113],
  [45.642910185219336, -122.53980699590261],
  [45.642925, -122.53718400000001],
  [45.642932, -122.53546500000002],
  [45.642941, -122.533961],
  [45.64294231718066, -122.53353258699009],
  [45.642942317180655, -122.5335325869908],
  [45.642945, -122.53266],
  [45.642947, -122.532239],
  [45.642951, -122.530708],
  [45.642951335836294, -122.53014010082661],
  [45.64295133583629, -122.53014010082667],
  [45.642952, -122.52901700000001],
  [45.642959, -122.528864],
  [45.642962, -122.52817400000002],
  [45.642962, -122.528057],
  [45.642965, -122.52761200000002],
  [45.642966, -122.52731900000002],
  [45.642967, -122.527136],
  [45.642968, -122.526839],
  [45.642965, -122.52629300000001],
  [45.642971, -122.525941],
  [45.64297207278978, -122.52570552264262],
  [45.64297207278978, -122.525705522643],
  [45.642973, -122.52550199999999],
  [45.642966, -122.524936],
  [45.642974, -122.52452900000002],
  [45.642978, -122.524328],
  [45.642978, -122.524206],
  [45.642971, -122.523561],
  [45.642981, -122.523115],
  [45.642983, -122.522902],
  [45.642985, -122.522414],
  [45.642986, -122.522208],
  [45.642986, -122.522005],
  [45.642987, -122.52160100000002],
  [45.6429888104612, -122.52115653177492],
  [45.6429888104612, -122.52115653177526],
  [45.642989, -122.52111000000001],
  [45.642978, -122.52093800000002],
  [45.642992, -122.52033000000002],
  [45.642994, -122.519836],
  [45.642996, -122.519431],
  [45.642996, -122.519165],
  [45.642996, -122.51903000000001],
  [45.642997, -122.51893700000001],
  [45.642998, -122.518472],
  [45.643002, -122.51773600000001],
  [45.643006, -122.516402],
  [45.642994, -122.515897],
  [45.642992, -122.5144],
  [45.642982, -122.51304700000001],
  [45.642961, -122.512567],
  [45.642951, -122.51202900000001],
  [45.64294763023025, -122.51191190050133],
  [45.64294763023041, -122.5119119005066],
  [45.642943, -122.511751],
  [45.642941, -122.511286],
  [45.642947, -122.51093600000002],
  [45.642949, -122.510698],
  [45.642933, -122.50975200000002],
  [45.642931, -122.50767100000002],
  [45.64292977807048, -122.50739327287597],
  [45.642929778070474, -122.50739327287651],
  [45.642924, -122.50608],
  [45.642661, -122.506083],
  [45.641726, -122.506088],
  [45.640117, -122.506098],
  [45.63943, -122.506107],
  [45.63907168785954, -122.50610846175273],
  [45.63907168782316, -122.50610846175289],
  [45.637469, -122.50611499999998],
  [45.63607445841262, -122.5061245082381],
  [45.63607445837624, -122.50612450823834],
  [45.635709, -122.50612699999999],
  [45.635315, -122.506124],
  [45.634986, -122.50612099999998],
  [45.634753, -122.506119],
  [45.632941, -122.506098],
  [45.632683364554396, -122.5060967932766],
  [45.6326833646126, -122.50609679327687],
  [45.632087, -122.50609400000002],
  [45.63171, -122.506089],
  [45.630282, -122.506076],
  [45.630167, -122.506074],
  [45.629922, -122.50607200000002],
  [45.629564, -122.506069],
  [45.629153, -122.506065],
  [45.62907101826568, -122.50606389213874],
  [45.62907101840392, -122.5060638921406],
  [45.628857, -122.506061],
  [45.62846, -122.506057],
  [45.627704, -122.50605],
  [45.62737, -122.50604700000001],
  [45.626991, -122.506043],
  [45.626516, -122.505986],
  [45.626418, -122.50597000000002],
  [45.626243, -122.505907],
  [45.626085, -122.505853],
  [45.625983, -122.50581],
  [45.62585, -122.505759],
  [45.6257, -122.505667],
  [45.625538, -122.50557100000002],
  [45.625416, -122.50549500000001],
  [45.6251, -122.50529200000001],
  [45.625004, -122.50523],
  [45.624888, -122.50516200000001],
  [45.62426, -122.504757],
  [45.624097, -122.504665],
  [45.623903, -122.504558],
  [45.623712, -122.504483],
  [45.623529, -122.50441500000001],
  [45.623376, -122.50437700000002],
  [45.623172, -122.504321],
  [45.62304, -122.504302],
  [45.62285, -122.50428700000002],
  [45.622679, -122.50427500000002],
  [45.622358, -122.504272],
  [45.622129, -122.50427400000001],
  [45.621188, -122.50425500000001],
  [45.62025942215632, -122.50429294189038],
  [45.62025942114087, -122.5042929419319],
  [45.620258, -122.504293],
  [45.619952, -122.504274],
  [45.619311, -122.50426100000001],
  [45.618194, -122.504249],
  [45.617691, -122.504255],
  [45.617410593072236, -122.50428022489099],
  [45.61741059190331, -122.50428022499614],
  [45.617213, -122.504298],
  [45.61548, -122.504301],
  [45.615354, -122.504301],
  [45.615236, -122.504296],
  [45.614982689054614, -122.5042867819889],
  [45.61498268937703, -122.50428678200063],
  [45.614549, -122.504271],
  [45.613573, -122.504238],
  [45.613364, -122.504224],
  [45.61325, -122.504213],
  [45.612925, -122.504185],
  [45.612144, -122.504178],
  [45.612024, -122.504163],
  [45.611724139434045, -122.50415257783536],
  [45.6117241399088, -122.50415257785185],
  [45.611017, -122.50412800000001],
  [45.610196, -122.50411300000002],
  [45.608495, -122.504013],
  [45.608408, -122.50399],
  [45.6083, -122.50398400000002],
  [45.607478, -122.503978],
  [45.606678, -122.50397200000002],
  [45.605956310977945, -122.50394059316294],
  [45.60595631198976, -122.50394059320693],
  [45.605598, -122.50392499999998],
  [45.604358, -122.503878],
  [45.60380391718354, -122.50389151421503],
  [45.60380391701074, -122.50389151421925],
  [45.603456, -122.5039],
  [45.602952, -122.503878],
  [45.602011, -122.503884],
  [45.601783, -122.503888],
  [45.600246, -122.50387999999998],
  [45.599543, -122.50389100000001],
  [45.599286, -122.50387999999998],
  [45.599031, -122.50387100000002],
  [45.59870157520709, -122.50386903445829],
  [45.598701575319865, -122.50386903445894],
  [45.598193, -122.50386600000002],
  [45.597951, -122.503875],
  [45.597742, -122.50388800000002],
  [45.597599, -122.503911],
  [45.597453, -122.50392700000002],
  [45.597236, -122.50393800000002],
  [45.596825, -122.503932],
  [45.596739, -122.503929],
  [45.594947, -122.503896],
  [45.594534, -122.503889],
  [45.594216, -122.503867],
  [45.594207, -122.50431100000002],
  [45.594203, -122.504374],
  [45.594194, -122.50441900000001],
  [45.59418, -122.504465],
  [45.594163, -122.504503],
  [45.594145, -122.504548],
  [45.594105, -122.50465],
  [45.594096, -122.504681],
  [45.59409, -122.50471299999998],
  [45.594089, -122.504747],
  [45.594091, -122.50478],
  [45.594097, -122.50480600000002],
  [45.594133, -122.504891],
  [45.594368, -122.50542800000001],
  [45.594472226508856, -122.50568463319634]
];

const stopNames = {
  "293": "Burton &amp; 98th Ave",
  "1121": "Andresen at WINCO",
  "6172": "Broadway &amp; 16th St",
  "649": "E 18th St &amp; Murton",
  "648": "E 20th St &amp; Grand Blvd",
  "1318": "SE 164th Ave &amp; 32nd St",
  "1281": "SE 164th Ave 2100 Block",
  "6248": "NE 28th St &amp; 157th Ave",
  "6247": "NE 28th St &amp; 148th Ave",
  "587": "McLoughlin &amp; W St",
  "582": "McLoughlin at Marshall Center",
  "583": "McLoughlin &amp; Fort Vancouver Way",
  "581": "McLoughlin &amp; F St",
  "589": "McLoughlin Blvd &amp; Grand",
  "2887": "NE 162nd Ave &amp; 11th St",
  "2886": "NE 162nd Ave &amp; 15th St",
  "1120": "Andresen &amp; 18th St",
  "652": "E 18th St &amp; Brandt",
  "650": "E 18th St 3200 Block",
  "651": "E 18th St 3600 Block",
  "3238": "NE 162nd Ave &amp; 23rd St",
  "3239": "NE 162nd Ave &amp; 18th St",
  "3058": "NE 18th St &amp; 65th Ave",
  "1043": "Burton &amp; Bridge Creek Ave",
  "1040": "E 18th St &amp; Devine",
  "1047": "Burton 7700 Block",
  "1046": "NE 25th &amp; Andresen",
  "1044": "Burton &amp; 92nd Ave",
  "227": "McLoughlin at Clark College",
  "3128": "Burton &amp; 87th Ave",
  "1315": "SE 164th Ave &amp; McGillivray",
  "1310": "SE 164th Ave 900 Block",
  "3322": "NE 28th St &amp; 135th Ave",
  "3319": "NE 28th St 12400 Block",
  "9006": "Fisher&#x27;s Landing Transit Center: Bay G",
  "3315": "Burton &amp; 109th Ave",
  "3314": "Burton &amp; 103rd Ave",
  "3317": "NE 28th St &amp; 119th Ave",
  "6249": "NE 28th St &amp; 160th Ave",
  "2156": "SE 164th Ave &amp; 12th St",
  "1038": "E 18th St 4600 Block",
  "1039": "E 18th St &amp; Carlson Rd",
  "1037": "E 18th St &amp; Bryant",
  "633": "Broadway &amp; 13th St",
  "6245": "NE 28th St &amp; 138th Ave",
  "3320": "NE 28th St &amp; 129th Ave",
  "3485": "SE 164th Ave &amp; 6th St",
  "1323": "SE 164th Ave &amp; 1st St",
  "6246": "NE 28th St &amp; 143rd Ave",
  "3316": "NE 28th St &amp; 114th Ave",
  "632": "Broadway &amp; Evergreen Blvd"
};

const stops = [
  { stop_id: "632", name: "Broadway &amp; Evergreen Blvd", lat: 45.62851, lon: -122.670441, times: ["5:52 AM", "6:22 AM", "6:45 AM", "7:21 AM", "7:51 AM", "8:21 AM", "8:50 AM", "9:20 AM"] },
  { stop_id: "633", name: "Broadway &amp; 13th St", lat: 45.631333, lon: -122.67046, times: ["5:52 AM", "6:22 AM", "6:45 AM", "7:21 AM", "7:51 AM", "8:21 AM", "8:50 AM", "9:20 AM"] },
  { stop_id: "6172", name: "Broadway &amp; 16th St", lat: 45.633579, lon: -122.67038, times: ["5:53 AM", "6:23 AM", "6:46 AM", "7:22 AM", "7:52 AM", "8:22 AM", "8:51 AM", "9:21 AM"] },
  { stop_id: "581", name: "McLoughlin &amp; F St", lat: 45.63479, lon: -122.666225, times: ["5:54 AM", "6:24 AM", "6:47 AM", "7:23 AM", "7:53 AM", "8:23 AM", "8:52 AM", "9:22 AM"] },
  { stop_id: "582", name: "McLoughlin at Marshall Center", lat: 45.633861, lon: -122.660909, times: ["5:56 AM", "6:26 AM", "6:49 AM", "7:25 AM", "7:55 AM", "8:25 AM", "8:54 AM", "9:24 AM"] },
  { stop_id: "583", name: "McLoughlin &amp; Fort Vancouver Way", lat: 45.632931, lon: -122.657806, times: ["5:56 AM", "6:26 AM", "6:49 AM", "7:25 AM", "7:55 AM", "8:25 AM", "8:54 AM", "9:24 AM"] },
  { stop_id: "227", name: "McLoughlin at Clark College", lat: 45.632222, lon: -122.651949, times: ["5:57 AM", "6:27 AM", "6:50 AM", "7:26 AM", "7:56 AM", "8:26 AM", "8:55 AM", "9:25 AM"] },
  { stop_id: "587", name: "McLoughlin &amp; W St", lat: 45.632272, lon: -122.647136, times: ["5:58 AM", "6:28 AM", "6:51 AM", "7:27 AM", "7:57 AM", "8:27 AM", "8:56 AM", "9:26 AM"] },
  { stop_id: "589", name: "McLoughlin Blvd &amp; Grand", lat: 45.63245, lon: -122.64138, times: ["5:59 AM", "6:29 AM", "6:52 AM", "7:29 AM", "7:59 AM", "8:29 AM", "8:57 AM", "9:27 AM"] },
  { stop_id: "648", name: "E 20th St &amp; Grand Blvd", lat: 45.635799, lon: -122.640984, times: ["6:00 AM", "6:30 AM", "6:53 AM", "7:30 AM", "8:00 AM", "8:30 AM", "8:58 AM", "9:28 AM"] },
  { stop_id: "649", name: "E 18th St &amp; Murton", lat: 45.635172, lon: -122.638954, times: ["6:01 AM", "6:31 AM", "6:54 AM", "7:30 AM", "8:00 AM", "8:30 AM", "8:59 AM", "9:29 AM"] },
  { stop_id: "650", name: "E 18th St 3200 Block", lat: 45.634759, lon: -122.636761, times: ["6:01 AM", "6:31 AM", "6:54 AM", "7:31 AM", "8:01 AM", "8:31 AM", "8:59 AM", "9:29 AM"] },
  { stop_id: "651", name: "E 18th St 3600 Block", lat: 45.634781, lon: -122.632942, times: ["6:02 AM", "6:32 AM", "6:55 AM", "7:32 AM", "8:02 AM", "8:32 AM", "9:00 AM", "9:30 AM"] },
  { stop_id: "652", name: "E 18th St &amp; Brandt", lat: 45.63468, lon: -122.630281, times: ["6:03 AM", "6:33 AM", "6:56 AM", "7:32 AM", "8:02 AM", "8:32 AM", "9:01 AM", "9:31 AM"] },
  { stop_id: "1037", name: "E 18th St &amp; Bryant", lat: 45.634697, lon: -122.626383, times: ["6:03 AM", "6:33 AM", "6:56 AM", "7:33 AM", "8:03 AM", "8:33 AM", "9:01 AM", "9:31 AM"] },
  { stop_id: "1038", name: "E 18th St 4600 Block", lat: 45.634724, lon: -122.62126, times: ["6:04 AM", "6:34 AM", "6:57 AM", "7:34 AM", "8:04 AM", "8:34 AM", "9:02 AM", "9:32 AM"] },
  { stop_id: "1039", name: "E 18th St &amp; Carlson Rd", lat: 45.634743, lon: -122.618049, times: ["6:05 AM", "6:35 AM", "6:58 AM", "7:35 AM", "8:05 AM", "8:35 AM", "9:03 AM", "9:33 AM"] },
  { stop_id: "1040", name: "E 18th St &amp; Devine", lat: 45.634922, lon: -122.615647, times: ["6:05 AM", "6:35 AM", "6:58 AM", "7:35 AM", "8:05 AM", "8:35 AM", "9:03 AM", "9:33 AM"] },
  { stop_id: "3058", name: "NE 18th St &amp; 65th Ave", lat: 45.63636, lon: -122.60408, times: ["6:08 AM", "6:38 AM", "7:01 AM", "7:38 AM", "8:08 AM", "8:38 AM", "9:06 AM", "9:36 AM"] },
  { stop_id: "1120", name: "Andresen &amp; 18th St", lat: 45.63713, lon: -122.599996, times: ["6:09 AM", "6:39 AM", "7:02 AM", "7:39 AM", "8:09 AM", "8:39 AM", "9:07 AM", "9:37 AM"] },
  { stop_id: "1121", name: "Andresen at WINCO", lat: 45.639228, lon: -122.60001, times: ["6:10 AM", "6:40 AM", "7:03 AM", "7:41 AM", "8:11 AM", "8:41 AM", "9:09 AM", "9:39 AM"] },
  { stop_id: "1046", name: "NE 25th &amp; Andresen", lat: 45.64062, lon: -122.599346, times: ["6:10 AM", "6:40 AM", "7:03 AM", "7:41 AM", "8:11 AM", "8:41 AM", "9:09 AM", "9:39 AM"] },
  { stop_id: "1047", name: "Burton 7700 Block", lat: 45.640301, lon: -122.593452, times: ["6:11 AM", "6:41 AM", "7:04 AM", "7:42 AM", "8:12 AM", "8:42 AM", "9:10 AM", "9:40 AM"] },
  { stop_id: "1043", name: "Burton &amp; Bridge Creek Ave", lat: 45.639881, lon: -122.587593, times: ["6:12 AM", "6:42 AM", "7:05 AM", "7:43 AM", "8:13 AM", "8:43 AM", "9:11 AM", "9:41 AM"] },
  { stop_id: "3128", name: "Burton &amp; 87th Ave", lat: 45.639655, lon: -122.584051, times: ["6:12 AM", "6:42 AM", "7:05 AM", "7:44 AM", "8:14 AM", "8:43 AM", "9:11 AM", "9:41 AM"] },
  { stop_id: "1044", name: "Burton &amp; 92nd Ave", lat: 45.63951, lon: -122.578099, times: ["6:13 AM", "6:43 AM", "7:06 AM", "7:45 AM", "8:15 AM", "8:44 AM", "9:12 AM", "9:42 AM"] },
  { stop_id: "293", name: "Burton &amp; 98th Ave", lat: 45.640186, lon: -122.571549, times: ["6:14 AM", "6:44 AM", "7:07 AM", "7:46 AM", "8:16 AM", "8:45 AM", "9:13 AM", "9:43 AM"] },
  { stop_id: "3314", name: "Burton &amp; 103rd Ave", lat: 45.641194, lon: -122.566789, times: ["6:15 AM", "6:45 AM", "7:08 AM", "7:47 AM", "8:17 AM", "8:46 AM", "9:14 AM", "9:44 AM"] },
  { stop_id: "3315", name: "Burton &amp; 109th Ave", lat: 45.642269, lon: -122.561616, times: ["5:20 AM", "6:16 AM", "6:46 AM", "7:09 AM", "7:48 AM", "8:18 AM", "8:47 AM", "9:15 AM"] },
  { stop_id: "3316", name: "NE 28th St &amp; 114th Ave", lat: 45.642675, lon: -122.556508, times: ["5:21 AM", "6:17 AM", "6:47 AM", "7:10 AM", "7:49 AM", "8:19 AM", "8:48 AM", "9:16 AM"] },
  { stop_id: "3317", name: "NE 28th St &amp; 119th Ave", lat: 45.642712, lon: -122.550552, times: ["5:21 AM", "6:17 AM", "6:47 AM", "7:10 AM", "7:49 AM", "8:19 AM", "8:48 AM", "9:16 AM"] },
  { stop_id: "3319", name: "NE 28th St 12400 Block", lat: 45.642807, lon: -122.544984, times: ["5:22 AM", "6:18 AM", "6:48 AM", "7:11 AM", "7:50 AM", "8:20 AM", "8:49 AM", "9:17 AM"] },
  { stop_id: "3320", name: "NE 28th St &amp; 129th Ave", lat: 45.642824, lon: -122.539806, times: ["5:23 AM", "6:19 AM", "6:49 AM", "7:12 AM", "7:51 AM", "8:21 AM", "8:50 AM", "9:18 AM"] },
  { stop_id: "3322", name: "NE 28th St &amp; 135th Ave", lat: 45.642849, lon: -122.533532, times: ["5:24 AM", "6:20 AM", "6:50 AM", "7:13 AM", "7:52 AM", "8:22 AM", "8:51 AM", "9:19 AM"] },
  { stop_id: "6245", name: "NE 28th St &amp; 138th Ave", lat: 45.642868, lon: -122.53014, times: ["5:24 AM", "6:20 AM", "6:50 AM", "7:13 AM", "7:52 AM", "8:22 AM", "8:51 AM", "9:19 AM"] },
  { stop_id: "6246", name: "NE 28th St &amp; 143rd Ave", lat: 45.642916, lon: -122.525705, times: ["5:25 AM", "6:21 AM", "6:51 AM", "7:14 AM", "7:53 AM", "8:23 AM", "8:52 AM", "9:20 AM"] },
  { stop_id: "6247", name: "NE 28th St &amp; 148th Ave", lat: 45.642925, lon: -122.521156, times: ["5:26 AM", "6:22 AM", "6:52 AM", "7:15 AM", "7:54 AM", "8:24 AM", "8:53 AM", "9:21 AM"] },
  { stop_id: "6248", name: "NE 28th St &amp; 157th Ave", lat: 45.642878, lon: -122.511916, times: ["5:27 AM", "6:23 AM", "6:53 AM", "7:16 AM", "7:55 AM", "8:25 AM", "8:54 AM", "9:22 AM"] },
  { stop_id: "6249", name: "NE 28th St &amp; 160th Ave", lat: 45.642849, lon: -122.507394, times: ["5:28 AM", "6:24 AM", "6:54 AM", "7:17 AM", "7:56 AM", "8:26 AM", "8:55 AM", "9:23 AM"] },
  { stop_id: "3238", name: "NE 162nd Ave &amp; 23rd St", lat: 45.639072, lon: -122.506265, times: ["5:29 AM", "6:25 AM", "6:55 AM", "7:18 AM", "7:57 AM", "8:27 AM", "8:56 AM", "9:24 AM"] },
  { stop_id: "3239", name: "NE 162nd Ave &amp; 18th St", lat: 45.636075, lon: -122.506287, times: ["5:29 AM", "6:25 AM", "6:55 AM", "7:19 AM", "7:58 AM", "8:28 AM", "8:57 AM", "9:25 AM"] },
  { stop_id: "2886", name: "NE 162nd Ave &amp; 15th St", lat: 45.632683, lon: -122.506256, times: ["5:30 AM", "6:26 AM", "6:56 AM", "7:20 AM", "7:59 AM", "8:29 AM", "8:58 AM", "9:26 AM"] },
  { stop_id: "2887", name: "NE 162nd Ave &amp; 11th St", lat: 45.62907, lon: -122.506218, times: ["5:31 AM", "6:27 AM", "6:57 AM", "7:21 AM", "8:00 AM", "8:30 AM", "8:59 AM", "9:27 AM"] },
  { stop_id: "1323", name: "SE 164th Ave &amp; 1st St", lat: 45.620263, lon: -122.504472, times: ["5:33 AM", "6:29 AM", "7:00 AM", "7:23 AM", "8:02 AM", "8:32 AM", "9:01 AM", "9:29 AM"] },
  { stop_id: "3485", name: "SE 164th Ave &amp; 6th St", lat: 45.61742, lon: -122.504494, times: ["5:34 AM", "6:30 AM", "7:00 AM", "7:24 AM", "8:03 AM", "8:33 AM", "9:02 AM", "9:30 AM"] },
  { stop_id: "1310", name: "SE 164th Ave 900 Block", lat: 45.614979, lon: -122.504494, times: ["5:34 AM", "6:30 AM", "7:01 AM", "7:24 AM", "8:03 AM", "8:33 AM", "9:02 AM", "9:31 AM"] },
  { stop_id: "2156", name: "SE 164th Ave &amp; 12th St", lat: 45.61172, lon: -122.504396, times: ["5:35 AM", "6:31 AM", "7:02 AM", "7:25 AM", "8:04 AM", "8:34 AM", "9:03 AM", "9:32 AM"] },
  { stop_id: "1281", name: "SE 164th Ave 2100 Block", lat: 45.605951, lon: -122.50419, times: ["5:36 AM", "6:32 AM", "7:03 AM", "7:27 AM", "8:06 AM", "8:36 AM", "9:05 AM", "9:34 AM"] },
  { stop_id: "1315", name: "SE 164th Ave &amp; McGillivray", lat: 45.603806, lon: -122.504066, times: ["5:37 AM", "6:33 AM", "7:04 AM", "7:27 AM", "8:06 AM", "8:36 AM", "9:05 AM", "9:34 AM"] },
  { stop_id: "1318", name: "SE 164th Ave &amp; 32nd St", lat: 45.598701, lon: -122.504066, times: ["5:38 AM", "6:34 AM", "7:05 AM", "7:29 AM", "8:08 AM", "8:38 AM", "9:07 AM", "9:36 AM"] },
  { stop_id: "9006", name: "Fisher&#x27;s Landing Transit Center: Bay G", lat: 45.59452, lon: -122.505645, times: ["5:40 AM", "6:36 AM", "7:07 AM", "7:31 AM", "8:10 AM", "8:40 AM", "9:09 AM", "9:38 AM"] },
]

    const polylineOut = L.polyline(shapeOutbound, { color: 'blue', weight: 4, opacity: 0.7 }).addTo(map);
    map.fitBounds(polylineOut.getBounds());

    const nowPT = new Date(new Date().toLocaleString('en-US', { timeZone: 'America/Los_Angeles' }));
    const nowMins = nowPT.getHours() * 60 + nowPT.getMinutes();

    stops.forEach(stop => {
      let highlightedTimes = [];
      let foundNext = false;
      stop.times.forEach(timeStr => {
        let cleanTime = timeStr.trim();
        let [h, m] = cleanTime.split(":");
        let schedMins = parseInt(h, 10) * 60 + parseInt(m, 10);
        if (schedMins < nowMins && nowMins - schedMins > 720) {
          schedMins += 1440;
        }
        if (!foundNext && schedMins >= nowMins) {
          highlightedTimes.push(`<span style="background:#4dd0e1; color:#000; padding:2px 6px; border-radius:6px; font-weight:bold;">${cleanTime}</span>`);
          foundNext = true;
        } else {
          highlightedTimes.push(cleanTime);
        }
      });

      L.circleMarker([stop.lat, stop.lon], {
        radius: 6,
        color: '#4dd0e1',
        fillColor: '#4dd0e1',
        fillOpacity: 0.9,
        weight: 1
      })
      .bindPopup(`<strong>${stop.name}</strong><br>${highlightedTimes.join("<br>") || 'No scheduled times'}`)
      .addTo(map);
    });

    let busMarkers = {};
    async function fetchAndDisplay() {
      const res = await fetch(`https://developer.trimet.org/ws/v2/vehicles?route=${routeNumber}&appID=${apiKey}&json=true`);
      const data = await res.json();
      const buses = (data.resultSet.vehicle || []).filter(v => v.routeNumber == routeNumber && v.direction == direction);

      Object.values(busMarkers).forEach(m => map.removeLayer(m));
      busMarkers = {};
      if (!buses.length) return;

      buses.forEach(bus => {
        if (!bus.latitude || !bus.longitude || !bus.blockID) return;
        const icon = L.divIcon({    
           className: '',
           html: `
            <div style="text-align:center;">
              <div style="background:#0071CE;color:#fff;padding:2px 6px;border-radius:6px;font-weight:bold;">${bus.vehicleID}</div>
              <div style="width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-top:10px solid #00bfff;margin:auto;"></div>
            </div>
          `,
          iconSize: [40, 30], iconAnchor: [20, 30]
        });
        const marker = L.marker([bus.latitude, bus.longitude], { icon }).addTo(map);
        busMarkers[bus.vehicleID] = marker;
      });
    }
    fetchAndDisplay();
    setInterval(fetchAndDisplay, 15000);
  </script>

  <footer class="site-footer">
    <a href="terms.html">Terms of Use</a> &nbsp;|&nbsp;
    <a href="contact.html">Contact Us</a> &nbsp;|&nbsp;
    <a href="report.html">Report a Problem</a> &nbsp;|&nbsp;
    <a href="dmca.html">DMCA</a> &nbsp;|&nbsp;
    <a href="privacy.html">Privacy Policy</a>
  </footer>

  <script>
    if (!localStorage.getItem('cookieConsent')) {
      document.write(`
        <div id="cookie-banner" style="position: fixed; bottom: 0; left: 0; right: 0; background: #333; color: #fff; padding: 1rem; z-index: 1000; font-size: 0.9rem; line-height: 1.4; text-align: center; box-sizing: border-box;">
          📢 We use cookies to improve functionality and analyze traffic.
          By using MetroFeed, you agree to our 
          <a href='privacy.html' style='color: #4dd0e1; text-decoration: underline;'>Privacy Policy</a>.<br>
          <button onclick='localStorage.setItem("cookieConsent", "true"); document.getElementById("cookie-banner").remove();' style='margin-top: 0.5rem; background: #4dd0e1; color: #000; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer; font-weight: bold;'>OK</button>
        </div>
      `);
    }
  </script>
</body>
</html>