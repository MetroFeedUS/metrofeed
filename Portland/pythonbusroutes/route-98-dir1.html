<!DOCTYPE html>
<html lang="en">
<head>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EL337T4JX4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-EL337T4JX4');
</script>

<meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Route 98 - Westbound | MetroFeed Portland</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #0d0d0d;
      color: #cccccc;
      overflow-y: auto;
    }

    body {
      padding-top: 120px;
    }

    .ad-banner {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: #222;
      padding: 0;
      z-index: 1000;
      box-shadow: 0 2px 2px rgba(0,0,0,0.5);
      text-align: center;
    }

    .ad-banner img {
      width: 100%;
      max-width: 728px;
      max-height: 120px;
      display: block;
      margin: 0 auto;
    }
    .home-button {
      position: fixed;
      top: 120px;
      left: 10px;
      background-color: #4dd0e1;
      color: #0d0d0d;
      padding: 0.5rem 1rem;
      font-weight: bold;
      border-radius: 8px;
      text-decoration: none;
      z-index: 1001;
      box-shadow: 0 0 10px #4dd0e1;
    }

    .home-button:hover {
      background-color: #00bcd4;
      color: #ffffff;
    }

    header {
      background-color: #0d0d0d;
      border-top: 4px solid #4dd0e1;
      border-bottom: 3px solid #4dd0e1;
      padding: 1rem;
      text-align: center;
    }

    header img {
      max-height: 60px;
    }

    h1 {
      text-align: center;
      margin: 1rem 0;
      font-size: 2rem;
      color: #f0f0f0;
    }

    .content-box {
      border-radius: 12px;
      padding: 0;
      margin: 0;
      background-color: #1e1e1e;
    }

    #map {
      width: 100%;
      height: 85vh;
      border: none;
      margin: 0 auto;
      display: block;
      border-radius: 8px;
    }

    .button-bar {
      display: flex;
      justify-content: center;
      margin: 1rem 0;
    }

    .button-bar a, .back-button {
      background: #4dd0e1;
      color: #0d0d0d;
      padding: 0.6rem 1.2rem;
      text-decoration: none;
      border-radius: 8px;
      font-weight: bold;
      border: none;
      cursor: pointer;
      box-shadow: 0 0 10px #4dd0e1;
    }

    .back-button:hover {
      background-color: #35c0d6;
    }

    .site-footer {
      text-align: center;
      margin-top: 3rem;
      margin-bottom: 120px;
      font-size: 0.85rem;
      color: #aaa;
    }

    .site-footer a {
      color: #00BFFF;
      text-decoration: none;
    }

    .site-footer a:hover {
      text-decoration: underline;
    }

    @media (max-width: 600px) {
      .ad-banner {
        padding-top: 1rem;
        padding-bottom: 0rem;
      }
    }
  </style>
</head>

<body>
  <div class="ad-banner">
    <iframe src="https://metrofeedus.com/portland/Ads/route-98-dir1-ad.html" style="border:none; width:100%; max-width: 728px; height:90px;"></iframe>
  </div>

  <header>
    <img src="MetroFeedPortlandLogo.png" alt="MetroFeed Portland">
  </header>

  <div class="disclaimer" style="margin: 1rem auto 0.5rem; max-width: 600px; font-size: 0.8rem; color: #bbb; text-align: center; padding: 0.5rem 1rem; background-color: #111; border: 1px dashed #444; border-radius: 6px;">
    ‚ö†Ô∏è This is a Beta program, work in progress. Please REPORT bugs and pretend to be impressed.
  </div>
  <div class="disclaimer" style="margin: 0 auto 1rem; max-width: 600px; font-size: 0.75rem; color: #888; text-align: center; padding: 0.25rem 1rem;">
    This tool is not affiliated with or endorsed by TriMet. For official schedules and service alerts, visit <a href="https://trimet.org" style="color:#4dd0e1;">trimet.org</a>.
  </div>

  <div style="margin: 2rem 0; text-align: center;">
    <button class="back-button" onclick="history.back()">Back</button>
  </div>

  <h1>Route 98 - Westbound</h1>

  <div class="content-box">
    <div id="map"></div>
    <div style="text-align:right; font-size: 0.7rem; color: #777; margin-top: 0.5rem;">
      Data courtesy of TriMet.
    </div>
  </div>

  <script>
    if (document.referrer === "" && performance.navigation.type === 0) {
      window.location.href = "/index.html";
    }

    const apiKey = "2C4447D4A42083BCD84DE3B8E";
    const routeNumber = 98;
    const direction = parseInt(1);

    const map = L.map('map', {
      center: [45.6, -122.7],
      zoom: 12,
      minZoom: 12,
      maxZoom: 18,
      maxBounds: [[45.3, -123.1], [45.9, -122.3]],
      maxBoundsViscosity: 1.0
    });
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);

    const shapeOutbound = [
  [45.529874, -122.561971],
  [45.529827, -122.561963],
  [45.529688, -122.561947],
  [45.529572, -122.561941],
  [45.529477, -122.561942],
  [45.52947, -122.562054],
  [45.529468, -122.562594],
  [45.529466, -122.563],
  [45.529533, -122.563066],
  [45.529537, -122.563312],
  [45.529537, -122.563337],
  [45.529538, -122.563394],
  [45.529547, -122.563465],
  [45.529549, -122.563479],
  [45.529567, -122.563548],
  [45.529588, -122.563598],
  [45.529653, -122.563654],
  [45.529748, -122.56368],
  [45.529938, -122.563661],
  [45.530105, -122.56369],
  [45.530678, -122.563903],
  [45.530875, -122.563964],
  [45.531008, -122.564005],
  [45.531055, -122.564003],
  [45.531106, -122.563969],
  [45.531154, -122.563897],
  [45.531162, -122.563873],
  [45.531172, -122.563846],
  [45.531186, -122.563794],
  [45.531199, -122.563739],
  [45.531234, -122.563555],
  [45.531163, -122.563535],
  [45.531062, -122.563504],
  [45.530303, -122.563198],
  [45.530197, -122.563158],
  [45.529906, -122.563116],
  [45.529758, -122.563141],
  [45.529692, -122.563131],
  [45.529684, -122.56313],
  [45.529636, -122.56312],
  [45.529533, -122.563066],
  [45.529466, -122.563],
  [45.529468, -122.562594],
  [45.52947, -122.562054],
  [45.529477, -122.561942],
  [45.528923, -122.561944],
  [45.528501, -122.561948],
  [45.528369, -122.56195],
  [45.528199, -122.561952],
  [45.52772, -122.561958],
  [45.527497, -122.561961],
  [45.52641, -122.561985],
  [45.526284, -122.561981],
  [45.526286, -122.562097],
  [45.526288, -122.562907],
  [45.526296, -122.563531],
  [45.526304, -122.56391],
  [45.526311, -122.564199],
  [45.526315, -122.564316],
  [45.526318, -122.564463],
  [45.526319, -122.56462],
  [45.526329, -122.56585],
  [45.526327, -122.566043],
  [45.526332, -122.566568],
  [45.526334, -122.566786],
  [45.526335, -122.566924],
  [45.52634, -122.567445],
  [45.526342, -122.567708],
  [45.526347, -122.568346],
  [45.52635, -122.568652],
  [45.526354, -122.569331],
  [45.526358, -122.56992],
  [45.526361, -122.570308],
  [45.526367, -122.571264],
  [45.526377, -122.572877],
  [45.526381, -122.573624],
  [45.526384, -122.573889],
  [45.526393, -122.574993],
  [45.526396, -122.575291],
  [45.526401, -122.575976],
  [45.526401, -122.57601],
  [45.526404, -122.576486],
  [45.526405, -122.57662],
  [45.526408, -122.577031],
  [45.526415, -122.578042],
  [45.526418, -122.578445],
  [45.526419, -122.578521],
  [45.526421, -122.578928],
  [45.52642, -122.579056],
  [45.526515, -122.579058],
  [45.526716, -122.579056],
  [45.526742, -122.579056],
  [45.526968, -122.579053],
  [45.527999, -122.579055],
  [45.528385, -122.579052],
  [45.529475, -122.579045],
  [45.530187, -122.579044],
  [45.530957, -122.579039],
  [45.5316, -122.579041],
  [45.531713, -122.579041],
  [45.531779, -122.579041],
  [45.532143, -122.579032],
  [45.532343, -122.579032],
  [45.532414, -122.579034],
  [45.532501, -122.579036],
  [45.532764, -122.579036],
  [45.532846, -122.579036],
  [45.532963, -122.579036],
  [45.533025, -122.578964],
  [45.533171, -122.578964],
  [45.533772, -122.578962],
  [45.53382, -122.578962],
  [45.533972, -122.579039],
  [45.533966, -122.578853],
  [45.533964, -122.578775],
  [45.533963, -122.578736],
  [45.533956, -122.578654],
  [45.533949, -122.578609],
  [45.533927, -122.578538],
  [45.533809, -122.578232],
  [45.533717, -122.577994],
  [45.53365, -122.577803],
  [45.533612, -122.577683],
  [45.533607, -122.57766],
  [45.533592, -122.577599],
  [45.533577, -122.577519],
  [45.533566, -122.577393],
  [45.533563, -122.577328],
  [45.533561, -122.577268],
  [45.533552, -122.576687],
  [45.533553, -122.576617],
  [45.533564, -122.576564],
  [45.533576, -122.576517],
  [45.533595, -122.576471],
  [45.533613, -122.576438],
  [45.533638, -122.576403],
  [45.533668, -122.576376],
  [45.533741, -122.576316],
  [45.533914, -122.576501],
  [45.534032, -122.576697],
  [45.534106, -122.576831],
  [45.534162, -122.576936],
  [45.534218, -122.577054],
  [45.534283, -122.577197],
  [45.534335, -122.577314],
  [45.534428, -122.577548],
  [45.534476, -122.57769],
  [45.534502, -122.577786],
  [45.534526, -122.577887],
  [45.534545, -122.578007],
  [45.534558, -122.578106],
  [45.534569, -122.578234],
  [45.534574, -122.578335],
  [45.534575, -122.578417],
  [45.534575, -122.578518],
  [45.534568, -122.578678],
  [45.5345, -122.578867],
  [45.53449, -122.578928],
  [45.534475, -122.579001],
  [45.534453, -122.579086],
  [45.534429, -122.579171],
  [45.534379, -122.579316],
  [45.534346, -122.579399],
  [45.534314, -122.579474],
  [45.534272, -122.579569],
  [45.53421, -122.579694],
  [45.534023, -122.580071],
  [45.533775, -122.580562],
  [45.533704, -122.580705],
  [45.533674, -122.580775],
  [45.533648, -122.580843],
  [45.533635, -122.580885],
  [45.533625, -122.58093],
  [45.533617, -122.58098],
  [45.533612, -122.581028],
  [45.533608, -122.581103],
  [45.533607, -122.581159],
  [45.533607, -122.581708],
  [45.533606, -122.58196],
  [45.533606, -122.582035],
  [45.533605, -122.582772],
  [45.533604, -122.582941],
  [45.533604, -122.583165],
  [45.533602, -122.583912],
  [45.533601, -122.584182],
  [45.5336, -122.584829],
  [45.533599, -122.585194],
  [45.533598, -122.585802],
  [45.533598, -122.586207],
  [45.533596, -122.586785],
  [45.533595, -122.58722],
  [45.533594, -122.587751],
  [45.533593, -122.588239],
  [45.533594, -122.588734],
  [45.533596, -122.58938],
  [45.533597, -122.589826],
  [45.5336, -122.590095],
  [45.533609, -122.590392],
  [45.533623, -122.590841],
  [45.533634, -122.591729],
  [45.533637, -122.59236],
  [45.533637, -122.592574],
  [45.533643, -122.593877],
  [45.533645, -122.594334],
  [45.533647, -122.594756],
  [45.533661, -122.595965],
  [45.533669, -122.596606],
  [45.533671, -122.596749],
  [45.533682, -122.59768],
  [45.53369, -122.598621],
  [45.533693, -122.598931],
  [45.533697, -122.599558],
  [45.533701, -122.60022],
  [45.533704, -122.600604],
  [45.533706, -122.601197],
  [45.533707, -122.601621],
  [45.533706, -122.602022],
  [45.533707, -122.602163],
  [45.533633, -122.602165],
  [45.533617, -122.602165],
  [45.533011, -122.602173],
  [45.532284, -122.602184],
  [45.531637, -122.602193],
  [45.531001, -122.602207],
  [45.530319, -122.602214],
  [45.529559, -122.602224],
  [45.52895, -122.602239],
  [45.528642, -122.602246],
  [45.528603, -122.602248],
  [45.528312, -122.602257],
  [45.528217, -122.602259],
  [45.527957, -122.602265],
  [45.527219, -122.602274],
  [45.526952, -122.602262],
  [45.526582, -122.602264],
  [45.526481, -122.602265],
  [45.526486, -122.603834],
  [45.52659, -122.603835],
  [45.526932, -122.603834],
  [45.527018, -122.603841],
  [45.527111, -122.603861],
  [45.527198, -122.60391],
  [45.527265, -122.603973],
  [45.527327, -122.60406],
  [45.527387, -122.604173],
  [45.527603, -122.604638],
  [45.527648, -122.604747],
  [45.527709, -122.604929],
  [45.527747, -122.605053],
  [45.527761, -122.605156],
  [45.527761, -122.605258],
  [45.527749, -122.605356],
  [45.527672, -122.605792],
  [45.527617, -122.606148],
  [45.527572, -122.606493],
  [45.527537, -122.606835],
  [45.527523, -122.606983],
  [45.527512, -122.607132],
  [45.527495, -122.607375],
  [45.527485, -122.607585],
  [45.52748, -122.607794],
  [45.527475, -122.607968],
  [45.527422, -122.608276],
  [45.527427, -122.608347],
  [45.527458, -122.608669],
  [45.527494, -122.608986],
  [45.527538, -122.609271],
  [45.527592, -122.609575],
  [45.527657, -122.609873],
  [45.527733, -122.610172],
  [45.527817, -122.61046],
  [45.527911, -122.610736],
  [45.528017, -122.611016],
  [45.528128, -122.61128],
  [45.528254, -122.611543],
  [45.528385, -122.611793],
  [45.528519, -122.612034],
  [45.528664, -122.612277],
  [45.528805, -122.612507],
  [45.530274, -122.614778],
  [45.53077, -122.61531],
  [45.530954, -122.615578],
  [45.531212, -122.615995],
  [45.531471, -122.616434],
  [45.531684, -122.616849],
  [45.531778, -122.617053],
  [45.532169, -122.617977],
  [45.532419, -122.618553],
  [45.53254, -122.61875],
  [45.532699, -122.618944],
  [45.532817, -122.619023],
  [45.532912, -122.619066],
  [45.533036, -122.619096],
  [45.533101, -122.619101],
  [45.53347, -122.619098],
  [45.533703, -122.619098],
  [45.53379, -122.619096],
  [45.53379, -122.619171],
  [45.533792, -122.619553],
  [45.533793, -122.619652],
  [45.533794, -122.619781],
  [45.533799, -122.620308],
  [45.533798, -122.62045],
  [45.533797, -122.620699],
  [45.533796, -122.620943],
  [45.533795, -122.621029],
  [45.533795, -122.621142],
  [45.533795, -122.621292],
  [45.533793, -122.621732],
  [45.533798, -122.621887],
  [45.5338, -122.621934],
  [45.533806, -122.622061],
  [45.533821, -122.622306],
  [45.533833, -122.622454],
  [45.533836, -122.622487],
  [45.533844, -122.622754],
  [45.533809, -122.62295],
  [45.533886, -122.622901],
  [45.533931, -122.622885],
  [45.534309, -122.622884],
  [45.534367, -122.622884],
  [45.534768, -122.622883],
  [45.534866, -122.622899],
  [45.534709, -122.623296],
  [45.534486, -122.623813],
  [45.534445, -122.623913],
  [45.534405, -122.624009],
  [45.534315, -122.624216],
  [45.534245, -122.624373],
  [45.534178, -122.624537],
  [45.534052, -122.624854],
  [45.534044, -122.624969],
  [45.534033, -122.625149],
  [45.533988, -122.62527],
  [45.533962, -122.625359],
  [45.533952, -122.625432],
  [45.533948, -122.625495],
  [45.53395, -122.62556],
  [45.533954, -122.625627],
  [45.533965, -122.625695],
  [45.53399, -122.625857],
  [45.534302, -122.627244],
  [45.534357, -122.627509],
  [45.534406, -122.627765],
  [45.534448, -122.628024],
  [45.534475, -122.628255],
  [45.534497, -122.628497],
  [45.534508, -122.628709],
  [45.534512, -122.628901],
  [45.534509, -122.629096],
  [45.534498, -122.629258],
  [45.534485, -122.629436],
  [45.534467, -122.629583],
  [45.534438, -122.629765],
  [45.5344, -122.629962],
  [45.53435, -122.630168],
  [45.534301, -122.630376],
  [45.534247, -122.630547],
  [45.534192, -122.630703],
  [45.53412, -122.630862],
  [45.534062, -122.630986],
  [45.533959, -122.631178],
  [45.533843, -122.631359],
  [45.533726, -122.631521],
  [45.533602, -122.631672],
  [45.53348, -122.631835],
  [45.533354, -122.631987],
  [45.533222, -122.632135],
  [45.533089, -122.632273],
  [45.532949, -122.632413],
  [45.532809, -122.632541],
  [45.532672, -122.632659],
  [45.532249, -122.633018],
  [45.532104, -122.633143],
  [45.531963, -122.633265],
  [45.531826, -122.63339],
  [45.531686, -122.633525],
  [45.531559, -122.633655],
  [45.531429, -122.633805],
  [45.531306, -122.633959],
  [45.531188, -122.634126],
  [45.531083, -122.6343],
  [45.530981, -122.634479],
  [45.530884, -122.634674],
  [45.530805, -122.634861],
  [45.530729, -122.635074],
  [45.530664, -122.635287],
  [45.530604, -122.635508],
  [45.530556, -122.635732],
  [45.530515, -122.635961],
  [45.530483, -122.636188],
  [45.530457, -122.636427],
  [45.530438, -122.63667],
  [45.530422, -122.6369],
  [45.53041, -122.637133],
  [45.530353, -122.638209],
  [45.529983, -122.646034],
  [45.529986, -122.646901],
  [45.529985, -122.647138],
  [45.529978, -122.647376],
  [45.529967, -122.647598],
  [45.529919, -122.648173],
  [45.529898, -122.648413],
  [45.529873, -122.648665],
  [45.529846, -122.64891],
  [45.529826, -122.649139],
  [45.529816, -122.649304],
  [45.529812, -122.649456],
  [45.529814, -122.64959],
  [45.529821, -122.649707],
  [45.52984, -122.649886],
  [45.529861, -122.650059],
  [45.529953, -122.650688],
  [45.529969, -122.650838],
  [45.529979, -122.650972],
  [45.529988, -122.651256],
  [45.529978, -122.651413],
  [45.529963, -122.651547],
  [45.529936, -122.651703],
  [45.529918, -122.651783],
  [45.529905, -122.651843],
  [45.529825, -122.652172],
  [45.529729, -122.652384],
  [45.529615, -122.652595],
  [45.529577, -122.652812],
  [45.529471, -122.653166],
  [45.529409, -122.653354],
  [45.529351, -122.65353],
  [45.529238, -122.653617],
  [45.529127, -122.654069],
  [45.529104, -122.654163],
  [45.52906, -122.654334],
  [45.52902, -122.65449],
  [45.528849, -122.655123],
  [45.528796, -122.655314],
  [45.528688, -122.655718],
  [45.528647, -122.655863],
  [45.528573, -122.656105],
  [45.528496, -122.656331],
  [45.528444, -122.656475],
  [45.528368, -122.656684],
  [45.528253, -122.656975],
  [45.528106, -122.657317],
  [45.527887, -122.657796],
  [45.527626, -122.65837],
  [45.527577, -122.658486],
  [45.527418, -122.658828],
  [45.527367, -122.658926],
  [45.527354, -122.658949],
  [45.527293, -122.659056],
  [45.527226, -122.659163],
  [45.527149, -122.659271],
  [45.527089, -122.659351],
  [45.526848, -122.659625],
  [45.526826, -122.659651],
  [45.526757, -122.659734],
  [45.526705, -122.659804],
  [45.526688, -122.659834],
  [45.52666, -122.65988],
  [45.526613, -122.65998],
  [45.526582, -122.660064],
  [45.526555, -122.660163],
  [45.526543, -122.66025],
  [45.52654, -122.660349],
  [45.52654, -122.660564],
  [45.526541, -122.660672],
  [45.526541, -122.660692],
  [45.526543, -122.661129],
  [45.526544, -122.6617],
  [45.526544, -122.661793],
  [45.526547, -122.662414],
  [45.526548, -122.66263],
  [45.52655, -122.663186],
  [45.526553, -122.663406],
  [45.52656, -122.663503],
  [45.526571, -122.663582],
  [45.526576, -122.663609],
  [45.526593, -122.66369],
  [45.526637, -122.663838],
  [45.526695, -122.663871],
  [45.526815, -122.664153],
  [45.526839, -122.664246],
  [45.526891, -122.664376],
  [45.526922, -122.66445],
  [45.526941, -122.664508],
  [45.526956, -122.664551],
  [45.527022, -122.664746],
  [45.52703, -122.664799],
  [45.527098, -122.664947],
  [45.527178, -122.665112],
  [45.527232, -122.665201],
  [45.527297, -122.665281],
  [45.527354, -122.665339],
  [45.527423, -122.665402],
  [45.527486, -122.665448],
  [45.527536, -122.665482],
  [45.52766, -122.665542],
  [45.527886, -122.66564],
  [45.528032, -122.665698],
  [45.528084, -122.665715],
  [45.528153, -122.665729],
  [45.528228, -122.66574],
  [45.528306, -122.665746],
  [45.528506, -122.665752],
  [45.528588, -122.665752],
  [45.528661, -122.665755],
  [45.528741, -122.665758],
  [45.528992, -122.665759],
  [45.529088, -122.665767],
  [45.529148, -122.66578],
  [45.529192, -122.665794],
  [45.529239, -122.665819],
  [45.529314, -122.665836],
  [45.529388, -122.665864],
  [45.529436, -122.665896],
  [45.529483, -122.665837],
  [45.529518, -122.665801],
  [45.529572, -122.665766],
  [45.529666, -122.665741],
  [45.529794, -122.665729],
  [45.529872, -122.66573]
];

const stopNames = {
  "7828": "NE 60th &amp; 60th Ave MAX Stn/I-84",
  "7999": "NE 82nd &amp; 82nd Ave MAX Stn/I-84",
  "8196": "Gateway Transit Center",
  "10271": "Rose Quarter TC &amp; Holladay",
  "14144": "NE Halsey &amp; 42nd (Hollywood)"
};

const stops = [
  { stop_id: "8196", name: "Gateway Transit Center", lat: 45.530884, lon: -122.563895, times: ["3:38 AM", "3:58 AM", "4:20 AM", "4:37 AM", "4:57 AM", "5:17 AM", "5:26 AM", "5:34 AM"] },
  { stop_id: "7999", name: "NE 82nd &amp; 82nd Ave MAX Stn/I-84", lat: 45.53378, lon: -122.578903, times: ["3:16 AM", "3:44 AM", "4:04 AM", "4:26 AM", "4:43 AM", "5:03 AM", "5:23 AM", "5:32 AM"] },
  { stop_id: "7828", name: "NE 60th &amp; 60th Ave MAX Stn/I-84", lat: 45.528606, lon: -122.602393, times: ["3:21 AM", "3:49 AM", "4:09 AM", "4:31 AM", "4:48 AM", "5:08 AM", "5:28 AM", "5:37 AM"] },
  { stop_id: "14144", name: "NE Halsey &amp; 42nd (Hollywood)", lat: 45.53387, lon: -122.620711, times: ["3:25 AM", "3:53 AM", "4:13 AM", "4:35 AM", "4:52 AM", "5:12 AM", "5:32 AM", "5:42 AM"] },
  { stop_id: "10271", name: "Rose Quarter TC &amp; Holladay", lat: 45.529872, lon: -122.66564, times: ["3:37 AM", "4:05 AM", "4:25 AM", "4:47 AM", "5:04 AM", "5:24 AM", "5:45 AM", "5:55 AM"] },
]

    const polylineOut = L.polyline(shapeOutbound, { color: 'blue', weight: 4, opacity: 0.7 }).addTo(map);
    map.fitBounds(polylineOut.getBounds());

    const nowPT = new Date(new Date().toLocaleString('en-US', { timeZone: 'America/Los_Angeles' }));
    const nowMins = nowPT.getHours() * 60 + nowPT.getMinutes();

    stops.forEach(stop => {
      let highlightedTimes = [];
      let foundNext = false;
      stop.times.forEach(timeStr => {
        let cleanTime = timeStr.trim();
        let [h, m] = cleanTime.split(":");
        let schedMins = parseInt(h, 10) * 60 + parseInt(m, 10);
        if (schedMins < nowMins && nowMins - schedMins > 720) {
          schedMins += 1440;
        }
        if (!foundNext && schedMins >= nowMins) {
          highlightedTimes.push(`<span style="background:#4dd0e1; color:#000; padding:2px 6px; border-radius:6px; font-weight:bold;">${cleanTime}</span>`);
          foundNext = true;
        } else {
          highlightedTimes.push(cleanTime);
        }
      });

      L.circleMarker([stop.lat, stop.lon], {
        radius: 6,
        color: '#4dd0e1',
        fillColor: '#4dd0e1',
        fillOpacity: 0.9,
        weight: 1
      })
      .bindPopup(`<strong>${stop.name}</strong><br>${highlightedTimes.join("<br>") || 'No scheduled times'}`)
      .addTo(map);
    });

    let busMarkers = {};
    async function fetchAndDisplay() {
      const res = await fetch(`https://developer.trimet.org/ws/v2/vehicles?route=${routeNumber}&appID=${apiKey}&json=true`);
      const data = await res.json();
      const buses = (data.resultSet.vehicle || []).filter(v => v.routeNumber == routeNumber && v.direction == direction);

      Object.values(busMarkers).forEach(m => map.removeLayer(m));
      busMarkers = {};
      if (!buses.length) return;

      buses.forEach(bus => {
        if (!bus.latitude || !bus.longitude || !bus.blockID) return;
        const icon = L.divIcon({    
           className: '',
           html: `
            <div style="text-align:center;">
              <div style="background:#0071CE;color:#fff;padding:2px 6px;border-radius:6px;font-weight:bold;">${bus.vehicleID}</div>
              <div style="width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-top:10px solid #00bfff;margin:auto;"></div>
            </div>
          `,
          iconSize: [40, 30], iconAnchor: [20, 30]
        });
        const marker = L.marker([bus.latitude, bus.longitude], { icon }).addTo(map);
        busMarkers[bus.vehicleID] = marker;
      });
    }
    fetchAndDisplay();
    setInterval(fetchAndDisplay, 15000);
  </script>

  <footer class="site-footer">
    <a href="terms.html">Terms of Use</a> &nbsp;|&nbsp;
    <a href="contact.html">Contact Us</a> &nbsp;|&nbsp;
    <a href="report.html">Report a Problem</a> &nbsp;|&nbsp;
    <a href="dmca.html">DMCA</a> &nbsp;|&nbsp;
    <a href="privacy.html">Privacy Policy</a>
  </footer>

  <script>
    if (!localStorage.getItem('cookieConsent')) {
      document.write(`
        <div id="cookie-banner" style="position: fixed; bottom: 0; left: 0; right: 0; background: #333; color: #fff; padding: 1rem; z-index: 1000; font-size: 0.9rem; line-height: 1.4; text-align: center; box-sizing: border-box;">
          üì¢ We use cookies to improve functionality and analyze traffic.
          By using MetroFeed, you agree to our 
          <a href='privacy.html' style='color: #4dd0e1; text-decoration: underline;'>Privacy Policy</a>.<br>
          <button onclick='localStorage.setItem("cookieConsent", "true"); document.getElementById("cookie-banner").remove();' style='margin-top: 0.5rem; background: #4dd0e1; color: #000; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer; font-weight: bold;'>OK</button>
        </div>
      `);
    }
  </script>
</body>
</html>