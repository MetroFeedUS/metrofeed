<!DOCTYPE html>
<html lang="en">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EL337T4JX4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-EL337T4JX4');
</script>

<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Route 77 - To Montgomery Park | MetroFeed Portland</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
  html, body {
    margin: 0;
    padding: 0;
    font-family: 'Segoe UI', sans-serif;
    background-color: #0d0d0d;
    color: #cccccc;
    overflow-y: auto;
  }

  .back-button-fixed {
    position: fixed;
    top: 20px;
    left: 20px;
    width: 45px;
    height: 45px;
    background-color: #4dd0e1;
    border: 2px solid #000;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1001;
    box-shadow: 0 0 10px #4dd0e1;
    cursor: pointer;
    transition: background 0.2s;
    outline: none;
  }
  .back-button-fixed:active, .back-button-fixed:focus {
    background-color: #1976d2;
  }
  .back-button-fixed svg {
    width: 24px;
    height: 24px;
    fill: #000;
    display: block;
  }
  .back-button-fixed:active svg,
  .back-button-fixed:focus svg {
    fill: #fff;
  }

  header {
    background-color: #0d0d0d;
    border-top: 4px solid #4dd0e1;
    border-bottom: 3px solid #4dd0e1;
    padding: 1rem;
    text-align: center;
  }

  header img {
    max-height: 60px;
  }

  h1#route-title {
    text-align: center;
    margin: 1rem 0;
    font-size: 2rem;
    color: #f0f0f0;
  }

  .content-box {
    border-radius: 12px;
    padding: 0;
    margin: 0;
    background-color: #1e1e1e;
  }

  #map {
    width: 100%;
    height: 85vh;
    border: none;
    margin: 0 auto;
    display: block;
    border-radius: 8px;
  }

  .button-bar {
    display: flex;
    justify-content: center;
    margin: 1rem 0;
  }

  .button-bar a, .back-button {
    background: #4dd0e1;
    color: #0d0d0d;
    padding: 0.6rem 1.2rem;
    text-decoration: none;
    border-radius: 8px;
    font-weight: bold;
    border: none;
    cursor: pointer;
    box-shadow: 0 0 10px #4dd0e1;
  }

  .back-button:hover {
    background-color: #35c0d6;
  }

  .site-footer {
    text-align: center;
    margin-top: 3rem;
    margin-bottom: 120px;
    font-size: 0.85rem;
    color: #aaa;
  }

  .site-footer a {
    color: #00BFFF;
    text-decoration: none;
  }

  .site-footer a:hover {
    text-decoration: underline;
  }

.favorite-save-box {
  position: absolute;
  top: 20px;
  right: 20px;
  display: flex;
  flex-direction: column;
  align-items: center;
  z-index: 1010;
}

.favorite-star {
  background: #4dd0e1;
  color: #FFD700;
  font-size: 2.5rem;
  border: 2px solid #222;
  border-radius: 10px;
  width: 56px;
  height: 56px;
  cursor: pointer;
  box-shadow: 0 0 8px #4dd0e1;
  transition: background 0.18s, color 0.18s;
  display: flex;
  align-items: center;
  justify-content: center;
  outline: none;
  margin-bottom: 8px;
}
.favorite-star:active,
.favorite-star:focus {
  background: #1976d2;
  color: #ffea00;
}

.favorite-label {
  color: #4dd0e1;
  font-size: 1.03rem;
  font-weight: bold;
  background: #181818;
  border-radius: 6px;
  padding: 2px 10px;
  text-align: center;
  letter-spacing: 0.01em;
  margin-top: 0;
  box-shadow: 0 1px 6px #2224;
}
.fav-dropdown {
  display: none;
  position: absolute;
  top: 65px;
  right: 0;
  z-index: 99999;
  background: #222;
  border: 2px solid #4dd0e1;
  border-radius: 10px;
  padding: 10px 20px;
  text-align: center;
  box-shadow: 0 2px 12px #2224;
}
.fav-dropdown button {
  font-size: 1.1rem;
  padding: 6px 16px;
  background: #4dd0e1;
  color: #222;
  border: none;
  border-radius: 7px;
  cursor: pointer;
  font-weight: bold;
}
.fav-dropdown button:hover, .fav-dropdown button:focus {
  background: #fff;
  color: #0071ce;
  outline: none;
}
</style>
</head>
<body>
  
  <header>
    <img src="MetroFeedPortlandLogo.png" alt="MetroFeed Portland">
  </header>

<!-- Favorite Route Button (Top Right) with Dropdown -->
<div class="favorite-save-box">
  <button class="favorite-star" id="fav-star" aria-label="Save route to favorites" onclick="showFavDropdown(event)">☆</button>
  <div class="favorite-label">Save to Favorites</div>
  <div class="fav-dropdown" id="fav-dropdown">
    <button id="fav-dropdown-btn">Add to Favorites</button>
  </div>
</div>

  <!-- Beta Disclaimers -->
  <div class="disclaimer" style="margin: 1rem auto 0.5rem; max-width: 600px; font-size: 0.8rem; color: #bbb; text-align: center; padding: 0.5rem 1rem; background-color: #111; border: 1px dashed #444; border-radius: 6px;">
    ⚠️ This is a Beta program, work in progress. Please REPORT bugs and pretend to be impressed.
  </div>
  <div class="disclaimer" style="margin: 0 auto 1rem; max-width: 600px; font-size: 0.75rem; color: #888; text-align: center; padding: 0.25rem 1rem;">
    This tool is not affiliated with or endorsed by TriMet. For official schedules and service alerts, visit <a href="https://trimet.org" style="color:#4dd0e1;">trimet.org</a>.
  </div>

  <!-- Back button -->
  <button class="back-button-fixed" onclick="history.back()" aria-label="Go back">
    <svg viewBox="0 0 24 24">
      <path d="M15.5 19c-.28 0-.53-.11-.71-.29l-6.5-6.5a1.003 1.003 0 010-1.42l6.5-6.5a1.003 1.003 0 011.42 1.42L10.41 12l6.3 6.29a1.003 1.003 0 01-1.21 1.54z"/>
    </svg>
  </button>

  <h1 id="route-title">Route 77 - To Montgomery Park</h1>
  <span id="route-type" style="display:none;"></span>

  <div class="content-box">
    <div id="map"></div>
    <div style="text-align:right; font-size: 0.7rem; color: #777; margin-top: 0.5rem;">
      Data courtesy of TriMet.
    </div>
  </div>

  <script>
    if (document.referrer === "" && performance.navigation.type === 0) {
      window.location.href = "/index.html";
    }

    const apiKey = "2C4447D4A42083BCD84DE3B8E";
    const routeNumber = 77;
    const direction = parseInt(1);

    const map = L.map('map', {
      center: [45.6, -122.7],
      zoom: 12,
      minZoom: 12,
      maxZoom: 18,
      maxBounds: [[45.3, -123.1], [45.9, -122.3]],
      maxBoundsViscosity: 1.0
    });
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);

    const shapeOutbound = [
  [45.544511, -122.393388],
  [45.544503, -122.393178],
  [45.544477, -122.392588],
  [45.544462, -122.392243],
  [45.544441, -122.39183],
  [45.544411, -122.39127],
  [45.544373, -122.391187],
  [45.544363, -122.391114],
  [45.544346, -122.391041],
  [45.54432, -122.390948],
  [45.544271, -122.390855],
  [45.54422, -122.3908],
  [45.544173, -122.390758],
  [45.544125, -122.390721],
  [45.544037, -122.390679],
  [45.54395, -122.390664],
  [45.543813, -122.390545],
  [45.543543, -122.390545],
  [45.543257, -122.390542],
  [45.54321, -122.39054],
  [45.543138, -122.390537],
  [45.541638, -122.390578],
  [45.541061, -122.390584],
  [45.540874, -122.390587],
  [45.540761, -122.390588],
  [45.540761, -122.390788],
  [45.540764, -122.391252],
  [45.540764, -122.3913],
  [45.540766, -122.391919],
  [45.540761, -122.392003],
  [45.540748, -122.392055],
  [45.540731, -122.392103],
  [45.5407, -122.392165],
  [45.540621, -122.392246],
  [45.540492, -122.392379],
  [45.540332, -122.392557],
  [45.540194, -122.392732],
  [45.540083, -122.39289],
  [45.539988, -122.39304],
  [45.539884, -122.393219],
  [45.539836, -122.393304],
  [45.539674, -122.393601],
  [45.539594, -122.393761],
  [45.539513, -122.393931],
  [45.539448, -122.394108],
  [45.539389, -122.3943],
  [45.539342, -122.394485],
  [45.539301, -122.394653],
  [45.539252, -122.394918],
  [45.539218, -122.395148],
  [45.539194, -122.395396],
  [45.539175, -122.395651],
  [45.539162, -122.395983],
  [45.539142, -122.396432],
  [45.539129, -122.396734],
  [45.539123, -122.396883],
  [45.539119, -122.396969],
  [45.539098, -122.397477],
  [45.539077, -122.397984],
  [45.539057, -122.398443],
  [45.539019, -122.399308],
  [45.538987, -122.400129],
  [45.538984, -122.400204],
  [45.538973, -122.400446],
  [45.538947, -122.401073],
  [45.538941, -122.401198],
  [45.538838, -122.403607],
  [45.538785, -122.404751],
  [45.538768, -122.405115],
  [45.538749, -122.405522],
  [45.538729, -122.405856],
  [45.538703, -122.406243],
  [45.538691, -122.406395],
  [45.538682, -122.406505],
  [45.538656, -122.406791],
  [45.538623, -122.407095],
  [45.538578, -122.407494],
  [45.538516, -122.40797],
  [45.538406, -122.408775],
  [45.538312, -122.409483],
  [45.538025, -122.411632],
  [45.53801, -122.411734],
  [45.537922, -122.412387],
  [45.537806, -122.413255],
  [45.53757, -122.415018],
  [45.537466, -122.415784],
  [45.537405, -122.416229],
  [45.537354, -122.416603],
  [45.537256, -122.417353],
  [45.537144, -122.418173],
  [45.537116, -122.418382],
  [45.537088, -122.418587],
  [45.537048, -122.418885],
  [45.537033, -122.418997],
  [45.536965, -122.419508],
  [45.53687, -122.420195],
  [45.536808, -122.420729],
  [45.536774, -122.421074],
  [45.536737, -122.421359],
  [45.536663, -122.421904],
  [45.536605, -122.422332],
  [45.536583, -122.422494],
  [45.536503, -122.423091],
  [45.536458, -122.423422],
  [45.536363, -122.424125],
  [45.53633, -122.424375],
  [45.536282, -122.424733],
  [45.536093, -122.426139],
  [45.536091, -122.426153],
  [45.535973, -122.427028],
  [45.535872, -122.427786],
  [45.535853, -122.427914],
  [45.535763, -122.428581],
  [45.535695, -122.429081],
  [45.535633, -122.429541],
  [45.535542, -122.430216],
  [45.535402, -122.431255],
  [45.535305, -122.431913],
  [45.535243, -122.43233],
  [45.535175, -122.432787],
  [45.53508, -122.4335],
  [45.535057, -122.433648],
  [45.535039, -122.433769],
  [45.53502, -122.433889],
  [45.534995, -122.434007],
  [45.534963, -122.434134],
  [45.534912, -122.4343],
  [45.534861, -122.434443],
  [45.534804, -122.434587],
  [45.534662, -122.43492],
  [45.534588, -122.435092],
  [45.534523, -122.435271],
  [45.534472, -122.435445],
  [45.534436, -122.4356],
  [45.534405, -122.435777],
  [45.53438, -122.435968],
  [45.534369, -122.436191],
  [45.534365, -122.437162],
  [45.534361, -122.437423],
  [45.534348, -122.437708],
  [45.534329, -122.43801],
  [45.534301, -122.438289],
  [45.534111, -122.439901],
  [45.534098, -122.44001],
  [45.534087, -122.440102],
  [45.534057, -122.440344],
  [45.534001, -122.440801],
  [45.533887, -122.441785],
  [45.533846, -122.442185],
  [45.533809, -122.442556],
  [45.533786, -122.442971],
  [45.53372, -122.444107],
  [45.533679, -122.444842],
  [45.533617, -122.445969],
  [45.533609, -122.446125],
  [45.5336, -122.446317],
  [45.533593, -122.446453],
  [45.533586, -122.44661],
  [45.533545, -122.447387],
  [45.533474, -122.44871],
  [45.533453, -122.449102],
  [45.533432, -122.44951],
  [45.533415, -122.449856],
  [45.533404, -122.450108],
  [45.533398, -122.450381],
  [45.533397, -122.450613],
  [45.533395, -122.450983],
  [45.533398, -122.451797],
  [45.5334, -122.45237],
  [45.533402, -122.452988],
  [45.533404, -122.45368],
  [45.533408, -122.453928],
  [45.533413, -122.454221],
  [45.533422, -122.454503],
  [45.53345, -122.455037],
  [45.53348, -122.455564],
  [45.533523, -122.4564],
  [45.533527, -122.456528],
  [45.533532, -122.456678],
  [45.533549, -122.456962],
  [45.533551, -122.457003],
  [45.533571, -122.457261],
  [45.533576, -122.457327],
  [45.533608, -122.457777],
  [45.533625, -122.458089],
  [45.53363, -122.458251],
  [45.533631, -122.458442],
  [45.533631, -122.458473],
  [45.533631, -122.458983],
  [45.533631, -122.459013],
  [45.533631, -122.459219],
  [45.533635, -122.459924],
  [45.533636, -122.460391],
  [45.533638, -122.460946],
  [45.533638, -122.461193],
  [45.53364, -122.461695],
  [45.533641, -122.461727],
  [45.533643, -122.462218],
  [45.53365, -122.464504],
  [45.533653, -122.465501],
  [45.533658, -122.466199],
  [45.533659, -122.46632],
  [45.533659, -122.466679],
  [45.533658, -122.467279],
  [45.533659, -122.468336],
  [45.533659, -122.469163],
  [45.533663, -122.47132],
  [45.533664, -122.471875],
  [45.533665, -122.47209],
  [45.533666, -122.472869],
  [45.533667, -122.47356],
  [45.533671, -122.473754],
  [45.533678, -122.473889],
  [45.533698, -122.474032],
  [45.533719, -122.474166],
  [45.533749, -122.474302],
  [45.533776, -122.474419],
  [45.533817, -122.474554],
  [45.533857, -122.474659],
  [45.533935, -122.474845],
  [45.533958, -122.474899],
  [45.534069, -122.475089],
  [45.534319, -122.475521],
  [45.534379, -122.475635],
  [45.534467, -122.475682],
  [45.534508, -122.475769],
  [45.534551, -122.475873],
  [45.534599, -122.476014],
  [45.534633, -122.476137],
  [45.534641, -122.476163],
  [45.534677, -122.476315],
  [45.534716, -122.476513],
  [45.534738, -122.47676],
  [45.534745, -122.476933],
  [45.534743, -122.477095],
  [45.534699, -122.477272],
  [45.534698, -122.477688],
  [45.534698, -122.478188],
  [45.534696, -122.479308],
  [45.534697, -122.480383],
  [45.534696, -122.480695],
  [45.534696, -122.480964],
  [45.534695, -122.481752],
  [45.534695, -122.481997],
  [45.534694, -122.482589],
  [45.534694, -122.483128],
  [45.534694, -122.484139],
  [45.534694, -122.484226],
  [45.534693, -122.485009],
  [45.534693, -122.485386],
  [45.534693, -122.485747],
  [45.534692, -122.48614],
  [45.534692, -122.48627],
  [45.534692, -122.486881],
  [45.534692, -122.487301],
  [45.534692, -122.487322],
  [45.534686, -122.487713],
  [45.534677, -122.487909],
  [45.53466, -122.48811],
  [45.534637, -122.488326],
  [45.534606, -122.488533],
  [45.534576, -122.488728],
  [45.534537, -122.488938],
  [45.5345, -122.489133],
  [45.534425, -122.489523],
  [45.53438, -122.489793],
  [45.534345, -122.490033],
  [45.534324, -122.490241],
  [45.534309, -122.490425],
  [45.534297, -122.490641],
  [45.53429, -122.49086],
  [45.534294, -122.491359],
  [45.534295, -122.49146],
  [45.534303, -122.492254],
  [45.534307, -122.492611],
  [45.534317, -122.493553],
  [45.534324, -122.494129],
  [45.534333, -122.494931],
  [45.534331, -122.49509],
  [45.534322, -122.495262],
  [45.534309, -122.495429],
  [45.534308, -122.495435],
  [45.534296, -122.495564],
  [45.534284, -122.495661],
  [45.534258, -122.495833],
  [45.534233, -122.496005],
  [45.534206, -122.496133],
  [45.534144, -122.4964],
  [45.534082, -122.496632],
  [45.534025, -122.496822],
  [45.53395, -122.497056],
  [45.533851, -122.49737],
  [45.533823, -122.497473],
  [45.533781, -122.497631],
  [45.533755, -122.497745],
  [45.533725, -122.497881],
  [45.533703, -122.498003],
  [45.533681, -122.498192],
  [45.533674, -122.498293],
  [45.533667, -122.498392],
  [45.53366, -122.498631],
  [45.53366, -122.498876],
  [45.533659, -122.499016],
  [45.53366, -122.499652],
  [45.533662, -122.500447],
  [45.533663, -122.500941],
  [45.533663, -122.501059],
  [45.533663, -122.502463],
  [45.533662, -122.502708],
  [45.533661, -122.503537],
  [45.533662, -122.503678],
  [45.533662, -122.503826],
  [45.533662, -122.504087],
  [45.533663, -122.504737],
  [45.533664, -122.505037],
  [45.533664, -122.505525],
  [45.533664, -122.50601],
  [45.533663, -122.506501],
  [45.533673, -122.508386],
  [45.533676, -122.508841],
  [45.533676, -122.509021],
  [45.533675, -122.509201],
  [45.53367, -122.509491],
  [45.533667, -122.509665],
  [45.533658, -122.510274],
  [45.533656, -122.510526],
  [45.533658, -122.511253],
  [45.533658, -122.511659],
  [45.533664, -122.512411],
  [45.533668, -122.512967],
  [45.533673, -122.514277],
  [45.533679, -122.515058],
  [45.533682, -122.515586],
  [45.533683, -122.5159],
  [45.533684, -122.516921],
  [45.533677, -122.517327],
  [45.533664, -122.518126],
  [45.533638, -122.519318],
  [45.533633, -122.519592],
  [45.533614, -122.520566],
  [45.533598, -122.521313],
  [45.533585, -122.52205],
  [45.533578, -122.522467],
  [45.533575, -122.522628],
  [45.533566, -122.523266],
  [45.533563, -122.524155],
  [45.533562, -122.524514],
  [45.533547, -122.525351],
  [45.533537, -122.525791],
  [45.533533, -122.52595],
  [45.53352, -122.526602],
  [45.533513, -122.526981],
  [45.53351, -122.527131],
  [45.533509, -122.527219],
  [45.533509, -122.52732],
  [45.533513, -122.527887],
  [45.533517, -122.528565],
  [45.533522, -122.529336],
  [45.533533, -122.531164],
  [45.533535, -122.531524],
  [45.533536, -122.531668],
  [45.533538, -122.532138],
  [45.53354, -122.532439],
  [45.533544, -122.533192],
  [45.533548, -122.533795],
  [45.53355, -122.534338],
  [45.533552, -122.534692],
  [45.533554, -122.535158],
  [45.533558, -122.535907],
  [45.533563, -122.536607],
  [45.533566, -122.536898],
  [45.533567, -122.537042],
  [45.53357, -122.537485],
  [45.533568, -122.537654],
  [45.533566, -122.537982],
  [45.533563, -122.538263],
  [45.533563, -122.538295],
  [45.533562, -122.538451],
  [45.53356, -122.538594],
  [45.533558, -122.538819],
  [45.533555, -122.539138],
  [45.533554, -122.539341],
  [45.533546, -122.540225],
  [45.533541, -122.540791],
  [45.533534, -122.541426],
  [45.533529, -122.542059],
  [45.533525, -122.542652],
  [45.533517, -122.543307],
  [45.53351, -122.544119],
  [45.533506, -122.544564],
  [45.533547, -122.544672],
  [45.533545, -122.544851],
  [45.533542, -122.545043],
  [45.53354, -122.545252],
  [45.533536, -122.545517],
  [45.533539, -122.545685],
  [45.533547, -122.545865],
  [45.53356, -122.545968],
  [45.533588, -122.54609],
  [45.533609, -122.546167],
  [45.533632, -122.546234],
  [45.53367, -122.546341],
  [45.533711, -122.546443],
  [45.533762, -122.546551],
  [45.533926, -122.54687],
  [45.533968, -122.546969],
  [45.53401, -122.547082],
  [45.534045, -122.547191],
  [45.53408, -122.547326],
  [45.534109, -122.547477],
  [45.534121, -122.547579],
  [45.534133, -122.547677],
  [45.534141, -122.547857],
  [45.534144, -122.548232],
  [45.534145, -122.548421],
  [45.534146, -122.548546],
  [45.53415, -122.54907],
  [45.534151, -122.549335],
  [45.534151, -122.549465],
  [45.534155, -122.550381],
  [45.534156, -122.550715],
  [45.534157, -122.550916],
  [45.534159, -122.551345],
  [45.53416, -122.551605],
  [45.534163, -122.5524],
  [45.534164, -122.55258],
  [45.534164, -122.552778],
  [45.534164, -122.552815],
  [45.534165, -122.553032],
  [45.534166, -122.553287],
  [45.534167, -122.553535],
  [45.534169, -122.554047],
  [45.53417, -122.554206],
  [45.53417, -122.554301],
  [45.534172, -122.55465],
  [45.534175, -122.555476],
  [45.534176, -122.55572],
  [45.534179, -122.55653],
  [45.53418, -122.556788],
  [45.534181, -122.556993],
  [45.534181, -122.55713],
  [45.534182, -122.557282],
  [45.534182, -122.557417],
  [45.534179, -122.557508],
  [45.534174, -122.55763],
  [45.534171, -122.557709],
  [45.534153, -122.557886],
  [45.534131, -122.55806],
  [45.534106, -122.558192],
  [45.534025, -122.558479],
  [45.533966, -122.55865],
  [45.533928, -122.558763],
  [45.533724, -122.559339],
  [45.533671, -122.559505],
  [45.533633, -122.559672],
  [45.533609, -122.559811],
  [45.533597, -122.559927],
  [45.53359, -122.560037],
  [45.533582, -122.560219],
  [45.533579, -122.560831],
  [45.533584, -122.560932],
  [45.533593, -122.561056],
  [45.533598, -122.561267],
  [45.5336, -122.561366],
  [45.53361, -122.561517],
  [45.533626, -122.561653],
  [45.53365, -122.561799],
  [45.533668, -122.561901],
  [45.533705, -122.562064],
  [45.533827, -122.562593],
  [45.534009, -122.563302],
  [45.534051, -122.563488],
  [45.534087, -122.56369],
  [45.534114, -122.563878],
  [45.534133, -122.56408],
  [45.534144, -122.564272],
  [45.53415, -122.564467],
  [45.534151, -122.564654],
  [45.534147, -122.564829],
  [45.534138, -122.564992],
  [45.534121, -122.565156],
  [45.534101, -122.565318],
  [45.534074, -122.565485],
  [45.534041, -122.565652],
  [45.534, -122.565835],
  [45.533952, -122.566006],
  [45.533889, -122.566203],
  [45.533807, -122.566434],
  [45.533747, -122.56662],
  [45.533695, -122.5668],
  [45.533653, -122.566951],
  [45.533614, -122.567134],
  [45.533579, -122.56732],
  [45.533532, -122.567639],
  [45.533517, -122.567773],
  [45.533503, -122.567962],
  [45.533495, -122.568125],
  [45.533494, -122.568351],
  [45.533469, -122.56857],
  [45.533475, -122.569169],
  [45.533475, -122.569202],
  [45.533481, -122.569537],
  [45.533485, -122.569779],
  [45.533497, -122.570855],
  [45.533516, -122.571747],
  [45.533518, -122.572042],
  [45.533521, -122.57232],
  [45.533523, -122.572499],
  [45.533525, -122.57258],
  [45.533562, -122.574419],
  [45.533565, -122.574547],
  [45.533569, -122.575213],
  [45.533552, -122.575325],
  [45.533555, -122.575497],
  [45.533566, -122.575727],
  [45.533572, -122.575812],
  [45.533581, -122.575878],
  [45.533598, -122.575952],
  [45.533619, -122.576021],
  [45.533666, -122.57615],
  [45.533691, -122.57621],
  [45.533741, -122.576316],
  [45.533668, -122.576376],
  [45.533638, -122.576403],
  [45.533613, -122.576438],
  [45.533595, -122.576471],
  [45.533576, -122.576517],
  [45.533564, -122.576564],
  [45.533553, -122.576617],
  [45.533552, -122.576687],
  [45.533561, -122.577268],
  [45.533563, -122.577328],
  [45.533566, -122.577393],
  [45.533577, -122.577519],
  [45.533592, -122.577599],
  [45.533607, -122.57766],
  [45.533612, -122.577683],
  [45.53365, -122.577803],
  [45.533717, -122.577994],
  [45.533809, -122.578232],
  [45.533927, -122.578538],
  [45.533949, -122.578609],
  [45.533956, -122.578654],
  [45.533963, -122.578736],
  [45.533964, -122.578775],
  [45.533964, -122.578776],
  [45.533966, -122.578853],
  [45.533972, -122.579039],
  [45.533821, -122.579101],
  [45.533219, -122.579098],
  [45.533027, -122.579098],
  [45.532963, -122.579036],
  [45.532846, -122.579036],
  [45.532764, -122.579036],
  [45.532501, -122.579036],
  [45.532414, -122.579034],
  [45.532413, -122.579174],
  [45.532412, -122.579597],
  [45.532414, -122.579813],
  [45.532417, -122.57986],
  [45.532425, -122.579898],
  [45.532445, -122.579952],
  [45.532468, -122.579995],
  [45.532492, -122.580007],
  [45.532516, -122.580013],
  [45.532553, -122.580017],
  [45.532741, -122.580017],
  [45.532832, -122.580016],
  [45.532876, -122.580016],
  [45.53321, -122.580008],
  [45.533293, -122.580013],
  [45.533341, -122.580025],
  [45.53338, -122.58004],
  [45.533408, -122.580054],
  [45.533445, -122.58008],
  [45.533493, -122.580129],
  [45.533541, -122.580192],
  [45.53356, -122.580234],
  [45.533572, -122.580269],
  [45.533585, -122.580338],
  [45.533602, -122.580405],
  [45.533602, -122.580585],
  [45.533603, -122.580609],
  [45.53361, -122.580631],
  [45.533622, -122.580664],
  [45.533674, -122.580775],
  [45.533648, -122.580843],
  [45.533635, -122.580885],
  [45.533625, -122.58093],
  [45.533617, -122.58098],
  [45.533612, -122.581028],
  [45.533608, -122.581103],
  [45.533607, -122.581159],
  [45.533607, -122.581708],
  [45.533607, -122.581901],
  [45.533606, -122.58196],
  [45.533606, -122.582035],
  [45.533604, -122.582941],
  [45.533604, -122.583165],
  [45.533602, -122.583912],
  [45.533601, -122.584182],
  [45.5336, -122.584829],
  [45.5336, -122.585039],
  [45.533599, -122.585194],
  [45.533598, -122.585802],
  [45.533598, -122.586207],
  [45.533596, -122.586785],
  [45.533596, -122.587081],
  [45.533595, -122.58722],
  [45.533594, -122.587751],
  [45.533593, -122.588239],
  [45.533594, -122.588734],
  [45.533596, -122.58938],
  [45.533597, -122.589826],
  [45.5336, -122.590095],
  [45.533609, -122.590392],
  [45.533623, -122.590841],
  [45.533631, -122.591526],
  [45.533634, -122.591729],
  [45.533637, -122.59236],
  [45.533637, -122.592574],
  [45.533643, -122.593877],
  [45.533645, -122.594334],
  [45.533647, -122.594756],
  [45.533658, -122.595704],
  [45.533661, -122.595965],
  [45.533669, -122.596606],
  [45.533671, -122.596749],
  [45.533682, -122.59768],
  [45.53369, -122.598621],
  [45.533693, -122.598931],
  [45.533697, -122.599558],
  [45.533701, -122.60022],
  [45.533704, -122.600604],
  [45.533706, -122.601197],
  [45.533707, -122.601621],
  [45.533706, -122.601936],
  [45.533706, -122.602022],
  [45.533707, -122.602163],
  [45.533707, -122.602281],
  [45.533707, -122.602656],
  [45.533708, -122.603123],
  [45.533708, -122.603182],
  [45.533709, -122.603702],
  [45.53371, -122.60406],
  [45.533712, -122.604539],
  [45.533713, -122.604648],
  [45.533714, -122.604754],
  [45.533713, -122.604994],
  [45.533713, -122.605079],
  [45.533714, -122.605333],
  [45.533714, -122.605867],
  [45.533717, -122.606878],
  [45.533719, -122.607593],
  [45.53372, -122.607893],
  [45.533722, -122.60867],
  [45.533722, -122.608699],
  [45.533723, -122.608855],
  [45.533726, -122.609917],
  [45.533727, -122.610117],
  [45.533731, -122.610935],
  [45.533733, -122.6113],
  [45.533738, -122.611952],
  [45.533743, -122.612698],
  [45.533744, -122.612875],
  [45.533745, -122.612967],
  [45.533752, -122.613977],
  [45.533758, -122.614725],
  [45.53376, -122.614993],
  [45.533831, -122.615001],
  [45.534127, -122.615],
  [45.534167, -122.615],
  [45.535124, -122.614996],
  [45.535126, -122.615975],
  [45.535124, -122.616949],
  [45.535125, -122.617751],
  [45.535125, -122.617916],
  [45.535125, -122.618173],
  [45.535125, -122.618919],
  [45.535125, -122.619527],
  [45.535125, -122.620006],
  [45.535124, -122.62031],
  [45.535068, -122.620311],
  [45.534877, -122.62031],
  [45.534761, -122.620309],
  [45.534551, -122.620308],
  [45.534497, -122.620309],
  [45.534389, -122.620309],
  [45.534259, -122.620309],
  [45.53403, -122.620309],
  [45.533876, -122.620309],
  [45.533799, -122.620308],
  [45.533798, -122.62045],
  [45.533796, -122.620943],
  [45.533795, -122.621029],
  [45.533795, -122.621142],
  [45.533795, -122.621292],
  [45.533793, -122.621732],
  [45.533798, -122.621887],
  [45.5338, -122.621934],
  [45.533806, -122.622061],
  [45.533821, -122.622306],
  [45.533833, -122.622454],
  [45.533836, -122.622487],
  [45.533844, -122.622754],
  [45.533809, -122.62295],
  [45.533886, -122.622901],
  [45.533931, -122.622885],
  [45.534309, -122.622884],
  [45.534367, -122.622884],
  [45.534677, -122.622883],
  [45.534768, -122.622883],
  [45.534866, -122.622899],
  [45.534982, -122.622916],
  [45.535094, -122.622988],
  [45.535112, -122.622993],
  [45.535184, -122.622995],
  [45.535174, -122.623096],
  [45.535173, -122.623367],
  [45.535172, -122.623447],
  [45.535169, -122.623996],
  [45.535164, -122.624523],
  [45.535162, -122.624682],
  [45.535162, -122.624755],
  [45.535161, -122.624786],
  [45.53516, -122.624928],
  [45.535161, -122.625019],
  [45.535166, -122.625121],
  [45.535167, -122.625552],
  [45.535167, -122.625778],
  [45.535168, -122.626026],
  [45.535153, -122.628273],
  [45.535152, -122.628403],
  [45.535153, -122.630249],
  [45.535154, -122.630374],
  [45.535156, -122.630562],
  [45.535158, -122.630682],
  [45.535159, -122.630849],
  [45.53516, -122.631152],
  [45.53516, -122.631264],
  [45.53516, -122.631423],
  [45.53516, -122.632345],
  [45.535161, -122.633252],
  [45.535159, -122.633732],
  [45.535159, -122.634123],
  [45.53521, -122.634549],
  [45.535215, -122.634785],
  [45.535217, -122.634997],
  [45.535209, -122.635194],
  [45.535204, -122.635327],
  [45.535164, -122.635527],
  [45.535164, -122.636595],
  [45.535164, -122.636716],
  [45.535164, -122.636809],
  [45.535165, -122.637606],
  [45.535165, -122.637845],
  [45.535164, -122.638152],
  [45.535167, -122.639124],
  [45.535168, -122.639228],
  [45.535168, -122.639568],
  [45.535168, -122.640027],
  [45.535168, -122.640119],
  [45.535168, -122.640332],
  [45.535168, -122.640446],
  [45.535167, -122.640537],
  [45.535164, -122.640628],
  [45.53516, -122.640714],
  [45.535153, -122.640813],
  [45.535137, -122.641024],
  [45.53513, -122.641113],
  [45.535119, -122.6412],
  [45.535105, -122.641306],
  [45.535095, -122.641379],
  [45.535061, -122.641583],
  [45.535058, -122.641601],
  [45.535034, -122.641746],
  [45.535022, -122.641837],
  [45.535012, -122.641964],
  [45.53501, -122.642104],
  [45.535008, -122.642318],
  [45.535006, -122.642999],
  [45.535007, -122.643396],
  [45.535008, -122.643611],
  [45.535009, -122.643958],
  [45.535011, -122.644712],
  [45.535011, -122.644834],
  [45.535013, -122.645091],
  [45.535013, -122.645229],
  [45.535013, -122.645277],
  [45.535013, -122.645338],
  [45.535016, -122.645966],
  [45.535019, -122.646496],
  [45.53502, -122.646667],
  [45.535026, -122.648449],
  [45.535028, -122.648999],
  [45.535029, -122.649368],
  [45.535029, -122.649472],
  [45.535029, -122.649655],
  [45.53503, -122.649859],
  [45.535031, -122.650389],
  [45.535031, -122.650495],
  [45.535031, -122.650589],
  [45.535034, -122.651021],
  [45.535034, -122.651101],
  [45.535036, -122.651505],
  [45.535038, -122.652098],
  [45.535039, -122.65253],
  [45.535042, -122.653293],
  [45.535042, -122.653407],
  [45.535042, -122.65346],
  [45.535042, -122.653537],
  [45.535041, -122.65361],
  [45.535045, -122.65455],
  [45.535045, -122.654628],
  [45.535047, -122.655564],
  [45.53505, -122.65604],
  [45.535053, -122.656473],
  [45.535052, -122.656583],
  [45.534966, -122.656582],
  [45.534446, -122.65658],
  [45.534351, -122.65658],
  [45.534265, -122.65658],
  [45.533959, -122.656582],
  [45.533722, -122.656584],
  [45.533629, -122.656584],
  [45.532557, -122.656591],
  [45.531597, -122.656597],
  [45.531493, -122.656597],
  [45.531495, -122.656729],
  [45.531495, -122.657075],
  [45.531497, -122.657721],
  [45.5315, -122.658493],
  [45.531501, -122.658609],
  [45.531501, -122.658652],
  [45.5315, -122.658734],
  [45.531504, -122.659645],
  [45.531503, -122.659709],
  [45.531507, -122.660483],
  [45.531507, -122.660597],
  [45.531507, -122.660659],
  [45.531509, -122.661551],
  [45.531511, -122.661673],
  [45.531512, -122.661812],
  [45.531509, -122.661879],
  [45.531502, -122.661972],
  [45.531485, -122.662062],
  [45.531483, -122.662072],
  [45.53147, -122.662125],
  [45.531445, -122.662198],
  [45.531416, -122.662269],
  [45.531343, -122.662413],
  [45.53129, -122.662513],
  [45.531106, -122.662873],
  [45.531049, -122.662985],
  [45.530966, -122.66314],
  [45.530916, -122.663245],
  [45.530893, -122.663299],
  [45.53087, -122.663358],
  [45.530844, -122.663438],
  [45.53082, -122.66354],
  [45.530807, -122.663625],
  [45.530794, -122.66372],
  [45.530785, -122.663828],
  [45.530784, -122.663947],
  [45.530789, -122.664629],
  [45.530791, -122.664722],
  [45.530797, -122.665528],
  [45.530796, -122.665669],
  [45.530794, -122.665782],
  [45.530704, -122.665831],
  [45.530627, -122.66584],
  [45.530504, -122.665878],
  [45.530408, -122.665911],
  [45.530305, -122.665948],
  [45.530258, -122.665977],
  [45.530221, -122.66602],
  [45.530185, -122.666084],
  [45.530056, -122.666313],
  [45.529979, -122.666427],
  [45.529978, -122.666429],
  [45.52988, -122.666547],
  [45.529824, -122.666612],
  [45.529802, -122.666637],
  [45.529769, -122.666672],
  [45.529651, -122.666796],
  [45.529605, -122.666842],
  [45.529561, -122.666885],
  [45.529524, -122.666918],
  [45.529487, -122.666937],
  [45.529445, -122.666948],
  [45.529383, -122.66696],
  [45.529304, -122.666981],
  [45.529093, -122.66705],
  [45.528988, -122.667116],
  [45.52887, -122.667158],
  [45.528774, -122.667212],
  [45.528694, -122.667259],
  [45.528584, -122.667346],
  [45.528514, -122.667415],
  [45.528435, -122.667506],
  [45.528354, -122.667624],
  [45.528269, -122.667779],
  [45.527772, -122.668873],
  [45.527588, -122.669277],
  [45.52745, -122.669581],
  [45.527077, -122.670373],
  [45.526965, -122.670603],
  [45.526904, -122.670724],
  [45.526867, -122.670807],
  [45.526859, -122.670828],
  [45.526845, -122.670881],
  [45.526834, -122.670939],
  [45.52683, -122.670996],
  [45.526828, -122.671101],
  [45.52688, -122.672382],
  [45.526879, -122.672503],
  [45.526872, -122.672738],
  [45.526863, -122.672975],
  [45.52686, -122.673192],
  [45.526844, -122.673331],
  [45.526834, -122.673421],
  [45.526817, -122.673573],
  [45.526809, -122.673643],
  [45.526755, -122.67409],
  [45.526714, -122.67443],
  [45.526679, -122.674539],
  [45.526674, -122.674659],
  [45.52667, -122.674755],
  [45.526661, -122.67494],
  [45.526646, -122.675469],
  [45.526645, -122.675527],
  [45.526644, -122.675569],
  [45.526638, -122.675786],
  [45.526631, -122.67655],
  [45.526631, -122.676576],
  [45.526612, -122.677555],
  [45.526604, -122.67799],
  [45.526593, -122.678596],
  [45.526581, -122.679218],
  [45.526574, -122.679587],
  [45.526567, -122.679982],
  [45.526562, -122.68023],
  [45.526546, -122.6811],
  [45.526543, -122.681227],
  [45.526543, -122.681248],
  [45.526524, -122.682254],
  [45.526524, -122.682277],
  [45.526516, -122.682669],
  [45.526508, -122.68314],
  [45.526505, -122.683272],
  [45.526486, -122.684288],
  [45.526469, -122.68516],
  [45.526467, -122.685305],
  [45.526461, -122.685397],
  [45.526445, -122.6862],
  [45.526443, -122.686317],
  [45.526443, -122.686528],
  [45.526439, -122.686803],
  [45.526435, -122.687132],
  [45.526434, -122.68716],
  [45.52643, -122.687328],
  [45.526416, -122.687959],
  [45.526408, -122.68835],
  [45.526393, -122.689263],
  [45.526394, -122.689379],
  [45.526379, -122.69017],
  [45.526375, -122.690388],
  [45.526349, -122.691853],
  [45.526339, -122.692409],
  [45.526325, -122.693179],
  [45.526316, -122.693656],
  [45.526314, -122.693784],
  [45.526312, -122.693867],
  [45.526302, -122.694428],
  [45.526953, -122.694451],
  [45.527022, -122.694454],
  [45.527083, -122.694457],
  [45.527648, -122.694476],
  [45.527728, -122.694479],
  [45.528375, -122.694504],
  [45.528444, -122.694507],
  [45.529157, -122.694535],
  [45.529389, -122.694544],
  [45.529672, -122.694555],
  [45.529698, -122.694556],
  [45.529852, -122.694562],
  [45.529867, -122.694562],
  [45.529934, -122.694565],
  [45.530022, -122.694568],
  [45.53005, -122.694569],
  [45.530113, -122.694571],
  [45.530515, -122.694583],
  [45.530579, -122.694585],
  [45.531207, -122.694608],
  [45.531295, -122.694611],
  [45.531308, -122.694612],
  [45.531357, -122.694613],
  [45.531719, -122.694628],
  [45.532007, -122.694639],
  [45.5323, -122.694651],
  [45.532718, -122.694668],
  [45.532915, -122.694675],
  [45.533427, -122.694692],
  [45.534146, -122.69472],
  [45.534877, -122.694746],
  [45.534896, -122.694746],
  [45.535572, -122.694778],
  [45.535564, -122.695165],
  [45.535552, -122.695714],
  [45.535533, -122.696798],
  [45.535503, -122.698433],
  [45.5355, -122.698729],
  [45.535498, -122.698838],
  [45.535559, -122.698847],
  [45.53575, -122.698853],
  [45.536453, -122.698877],
  [45.536755, -122.698887],
  [45.536919, -122.698895],
  [45.536916, -122.699026],
  [45.536913, -122.699215],
  [45.536907, -122.699597],
  [45.536904, -122.699814],
  [45.53689, -122.700749],
  [45.536888, -122.700869],
  [45.536867, -122.70184],
  [45.536864, -122.702046],
  [45.536855, -122.702623],
  [45.536851, -122.702901],
  [45.536849, -122.70299],
  [45.536847, -122.703213],
  [45.536843, -122.703763],
  [45.53683, -122.704496],
  [45.536826, -122.704724],
  [45.536822, -122.704891],
  [45.537095, -122.704901],
  [45.537524, -122.704917],
  [45.537505, -122.706559]
];

const stopNames = {
  "629": "NE Broadway &amp; 12th",
  "631": "NE Broadway &amp; 16th",
  "634": "NE Broadway &amp; 21st",
  "635": "NE Broadway &amp; 24th",
  "637": "NE Broadway &amp; 26th",
  "639": "NE Broadway &amp; 28th",
  "644": "NE Broadway &amp; 33rd",
  "647": "NE Broadway &amp; 35th",
  "649": "NE Broadway &amp; 37th",
  "650": "NE Broadway &amp; 44th",
  "1997": "NW Glisan &amp; Broadway",
  "2011": "NW Glisan &amp; 10th",
  "2030": "NW Glisan &amp; 12th",
  "2046": "NW Glisan &amp; 14th",
  "2062": "NW Glisan &amp; 16th",
  "2086": "NW Glisan &amp; 19th",
  "2099": "NW Glisan &amp; 21st",
  "2326": "NE Halsey &amp; 196th",
  "2331": "23300 Block NE Halsey",
  "2333": "23900 Block NE Halsey",
  "2340": "2100 Block SW Halsey (Edgefield Manor)",
  "2342": "NE Halsey &amp; Fairview/223rd",
  "2343": "NE Halsey &amp; 100th",
  "2346": "SW Halsey &amp; Halsey Loop",
  "2349": "NE Halsey &amp; 176th",
  "2361": "NE Halsey &amp; 114th",
  "2367": "NE Halsey &amp; 122nd",
  "2371": "NE Halsey &amp; 128th",
  "2375": "NE Halsey &amp; 132nd",
  "2379": "NE Halsey &amp; 136th Pl",
  "2382": "NE Halsey &amp; 143rd",
  "2386": "NE Halsey &amp; 148th",
  "2390": "NE Halsey &amp; 155th",
  "2395": "NE Halsey &amp; 162nd",
  "2398": "NE Halsey &amp; 169th",
  "2399": "NE Halsey &amp; 172nd",
  "2406": "NE Halsey &amp; 186th",
  "2407": "NE Halsey &amp; 192nd",
  "2411": "NE Halsey &amp; 201st",
  "2414": "NE Halsey &amp; Fairview Parkway",
  "2419": "NE Halsey &amp; 230th Ct",
  "2420": "NE Halsey &amp; 238th",
  "2423": "NE Halsey &amp; 244th",
  "2425": "NE Halsey &amp; 49th",
  "2428": "NE Halsey &amp; 53rd",
  "2432": "NE Halsey &amp; 57th",
  "2437": "NE Halsey &amp; 7th St",
  "2438": "NE Halsey &amp; 60th",
  "2443": "NE Halsey &amp; 66th",
  "2445": "NE Halsey &amp; 69th",
  "2451": "NE Halsey &amp; 74th",
  "2453": "NE Halsey &amp; 76th",
  "2455": "NE Halsey &amp; 79th",
  "2457": "NE Halsey &amp; 86th",
  "2459": "NE Halsey &amp; 90th",
  "2592": "Rose Quarter Transit Center",
  "4043": "NE Multnomah &amp; Grand",
  "6014": "NW Vaughn &amp; 24th",
  "6223": "NE Weidler &amp; 106th",
  "6225": "NE Weidler &amp; 111th",
  "7113": "NW 21st &amp; Irving",
  "7122": "NW 21st &amp; Lovejoy",
  "7128": "NW 21st &amp; Northrup",
  "7130": "NW 21st &amp; Pettygrove",
  "7169": "NW 23rd &amp; Thurman",
  "7484": "NE Cesar Chavez Blvd &amp; Sandy",
  "7571": "NE 47th &amp; Halsey",
  "7916": "NE 81st &amp; Clackamas",
  "8414": "NW Vaughn &amp; 26th",
  "8746": "W Columbia River Hwy &amp; NW Graham",
  "8825": "19800 Block NE Halsey",
  "8860": "NE Halsey &amp; 181st",
  "9311": "NW Glisan &amp; 3rd",
  "9471": "NW Graham/257th &amp; 257th Way",
  "9473": "NW Frontage Rd &amp; Phoenix Dr",
  "10630": "SW Halsey &amp; Edgefield Meadows",
  "10746": "NE Weidler &amp; 103rd Pl",
  "10846": "NE Jonesmore &amp; 82nd",
  "10867": "NE 9th &amp; Weidler",
  "10876": "NE Multnomah &amp; 9th",
  "11492": "NE Multnomah &amp; 3rd",
  "13026": "NE Halsey &amp; 159th Ct",
  "13505": "NE Halsey &amp; 208th Pl",
  "13809": "NE Halsey &amp; Wood Village Blvd",
  "13883": "NE Halsey &amp; 92nd",
  "14040": "NW Thurman &amp; 21st",
  "14365": "NW Wilson &amp; 27th",
  "14425": "NE Halsey &amp; 140th",
  "14640": "NE 42nd &amp; Halsey"
};

const stops = [
  { stop_id: "9473", name: "NW Frontage Rd &amp; Phoenix Dr", lat: 45.544394, lon: -122.393414, times: ["8:24 PM", "9:35 PM", "10:27 PM", "6:06 AM", "7:13 AM", "8:13 AM", "9:25 AM", "9:55 AM"] },
  { stop_id: "9471", name: "NW Graham/257th &amp; 257th Way", lat: 45.543218, lon: -122.390753, times: ["8:24 PM", "9:35 PM", "10:27 PM", "6:06 AM", "7:13 AM", "8:13 AM", "9:25 AM", "9:55 AM"] },
  { stop_id: "8746", name: "W Columbia River Hwy &amp; NW Graham", lat: 45.54084, lon: -122.391299, times: ["8:25 PM", "9:36 PM", "10:28 PM", "6:07 AM", "7:14 AM", "8:14 AM", "9:26 AM", "9:56 AM"] },
  { stop_id: "2346", name: "SW Halsey &amp; Halsey Loop", lat: 45.539209, lon: -122.396738, times: ["8:26 PM", "9:37 PM", "10:29 PM", "6:08 AM", "7:15 AM", "8:15 AM", "9:27 AM", "9:57 AM"] },
  { stop_id: "10630", name: "SW Halsey &amp; Edgefield Meadows", lat: 45.539056, lon: -122.400211, times: ["8:26 PM", "9:37 PM", "10:29 PM", "6:08 AM", "7:15 AM", "8:15 AM", "9:27 AM", "9:57 AM"] },
  { stop_id: "2340", name: "2100 Block SW Halsey (Edgefield Manor)", lat: 45.538745, lon: -122.406402, times: ["8:27 PM", "9:38 PM", "10:30 PM", "6:09 AM", "7:16 AM", "8:16 AM", "9:28 AM", "9:58 AM"] },
  { stop_id: "2423", name: "NE Halsey &amp; 244th", lat: 45.537994, lon: -122.412407, times: ["8:28 PM", "9:39 PM", "10:31 PM", "6:10 AM", "7:17 AM", "8:17 AM", "9:29 AM", "9:59 AM"] },
  { stop_id: "2333", name: "23900 Block NE Halsey", lat: 45.537572, lon: -122.415814, times: ["8:29 PM", "9:40 PM", "10:32 PM", "6:11 AM", "7:18 AM", "8:18 AM", "9:30 AM", "10:00 AM"] },
  { stop_id: "2420", name: "NE Halsey &amp; 238th", lat: 45.53713, lon: -122.418907, times: ["8:29 PM", "9:40 PM", "10:32 PM", "6:11 AM", "7:18 AM", "8:18 AM", "9:30 AM", "10:00 AM"] },
  { stop_id: "2331", name: "23300 Block NE Halsey", lat: 45.536654, lon: -122.422514, times: ["8:30 PM", "9:41 PM", "10:33 PM", "6:12 AM", "7:19 AM", "8:19 AM", "9:31 AM", "10:01 AM"] },
  { stop_id: "2419", name: "NE Halsey &amp; 230th Ct", lat: 45.53618, lon: -122.426163, times: ["8:30 PM", "9:41 PM", "10:33 PM", "6:12 AM", "7:19 AM", "8:19 AM", "9:31 AM", "10:01 AM"] },
  { stop_id: "13809", name: "NE Halsey &amp; Wood Village Blvd", lat: 45.535837, lon: -122.428602, times: ["8:31 PM", "9:42 PM", "10:34 PM", "6:13 AM", "7:20 AM", "8:20 AM", "9:32 AM", "10:02 AM"] },
  { stop_id: "2342", name: "NE Halsey &amp; Fairview/223rd", lat: 45.535081, lon: -122.434046, times: ["8:32 PM", "9:43 PM", "10:35 PM", "6:14 AM", "7:21 AM", "8:21 AM", "9:33 AM", "10:03 AM"] },
  { stop_id: "2437", name: "NE Halsey &amp; 7th St", lat: 45.534163, lon: -122.44037, times: ["8:33 PM", "9:44 PM", "10:36 PM", "6:15 AM", "7:22 AM", "8:22 AM", "9:34 AM", "10:04 AM"] },
  { stop_id: "2414", name: "NE Halsey &amp; Fairview Parkway", lat: 45.533724, lon: -122.445982, times: ["8:33 PM", "9:44 PM", "10:36 PM", "6:15 AM", "7:22 AM", "8:22 AM", "9:34 AM", "10:04 AM"] },
  { stop_id: "13505", name: "NE Halsey &amp; 208th Pl", lat: 45.533549, lon: -122.449126, times: ["8:34 PM", "9:45 PM", "10:37 PM", "6:16 AM", "7:23 AM", "8:23 AM", "9:35 AM", "10:05 AM"] },
  { stop_id: "2411", name: "NE Halsey &amp; 201st", lat: 45.533668, lon: -122.456948, times: ["8:35 PM", "9:46 PM", "10:38 PM", "6:17 AM", "7:24 AM", "8:24 AM", "9:36 AM", "10:06 AM"] },
  { stop_id: "8825", name: "19800 Block NE Halsey", lat: 45.533693, lon: -122.458982, times: ["8:35 PM", "9:46 PM", "10:38 PM", "6:17 AM", "7:24 AM", "8:24 AM", "9:36 AM", "10:06 AM"] },
  { stop_id: "2326", name: "NE Halsey &amp; 196th", lat: 45.533746, lon: -122.461693, times: ["8:36 PM", "9:47 PM", "10:39 PM", "6:18 AM", "7:25 AM", "8:25 AM", "9:37 AM", "10:07 AM"] },
  { stop_id: "2407", name: "NE Halsey &amp; 192nd", lat: 45.533762, lon: -122.466681, times: ["8:37 PM", "9:48 PM", "10:40 PM", "6:19 AM", "7:26 AM", "8:26 AM", "9:38 AM", "10:08 AM"] },
  { stop_id: "2406", name: "NE Halsey &amp; 186th", lat: 45.533785, lon: -122.471874, times: ["8:38 PM", "9:49 PM", "10:41 PM", "6:20 AM", "7:27 AM", "8:27 AM", "9:39 AM", "10:09 AM"] },
  { stop_id: "8860", name: "NE Halsey &amp; 181st", lat: 45.534809, lon: -122.477689, times: ["8:39 PM", "9:50 PM", "10:42 PM", "6:21 AM", "7:28 AM", "8:28 AM", "9:40 AM", "10:10 AM"] },
  { stop_id: "2349", name: "NE Halsey &amp; 176th", lat: 45.534816, lon: -122.481752, times: ["8:39 PM", "9:50 PM", "10:42 PM", "6:21 AM", "7:28 AM", "8:28 AM", "9:40 AM", "10:10 AM"] },
  { stop_id: "2399", name: "NE Halsey &amp; 172nd", lat: 45.534808, lon: -122.486142, times: ["8:40 PM", "9:51 PM", "10:43 PM", "6:22 AM", "7:29 AM", "8:29 AM", "9:41 AM", "10:11 AM"] },
  { stop_id: "2398", name: "NE Halsey &amp; 169th", lat: 45.534635, lon: -122.488975, times: ["8:40 PM", "9:51 PM", "10:43 PM", "6:22 AM", "7:29 AM", "8:29 AM", "9:42 AM", "10:12 AM"] },
  { stop_id: "2395", name: "NE Halsey &amp; 162nd", lat: 45.534428, lon: -122.495461, times: ["8:41 PM", "9:52 PM", "10:44 PM", "6:23 AM", "7:30 AM", "8:30 AM", "9:43 AM", "10:13 AM"] },
  { stop_id: "13026", name: "NE Halsey &amp; 159th Ct", lat: 45.533771, lon: -122.498859, times: ["8:42 PM", "9:53 PM", "10:45 PM", "6:24 AM", "7:31 AM", "8:31 AM", "9:43 AM", "10:13 AM"] },
  { stop_id: "2390", name: "NE Halsey &amp; 155th", lat: 45.533758, lon: -122.503678, times: ["8:42 PM", "9:53 PM", "10:45 PM", "6:25 AM", "7:32 AM", "8:32 AM", "9:44 AM", "10:14 AM"] },
  { stop_id: "2386", name: "NE Halsey &amp; 148th", lat: 45.533772, lon: -122.509491, times: ["8:43 PM", "9:54 PM", "10:46 PM", "6:26 AM", "7:33 AM", "8:33 AM", "9:45 AM", "10:15 AM"] },
  { stop_id: "2382", name: "NE Halsey &amp; 143rd", lat: 45.533784, lon: -122.51588, times: ["8:44 PM", "9:55 PM", "10:47 PM", "6:27 AM", "7:34 AM", "8:34 AM", "9:46 AM", "10:16 AM"] },
  { stop_id: "14425", name: "NE Halsey &amp; 140th", lat: 45.533737, lon: -122.519594, times: ["8:45 PM", "9:56 PM", "10:48 PM", "6:27 AM", "7:34 AM", "8:34 AM", "9:47 AM", "10:17 AM"] },
  { stop_id: "2379", name: "NE Halsey &amp; 136th Pl", lat: 45.533674, lon: -122.522471, times: ["8:45 PM", "9:56 PM", "10:48 PM", "6:28 AM", "7:35 AM", "8:35 AM", "9:48 AM", "10:18 AM"] },
  { stop_id: "2375", name: "NE Halsey &amp; 132nd", lat: 45.533624, lon: -122.526985, times: ["8:46 PM", "9:57 PM", "10:49 PM", "6:29 AM", "7:36 AM", "8:36 AM", "9:48 AM", "10:18 AM"] },
  { stop_id: "2371", name: "NE Halsey &amp; 128th", lat: 45.533649, lon: -122.531522, times: ["8:47 PM", "9:58 PM", "10:50 PM", "6:29 AM", "7:36 AM", "8:36 AM", "9:49 AM", "10:19 AM"] },
  { stop_id: "2367", name: "NE Halsey &amp; 122nd", lat: 45.53368, lon: -122.538265, times: ["8:48 PM", "9:59 PM", "10:51 PM", "6:31 AM", "7:38 AM", "8:38 AM", "9:51 AM", "10:21 AM"] },
  { stop_id: "2361", name: "NE Halsey &amp; 114th", lat: 45.533617, lon: -122.54485, times: ["8:49 PM", "10:00 PM", "10:52 PM", "6:32 AM", "7:39 AM", "8:39 AM", "9:52 AM", "10:22 AM"] },
  { stop_id: "6225", name: "NE Weidler &amp; 111th", lat: 45.534177, lon: -122.549465, times: ["8:50 PM", "10:01 PM", "10:52 PM", "6:33 AM", "7:40 AM", "8:40 AM", "9:53 AM", "10:23 AM"] },
  { stop_id: "6223", name: "NE Weidler &amp; 106th", lat: 45.534206, lon: -122.553284, times: ["8:50 PM", "10:01 PM", "10:53 PM", "6:33 AM", "7:40 AM", "8:40 AM", "9:54 AM", "10:24 AM"] },
  { stop_id: "10746", name: "NE Weidler &amp; 103rd Pl", lat: 45.534212, lon: -122.556993, times: ["8:51 PM", "10:02 PM", "10:54 PM", "6:34 AM", "7:41 AM", "8:41 AM", "9:55 AM", "10:25 AM"] },
  { stop_id: "2343", name: "NE Halsey &amp; 100th", lat: 45.533647, lon: -122.561263, times: ["8:52 PM", "10:03 PM", "10:54 PM", "5:45 AM", "6:35 AM", "7:42 AM", "8:42 AM", "9:56 AM"] },
  { stop_id: "13883", name: "NE Halsey &amp; 92nd", lat: 45.533551, lon: -122.569167, times: ["8:54 PM", "10:05 PM", "10:56 PM", "5:46 AM", "6:37 AM", "7:44 AM", "8:44 AM", "9:57 AM"] },
  { stop_id: "2459", name: "NE Halsey &amp; 90th", lat: 45.533599, lon: -122.572317, times: ["8:54 PM", "10:05 PM", "10:56 PM", "5:46 AM", "6:37 AM", "7:44 AM", "8:44 AM", "9:58 AM"] },
  { stop_id: "2457", name: "NE Halsey &amp; 86th", lat: 45.533629, lon: -122.574415, times: ["8:55 PM", "10:06 PM", "10:57 PM", "5:47 AM", "6:38 AM", "7:45 AM", "8:45 AM", "9:58 AM"] },
  { stop_id: "10846", name: "NE Jonesmore &amp; 82nd", lat: 45.534031, lon: -122.578772, times: ["8:56 PM", "10:07 PM", "10:58 PM", "5:48 AM", "6:39 AM", "7:46 AM", "8:46 AM", "10:00 AM"] },
  { stop_id: "7916", name: "NE 81st &amp; Clackamas", lat: 45.532743, lon: -122.579926, times: ["8:56 PM", "10:07 PM", "10:58 PM", "5:48 AM", "6:39 AM", "7:46 AM", "8:46 AM", "10:00 AM"] },
  { stop_id: "2455", name: "NE Halsey &amp; 79th", lat: 45.533688, lon: -122.581903, times: ["8:57 PM", "10:08 PM", "10:59 PM", "5:49 AM", "6:40 AM", "7:47 AM", "8:47 AM", "10:01 AM"] },
  { stop_id: "2453", name: "NE Halsey &amp; 76th", lat: 45.533672, lon: -122.585038, times: ["8:57 PM", "10:08 PM", "10:59 PM", "5:49 AM", "6:41 AM", "7:48 AM", "8:48 AM", "10:02 AM"] },
  { stop_id: "2451", name: "NE Halsey &amp; 74th", lat: 45.533659, lon: -122.58708, times: ["8:58 PM", "10:09 PM", "11:00 PM", "5:50 AM", "6:41 AM", "7:48 AM", "8:48 AM", "10:02 AM"] },
  { stop_id: "2445", name: "NE Halsey &amp; 69th", lat: 45.533685, lon: -122.591525, times: ["8:58 PM", "10:09 PM", "11:00 PM", "5:50 AM", "6:42 AM", "7:49 AM", "8:49 AM", "10:03 AM"] },
  { stop_id: "2443", name: "NE Halsey &amp; 66th", lat: 45.533716, lon: -122.595702, times: ["8:59 PM", "10:10 PM", "11:01 PM", "5:51 AM", "6:43 AM", "7:50 AM", "8:50 AM", "10:04 AM"] },
  { stop_id: "2438", name: "NE Halsey &amp; 60th", lat: 45.533768, lon: -122.601937, times: ["9:00 PM", "10:11 PM", "11:02 PM", "5:52 AM", "6:44 AM", "7:51 AM", "8:51 AM", "10:05 AM"] },
  { stop_id: "2432", name: "NE Halsey &amp; 57th", lat: 45.533767, lon: -122.604539, times: ["9:01 PM", "10:12 PM", "11:03 PM", "5:53 AM", "6:44 AM", "7:51 AM", "8:51 AM", "10:05 AM"] },
  { stop_id: "2428", name: "NE Halsey &amp; 53rd", lat: 45.533791, lon: -122.608668, times: ["9:02 PM", "10:13 PM", "11:04 PM", "5:54 AM", "6:45 AM", "7:52 AM", "8:52 AM", "10:06 AM"] },
  { stop_id: "2425", name: "NE Halsey &amp; 49th", lat: 45.533797, lon: -122.612873, times: ["9:02 PM", "10:13 PM", "11:04 PM", "5:54 AM", "6:46 AM", "7:53 AM", "8:53 AM", "10:07 AM"] },
  { stop_id: "7571", name: "NE 47th &amp; Halsey", lat: 45.534127, lon: -122.614876, times: ["9:03 PM", "10:14 PM", "11:05 PM", "5:55 AM", "6:47 AM", "7:54 AM", "8:54 AM", "10:08 AM"] },
  { stop_id: "650", name: "NE Broadway &amp; 44th", lat: 45.535188, lon: -122.617752, times: ["9:04 PM", "10:15 PM", "11:06 PM", "5:56 AM", "6:48 AM", "7:55 AM", "8:55 AM", "10:09 AM"] },
  { stop_id: "14640", name: "NE 42nd &amp; Halsey", lat: 45.534038, lon: -122.620383, times: ["9:05 PM", "10:16 PM", "11:07 PM", "5:57 AM", "6:49 AM", "7:56 AM", "8:56 AM", "10:10 AM"] },
  { stop_id: "7484", name: "NE Cesar Chavez Blvd &amp; Sandy", lat: 45.534699, lon: -122.622777, times: ["9:06 PM", "10:17 PM", "11:08 PM", "5:58 AM", "6:50 AM", "7:57 AM", "8:57 AM", "10:12 AM"] },
  { stop_id: "649", name: "NE Broadway &amp; 37th", lat: 45.535232, lon: -122.624789, times: ["9:07 PM", "10:18 PM", "11:09 PM", "5:59 AM", "6:51 AM", "7:58 AM", "8:58 AM", "10:13 AM"] },
  { stop_id: "647", name: "NE Broadway &amp; 35th", lat: 45.535239, lon: -122.628275, times: ["9:08 PM", "10:19 PM", "11:10 PM", "6:00 AM", "6:52 AM", "7:59 AM", "8:59 AM", "10:14 AM"] },
  { stop_id: "644", name: "NE Broadway &amp; 33rd", lat: 45.535239, lon: -122.63115, times: ["8:10 PM", "9:09 PM", "10:20 PM", "11:11 PM", "6:01 AM", "6:53 AM", "8:00 AM", "9:00 AM"] },
  { stop_id: "639", name: "NE Broadway &amp; 28th", lat: 45.535262, lon: -122.636596, times: ["8:12 PM", "9:10 PM", "10:21 PM", "11:12 PM", "6:02 AM", "6:54 AM", "8:02 AM", "9:02 AM"] },
  { stop_id: "637", name: "NE Broadway &amp; 26th", lat: 45.535238, lon: -122.639566, times: ["8:13 PM", "9:11 PM", "10:22 PM", "11:13 PM", "6:03 AM", "6:55 AM", "8:03 AM", "9:03 AM"] },
  { stop_id: "635", name: "NE Broadway &amp; 24th", lat: 45.535122, lon: -122.641606, times: ["8:13 PM", "9:12 PM", "10:23 PM", "11:14 PM", "6:04 AM", "6:56 AM", "8:04 AM", "9:04 AM"] },
  { stop_id: "634", name: "NE Broadway &amp; 21st", lat: 45.535099, lon: -122.645338, times: ["8:15 PM", "9:13 PM", "10:24 PM", "11:15 PM", "6:05 AM", "6:57 AM", "8:05 AM", "9:05 AM"] },
  { stop_id: "631", name: "NE Broadway &amp; 16th", lat: 45.535116, lon: -122.649857, times: ["8:16 PM", "9:14 PM", "10:25 PM", "11:16 PM", "6:06 AM", "6:58 AM", "8:06 AM", "9:06 AM"] },
  { stop_id: "629", name: "NE Broadway &amp; 12th", lat: 45.535103, lon: -122.653405, times: ["8:18 PM", "9:16 PM", "10:27 PM", "11:18 PM", "6:08 AM", "7:00 AM", "8:08 AM", "9:08 AM"] },
  { stop_id: "10867", name: "NE 9th &amp; Weidler", lat: 45.534439, lon: -122.656687, times: ["8:19 PM", "9:17 PM", "10:28 PM", "11:19 PM", "6:09 AM", "7:01 AM", "8:09 AM", "9:09 AM"] },
  { stop_id: "10876", name: "NE Multnomah &amp; 9th", lat: 45.531573, lon: -122.657075, times: ["8:21 PM", "9:19 PM", "10:29 PM", "11:20 PM", "6:10 AM", "7:02 AM", "8:11 AM", "9:11 AM"] },
  { stop_id: "4043", name: "NE Multnomah &amp; Grand", lat: 45.531586, lon: -122.660482, times: ["8:22 PM", "9:20 PM", "10:30 PM", "11:21 PM", "6:11 AM", "7:03 AM", "8:12 AM", "9:12 AM"] },
  { stop_id: "11492", name: "NE Multnomah &amp; 3rd", lat: 45.531159, lon: -122.66293, times: ["8:23 PM", "9:21 PM", "10:31 PM", "11:22 PM", "6:12 AM", "7:04 AM", "8:13 AM", "9:13 AM"] },
  { stop_id: "2592", name: "Rose Quarter Transit Center", lat: 45.530005, lon: -122.666476, times: ["8:25 PM", "9:23 PM", "10:33 PM", "11:24 PM", "6:14 AM", "7:06 AM", "8:15 AM", "9:15 AM"] },
  { stop_id: "9311", name: "NW Glisan &amp; 3rd", lat: 45.526817, lon: -122.674106, times: ["8:27 PM", "9:25 PM", "10:35 PM", "11:26 PM", "6:16 AM", "7:08 AM", "8:17 AM", "9:17 AM"] },
  { stop_id: "1997", name: "NW Glisan &amp; Broadway", lat: 45.52666, lon: -122.677992, times: ["8:28 PM", "9:26 PM", "10:36 PM", "11:27 PM", "6:17 AM", "7:09 AM", "8:18 AM", "9:18 AM"] },
  { stop_id: "2011", name: "NW Glisan &amp; 10th", lat: 45.526586, lon: -122.681069, times: ["8:29 PM", "9:27 PM", "10:37 PM", "11:28 PM", "6:18 AM", "7:10 AM", "8:19 AM", "9:19 AM"] },
  { stop_id: "2030", name: "NW Glisan &amp; 12th", lat: 45.526578, lon: -122.683142, times: ["8:30 PM", "9:28 PM", "10:37 PM", "11:28 PM", "6:18 AM", "7:10 AM", "8:20 AM", "9:20 AM"] },
  { stop_id: "2046", name: "NW Glisan &amp; 14th", lat: 45.526532, lon: -122.685164, times: ["8:30 PM", "9:28 PM", "10:38 PM", "11:29 PM", "6:19 AM", "7:11 AM", "8:20 AM", "9:20 AM"] },
  { stop_id: "2062", name: "NW Glisan &amp; 16th", lat: 45.526503, lon: -122.687165, times: ["8:31 PM", "9:29 PM", "10:38 PM", "11:29 PM", "6:19 AM", "7:11 AM", "8:21 AM", "9:21 AM"] },
  { stop_id: "2086", name: "NW Glisan &amp; 19th", lat: 45.526441, lon: -122.690173, times: ["8:32 PM", "9:30 PM", "10:39 PM", "11:30 PM", "6:20 AM", "7:12 AM", "8:22 AM", "9:22 AM"] },
  { stop_id: "2099", name: "NW Glisan &amp; 21st", lat: 45.526373, lon: -122.693787, times: ["8:33 PM", "9:31 PM", "10:40 PM", "11:31 PM", "6:21 AM", "7:13 AM", "8:23 AM", "9:23 AM"] },
  { stop_id: "7113", name: "NW 21st &amp; Irving", lat: 45.527648, lon: -122.694407, times: ["8:34 PM", "9:32 PM", "10:41 PM", "11:32 PM", "6:22 AM", "7:14 AM", "8:24 AM", "9:24 AM"] },
  { stop_id: "7122", name: "NW 21st &amp; Lovejoy", lat: 45.530114, lon: -122.694475, times: ["8:35 PM", "9:33 PM", "10:42 PM", "11:33 PM", "6:23 AM", "7:15 AM", "8:25 AM", "9:25 AM"] },
  { stop_id: "7128", name: "NW 21st &amp; Northrup", lat: 45.531208, lon: -122.694535, times: ["8:35 PM", "9:33 PM", "10:42 PM", "11:33 PM", "6:23 AM", "7:15 AM", "8:25 AM", "9:25 AM"] },
  { stop_id: "7130", name: "NW 21st &amp; Pettygrove", lat: 45.532916, lon: -122.694588, times: ["8:36 PM", "9:34 PM", "10:43 PM", "11:34 PM", "6:24 AM", "7:16 AM", "8:26 AM", "9:26 AM"] },
  { stop_id: "14040", name: "NW Thurman &amp; 21st", lat: 45.535621, lon: -122.695164, times: ["8:38 PM", "9:35 PM", "10:44 PM", "11:35 PM", "6:25 AM", "7:17 AM", "8:28 AM", "9:28 AM"] },
  { stop_id: "7169", name: "NW 23rd &amp; Thurman", lat: 45.535752, lon: -122.698714, times: ["8:39 PM", "9:37 PM", "10:46 PM", "11:37 PM", "6:27 AM", "7:19 AM", "8:29 AM", "9:29 AM"] },
  { stop_id: "6014", name: "NW Vaughn &amp; 24th", lat: 45.536956, lon: -122.700749, times: ["8:41 PM", "9:38 PM", "10:47 PM", "11:38 PM", "6:28 AM", "7:20 AM", "8:31 AM", "9:31 AM"] },
  { stop_id: "8414", name: "NW Vaughn &amp; 26th", lat: 45.536887, lon: -122.704726, times: ["8:42 PM", "9:40 PM", "10:49 PM", "11:40 PM", "6:30 AM", "7:22 AM", "8:32 AM", "9:32 AM"] },
  { stop_id: "14365", name: "NW Wilson &amp; 27th", lat: 45.537551, lon: -122.706558, times: ["8:44 PM", "9:41 PM", "10:50 PM", "11:41 PM", "6:31 AM", "7:23 AM", "8:34 AM", "9:34 AM"] },
]

    const polylineOut = L.polyline(shapeOutbound, { color: 'blue', weight: 4, opacity: 0.7 }).addTo(map);
    map.fitBounds(polylineOut.getBounds());

    const nowPT = new Date(new Date().toLocaleString('en-US', { timeZone: 'America/Los_Angeles' }));
    const nowMins = nowPT.getHours() * 60 + nowPT.getMinutes();

    stops.forEach(stop => {
      let highlightedTimes = [];
      let foundNext = false;
      stop.times.forEach(timeStr => {
        let cleanTime = timeStr.trim();
        let [h, m] = cleanTime.split(":");
        let schedMins = parseInt(h, 10) * 60 + parseInt(m, 10);
        if (schedMins < nowMins && nowMins - schedMins > 720) {
          schedMins += 1440;
        }
        if (!foundNext && schedMins >= nowMins) {
          highlightedTimes.push(`<span style="background:#4dd0e1; color:#000; padding:2px 6px; border-radius:6px; font-weight:bold;">${cleanTime}</span>`);
          foundNext = true;
        } else {
          highlightedTimes.push(cleanTime);
        }
      });

      L.circleMarker([stop.lat, stop.lon], {
        radius: 6,
        color: '#4dd0e1',
        fillColor: '#4dd0e1',
        fillOpacity: 0.9,
        weight: 1
      })
      .bindPopup(`<strong>${stop.name}</strong><br>${highlightedTimes.join("<br>") || 'No scheduled times'}`)
      .addTo(map);
    });

    let busMarkers = {};
    async function fetchAndDisplay() {
      const res = await fetch(`https://developer.trimet.org/ws/v2/vehicles?route=${routeNumber}&appID=${apiKey}&json=true`);
      const data = await res.json();
      const buses = (data.resultSet.vehicle || []).filter(v => v.routeNumber == routeNumber && v.direction == direction);

      Object.values(busMarkers).forEach(m => map.removeLayer(m));
      busMarkers = {};
      if (!buses.length) return;

      buses.forEach(bus => {
        if (!bus.latitude || !bus.longitude || !bus.blockID) return;
        const icon = L.divIcon({    
           className: '',
           html: `
            <div style="text-align:center;">
              <div style="background:#0071CE;color:#fff;padding:2px 6px;border-radius:6px;font-weight:bold;">${bus.vehicleID}</div>
              <div style="width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-top:10px solid #00bfff;margin:auto;"></div>
            </div>
          `,
          iconSize: [40, 30], iconAnchor: [20, 30]
        });
        const marker = L.marker([bus.latitude, bus.longitude], { icon }).addTo(map);
        busMarkers[bus.vehicleID] = marker;
      });
    }
    fetchAndDisplay();
    setInterval(fetchAndDisplay, 15000);
  </script>

<footer class="site-footer">
  <a href="terms.html">Terms of Use</a> &nbsp;|&nbsp;
  <a href="contact.html">Contact Us</a> &nbsp;|&nbsp;
  <a href="report.html">Report a Problem</a> &nbsp;|&nbsp;
  <a href="dmca.html">DMCA</a> &nbsp;|&nbsp;
  <a href="privacy.html">Privacy Policy</a>
</footer>

<script>
// ---- Favorite Star Dropdown: Auto-detect route info, menu UI ----

function getRouteInfoFromPage() {
  let routeNumber = "";
  let routeType = "";
  let routeLink = "";

  let titleEl = document.getElementById('route-title');
  if (titleEl) {
    let match = titleEl.textContent.match(/Route\s+(\d+)[^\d]?/i);
    if (match) routeNumber = match[1];
  }
  let typeEl = document.getElementById('route-type');
  if (typeEl) {
    routeType = typeEl.textContent.trim().toLowerCase();
  }
  routeLink = window.location.pathname + window.location.search;

  if (!routeNumber) {
    let titleMatch = document.title.match(/Route\s+(\d+)/i);
    if (titleMatch) routeNumber = titleMatch[1];
  }
  if (!routeType) {
    routeType = document.body.className.includes('rail') ? 'rail' : 
                document.body.className.includes('max') ? 'max' :
                document.body.className.includes('streetcar') ? 'streetcar' :
                'bus';
  }
  if (!routeLink) routeLink = window.location.href;
  if (!routeNumber) return null;
  return {
    number: routeNumber,
    link: routeLink,
    type: routeType
  };
}

function updateStarIcon() {
  const thisRoute = getRouteInfoFromPage();
  if (!thisRoute) return;
  let favorites = JSON.parse(localStorage.getItem('metrofeed_favorites') || '[]');
  const isFavorite = favorites.find(r => r.number === thisRoute.number && r.type === thisRoute.type);
  const btn = document.getElementById('fav-star');
  if (btn) btn.textContent = isFavorite ? "★" : "☆";

  // Update dropdown button label
  const ddBtn = document.getElementById('fav-dropdown-btn');
  if (ddBtn) ddBtn.textContent = isFavorite ? "Remove from Favorites" : "Add to Favorites";
}

// Show/hide dropdown on star click
function showFavDropdown(e) {
  e.stopPropagation();
  const dd = document.getElementById('fav-dropdown');
  dd.style.display = dd.style.display === "block" ? "none" : "block";
  updateStarIcon();

  // When dropdown opens, add outside click listener
  if (dd.style.display === "block") {
    setTimeout(() => {
      document.addEventListener('click', closeFavDropdown);
    }, 10);
  }
}
// Actually add/remove on dropdown click
document.addEventListener("DOMContentLoaded", function() {
  updateStarIcon();
  const ddBtn = document.getElementById('fav-dropdown-btn');
  if (ddBtn) {
    ddBtn.onclick = function(e) {
      e.stopPropagation();
      const thisRoute = getRouteInfoFromPage();
      if (!thisRoute) return;
      let favorites = JSON.parse(localStorage.getItem('metrofeed_favorites') || '[]');
      const exists = favorites.find(r => r.number === thisRoute.number && r.type === thisRoute.type);
      if (exists) {
        favorites = favorites.filter(r => !(r.number === thisRoute.number && r.type === thisRoute.type));
      } else {
        favorites.unshift(thisRoute);
        if (favorites.length > 4) favorites = favorites.slice(0, 4);
      }
      localStorage.setItem('metrofeed_favorites', JSON.stringify(favorites));
      updateStarIcon();
      document.getElementById('fav-dropdown').style.display = "none";
    };
  }
});

// Close dropdown if clicked anywhere else
function closeFavDropdown(e) {
  const dropdown = document.getElementById('fav-dropdown');
  if (!dropdown.contains(e.target)) {
    dropdown.style.display = "none";
    document.removeEventListener('click', closeFavDropdown);
  }
}

</script>
</body>
</html>