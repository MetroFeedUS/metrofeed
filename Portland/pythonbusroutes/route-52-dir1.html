<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Route 52 - To Beaverton Transit Center | MetroFeed Portland</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #0d0d0d;
      color: #cccccc;
      overflow-y: auto;
    }

    body {
      padding-top: 100px;
    }

    .ad-banner {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: #222;
      padding: 0.5rem 0;
      z-index: 1000;
      box-shadow: 0 2px 8px rgba(0,0,0,0.5);
      text-align: center;
    }

    .ad-banner img {
  width: 100%;
  max-width: 970px;
  height: auto;
  max-height: 120px; /* üëà Caps desktop height */
  display: block;
  margin: 0 auto;
}
    .home-button {
      position: fixed;
      top: 120px;
      left: 10px;
      background-color: #4dd0e1;
      color: #0d0d0d;
      padding: 0.5rem 1rem;
      font-weight: bold;
      border-radius: 8px;
      text-decoration: none;
      z-index: 1001;
      box-shadow: 0 0 10px #4dd0e1;
    }

    .home-button:hover {
      background-color: #00bcd4;
      color: #ffffff;
    }

    header {
      background-color: #0d0d0d;
      border-top: 4px solid #4dd0e1;
      border-bottom: 3px solid #4dd0e1;
      padding: 1rem;
      text-align: center;
    }

    header img {
      max-height: 60px;
    }

    h1 {
      text-align: center;
      margin: 1rem 0;
      font-size: 2rem;
      color: #f0f0f0;
    }

    .content-box {
      border-radius: 12px;
      padding: 0;
      margin: 0;
      background-color: #1e1e1e;
    }

    #map {
      width: 100%;
      height: 85vh;
      border: none;
      margin: 0 auto;
      display: block;
      border-radius: 8px;
    }

    .button-bar {
      display: flex;
      justify-content: center;
      margin: 1rem 0;
    }

    .button-bar a, .back-button {
      background: #4dd0e1;
      color: #0d0d0d;
      padding: 0.6rem 1.2rem;
      text-decoration: none;
      border-radius: 8px;
      font-weight: bold;
      border: none;
      cursor: pointer;
      box-shadow: 0 0 10px #4dd0e1;
    }

    .back-button:hover {
      background-color: #35c0d6;
    }

    .site-footer {
      text-align: center;
      margin-top: 3rem;
      margin-bottom: 120px;
      font-size: 0.85rem;
      color: #aaa;
    }

    .site-footer a {
      color: #00BFFF;
      text-decoration: none;
    }

    .site-footer a:hover {
      text-decoration: underline;
    }

@media (max-width: 600px) {
  .ad-banner {
    padding-top: 1rem;
    padding-bottom: 1rem;
  }
}


  </style>
</head>

<body>
 


 <header>
    <img src="MetroFeedPortlandLogo.png" alt="MetroFeed Portland">
  </header>

  <div class="disclaimer" style="margin: 1rem auto 0.5rem; max-width: 600px; font-size: 0.8rem; color: #bbb; text-align: center; padding: 0.5rem 1rem; background-color: #111; border: 1px dashed #444; border-radius: 6px;">
    ‚ö†Ô∏è This is a Beta program, work in progress. Please REPORT bugs and pretend to be impressed.
  </div>
  <div class="disclaimer" style="margin: 0 auto 1rem; max-width: 600px; font-size: 0.75rem; color: #888; text-align: center; padding: 0.25rem 1rem;">
    This tool is not affiliated with or endorsed by TriMet. For official schedules and service alerts, visit <a href="https://trimet.org" style="color:#4dd0e1;">trimet.org</a>.
  </div>

  <div style="margin: 2rem 0; text-align: center;">
    <button class="back-button" onclick="history.back()">Back</button>
  </div>

  <h1>Route 52 - To Beaverton Transit Center</h1>

  <div class="content-box">
    <div id="map"></div>
    <div style="text-align:right; font-size: 0.7rem; color: #777; margin-top: 0.5rem;">
      Data courtesy of TriMet.
    </div>
  </div>

  <script>
    if (document.referrer === "" && performance.navigation.type === 0) {
      window.location.href = "/index.html";
    }

    const apiKey = "2C4447D4A42083BCD84DE3B8E";
    const routeNumber = 52;
    const direction = parseInt(1);

    // Initialize map
    const map = L.map('map', {
      center: [45.6, -122.7],
      zoom: 12,
      minZoom: 12,
      maxZoom: 18,
      maxBounds: [[45.3, -123.1], [45.9, -122.3]],
      maxBoundsViscosity: 1.0
    });
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);

    // Injected shape & stop data
    const shapeOutbound = [
  [45.565802, -122.858548],
  [45.565804, -122.858546],
  [45.565887, -122.858483],
  [45.565943, -122.858492],
  [45.565996, -122.858525],
  [45.566074, -122.858623],
  [45.566103, -122.858754],
  [45.566096, -122.858829],
  [45.565954, -122.859385],
  [45.565951, -122.859394],
  [45.565868, -122.859605],
  [45.565759, -122.859721],
  [45.56564, -122.859786],
  [45.565569, -122.859814],
  [45.565487, -122.859448],
  [45.565355, -122.859128],
  [45.565293, -122.859012],
  [45.565228, -122.858931],
  [45.565069, -122.858727],
  [45.564903, -122.858614],
  [45.564762, -122.858552],
  [45.564634, -122.85851],
  [45.564519, -122.858505],
  [45.564379, -122.858528],
  [45.564159, -122.858624],
  [45.564058, -122.858686],
  [45.563961, -122.858763],
  [45.563908, -122.85884],
  [45.563855, -122.858955],
  [45.563821, -122.859082],
  [45.563801, -122.859262],
  [45.563779, -122.859518],
  [45.563743, -122.859874],
  [45.563717, -122.860167],
  [45.563706, -122.860368],
  [45.563693, -122.860529],
  [45.563664, -122.860642],
  [45.563615, -122.860753],
  [45.563565, -122.860824],
  [45.563517, -122.860873],
  [45.563459, -122.860909],
  [45.563352, -122.860942],
  [45.563229, -122.860946],
  [45.563012, -122.860951],
  [45.563012, -122.861701],
  [45.563012, -122.862324],
  [45.563011, -122.862907],
  [45.563023, -122.863337],
  [45.563024, -122.863479],
  [45.563025, -122.863647],
  [45.563025, -122.863822],
  [45.563024, -122.86394],
  [45.563021, -122.864134],
  [45.563021, -122.864138],
  [45.563018, -122.864273],
  [45.563016, -122.864385],
  [45.563004, -122.864552],
  [45.562989, -122.864737],
  [45.562966, -122.864909],
  [45.562943, -122.86504],
  [45.562919, -122.865155],
  [45.562897, -122.865259],
  [45.562863, -122.865392],
  [45.56285, -122.865442],
  [45.562832, -122.865521],
  [45.562808, -122.865657],
  [45.562773, -122.865876],
  [45.56274, -122.866125],
  [45.56272, -122.866311],
  [45.562707, -122.866507],
  [45.562701, -122.866745],
  [45.5627, -122.866923],
  [45.5627, -122.867591],
  [45.562605, -122.867594],
  [45.562305, -122.867603],
  [45.56221, -122.867605],
  [45.562048, -122.867603],
  [45.561129, -122.867576],
  [45.56029, -122.867561],
  [45.559431, -122.867567],
  [45.559282, -122.867649],
  [45.558611, -122.867662],
  [45.558566, -122.867663],
  [45.55853, -122.867664],
  [45.558107, -122.867672],
  [45.557965, -122.86761],
  [45.557809, -122.8676],
  [45.55744, -122.867601],
  [45.557324, -122.867604],
  [45.55681, -122.867601],
  [45.556686, -122.867597],
  [45.556316, -122.867604],
  [45.556213, -122.867605],
  [45.554923, -122.867589],
  [45.554812, -122.867587],
  [45.554709, -122.867586],
  [45.553256, -122.867571],
  [45.552887, -122.867568],
  [45.551119, -122.867554],
  [45.549002, -122.867534],
  [45.548869, -122.867532],
  [45.548717, -122.867532],
  [45.547458, -122.867528],
  [45.546679, -122.867525],
  [45.545494, -122.867524],
  [45.54537, -122.86752],
  [45.545247, -122.867513],
  [45.544919, -122.867515],
  [45.544488, -122.867519],
  [45.543529, -122.867525],
  [45.543515, -122.867525],
  [45.543412, -122.867523],
  [45.54329, -122.867526],
  [45.543034, -122.867542],
  [45.542779, -122.867548],
  [45.542555, -122.867557],
  [45.542243, -122.867562],
  [45.541518, -122.867558],
  [45.540893, -122.867555],
  [45.540803, -122.867652],
  [45.540498, -122.867651],
  [45.539705, -122.86764],
  [45.539301, -122.867644],
  [45.539103, -122.867644],
  [45.538988, -122.867577],
  [45.538919, -122.867532],
  [45.538335, -122.867528],
  [45.538157, -122.86753],
  [45.537989, -122.867526],
  [45.537728, -122.86753],
  [45.537678, -122.867531],
  [45.537305, -122.867524],
  [45.536592, -122.867524],
  [45.536348, -122.867528],
  [45.536218, -122.867531],
  [45.536071, -122.867533],
  [45.534399, -122.867529],
  [45.534203, -122.867516],
  [45.533755, -122.867488],
  [45.533667, -122.867487],
  [45.53347, -122.867483],
  [45.533378, -122.867568],
  [45.533272, -122.867566],
  [45.532906, -122.867558],
  [45.53272, -122.867556],
  [45.532634, -122.867478],
  [45.531838, -122.867476],
  [45.531235, -122.867478],
  [45.5312, -122.867481],
  [45.531071, -122.867547],
  [45.530443, -122.867544],
  [45.530261, -122.867546],
  [45.530178, -122.867468],
  [45.529816, -122.867472],
  [45.529736, -122.867468],
  [45.529462, -122.867468],
  [45.528596, -122.867467],
  [45.528568, -122.867465],
  [45.527834, -122.867465],
  [45.527693, -122.867461],
  [45.52737, -122.867458],
  [45.52684, -122.867452],
  [45.526766, -122.867449],
  [45.526665, -122.867538],
  [45.52602, -122.86755],
  [45.525793, -122.867554],
  [45.525721, -122.867479],
  [45.525416, -122.867484],
  [45.525279, -122.867488],
  [45.524996, -122.867491],
  [45.524788, -122.867494],
  [45.524729, -122.867579],
  [45.524169, -122.867585],
  [45.523855, -122.867588],
  [45.523795, -122.867504],
  [45.523438, -122.867503],
  [45.52332, -122.867503],
  [45.523187, -122.867497],
  [45.52298, -122.867493],
  [45.522822, -122.86749],
  [45.522726, -122.86757],
  [45.521662, -122.867558],
  [45.52131, -122.867556],
  [45.521228, -122.867482],
  [45.520824, -122.867473],
  [45.52074, -122.867471],
  [45.520652, -122.867467],
  [45.520446, -122.867465],
  [45.520142, -122.867463],
  [45.519153, -122.867455],
  [45.519025, -122.867531],
  [45.51855, -122.867529],
  [45.5181, -122.867533],
  [45.517794, -122.867535],
  [45.517687, -122.867535],
  [45.517689, -122.867649],
  [45.517709, -122.868234],
  [45.517715, -122.868896],
  [45.517718, -122.868976],
  [45.517726, -122.869048],
  [45.517746, -122.869144],
  [45.517769, -122.869223],
  [45.517801, -122.869331],
  [45.517824, -122.869402],
  [45.51786, -122.869521],
  [45.517936, -122.869725],
  [45.517961, -122.869785],
  [45.517988, -122.869841],
  [45.518029, -122.869913],
  [45.518071, -122.869974],
  [45.518106, -122.870021],
  [45.51816, -122.870078],
  [45.518223, -122.870135],
  [45.518192, -122.870243],
  [45.518146, -122.870332],
  [45.518029, -122.870528],
  [45.517881, -122.870759],
  [45.517835, -122.870804],
  [45.517791, -122.870816],
  [45.517744, -122.870817],
  [45.517693, -122.870802],
  [45.517654, -122.870777],
  [45.517615, -122.870736],
  [45.517582, -122.870675],
  [45.517545, -122.870562],
  [45.517484, -122.870366],
  [45.517435, -122.870207],
  [45.517379, -122.870036],
  [45.517311, -122.869833],
  [45.517252, -122.869656],
  [45.517246, -122.869593],
  [45.517249, -122.869531],
  [45.517259, -122.869493],
  [45.517281, -122.869459],
  [45.517312, -122.869423],
  [45.51738, -122.869368],
  [45.517657, -122.869194],
  [45.517746, -122.869144],
  [45.517726, -122.869048],
  [45.517718, -122.868976],
  [45.517715, -122.868896],
  [45.517709, -122.868234],
  [45.517689, -122.867649],
  [45.517687, -122.867535],
  [45.516672, -122.867536],
  [45.516381, -122.867536],
  [45.516329, -122.867537],
  [45.51615, -122.867537],
  [45.515987, -122.867538],
  [45.515737, -122.86754],
  [45.515667, -122.867538],
  [45.515559, -122.867537],
  [45.515427, -122.867538],
  [45.515232, -122.867539],
  [45.515059, -122.86754],
  [45.514417, -122.867552],
  [45.51356, -122.867562],
  [45.513427, -122.867486],
  [45.51302, -122.867496],
  [45.512828, -122.867501],
  [45.51217, -122.867502],
  [45.511319, -122.867505],
  [45.511086, -122.867505],
  [45.510714, -122.867505],
  [45.510569, -122.867497],
  [45.510459, -122.867487],
  [45.510436, -122.867484],
  [45.510121, -122.867444],
  [45.510013, -122.867435],
  [45.509818, -122.867419],
  [45.509732, -122.867416],
  [45.509727, -122.867416],
  [45.509508, -122.867412],
  [45.509061, -122.867416],
  [45.508982, -122.867491],
  [45.507981, -122.867493],
  [45.507885, -122.867416],
  [45.507432, -122.867419],
  [45.507409, -122.867419],
  [45.507164, -122.86742],
  [45.506885, -122.86742],
  [45.505037, -122.867423],
  [45.504982, -122.867422],
  [45.504499, -122.867421],
  [45.504406, -122.86742],
  [45.503489, -122.867424],
  [45.502439, -122.867423],
  [45.502431, -122.867423],
  [45.501876, -122.867427],
  [45.501375, -122.867424],
  [45.5013, -122.867423],
  [45.501012, -122.867421],
  [45.500731, -122.867397],
  [45.500532, -122.867366],
  [45.500336, -122.867327],
  [45.500246, -122.867305],
  [45.500155, -122.867283],
  [45.499955, -122.867247],
  [45.499813, -122.867221],
  [45.499474, -122.867191],
  [45.499125, -122.867192],
  [45.49898, -122.867192],
  [45.498582, -122.867193],
  [45.498084, -122.867194],
  [45.497665, -122.867193],
  [45.49714, -122.867193],
  [45.496735, -122.867193],
  [45.496015, -122.867192],
  [45.495919, -122.867261],
  [45.495706, -122.867262],
  [45.495523, -122.867263],
  [45.495502, -122.867264],
  [45.495192, -122.867268],
  [45.495027, -122.867247],
  [45.494828, -122.867251],
  [45.494757, -122.867257],
  [45.494673, -122.867254],
  [45.494519, -122.867259],
  [45.494212, -122.867264],
  [45.494096, -122.867268],
  [45.493727, -122.867268],
  [45.4936, -122.867269],
  [45.493351, -122.867268],
  [45.492959, -122.867268],
  [45.492941, -122.867268],
  [45.49289, -122.8672],
  [45.492851, -122.867199],
  [45.492818, -122.867199],
  [45.492455, -122.867193],
  [45.492185, -122.867193],
  [45.491994, -122.867193],
  [45.491781, -122.867193],
  [45.491096, -122.867192],
  [45.490636, -122.86721],
  [45.490054, -122.867232],
  [45.489692, -122.867235],
  [45.489576, -122.867236],
  [45.488721, -122.867243],
  [45.488179, -122.867244],
  [45.487413, -122.867232],
  [45.486967, -122.86722],
  [45.486536, -122.86721],
  [45.486257, -122.86721],
  [45.485609, -122.867207],
  [45.485496, -122.867207],
  [45.485356, -122.867208],
  [45.485058, -122.86722],
  [45.484178, -122.867257],
  [45.48387, -122.867278],
  [45.483705, -122.867289],
  [45.482851, -122.867322],
  [45.482395, -122.867323],
  [45.482323, -122.86736],
  [45.482217, -122.867363],
  [45.482118, -122.867367],
  [45.482054, -122.867339],
  [45.4817, -122.867344],
  [45.481307, -122.86735],
  [45.47988, -122.867404],
  [45.479563, -122.867415],
  [45.47903, -122.867436],
  [45.478842, -122.867444],
  [45.478702, -122.86745],
  [45.478631, -122.867452],
  [45.478133, -122.867453],
  [45.478074, -122.867454],
  [45.477505, -122.867468],
  [45.477114, -122.867485],
  [45.476847, -122.867499],
  [45.476797, -122.867501],
  [45.476389, -122.867516],
  [45.47625, -122.867523],
  [45.475898, -122.867527],
  [45.475653, -122.867529],
  [45.475418, -122.867531],
  [45.4753, -122.867534],
  [45.475373, -122.867396],
  [45.475484, -122.86715],
  [45.475572, -122.86695],
  [45.475673, -122.866724],
  [45.475736, -122.866582],
  [45.475826, -122.866372],
  [45.475868, -122.866276],
  [45.475987, -122.866003],
  [45.476145, -122.865617],
  [45.476177, -122.865539],
  [45.476179, -122.865474],
  [45.476196, -122.865437],
  [45.47629, -122.865227],
  [45.476321, -122.865159],
  [45.476362, -122.865126],
  [45.476645, -122.864481],
  [45.47675, -122.864241],
  [45.477643, -122.862238],
  [45.478148, -122.861142],
  [45.478203, -122.861023],
  [45.478534, -122.8603],
  [45.478952, -122.859377],
  [45.479286, -122.858616],
  [45.479399, -122.858372],
  [45.479503, -122.858146],
  [45.479617, -122.857901],
  [45.479666, -122.85779],
  [45.479707, -122.857696],
  [45.479923, -122.857216],
  [45.480037, -122.856964],
  [45.480175, -122.856653],
  [45.480351, -122.856258],
  [45.48039, -122.856169],
  [45.480616, -122.855666],
  [45.480637, -122.855619],
  [45.480694, -122.855467],
  [45.480735, -122.855336],
  [45.480795, -122.855158],
  [45.480766, -122.855063],
  [45.480819, -122.854901],
  [45.480908, -122.854569],
  [45.480992, -122.854219],
  [45.481058, -122.854185],
  [45.481098, -122.854026],
  [45.481203, -122.853596],
  [45.481287, -122.853295],
  [45.481374, -122.853004],
  [45.481763, -122.851735],
  [45.481846, -122.851476],
  [45.481941, -122.851221],
  [45.481984, -122.851089],
  [45.482083, -122.850776],
  [45.482638, -122.849014],
  [45.482915, -122.848129],
  [45.482972, -122.847949],
  [45.483148, -122.847323],
  [45.4833, -122.846693],
  [45.483338, -122.846513],
  [45.483421, -122.846088],
  [45.483445, -122.845965],
  [45.483543, -122.845386],
  [45.483624, -122.84483],
  [45.483685, -122.844296],
  [45.483768, -122.843521],
  [45.483793, -122.843214],
  [45.483821, -122.842921],
  [45.483919, -122.841952],
  [45.483942, -122.841744],
  [45.483997, -122.8412],
  [45.484013, -122.841041],
  [45.484105, -122.840096],
  [45.484167, -122.839485],
  [45.484264, -122.838491],
  [45.484279, -122.838348],
  [45.484341, -122.837748],
  [45.484383, -122.83739],
  [45.484393, -122.837302],
  [45.484409, -122.837157],
  [45.484565, -122.836003],
  [45.484719, -122.834952],
  [45.484796, -122.834425],
  [45.484799, -122.834401],
  [45.484929, -122.833458],
  [45.485187, -122.831636],
  [45.485215, -122.831434],
  [45.485353, -122.83035],
  [45.48538, -122.83014],
  [45.4854, -122.829989],
  [45.485422, -122.82984],
  [45.485491, -122.829131],
  [45.485524, -122.828799],
  [45.485535, -122.828645],
  [45.485638, -122.827733],
  [45.485655, -122.827579],
  [45.485666, -122.827484],
  [45.485675, -122.827408],
  [45.485703, -122.827181],
  [45.48576, -122.826726],
  [45.485795, -122.826443],
  [45.485807, -122.826347],
  [45.485832, -122.826141],
  [45.485858, -122.825926],
  [45.4859, -122.825553],
  [45.485927, -122.825305],
  [45.486003, -122.824728],
  [45.486101, -122.823991],
  [45.486176, -122.82349],
  [45.486349, -122.822317],
  [45.486425, -122.82179],
  [45.486452, -122.821598],
  [45.486519, -122.821116],
  [45.486597, -122.820565],
  [45.486656, -122.820148],
  [45.486706, -122.819819],
  [45.486744, -122.819528],
  [45.486767, -122.819373],
  [45.486788, -122.819213],
  [45.48682, -122.818984],
  [45.486825, -122.818944],
  [45.486873, -122.818594],
  [45.48688, -122.818542],
  [45.486961, -122.817936],
  [45.486982, -122.817791],
  [45.487053, -122.817192],
  [45.48707, -122.817044],
  [45.487078, -122.816986],
  [45.487095, -122.816863],
  [45.487126, -122.816611],
  [45.487163, -122.816333],
  [45.487192, -122.816148],
  [45.487204, -122.81607],
  [45.487227, -122.815953],
  [45.487239, -122.815902],
  [45.487288, -122.815664],
  [45.487308, -122.815553],
  [45.487327, -122.815454],
  [45.487338, -122.815385],
  [45.48736, -122.815233],
  [45.487371, -122.815128],
  [45.487402, -122.814832],
  [45.487407, -122.814742],
  [45.487407, -122.814674],
  [45.487403, -122.814212],
  [45.487403, -122.814138],
  [45.487402, -122.813991],
  [45.487405, -122.813697],
  [45.487409, -122.813571],
  [45.487413, -122.813431],
  [45.487415, -122.81339],
  [45.487416, -122.813308],
  [45.487426, -122.812777],
  [45.487427, -122.812724],
  [45.487429, -122.812273],
  [45.48743, -122.811989],
  [45.487432, -122.811516],
  [45.487435, -122.810962],
  [45.487435, -122.810855],
  [45.487386, -122.810692],
  [45.487389, -122.80987],
  [45.487393, -122.809233],
  [45.487393, -122.809048],
  [45.487388, -122.808917],
  [45.487373, -122.808771],
  [45.487367, -122.808706],
  [45.487345, -122.808472],
  [45.487302, -122.808061],
  [45.487195, -122.807053],
  [45.48717, -122.806812],
  [45.487109, -122.806219],
  [45.487108, -122.80621],
  [45.487145, -122.806099],
  [45.487088, -122.80556],
  [45.487066, -122.805349],
  [45.487048, -122.805185],
  [45.487032, -122.805028],
  [45.486972, -122.804463],
  [45.486926, -122.80402],
  [45.486869, -122.803912],
  [45.486814, -122.803374],
  [45.486778, -122.80302],
  [45.486674, -122.802026],
  [45.486633, -122.801637],
  [45.486603, -122.801431],
  [45.486579, -122.801266],
  [45.486534, -122.801076],
  [45.486513, -122.800936],
  [45.486498, -122.8008],
  [45.486491, -122.800611],
  [45.486492, -122.80052],
  [45.486495, -122.800469],
  [45.486499, -122.800396],
  [45.486508, -122.800323],
  [45.486603, -122.800327],
  [45.486614, -122.800327],
  [45.486791, -122.800331],
  [45.486912, -122.800331],
  [45.486966, -122.800337],
  [45.487032, -122.800352],
  [45.487117, -122.80038],
  [45.48722, -122.800421],
  [45.487286, -122.800462],
  [45.487376, -122.80053],
  [45.487692, -122.800757],
  [45.487763, -122.800811],
  [45.487782, -122.800825],
  [45.487934, -122.800937],
  [45.488017, -122.801019],
  [45.488118, -122.801027],
  [45.488416, -122.801135],
  [45.488597, -122.801199],
  [45.488746, -122.801235],
  [45.488873, -122.801261],
  [45.48902, -122.801293],
  [45.489283, -122.801356],
  [45.489338, -122.80137],
  [45.489697, -122.801464],
  [45.489764, -122.801547],
  [45.489938, -122.801628],
  [45.49005, -122.801694],
  [45.490093, -122.801723],
  [45.49014, -122.801757],
  [45.490192, -122.801799],
  [45.490257, -122.801851],
  [45.49034, -122.801631],
  [45.490357, -122.801601],
  [45.490373, -122.801571],
  [45.490406, -122.801536],
  [45.490457, -122.801506],
  [45.490564, -122.801393],
  [45.49074, -122.801229],
  [45.491005, -122.800981],
  [45.491068, -122.800924],
  [45.491124, -122.800829],
  [45.491342, -122.800632],
  [45.491388, -122.80061],
  [45.491436, -122.800603],
  [45.491494, -122.800617],
  [45.491548, -122.800646],
  [45.491599, -122.800689],
  [45.491649, -122.800746],
  [45.491658, -122.800811],
  [45.491653, -122.800869],
  [45.491631, -122.800932],
  [45.491483, -122.801072],
  [45.491366, -122.801182],
  [45.491344, -122.801203]
];

const stopNames = {
  "1640": "SW Farmington &amp; 156th",
  "1642": "18200 Block SW Farmington",
  "1646": "SW Farmington &amp; Erickson",
  "1650": "SW Farmington &amp; Hocken",
  "1652": "SW Farmington &amp; Kinnaman",
  "1658": "SW Farmington &amp; Remington Dr",
  "1661": "SW Farmington &amp; Murray",
  "1665": "SW Farmington &amp; Watson",
  "1669": "SW Farmington &amp; 142nd",
  "1671": "SW Farmington &amp; 149th",
  "1672": "SW Farmington &amp; 153rd",
  "1675": "SW Farmington &amp; 160th",
  "1679": "SW Farmington &amp; 165th",
  "1683": "SW Farmington &amp; 170th",
  "1688": "SW Farmington &amp; 179th",
  "4429": "PCC Rock Creek Main Stop",
  "6946": "3000 Block SW 185th",
  "6952": "SW 185th &amp; Aloha High School Drive",
  "6954": "NW 185th &amp; Adrian",
  "6956": "SW 185th &amp; Aloha Park Apts",
  "6959": "SW 185th &amp; Blanton",
  "6964": "NW 185th &amp; NE Cornell",
  "6969": "SW 185th &amp; Ewen",
  "6975": "NW 185th &amp; NE Heritage Pkwy",
  "6976": "SW 185th &amp; Honeywood",
  "6979": "SW 185th &amp; Johnson",
  "6981": "SW 185th &amp; Kinnaman",
  "6983": "SW 185th &amp; Longacre",
  "6987": "NW 185th &amp; Sunset Square",
  "6991": "NW 185th &amp; NE Holly St",
  "6994": "SW 185th &amp; Pheasant",
  "6996": "SW 185th &amp; Pike",
  "6999": "NW 185th &amp; Bronson",
  "7001": "NW 185th &amp; Rock Creek School",
  "7003": "SW 185th &amp; Rosa",
  "7006": "SW 185th &amp; SE Edgeway Dr",
  "7009": "SW 185th &amp; Sandra",
  "7013": "SW 185th &amp; Tualatin Valley Hwy",
  "7015": "NW 185th &amp; Tamarack",
  "7021": "700 Block NW 185th",
  "7023": "SW 185th &amp; W Baseline",
  "7025": "NW 185th &amp; NE Walker",
  "7026": "NW 185th &amp; West Union",
  "7027": "NW 185th &amp; West Union",
  "8603": "SW 185th &amp; Alexander",
  "8840": "NW Springville &amp; 178th",
  "8852": "NW Springville &amp; 181st",
  "9022": "NW 185th &amp; NE Evergreen",
  "9351": "NW 185th &amp; Rock Creek",
  "9869": "Willow Creek Transit Center",
  "9985": "Beaverton Transit Center",
  "10166": "SW Farmington &amp; 185th",
  "11810": "SW Farmington &amp; Hall",
  "12944": "SW Lombard &amp; Broadway",
  "13700": "PCC Rock Creek Layover",
  "13917": "SW Farmington &amp; Rose Ln"
};

const stops = [
  { stop_id: "8840", name: "NW Springville &amp; 178th", lat: 45.563205, lon: -122.861725, times: ["6:03 AM", "6:35 AM", "6:57 AM", "7:28 AM", "7:59 AM", "8:30 AM", "9:00 AM", "9:32 AM"] },
  { stop_id: "8852", name: "NW Springville &amp; 181st", lat: 45.563145, lon: -122.864143, times: ["6:03 AM", "6:35 AM", "6:57 AM", "7:29 AM", "7:59 AM", "8:30 AM", "9:00 AM", "9:32 AM"] },
  { stop_id: "7027", name: "NW 185th &amp; West Union", lat: 45.558561, lon: -122.867731, times: ["6:05 AM", "6:37 AM", "6:59 AM", "7:31 AM", "8:01 AM", "8:32 AM", "9:02 AM", "9:34 AM"] },
  { stop_id: "7015", name: "NW 185th &amp; Tamarack", lat: 45.554921, lon: -122.867749, times: ["6:05 AM", "6:37 AM", "7:00 AM", "7:32 AM", "8:02 AM", "8:33 AM", "9:03 AM", "9:35 AM"] },
  { stop_id: "6954", name: "NW 185th &amp; Adrian", lat: 45.552887, lon: -122.867739, times: ["6:06 AM", "6:38 AM", "7:00 AM", "7:32 AM", "8:02 AM", "8:33 AM", "9:03 AM", "9:35 AM"] },
  { stop_id: "7001", name: "NW 185th &amp; Rock Creek School", lat: 45.548711, lon: -122.867707, times: ["6:07 AM", "6:39 AM", "7:01 AM", "7:33 AM", "8:03 AM", "8:34 AM", "9:05 AM", "9:37 AM"] },
  { stop_id: "9351", name: "NW 185th &amp; Rock Creek", lat: 45.544914, lon: -122.867682, times: ["6:08 AM", "6:40 AM", "7:02 AM", "7:34 AM", "8:04 AM", "8:35 AM", "9:06 AM", "9:38 AM"] },
  { stop_id: "6999", name: "NW 185th &amp; Bronson", lat: 45.543508, lon: -122.867678, times: ["6:09 AM", "6:41 AM", "7:03 AM", "7:35 AM", "8:05 AM", "8:36 AM", "9:06 AM", "9:38 AM"] },
  { stop_id: "9022", name: "NW 185th &amp; NE Evergreen", lat: 45.537724, lon: -122.867747, times: ["6:10 AM", "6:42 AM", "7:05 AM", "7:37 AM", "8:07 AM", "8:38 AM", "9:08 AM", "9:40 AM"] },
  { stop_id: "6964", name: "NW 185th &amp; NE Cornell", lat: 45.533665, lon: -122.867689, times: ["6:11 AM", "6:43 AM", "7:06 AM", "7:38 AM", "8:08 AM", "8:39 AM", "9:09 AM", "9:41 AM"] },
  { stop_id: "6987", name: "NW 185th &amp; Sunset Square", lat: 45.529469, lon: -122.867641, times: ["6:12 AM", "6:44 AM", "7:07 AM", "7:39 AM", "8:09 AM", "8:40 AM", "9:11 AM", "9:43 AM"] },
  { stop_id: "7025", name: "NW 185th &amp; NE Walker", lat: 45.527369, lon: -122.867633, times: ["6:13 AM", "6:45 AM", "7:08 AM", "7:40 AM", "8:10 AM", "8:41 AM", "9:11 AM", "9:43 AM"] },
  { stop_id: "7021", name: "700 Block NW 185th", lat: 45.524991, lon: -122.867673, times: ["6:14 AM", "6:46 AM", "7:08 AM", "7:40 AM", "8:10 AM", "8:41 AM", "9:12 AM", "9:44 AM"] },
  { stop_id: "6991", name: "NW 185th &amp; NE Holly St", lat: 45.522979, lon: -122.867681, times: ["6:14 AM", "6:46 AM", "7:09 AM", "7:41 AM", "8:11 AM", "8:42 AM", "9:13 AM", "9:45 AM"] },
  { stop_id: "6975", name: "NW 185th &amp; NE Heritage Pkwy", lat: 45.520441, lon: -122.867653, times: ["6:15 AM", "6:47 AM", "7:10 AM", "7:42 AM", "8:12 AM", "8:43 AM", "9:14 AM", "9:46 AM"] },
  { stop_id: "7006", name: "SW 185th &amp; SE Edgeway Dr", lat: 45.518095, lon: -122.867631, times: ["6:15 AM", "6:47 AM", "7:10 AM", "7:42 AM", "8:12 AM", "8:43 AM", "9:14 AM", "9:46 AM"] },
  { stop_id: "9869", name: "Willow Creek Transit Center", lat: 45.517258, lon: -122.869868, times: ["6:17 AM", "6:49 AM", "7:12 AM", "7:44 AM", "8:14 AM", "8:45 AM", "9:16 AM", "9:48 AM"] },
  { stop_id: "7023", name: "SW 185th &amp; W Baseline", lat: 45.515226, lon: -122.867651, times: ["6:19 AM", "6:51 AM", "7:15 AM", "7:47 AM", "8:17 AM", "8:48 AM", "9:19 AM", "9:51 AM"] },
  { stop_id: "6956", name: "SW 185th &amp; Aloha Park Apts", lat: 45.513018, lon: -122.867686, times: ["6:19 AM", "6:51 AM", "7:15 AM", "7:47 AM", "8:17 AM", "8:48 AM", "9:19 AM", "9:51 AM"] },
  { stop_id: "6983", name: "SW 185th &amp; Longacre", lat: 45.51108, lon: -122.867661, times: ["6:20 AM", "6:52 AM", "7:16 AM", "7:48 AM", "8:18 AM", "8:49 AM", "9:20 AM", "9:52 AM"] },
  { stop_id: "6976", name: "SW 185th &amp; Honeywood", lat: 45.509723, lon: -122.867595, times: ["5:22 AM", "6:20 AM", "6:52 AM", "7:16 AM", "7:48 AM", "8:18 AM", "8:49 AM", "9:20 AM"] },
  { stop_id: "6994", name: "SW 185th &amp; Pheasant", lat: 45.507427, lon: -122.867598, times: ["5:22 AM", "6:21 AM", "6:53 AM", "7:17 AM", "7:49 AM", "8:19 AM", "8:50 AM", "9:21 AM"] },
  { stop_id: "6969", name: "SW 185th &amp; Ewen", lat: 45.504493, lon: -122.867611, times: ["5:23 AM", "6:21 AM", "6:53 AM", "7:18 AM", "7:50 AM", "8:20 AM", "8:50 AM", "9:21 AM"] },
  { stop_id: "7009", name: "SW 185th &amp; Sandra", lat: 45.502428, lon: -122.867582, times: ["5:23 AM", "6:22 AM", "6:54 AM", "7:19 AM", "7:51 AM", "8:21 AM", "8:51 AM", "9:22 AM"] },
  { stop_id: "6979", name: "SW 185th &amp; Johnson", lat: 45.499934, lon: -122.867426, times: ["5:24 AM", "6:23 AM", "6:55 AM", "7:19 AM", "7:51 AM", "8:21 AM", "8:52 AM", "9:23 AM"] },
  { stop_id: "6946", name: "3000 Block SW 185th", lat: 45.497665, lon: -122.867298, times: ["5:24 AM", "6:23 AM", "6:55 AM", "7:20 AM", "7:52 AM", "8:22 AM", "8:52 AM", "9:23 AM"] },
  { stop_id: "8603", name: "SW 185th &amp; Alexander", lat: 45.495519, lon: -122.867352, times: ["5:25 AM", "6:24 AM", "6:56 AM", "7:21 AM", "7:53 AM", "8:23 AM", "8:53 AM", "9:24 AM"] },
  { stop_id: "7013", name: "SW 185th &amp; Tualatin Valley Hwy", lat: 45.493727, lon: -122.867305, times: ["5:25 AM", "6:24 AM", "6:56 AM", "7:21 AM", "7:53 AM", "8:23 AM", "8:53 AM", "9:24 AM"] },
  { stop_id: "6959", name: "SW 185th &amp; Blanton", lat: 45.49218, lon: -122.867332, times: ["5:26 AM", "6:25 AM", "6:57 AM", "7:22 AM", "7:54 AM", "8:24 AM", "8:54 AM", "9:25 AM"] },
  { stop_id: "6996", name: "SW 185th &amp; Pike", lat: 45.489692, lon: -122.867366, times: ["5:26 AM", "6:25 AM", "6:57 AM", "7:22 AM", "7:54 AM", "8:24 AM", "8:54 AM", "9:25 AM"] },
  { stop_id: "6981", name: "SW 185th &amp; Kinnaman", lat: 45.485061, lon: -122.867365, times: ["5:27 AM", "6:26 AM", "6:58 AM", "7:23 AM", "7:55 AM", "8:25 AM", "8:56 AM", "9:26 AM"] },
  { stop_id: "6952", name: "SW 185th &amp; Aloha High School Drive", lat: 45.482335, lon: -122.86747, times: ["5:28 AM", "6:27 AM", "6:59 AM", "7:24 AM", "7:56 AM", "8:26 AM", "8:56 AM", "9:27 AM"] },
  { stop_id: "7003", name: "SW 185th &amp; Rosa", lat: 45.478845, lon: -122.867557, times: ["5:28 AM", "6:27 AM", "7:00 AM", "7:25 AM", "7:57 AM", "8:27 AM", "8:57 AM", "9:28 AM"] },
  { stop_id: "10166", name: "SW Farmington &amp; 185th", lat: 45.47548, lon: -122.866867, times: ["5:29 AM", "6:28 AM", "7:01 AM", "7:26 AM", "7:58 AM", "8:28 AM", "8:59 AM", "9:29 AM"] },
  { stop_id: "1642", name: "18200 Block SW Farmington", lat: 45.47658, lon: -122.864429, times: ["5:30 AM", "6:29 AM", "7:01 AM", "7:27 AM", "7:59 AM", "8:29 AM", "8:59 AM", "9:30 AM"] },
  { stop_id: "1688", name: "SW Farmington &amp; 179th", lat: 45.478081, lon: -122.861086, times: ["5:30 AM", "6:29 AM", "7:02 AM", "7:27 AM", "7:59 AM", "8:29 AM", "9:00 AM", "9:30 AM"] },
  { stop_id: "1658", name: "SW Farmington &amp; Remington Dr", lat: 45.479391, lon: -122.858041, times: ["5:31 AM", "6:30 AM", "7:02 AM", "7:28 AM", "8:00 AM", "8:30 AM", "9:01 AM", "9:31 AM"] },
  { stop_id: "1652", name: "SW Farmington &amp; Kinnaman", lat: 45.480539, lon: -122.855603, times: ["5:31 AM", "6:30 AM", "7:03 AM", "7:29 AM", "8:01 AM", "8:31 AM", "9:01 AM", "9:32 AM"] },
  { stop_id: "1683", name: "SW Farmington &amp; 170th", lat: 45.48194, lon: -122.850688, times: ["5:32 AM", "6:31 AM", "7:04 AM", "7:30 AM", "8:02 AM", "8:32 AM", "9:02 AM", "9:33 AM"] },
  { stop_id: "1679", name: "SW Farmington &amp; 165th", lat: 45.483289, lon: -122.846038, times: ["5:33 AM", "6:32 AM", "7:05 AM", "7:31 AM", "8:03 AM", "8:33 AM", "9:03 AM", "9:34 AM"] },
  { stop_id: "1675", name: "SW Farmington &amp; 160th", lat: 45.483845, lon: -122.841169, times: ["5:34 AM", "6:33 AM", "7:06 AM", "7:32 AM", "8:04 AM", "8:34 AM", "9:05 AM", "9:35 AM"] },
  { stop_id: "1640", name: "SW Farmington &amp; 156th", lat: 45.484255, lon: -122.837361, times: ["5:34 AM", "6:34 AM", "7:07 AM", "7:33 AM", "8:05 AM", "8:35 AM", "9:06 AM", "9:36 AM"] },
  { stop_id: "1672", name: "SW Farmington &amp; 153rd", lat: 45.484656, lon: -122.834386, times: ["5:35 AM", "6:34 AM", "7:08 AM", "7:34 AM", "8:06 AM", "8:36 AM", "9:07 AM", "9:37 AM"] },
  { stop_id: "1671", name: "SW Farmington &amp; 149th", lat: 45.485181, lon: -122.830306, times: ["5:36 AM", "6:36 AM", "7:09 AM", "7:35 AM", "8:07 AM", "8:37 AM", "9:08 AM", "9:38 AM"] },
  { stop_id: "1661", name: "SW Farmington &amp; Murray", lat: 45.485649, lon: -122.826406, times: ["5:37 AM", "6:37 AM", "7:10 AM", "7:36 AM", "8:08 AM", "8:38 AM", "9:09 AM", "9:39 AM"] },
  { stop_id: "1669", name: "SW Farmington &amp; 142nd", lat: 45.48633, lon: -122.821762, times: ["5:38 AM", "6:38 AM", "7:11 AM", "7:38 AM", "8:10 AM", "8:40 AM", "9:11 AM", "9:41 AM"] },
  { stop_id: "13917", name: "SW Farmington &amp; Rose Ln", lat: 45.486769, lon: -122.818512, times: ["5:39 AM", "6:39 AM", "7:12 AM", "7:39 AM", "8:11 AM", "8:41 AM", "9:12 AM", "9:42 AM"] },
  { stop_id: "1650", name: "SW Farmington &amp; Hocken", lat: 45.487309, lon: -122.814214, times: ["5:40 AM", "6:40 AM", "7:14 AM", "7:40 AM", "8:12 AM", "8:42 AM", "9:13 AM", "9:43 AM"] },
  { stop_id: "1646", name: "SW Farmington &amp; Erickson", lat: 45.487335, lon: -122.811513, times: ["5:41 AM", "6:41 AM", "7:14 AM", "7:41 AM", "8:13 AM", "8:43 AM", "9:14 AM", "9:44 AM"] },
  { stop_id: "1665", name: "SW Farmington &amp; Watson", lat: 45.487053, lon: -122.806231, times: ["5:42 AM", "6:42 AM", "7:16 AM", "7:43 AM", "8:15 AM", "8:45 AM", "9:16 AM", "9:46 AM"] },
  { stop_id: "11810", name: "SW Farmington &amp; Hall", lat: 45.486766, lon: -122.803382, times: ["5:43 AM", "6:43 AM", "7:17 AM", "7:44 AM", "8:16 AM", "8:46 AM", "9:17 AM", "9:47 AM"] },
  { stop_id: "12944", name: "SW Lombard &amp; Broadway", lat: 45.487818, lon: -122.800725, times: ["5:44 AM", "6:45 AM", "7:18 AM", "7:45 AM", "8:17 AM", "8:47 AM", "9:18 AM", "9:48 AM"] },
  { stop_id: "9985", name: "Beaverton Transit Center", lat: 45.491385, lon: -122.801308, times: ["5:46 AM", "6:47 AM", "7:21 AM", "7:48 AM", "8:20 AM", "8:50 AM", "9:21 AM", "9:51 AM"] },
  { stop_id: "13700", name: "PCC Rock Creek Layover", lat: 45.565759, lon: -122.85846, times: ["6:55 AM", "8:28 AM", "8:58 AM", "9:30 AM", "10:02 AM", "10:32 AM", "11:20 AM", "11:44 AM"] },
  { stop_id: "4429", name: "PCC Rock Creek Main Stop", lat: 45.565999, lon: -122.859421, times: ["6:56 AM", "7:27 AM", "7:58 AM", "8:29 AM", "8:59 AM", "9:31 AM", "10:03 AM", "10:33 AM"] },
  { stop_id: "7026", name: "NW 185th &amp; West Union", lat: 45.558515, lon: -122.867388, times: ["11:15 PM"] },
]

    // Draw route polyline
    const polylineOut = L.polyline(shapeOutbound, { color: 'blue', weight: 4, opacity: 0.7 }).addTo(map);
    map.fitBounds(polylineOut.getBounds());

    // 1. Get current time in PT
    const nowPT = new Date(new Date().toLocaleString('en-US', { timeZone: 'America/Los_Angeles' }));
    const datePT = nowPT.toDateString();

    // 2. Add stops with highlighted next time
    stops.forEach(stop => {
      const stamps = stop.times.map(t => new Date(`${datePT} ${t}`));
      const nextIdx = stamps.findIndex(ts => ts > nowPT);
      const timesHtml = stamps.slice(0, 8).map((ts, i) => {
        const lbl = ts.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        return i === nextIdx ? `<strong>${lbl}</strong>` : lbl;
      }).join('<br>');

      L.circleMarker([stop.lat, stop.lon], {
        radius: 6,
        color: '#4dd0e1',
        fillColor: '#4dd0e1',
        fillOpacity: 0.9,
        weight: 1
      })
      .bindPopup(`<strong>${stop.name}</strong><br>${timesHtml || 'No scheduled times'}`)
      .addTo(map);
    });

    // Bus markers fetch
    let busMarkers = {};
    async function fetchAndDisplay() {
      const res = await fetch(`https://developer.trimet.org/ws/v2/vehicles?route=${routeNumber}&appID=${apiKey}&json=true`);
      const data = await res.json();
      const buses = (data.resultSet.vehicle || []).filter(v => v.routeNumber == routeNumber && v.direction == direction);

      Object.values(busMarkers).forEach(m => map.removeLayer(m));
      busMarkers = {};
      if (!buses.length) return;

      buses.forEach(bus => {
        if (!bus.latitude || !bus.longitude || !bus.blockID) return;
        const icon = L.divIcon({    
           className: '',
	   html: `
            <div style="text-align:center;">
              <div style="background:#0071CE;color:#fff;padding:2px 6px;border-radius:6px;font-weight:bold;">${bus.vehicleID}</div>
              <div style="width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-top:10px solid #00bfff;margin:auto;"></div>
            </div>
          `,
          iconSize: [40, 30], iconAnchor: [20, 30]
        });
        const marker = L.marker([bus.latitude, bus.longitude], { icon }).addTo(map);
        busMarkers[bus.vehicleID] = marker;
      });
    }
    fetchAndDisplay();
    setInterval(fetchAndDisplay, 15000);
  </script>

  <footer class="site-footer">
    <a href="terms.html">Terms of Use</a> &nbsp;|&nbsp;
    <a href="contact.html">Contact Us</a> &nbsp;|&nbsp;
    <a href="report.html">Report a Problem</a> &nbsp;|&nbsp;
    <a href="privacy.html">Privacy Policy</a>
  </footer>

  <script>
    if (!localStorage.getItem('cookieConsent')) {
      document.write(`
        <div id="cookie-banner" style="position: fixed; bottom: 0; left: 0; right: 0; background: #333; color: #fff; padding: 1rem; z-index: 1000; font-size: 0.9rem; line-height: 1.4; text-align: center; box-sizing: border-box;">
          üì¢ We use cookies to improve functionality and analyze traffic.
          By using MetroFeed, you agree to our 
          <a href='privacy.html' style='color: #4dd0e1; text-decoration: underline;'>Privacy Policy</a>.<br>
          <button onclick='localStorage.setItem("cookieConsent", "true"); document.getElementById("cookie-banner").remove();' style='margin-top: 0.5rem; background: #4dd0e1; color: #000; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer; font-weight: bold;'>OK</button>
        </div>
      `);
    }
  </script>
</body>
</html>