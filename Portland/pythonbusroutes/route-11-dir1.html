<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Route 11 - To St Johns | MetroFeed Portland</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #0d0d0d;
      color: #cccccc;
      overflow-y: auto;
    }

    body {
      padding-top: 100px;
    }

    .ad-banner {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: #222;
      padding: 0.5rem 0;
      z-index: 1000;
      box-shadow: 0 2px 8px rgba(0,0,0,0.5);
      text-align: center;
    }

    .ad-banner img {
  width: 100%;
  max-width: 970px;
  height: auto;
  max-height: 120px; /* üëà Caps desktop height */
  display: block;
  margin: 0 auto;
}
    .home-button {
      position: fixed;
      top: 120px;
      left: 10px;
      background-color: #4dd0e1;
      color: #0d0d0d;
      padding: 0.5rem 1rem;
      font-weight: bold;
      border-radius: 8px;
      text-decoration: none;
      z-index: 1001;
      box-shadow: 0 0 10px #4dd0e1;
    }

    .home-button:hover {
      background-color: #00bcd4;
      color: #ffffff;
    }

    header {
      background-color: #0d0d0d;
      border-top: 4px solid #4dd0e1;
      border-bottom: 3px solid #4dd0e1;
      padding: 1rem;
      text-align: center;
    }

    header img {
      max-height: 60px;
    }

    h1 {
      text-align: center;
      margin: 1rem 0;
      font-size: 2rem;
      color: #f0f0f0;
    }

    .content-box {
      border-radius: 12px;
      padding: 0;
      margin: 0;
      background-color: #1e1e1e;
    }

    #map {
      width: 100%;
      height: 85vh;
      border: none;
      margin: 0 auto;
      display: block;
      border-radius: 8px;
    }

    .button-bar {
      display: flex;
      justify-content: center;
      margin: 1rem 0;
    }

    .button-bar a, .back-button {
      background: #4dd0e1;
      color: #0d0d0d;
      padding: 0.6rem 1.2rem;
      text-decoration: none;
      border-radius: 8px;
      font-weight: bold;
      border: none;
      cursor: pointer;
      box-shadow: 0 0 10px #4dd0e1;
    }

    .back-button:hover {
      background-color: #35c0d6;
    }

    .site-footer {
      text-align: center;
      margin-top: 3rem;
      margin-bottom: 120px;
      font-size: 0.85rem;
      color: #aaa;
    }

    .site-footer a {
      color: #00BFFF;
      text-decoration: none;
    }

    .site-footer a:hover {
      text-decoration: underline;
    }

@media (max-width: 600px) {
  .ad-banner {
    padding-top: 1rem;
    padding-bottom: 1rem;
  }
}


  </style>
</head>

<body>
 
 <div class="ad-banner">
    <a href="advertise.html" target="_blank">
      <img src="assets/ad-placeholder.png" alt="Advertise Here">
    </a>
  </div>

 <header>
    <img src="MetroFeedPortlandLogo.png" alt="MetroFeed Portland">
  </header>

  <div class="disclaimer" style="margin: 1rem auto 0.5rem; max-width: 600px; font-size: 0.8rem; color: #bbb; text-align: center; padding: 0.5rem 1rem; background-color: #111; border: 1px dashed #444; border-radius: 6px;">
    ‚ö†Ô∏è This is a Beta program, work in progress. Please REPORT bugs and pretend to be impressed.
  </div>
  <div class="disclaimer" style="margin: 0 auto 1rem; max-width: 600px; font-size: 0.75rem; color: #888; text-align: center; padding: 0.25rem 1rem;">
    This tool is not affiliated with or endorsed by TriMet. For official schedules and service alerts, visit <a href="https://trimet.org" style="color:#4dd0e1;">trimet.org</a>.
  </div>

  <div style="margin: 2rem 0; text-align: center;">
    <button class="back-button" onclick="history.back()">Back</button>
  </div>

  <h1>Route 11 - To St Johns</h1>

  <div class="content-box">
    <div id="map"></div>
    <div style="text-align:right; font-size: 0.7rem; color: #777; margin-top: 0.5rem;">
      Data courtesy of TriMet.
    </div>
  </div>

  <script>
    if (document.referrer === "" && performance.navigation.type === 0) {
      window.location.href = "/index.html";
    }

    const apiKey = "2C4447D4A42083BCD84DE3B8E";
    const routeNumber = 11;
    const direction = parseInt(1);

    // Initialize map
    const map = L.map('map', {
      center: [45.6, -122.7],
      zoom: 12,
      minZoom: 12,
      maxZoom: 18,
      maxBounds: [[45.3, -123.1], [45.9, -122.3]],
      maxBoundsViscosity: 1.0
    });
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);

    // Injected shape & stop data
    const shapeOutbound = [
  [45.595901, -122.667609],
  [45.595913, -122.66759],
  [45.596081, -122.667342],
  [45.596159, -122.667224],
  [45.596213, -122.667117],
  [45.596256, -122.66702],
  [45.596297, -122.66689],
  [45.596327, -122.666757],
  [45.596347, -122.666632],
  [45.596354, -122.666513],
  [45.596349, -122.666362],
  [45.596332, -122.666209],
  [45.596287, -122.665859],
  [45.596097, -122.664402],
  [45.596009, -122.663725],
  [45.595976, -122.663473],
  [45.595953, -122.663293],
  [45.59593, -122.663149],
  [45.595924, -122.663116],
  [45.595906, -122.663023],
  [45.595874, -122.66289],
  [45.595717, -122.66236],
  [45.595903, -122.662203],
  [45.595998, -122.662123],
  [45.596355, -122.661832],
  [45.59703, -122.661273],
  [45.59772, -122.660705],
  [45.598666, -122.659916],
  [45.598959, -122.659675],
  [45.599141, -122.659532],
  [45.599143, -122.65953],
  [45.599217, -122.659474],
  [45.599264, -122.659457],
  [45.599328, -122.659446],
  [45.59941, -122.659446],
  [45.59941, -122.659591],
  [45.599413, -122.65971],
  [45.599424, -122.659841],
  [45.599437, -122.659968],
  [45.599458, -122.660139],
  [45.599484, -122.660295],
  [45.599513, -122.660452],
  [45.599551, -122.660605],
  [45.599587, -122.660748],
  [45.599636, -122.660912],
  [45.599828, -122.661501],
  [45.600027, -122.662106],
  [45.600198, -122.662611],
  [45.600264, -122.662798],
  [45.600325, -122.662957],
  [45.60038, -122.663092],
  [45.600557, -122.663487],
  [45.600671, -122.663721],
  [45.600728, -122.663851],
  [45.600803, -122.664031],
  [45.600876, -122.664224],
  [45.600917, -122.664348],
  [45.600961, -122.664497],
  [45.601015, -122.664704],
  [45.601055, -122.664881],
  [45.601089, -122.66505],
  [45.601156, -122.665434],
  [45.60131, -122.666356],
  [45.60152, -122.667653],
  [45.601615, -122.668234],
  [45.601774, -122.669203],
  [45.601792, -122.669299],
  [45.601825, -122.669481],
  [45.601844, -122.669583],
  [45.601867, -122.669705],
  [45.602068, -122.670624],
  [45.60215, -122.671005],
  [45.60224, -122.67142],
  [45.602281, -122.671617],
  [45.602309, -122.671764],
  [45.602337, -122.671937],
  [45.602359, -122.672073],
  [45.60239, -122.672276],
  [45.602432, -122.672584],
  [45.602498, -122.673087],
  [45.602537, -122.673389],
  [45.602578, -122.673672],
  [45.602627, -122.673988],
  [45.602698, -122.674437],
  [45.602802, -122.675032],
  [45.602866, -122.675439],
  [45.602912, -122.675756],
  [45.60294, -122.675954],
  [45.603026, -122.676604],
  [45.6031, -122.677092],
  [45.603143, -122.67741],
  [45.603171, -122.677612],
  [45.603224, -122.677817],
  [45.603239, -122.67793],
  [45.603251, -122.678166],
  [45.603255, -122.678285],
  [45.603264, -122.678903],
  [45.603252, -122.679053],
  [45.603264, -122.679314],
  [45.603292, -122.67973],
  [45.603311, -122.679954],
  [45.603335, -122.680159],
  [45.603367, -122.680387],
  [45.603395, -122.680588],
  [45.60343, -122.680772],
  [45.60348, -122.681004],
  [45.603536, -122.68122],
  [45.603518, -122.68147],
  [45.603559, -122.681601],
  [45.603602, -122.681731],
  [45.603647, -122.68186],
  [45.603697, -122.68199],
  [45.603756, -122.682128],
  [45.603814, -122.682261],
  [45.603877, -122.682383],
  [45.603938, -122.682491],
  [45.603997, -122.682591],
  [45.604064, -122.682692],
  [45.60414, -122.682793],
  [45.604232, -122.68291],
  [45.604337, -122.683027],
  [45.604433, -122.683124],
  [45.604522, -122.683208],
  [45.60465, -122.683323],
  [45.604766, -122.683417],
  [45.604895, -122.683511],
  [45.605039, -122.683612],
  [45.605169, -122.683706],
  [45.60555, -122.683991],
  [45.605621, -122.684049],
  [45.6057, -122.684115],
  [45.605792, -122.684191],
  [45.606234, -122.684517],
  [45.606381, -122.684624],
  [45.60645, -122.684679],
  [45.606501, -122.68472],
  [45.606556, -122.684766],
  [45.606647, -122.684844],
  [45.606778, -122.684968],
  [45.606874, -122.685068],
  [45.606944, -122.685149],
  [45.607009, -122.685236],
  [45.607102, -122.685369],
  [45.607192, -122.68552],
  [45.607251, -122.685632],
  [45.607309, -122.685748],
  [45.607379, -122.685902],
  [45.607456, -122.686091],
  [45.607534, -122.686315],
  [45.607599, -122.686508],
  [45.607671, -122.68674],
  [45.607804, -122.687172],
  [45.607877, -122.687418],
  [45.607925, -122.687577],
  [45.608089, -122.688084],
  [45.608916, -122.690598],
  [45.609055, -122.691041],
  [45.60911, -122.691217],
  [45.609382, -122.692111],
  [45.609707, -122.693182],
  [45.609997, -122.694137],
  [45.610424, -122.695542],
  [45.610637, -122.696247],
  [45.61082, -122.696853],
  [45.611285, -122.698392],
  [45.611698, -122.699756],
  [45.611777, -122.699999],
  [45.61181, -122.700099],
  [45.611867, -122.700266],
  [45.611931, -122.700445],
  [45.612001, -122.700622],
  [45.612079, -122.700806],
  [45.612225, -122.70112],
  [45.612399, -122.701456],
  [45.612555, -122.701752],
  [45.612599, -122.701836],
  [45.612772, -122.702176],
  [45.612973, -122.702587],
  [45.613088, -122.70282],
  [45.613225, -122.702907],
  [45.613317, -122.703073],
  [45.613421, -122.703276],
  [45.613516, -122.703499],
  [45.613531, -122.703748],
  [45.613612, -122.703964],
  [45.6137, -122.704193],
  [45.613778, -122.704395],
  [45.613831, -122.704538],
  [45.61445, -122.706196],
  [45.614759, -122.707043],
  [45.615283, -122.708474],
  [45.615375, -122.708696],
  [45.615468, -122.708896],
  [45.615698, -122.709317],
  [45.616101, -122.710044],
  [45.616346, -122.710488],
  [45.616734, -122.711191],
  [45.616825, -122.711365],
  [45.616894, -122.711506],
  [45.617026, -122.711805],
  [45.617107, -122.712007],
  [45.617171, -122.71218],
  [45.617228, -122.712347],
  [45.617274, -122.712488],
  [45.617314, -122.712627],
  [45.617367, -122.712814],
  [45.617413, -122.713004],
  [45.617455, -122.713187],
  [45.617501, -122.713414],
  [45.617526, -122.713558],
  [45.617549, -122.71371],
  [45.617579, -122.713932],
  [45.617604, -122.714157],
  [45.617619, -122.714335],
  [45.617631, -122.71452],
  [45.617639, -122.714714],
  [45.617644, -122.71488],
  [45.617642, -122.715197],
  [45.617636, -122.715386],
  [45.617628, -122.715539],
  [45.617612, -122.715764],
  [45.617591, -122.715981],
  [45.617538, -122.7164],
  [45.617494, -122.716732],
  [45.61737, -122.717644],
  [45.617329, -122.717969],
  [45.617312, -122.718137],
  [45.617298, -122.718315],
  [45.617289, -122.718476],
  [45.617286, -122.718675],
  [45.617286, -122.718858],
  [45.617294, -122.719064],
  [45.617304, -122.719228],
  [45.617321, -122.71942],
  [45.617345, -122.719623],
  [45.61738, -122.719845],
  [45.617409, -122.72],
  [45.617441, -122.720152],
  [45.617483, -122.720331],
  [45.617529, -122.720499],
  [45.617596, -122.720715],
  [45.617631, -122.720819],
  [45.61766, -122.7209],
  [45.617698, -122.720998],
  [45.617749, -122.721125],
  [45.617846, -122.721354],
  [45.618224, -122.722218],
  [45.618321, -122.72244],
  [45.618647, -122.723184],
  [45.618711, -122.723333],
  [45.618775, -122.723353],
  [45.618873, -122.723578],
  [45.61887, -122.723698],
  [45.619078, -122.724176],
  [45.619444, -122.725019],
  [45.619608, -122.72539],
  [45.619693, -122.725461],
  [45.620059, -122.726264],
  [45.620085, -122.726437],
  [45.62023, -122.726732],
  [45.62037, -122.727022],
  [45.620636, -122.72754],
  [45.620752, -122.72765],
  [45.620778, -122.727701],
  [45.620879, -122.727886],
  [45.621113, -122.728319],
  [45.622003, -122.729921],
  [45.622294, -122.730449],
  [45.622585, -122.731],
  [45.622817, -122.731443],
  [45.622879, -122.73156],
  [45.622937, -122.731788],
  [45.623611, -122.733117],
  [45.623843, -122.733553],
  [45.624188, -122.734186],
  [45.624711, -122.735128],
  [45.624986, -122.735626],
  [45.625821, -122.737138],
  [45.6266, -122.738535],
  [45.627321, -122.73985],
  [45.627694, -122.740516],
  [45.627779, -122.740557],
  [45.627957, -122.740886],
  [45.627978, -122.741022],
  [45.62831, -122.741628],
  [45.629615, -122.743998],
  [45.630139, -122.744928],
  [45.630028, -122.745054],
  [45.629914, -122.745183],
  [45.629615, -122.745526],
  [45.629548, -122.745619],
  [45.629536, -122.745637],
  [45.629442, -122.745803],
  [45.629363, -122.745978],
  [45.629281, -122.746184],
  [45.629242, -122.746314],
  [45.629206, -122.746453],
  [45.629179, -122.746603],
  [45.629158, -122.746712],
  [45.629128, -122.747054],
  [45.629118, -122.747554],
  [45.629093, -122.74885],
  [45.629078, -122.749595],
  [45.629155, -122.750012],
  [45.629227, -122.750259],
  [45.629355, -122.750532],
  [45.629634, -122.751039],
  [45.629759, -122.751268],
  [45.629804, -122.75135],
  [45.630002, -122.75171],
  [45.630296, -122.752246],
  [45.630455, -122.752535],
  [45.631199, -122.75389],
  [45.63128, -122.754037],
  [45.631639, -122.754686],
  [45.631656, -122.754717],
  [45.632675, -122.756561],
  [45.632826, -122.756835],
  [45.632916, -122.756958],
  [45.633012, -122.757075],
  [45.633111, -122.757169],
  [45.633241, -122.757277],
  [45.633321, -122.757338],
  [45.633395, -122.75738],
  [45.633524, -122.757434],
  [45.633597, -122.75746],
  [45.633666, -122.757479],
  [45.633773, -122.757498],
  [45.633865, -122.757505],
  [45.633965, -122.757501],
  [45.634089, -122.757488],
  [45.63423, -122.757457],
  [45.634386, -122.75741],
  [45.634556, -122.757344],
  [45.634685, -122.757281],
  [45.63481, -122.757208],
  [45.634914, -122.75714],
  [45.634966, -122.757102],
  [45.635032, -122.757049],
  [45.635121, -122.756972],
  [45.635269, -122.756827],
  [45.635349, -122.756738],
  [45.635654, -122.756403],
  [45.635854, -122.756182],
  [45.636023, -122.75599],
  [45.636141, -122.755858],
  [45.636378, -122.756261],
  [45.636458, -122.756396],
  [45.636555, -122.756559],
  [45.636718, -122.756836],
  [45.637138, -122.757571],
  [45.637253, -122.75769],
  [45.637364, -122.757884],
  [45.637536, -122.758189],
  [45.637554, -122.758322],
  [45.637935, -122.758992],
  [45.638496, -122.759966],
  [45.638617, -122.760184],
  [45.638712, -122.760378],
  [45.638774, -122.760526],
  [45.638836, -122.760685],
  [45.63889, -122.760849],
  [45.638948, -122.761038],
  [45.638983, -122.761176],
  [45.639006, -122.761285],
  [45.639027, -122.761388],
  [45.639057, -122.761565],
  [45.639078, -122.761721],
  [45.639107, -122.761999],
  [45.639115, -122.76216],
  [45.639118, -122.762422],
  [45.639116, -122.762531],
  [45.639112, -122.762631],
  [45.639104, -122.762784],
  [45.639085, -122.762969],
  [45.63906, -122.763145],
  [45.639029, -122.763317],
  [45.638999, -122.763458],
  [45.638972, -122.763578],
  [45.638923, -122.763756],
  [45.638861, -122.763951],
  [45.638798, -122.764124],
  [45.638733, -122.76428],
  [45.638664, -122.764429],
  [45.638594, -122.764564],
  [45.638519, -122.764693],
  [45.638447, -122.764813],
  [45.638388, -122.76498],
  [45.638045, -122.765508],
  [45.63789, -122.765742],
  [45.637828, -122.765768],
  [45.637692, -122.765969],
  [45.637516, -122.766227],
  [45.636641, -122.767536],
  [45.636102, -122.768343],
  [45.635354, -122.769464],
  [45.635203, -122.76969],
  [45.634376, -122.770927],
  [45.634279, -122.771058],
  [45.634184, -122.771169],
  [45.634104, -122.771259],
  [45.63399, -122.771373],
  [45.633865, -122.771485],
  [45.63374, -122.77158],
  [45.633615, -122.771667],
  [45.633476, -122.771745],
  [45.633364, -122.771801],
  [45.63324, -122.771852],
  [45.633123, -122.771892],
  [45.63299, -122.771928],
  [45.632874, -122.771951],
  [45.632757, -122.771965],
  [45.632588, -122.771973],
  [45.632353, -122.771964],
  [45.631189, -122.771917],
  [45.63092, -122.771907],
  [45.630791, -122.771901],
  [45.630474, -122.771889],
  [45.630051, -122.771872],
  [45.629197, -122.771839],
  [45.628791, -122.771822],
  [45.627614, -122.771775],
  [45.623826, -122.771623],
  [45.623466, -122.77161],
  [45.623, -122.771595],
  [45.622399, -122.771566],
  [45.621366, -122.771527],
  [45.620954, -122.771511],
  [45.620314, -122.771485],
  [45.619372, -122.771449],
  [45.619271, -122.771444],
  [45.619182, -122.771438],
  [45.619172, -122.771437],
  [45.619118, -122.77143],
  [45.619059, -122.771418],
  [45.618938, -122.771388],
  [45.618828, -122.771352],
  [45.61867, -122.771288],
  [45.618587, -122.771248],
  [45.618433, -122.77116],
  [45.618367, -122.771117],
  [45.618253, -122.771032],
  [45.61811, -122.770906],
  [45.618028, -122.770892],
  [45.617945, -122.770812],
  [45.617848, -122.770702],
  [45.617784, -122.770622],
  [45.617704, -122.77051],
  [45.617665, -122.770371],
  [45.617598, -122.770249],
  [45.617538, -122.770135],
  [45.617454, -122.769958],
  [45.617407, -122.769845],
  [45.617369, -122.76974],
  [45.61734, -122.769663],
  [45.617316, -122.769588],
  [45.617286, -122.76948],
  [45.617257, -122.769363],
  [45.617225, -122.769216],
  [45.617202, -122.769101],
  [45.617175, -122.768953],
  [45.617052, -122.768153],
  [45.616946, -122.767499],
  [45.616878, -122.767071],
  [45.616735, -122.766075],
  [45.616702, -122.765863],
  [45.616675, -122.765726],
  [45.616645, -122.765594],
  [45.616614, -122.765476],
  [45.616575, -122.76534],
  [45.616522, -122.765182],
  [45.616479, -122.765063],
  [45.616434, -122.764949],
  [45.616349, -122.764751],
  [45.616275, -122.764596],
  [45.616204, -122.76447],
  [45.616127, -122.764338],
  [45.61606, -122.764236],
  [45.615991, -122.764137],
  [45.615906, -122.764027],
  [45.615825, -122.763929],
  [45.61572, -122.763814],
  [45.615645, -122.763736],
  [45.61556, -122.763656],
  [45.615435, -122.763553],
  [45.615334, -122.763476],
  [45.615271, -122.763431],
  [45.6152, -122.763387],
  [45.615092, -122.763327],
  [45.614969, -122.763265],
  [45.614844, -122.763212],
  [45.614741, -122.763175],
  [45.614634, -122.763147],
  [45.614492, -122.763115],
  [45.614156, -122.763065],
  [45.613709, -122.762999],
  [45.61329, -122.762938],
  [45.613206, -122.762996],
  [45.613011, -122.762972],
  [45.612699, -122.762933],
  [45.612678, -122.76293],
  [45.612571, -122.762832],
  [45.612451, -122.762792],
  [45.61234, -122.762746],
  [45.612261, -122.762711],
  [45.612195, -122.762676],
  [45.612088, -122.762603],
  [45.611983, -122.762527],
  [45.611894, -122.762453],
  [45.611813, -122.762377],
  [45.611725, -122.762287],
  [45.611624, -122.762165],
  [45.611555, -122.762075],
  [45.611491, -122.761979],
  [45.611418, -122.761864],
  [45.611362, -122.761776],
  [45.611282, -122.761664],
  [45.611185, -122.761538],
  [45.611102, -122.761441],
  [45.611038, -122.761373],
  [45.610964, -122.761302],
  [45.61041, -122.76081],
  [45.609657, -122.760141],
  [45.609473, -122.759977],
  [45.608832, -122.759408],
  [45.608645, -122.759241],
  [45.608543, -122.759149],
  [45.6084, -122.75902],
  [45.608261, -122.758893],
  [45.608167, -122.758801],
  [45.60808, -122.758709],
  [45.607918, -122.758522],
  [45.607821, -122.758401],
  [45.607731, -122.758279],
  [45.607644, -122.758154],
  [45.607558, -122.758025],
  [45.607409, -122.757775],
  [45.607303, -122.757579],
  [45.607202, -122.757371],
  [45.606564, -122.755967],
  [45.606106, -122.754956],
  [45.605732, -122.75413],
  [45.605494, -122.753601],
  [45.604729, -122.751915],
  [45.603956, -122.750203],
  [45.603902, -122.750083],
  [45.603362, -122.748871],
  [45.60254, -122.747008],
  [45.60214, -122.746107],
  [45.601939, -122.745643],
  [45.601885, -122.745516],
  [45.601828, -122.745363],
  [45.601771, -122.745205],
  [45.60171, -122.74502],
  [45.601651, -122.744824],
  [45.601542, -122.74442],
  [45.601506, -122.744289],
  [45.601455, -122.744135],
  [45.601376, -122.743911],
  [45.601328, -122.743782],
  [45.601196, -122.743458],
  [45.600565, -122.742093],
  [45.60056, -122.742082],
  [45.600519, -122.741992],
  [45.600436, -122.74181],
  [45.600311, -122.741541],
  [45.600207, -122.741318],
  [45.600014, -122.740941],
  [45.599915, -122.740758],
  [45.599693, -122.740377],
  [45.599468, -122.740029],
  [45.598859, -122.739115],
  [45.598688, -122.738868],
  [45.598543, -122.738665],
  [45.598444, -122.738534],
  [45.598334, -122.738404],
  [45.598086, -122.73814],
  [45.597922, -122.737954],
  [45.597831, -122.737846],
  [45.597725, -122.737707],
  [45.597614, -122.737552],
  [45.597469, -122.737328],
  [45.597342, -122.737119],
  [45.597206, -122.736873],
  [45.59672, -122.736001],
  [45.596608, -122.735798],
  [45.596418, -122.735457],
  [45.596379, -122.735386],
  [45.596078, -122.734844],
  [45.595722, -122.734205],
  [45.595667, -122.734096],
  [45.595609, -122.733969],
  [45.59558, -122.733901],
  [45.595549, -122.733816],
  [45.595508, -122.733703],
  [45.595474, -122.733588],
  [45.59544, -122.733469],
  [45.5954, -122.733292],
  [45.595377, -122.733157],
  [45.59536, -122.733045],
  [45.595344, -122.732902],
  [45.595335, -122.732799],
  [45.595328, -122.732674],
  [45.595323, -122.732441],
  [45.595325, -122.732067],
  [45.595325, -122.73201],
  [45.595326, -122.731893],
  [45.595327, -122.731516],
  [45.595327, -122.731322],
  [45.595327, -122.730934],
  [45.595321, -122.730628],
  [45.595315, -122.730526],
  [45.595306, -122.730389],
  [45.595196, -122.730378],
  [45.59495, -122.730378],
  [45.594574, -122.730379],
  [45.594195, -122.730379],
  [45.593884, -122.730379],
  [45.593808, -122.730379],
  [45.59369, -122.730379],
  [45.593565, -122.730359],
  [45.593166, -122.731618],
  [45.592909, -122.732429],
  [45.592879, -122.732526],
  [45.592836, -122.732693],
  [45.59289, -122.732919],
  [45.59326, -122.734334],
  [45.593415, -122.734938],
  [45.593494, -122.735271],
  [45.59353, -122.735424],
  [45.593757, -122.736377],
  [45.593989, -122.737346],
  [45.594189, -122.738191],
  [45.594216, -122.738306],
  [45.594236, -122.738392],
  [45.594438, -122.739273],
  [45.59466, -122.740234],
  [45.594846, -122.741012],
  [45.59489, -122.741199],
  [45.595121, -122.742181],
  [45.595346, -122.743125],
  [45.595551, -122.743978],
  [45.595578, -122.744095],
  [45.595804, -122.745048],
  [45.595918, -122.745529],
  [45.596031, -122.74601],
  [45.596163, -122.746558],
  [45.596234, -122.746856],
  [45.596263, -122.746976],
  [45.59649, -122.747934],
  [45.596618, -122.748479],
  [45.596644, -122.748608],
  [45.59666, -122.748695],
  [45.596675, -122.74881],
  [45.596687, -122.748933],
  [45.596692, -122.74902],
  [45.596693, -122.749046],
  [45.596697, -122.749172],
  [45.596696, -122.749297],
  [45.596689, -122.749403],
  [45.596675, -122.749541],
  [45.596657, -122.749684],
  [45.596635, -122.749806],
  [45.596608, -122.749924],
  [45.596571, -122.750064],
  [45.596534, -122.750178],
  [45.596498, -122.750277],
  [45.59646, -122.750367],
  [45.596372, -122.750556],
  [45.595933, -122.751458],
  [45.595869, -122.751589],
  [45.59578, -122.751772],
  [45.595397, -122.752562],
  [45.595148, -122.753071],
  [45.594969, -122.753438],
  [45.594951, -122.753474],
  [45.594464, -122.754473],
  [45.594449, -122.754505],
  [45.593981, -122.755467],
  [45.593739, -122.755965],
  [45.593348, -122.756767],
  [45.593153, -122.757168],
  [45.593012, -122.757452],
  [45.592989, -122.757498],
  [45.592937, -122.757572],
  [45.592876, -122.757658],
  [45.592825, -122.757749],
  [45.592745, -122.757906],
  [45.592627, -122.758137],
  [45.592508, -122.758381],
  [45.591906, -122.757812],
  [45.591389, -122.757303],
  [45.591315, -122.75723],
  [45.591081, -122.757007],
  [45.590982, -122.756912],
  [45.590912, -122.756846],
  [45.590731, -122.756673],
  [45.590626, -122.756571],
  [45.590523, -122.756469],
  [45.590505, -122.756452],
  [45.590389, -122.756337],
  [45.590143, -122.756095],
  [45.589875, -122.755838],
  [45.589671, -122.755643],
  [45.589603, -122.755578],
  [45.589497, -122.755495],
  [45.589532, -122.755402],
  [45.589553, -122.755326],
  [45.589573, -122.755226],
  [45.589518, -122.755086],
  [45.589418, -122.75478],
  [45.589251, -122.754269],
  [45.589084, -122.753756],
  [45.58895, -122.753344],
  [45.588841, -122.752999],
  [45.588741, -122.752676],
  [45.588662, -122.752423],
  [45.588546, -122.752076],
  [45.588474, -122.751858],
  [45.58842, -122.751713],
  [45.588383, -122.751596],
  [45.588345, -122.75147],
  [45.588203, -122.751565],
  [45.587985, -122.751721],
  [45.587837, -122.751821],
  [45.5877, -122.751907],
  [45.58741, -122.752095],
  [45.58736, -122.752127]
];

const stopNames = {
  "1698": "N Fessenden &amp; Allegheny",
  "1704": "N Fessenden &amp; Burr",
  "1713": "N Fessenden &amp; Midway",
  "1715": "N Fessenden &amp; Richmond",
  "1718": "N Fessenden &amp; Tioga",
  "3009": "N Ivanhoe &amp; Charleston",
  "3541": "13200 Block N Columbia",
  "4818": "N Richmond &amp; Syracuse",
  "5374": "N St Louis &amp; Seneca",
  "5375": "N St Louis &amp; Smith",
  "9202": "5300 Block N Marine",
  "9203": "5700 Block N Marine",
  "9204": "5900 Block N Marine",
  "9206": "N Columbia &amp; Simmons",
  "9309": "N Columbia &amp; Ramsey",
  "9451": "NE Middlefield &amp; 6th Drive",
  "9453": "NE 6th Drive &amp; Faloma",
  "9454": "N Marine &amp; Gantenbein",
  "9455": "N Marine &amp; Anchor",
  "9457": "6100 Block N Marine",
  "9458": "N Marine &amp; Bybee Lake Road",
  "9459": "N Marine &amp; Pacific Gateway Blvd",
  "9460": "14500 Block N Columbia",
  "9477": "NE Middlefield Rd &amp; N Vancouver Way",
  "10162": "N Columbia &amp; Terminal 5 Access Rd",
  "11006": "N Marine &amp; Portland Rd",
  "11832": "N Marine &amp; Pier 99 St",
  "11833": "N Columbia Blvd &amp; Upland Dr",
  "11834": "N Columbia Blvd &amp; Bank",
  "11835": "N Columbia Blvd &amp; Oregonian",
  "11836": "N Macrum &amp; Powers",
  "11837": "N Ivanhoe &amp; Baltimore",
  "11838": "N Columbia Blvd &amp; Hendricks",
  "11849": "9500 Block N Columbia Blvd",
  "11935": "N Ivanhoe &amp; Chicago",
  "13479": "N Fessenden &amp; Iris Way",
  "13527": "N Columbia &amp; Lombard (Burgard)",
  "13876": "N St Louis &amp; Lombard",
  "14126": "N Leadbetter &amp; Marine",
  "14127": "N Leadbetter &amp; Bybee Lake Ct",
  "14215": "N Richmond &amp; Princeton"
};

const stops = [
  { stop_id: "9477", name: "NE Middlefield Rd &amp; N Vancouver Way", lat: 45.59585, lon: -122.667541, times: ["7:47 AM", "2:17 PM", "3:11 PM", "4:10 PM", "5:10 PM", "6:14 PM", "5:08 AM", "6:09 AM"] },
  { stop_id: "9451", name: "NE Middlefield &amp; 6th Drive", lat: 45.595876, lon: -122.663135, times: ["7:47 AM", "2:17 PM", "3:11 PM", "4:11 PM", "5:11 PM", "6:14 PM", "5:08 AM", "6:09 AM"] },
  { stop_id: "9453", name: "NE 6th Drive &amp; Faloma", lat: 45.599115, lon: -122.659466, times: ["7:48 AM", "2:18 PM", "3:12 PM", "4:12 PM", "5:12 PM", "6:15 PM", "5:09 AM", "6:10 AM"] },
  { stop_id: "9454", name: "N Marine &amp; Gantenbein", lat: 45.601882, lon: -122.66946, times: ["7:50 AM", "2:19 PM", "3:14 PM", "4:15 PM", "5:15 PM", "6:17 PM", "5:11 AM", "6:12 AM"] },
  { stop_id: "9455", name: "N Marine &amp; Anchor", lat: 45.602985, lon: -122.675735, times: ["7:52 AM", "2:20 PM", "3:16 PM", "4:16 PM", "5:16 PM", "6:18 PM", "5:12 AM", "6:13 AM"] },
  { stop_id: "11832", name: "N Marine &amp; Pier 99 St", lat: 45.606312, lon: -122.684303, times: ["7:11 AM", "7:54 AM", "2:22 PM", "3:18 PM", "4:19 PM", "5:19 PM", "6:20 PM", "5:14 AM"] },
  { stop_id: "11006", name: "N Marine &amp; Portland Rd", lat: 45.613925, lon: -122.704467, times: ["7:13 AM", "7:56 AM", "2:24 PM", "3:20 PM", "4:21 PM", "5:21 PM", "6:22 PM", "5:16 AM"] },
  { stop_id: "9202", name: "5300 Block N Marine", lat: 45.618955, lon: -122.723581, times: ["7:15 AM", "7:58 AM", "2:26 PM", "3:22 PM", "4:23 PM", "5:23 PM", "6:24 PM", "5:18 AM"] },
  { stop_id: "9203", name: "5700 Block N Marine", lat: 45.620935, lon: -122.72782, times: ["7:16 AM", "7:59 AM", "2:27 PM", "3:23 PM", "4:24 PM", "5:24 PM", "6:24 PM", "5:18 AM"] },
  { stop_id: "9204", name: "5900 Block N Marine", lat: 45.622882, lon: -122.731368, times: ["7:16 AM", "7:59 AM", "2:27 PM", "3:23 PM", "4:24 PM", "5:24 PM", "6:25 PM", "5:19 AM"] },
  { stop_id: "9457", name: "6100 Block N Marine", lat: 45.625086, lon: -122.735509, times: ["7:17 AM", "8:00 AM", "2:28 PM", "3:24 PM", "4:25 PM", "5:25 PM", "6:25 PM", "5:19 AM"] },
  { stop_id: "9458", name: "N Marine &amp; Bybee Lake Road", lat: 45.628041, lon: -122.74084, times: ["7:18 AM", "8:00 AM", "2:28 PM", "3:24 PM", "4:25 PM", "5:25 PM", "6:26 PM", "5:20 AM"] },
  { stop_id: "14126", name: "N Leadbetter &amp; Marine", lat: 45.629603, lon: -122.745696, times: ["7:18 AM", "8:01 AM", "2:29 PM", "3:25 PM", "4:26 PM", "5:26 PM", "6:27 PM", "5:21 AM"] },
  { stop_id: "14127", name: "N Leadbetter &amp; Bybee Lake Ct", lat: 45.63133, lon: -122.753978, times: ["7:19 AM", "8:02 AM", "2:30 PM", "3:26 PM", "4:27 PM", "5:27 PM", "6:27 PM", "5:21 AM"] },
  { stop_id: "9459", name: "N Marine &amp; Pacific Gateway Blvd", lat: 45.636553, lon: -122.756281, times: ["7:20 AM", "8:03 AM", "2:31 PM", "3:27 PM", "4:28 PM", "5:28 PM", "6:28 PM", "5:22 AM"] },
  { stop_id: "9206", name: "N Columbia &amp; Simmons", lat: 45.637726, lon: -122.766013, times: ["7:22 AM", "8:04 AM", "2:32 PM", "3:28 PM", "4:29 PM", "5:29 PM", "6:29 PM", "5:23 AM"] },
  { stop_id: "10162", name: "N Columbia &amp; Terminal 5 Access Rd", lat: 45.635397, lon: -122.769526, times: ["7:22 AM", "8:05 AM", "2:33 PM", "3:29 PM", "4:30 PM", "5:30 PM", "6:30 PM", "5:24 AM"] },
  { stop_id: "9460", name: "14500 Block N Columbia", lat: 45.630915, lon: -122.771994, times: ["7:23 AM", "8:05 AM", "2:33 PM", "3:29 PM", "4:30 PM", "5:30 PM", "6:31 PM", "5:25 AM"] },
  { stop_id: "9309", name: "N Columbia &amp; Ramsey", lat: 45.623461, lon: -122.771709, times: ["7:24 AM", "8:06 AM", "2:34 PM", "3:30 PM", "4:31 PM", "5:31 PM", "6:32 PM", "5:26 AM"] },
  { stop_id: "3541", name: "13200 Block N Columbia", lat: 45.61918, lon: -122.771495, times: ["7:25 AM", "8:07 AM", "2:35 PM", "3:31 PM", "4:32 PM", "5:32 PM", "6:32 PM", "5:26 AM"] },
  { stop_id: "13527", name: "N Columbia &amp; Lombard (Burgard)", lat: 45.61269, lon: -122.763, times: ["7:26 AM", "8:08 AM", "2:36 PM", "3:32 PM", "4:33 PM", "5:33 PM", "6:34 PM", "5:28 AM"] },
  { stop_id: "11849", name: "9500 Block N Columbia Blvd", lat: 45.608596, lon: -122.759341, times: ["7:27 AM", "8:09 AM", "2:37 PM", "3:33 PM", "4:34 PM", "5:34 PM", "6:34 PM", "5:28 AM"] },
  { stop_id: "11838", name: "N Columbia Blvd &amp; Hendricks", lat: 45.603875, lon: -122.750288, times: ["7:28 AM", "8:10 AM", "2:38 PM", "3:34 PM", "4:35 PM", "5:35 PM", "6:35 PM", "5:29 AM"] },
  { stop_id: "11833", name: "N Columbia Blvd &amp; Upland Dr", lat: 45.600459, lon: -122.742188, times: ["7:29 AM", "8:11 AM", "2:39 PM", "3:35 PM", "4:36 PM", "5:36 PM", "6:36 PM", "5:30 AM"] },
  { stop_id: "11834", name: "N Columbia Blvd &amp; Bank", lat: 45.596541, lon: -122.735873, times: ["7:30 AM", "8:12 AM", "2:40 PM", "3:36 PM", "4:37 PM", "5:37 PM", "6:37 PM", "5:31 AM"] },
  { stop_id: "11835", name: "N Columbia Blvd &amp; Oregonian", lat: 45.595234, lon: -122.732063, times: ["7:30 AM", "8:13 AM", "2:41 PM", "3:37 PM", "4:38 PM", "5:38 PM", "6:38 PM", "5:32 AM"] },
  { stop_id: "11836", name: "N Macrum &amp; Powers", lat: 45.59388, lon: -122.730509, times: ["7:31 AM", "8:13 AM", "2:41 PM", "3:37 PM", "4:38 PM", "5:38 PM", "6:38 PM", "5:32 AM"] },
  { stop_id: "1713", name: "N Fessenden &amp; Midway", lat: 45.593574, lon: -122.735233, times: ["7:32 AM", "8:14 AM", "2:42 PM", "3:38 PM", "4:39 PM", "5:39 PM", "6:39 PM", "5:33 AM"] },
  { stop_id: "1704", name: "N Fessenden &amp; Burr", lat: 45.594261, lon: -122.738157, times: ["7:32 AM", "8:14 AM", "2:43 PM", "3:39 PM", "4:39 PM", "5:39 PM", "6:39 PM", "5:33 AM"] },
  { stop_id: "1718", name: "N Fessenden &amp; Tioga", lat: 45.594926, lon: -122.740973, times: ["7:33 AM", "8:15 AM", "2:44 PM", "3:39 PM", "4:40 PM", "5:40 PM", "6:40 PM", "5:34 AM"] },
  { stop_id: "1698", name: "N Fessenden &amp; Allegheny", lat: 45.595632, lon: -122.743941, times: ["7:34 AM", "8:16 AM", "2:45 PM", "3:40 PM", "4:41 PM", "5:41 PM", "6:41 PM", "5:35 AM"] },
  { stop_id: "1715", name: "N Fessenden &amp; Richmond", lat: 45.596299, lon: -122.746822, times: ["7:34 AM", "8:16 AM", "2:46 PM", "3:41 PM", "4:42 PM", "5:42 PM", "6:41 PM", "5:35 AM"] },
  { stop_id: "13479", name: "N Fessenden &amp; Iris Way", lat: 45.596766, lon: -122.749011, times: ["7:35 AM", "8:17 AM", "2:46 PM", "3:42 PM", "4:43 PM", "5:43 PM", "6:42 PM", "5:36 AM"] },
  { stop_id: "5374", name: "N St Louis &amp; Seneca", lat: 45.595995, lon: -122.751518, times: ["7:36 AM", "8:18 AM", "2:47 PM", "3:43 PM", "4:44 PM", "5:44 PM", "6:43 PM", "5:36 AM"] },
  { stop_id: "5375", name: "N St Louis &amp; Smith", lat: 45.595023, lon: -122.753491, times: ["7:36 AM", "8:18 AM", "2:48 PM", "3:44 PM", "4:44 PM", "5:44 PM", "6:43 PM", "5:37 AM"] },
  { stop_id: "13876", name: "N St Louis &amp; Lombard", lat: 45.593068, lon: -122.757508, times: ["7:37 AM", "8:19 AM", "2:50 PM", "3:45 PM", "4:46 PM", "5:46 PM", "6:44 PM", "5:38 AM"] },
  { stop_id: "11935", name: "N Ivanhoe &amp; Chicago", lat: 45.59136, lon: -122.757363, times: ["7:38 AM", "8:20 AM", "2:51 PM", "3:47 PM", "4:47 PM", "5:47 PM", "6:45 PM", "5:39 AM"] },
  { stop_id: "11837", name: "N Ivanhoe &amp; Baltimore", lat: 45.59049, lon: -122.756535, times: ["7:39 AM", "8:21 AM", "2:51 PM", "3:47 PM", "4:47 PM", "5:47 PM", "6:46 PM", "5:39 AM"] },
  { stop_id: "3009", name: "N Ivanhoe &amp; Charleston", lat: 45.588681, lon: -122.752711, times: ["7:40 AM", "8:22 AM", "2:53 PM", "3:49 PM", "4:49 PM", "5:49 PM", "6:47 PM", "5:40 AM"] },
  { stop_id: "14215", name: "N Richmond &amp; Princeton", lat: 45.587387, lon: -122.75221, times: ["7:41 AM", "8:23 AM", "3:50 PM", "4:50 PM", "5:50 PM", "6:48 PM", "5:41 AM", "6:44 AM"] },
  { stop_id: "4818", name: "N Richmond &amp; Syracuse", lat: 45.587889, lon: -122.751884, times: ["2:54 PM"] },
]

    // Draw route polyline
    const polylineOut = L.polyline(shapeOutbound, { color: 'blue', weight: 4, opacity: 0.7 }).addTo(map);
    map.fitBounds(polylineOut.getBounds());

    // 1. Get current time in PT
    const nowPT = new Date(new Date().toLocaleString('en-US', { timeZone: 'America/Los_Angeles' }));
    const datePT = nowPT.toDateString();

    // 2. Add stops with highlighted next time
    stops.forEach(stop => {
      const stamps = stop.times.map(t => new Date(`${datePT} ${t}`));
      const nextIdx = stamps.findIndex(ts => ts > nowPT);
      const timesHtml = stamps.slice(0, 8).map((ts, i) => {
        const lbl = ts.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        return i === nextIdx ? `<strong>${lbl}</strong>` : lbl;
      }).join('<br>');

      L.circleMarker([stop.lat, stop.lon], {
        radius: 6,
        color: '#4dd0e1',
        fillColor: '#4dd0e1',
        fillOpacity: 0.9,
        weight: 1
      })
      .bindPopup(`<strong>${stop.name}</strong><br>${timesHtml || 'No scheduled times'}`)
      .addTo(map);
    });

    // Bus markers fetch
    let busMarkers = {};
    async function fetchAndDisplay() {
      const res = await fetch(`https://developer.trimet.org/ws/v2/vehicles?route=${routeNumber}&appID=${apiKey}&json=true`);
      const data = await res.json();
      const buses = (data.resultSet.vehicle || []).filter(v => v.routeNumber == routeNumber && v.direction == direction);

      Object.values(busMarkers).forEach(m => map.removeLayer(m));
      busMarkers = {};
      if (!buses.length) return;

      buses.forEach(bus => {
        if (!bus.latitude || !bus.longitude || !bus.blockID) return;
        const icon = L.divIcon({    
           className: '',
	   html: `
            <div style="text-align:center;">
              <div style="background:#0071CE;color:#fff;padding:2px 6px;border-radius:6px;font-weight:bold;">${bus.vehicleID}</div>
              <div style="width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-top:10px solid #00bfff;margin:auto;"></div>
            </div>
          `,
          iconSize: [40, 30], iconAnchor: [20, 30]
        });
        const marker = L.marker([bus.latitude, bus.longitude], { icon }).addTo(map);
        busMarkers[bus.vehicleID] = marker;
      });
    }
    fetchAndDisplay();
    setInterval(fetchAndDisplay, 15000);
  </script>

  <footer class="site-footer">
    <a href="terms.html">Terms of Use</a> &nbsp;|&nbsp;
    <a href="contact.html">Contact Us</a> &nbsp;|&nbsp;
    <a href="report.html">Report a Problem</a> &nbsp;|&nbsp;
    <a href="privacy.html">Privacy Policy</a>
  </footer>

  <script>
    if (!localStorage.getItem('cookieConsent')) {
      document.write(`
        <div id="cookie-banner" style="position: fixed; bottom: 0; left: 0; right: 0; background: #333; color: #fff; padding: 1rem; z-index: 1000; font-size: 0.9rem; line-height: 1.4; text-align: center; box-sizing: border-box;">
          üì¢ We use cookies to improve functionality and analyze traffic.
          By using MetroFeed, you agree to our 
          <a href='privacy.html' style='color: #4dd0e1; text-decoration: underline;'>Privacy Policy</a>.<br>
          <button onclick='localStorage.setItem("cookieConsent", "true"); document.getElementById("cookie-banner").remove();' style='margin-top: 0.5rem; background: #4dd0e1; color: #000; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer; font-weight: bold;'>OK</button>
        </div>
      `);
    }
  </script>
</body>
</html>