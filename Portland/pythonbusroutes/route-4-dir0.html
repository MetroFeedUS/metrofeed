<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Route 4 - To St Johns | MetroFeed Portland</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #0d0d0d;
      color: #cccccc;
      overflow-y: auto;
    }

    body {
      padding-top: 100px;
    }

    .ad-banner {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: #222;
      padding: 0.5rem 0;
      z-index: 1000;
      box-shadow: 0 2px 8px rgba(0,0,0,0.5);
      text-align: center;
    }

    .ad-banner img {
      max-width: 100%;
      height: auto;
      display: block;
      margin: 0 auto;
    }

    .home-button {
      position: fixed;
      top: 120px;
      left: 10px;
      background-color: #4dd0e1;
      color: #0d0d0d;
      padding: 0.5rem 1rem;
      font-weight: bold;
      border-radius: 8px;
      text-decoration: none;
      z-index: 1001;
      box-shadow: 0 0 10px #4dd0e1;
    }

    .home-button:hover {
      background-color: #00bcd4;
      color: #ffffff;
    }

    header {
      background-color: #0d0d0d;
      border-top: 4px solid #4dd0e1;
      border-bottom: 3px solid #4dd0e1;
      padding: 1rem;
      text-align: center;
    }

    header img {
      max-height: 60px;
    }

    h1 {
      text-align: center;
      margin: 1rem 0;
      font-size: 2rem;
      color: #f0f0f0;
    }

    .content-box {
      border-radius: 12px;
      padding: 0;
      margin: 0;
      background-color: #1e1e1e;
    }

    #map {
      width: 100%;
      height: 85vh;
      border: none;
      margin: 0 auto;
      display: block;
      border-radius: 8px;
    }

    .button-bar {
      display: flex;
      justify-content: center;
      margin: 1rem 0;
    }

    .button-bar a, .back-button {
      background: #4dd0e1;
      color: #0d0d0d;
      padding: 0.6rem 1.2rem;
      text-decoration: none;
      border-radius: 8px;
      font-weight: bold;
      border: none;
      cursor: pointer;
      box-shadow: 0 0 10px #4dd0e1;
    }

    .back-button:hover {
      background-color: #35c0d6;
    }

    .site-footer {
      text-align: center;
      margin-top: 3rem;
      margin-bottom: 120px;
      font-size: 0.85rem;
      color: #aaa;
    }

    .site-footer a {
      color: #00BFFF;
      text-decoration: none;
    }

    .site-footer a:hover {
      text-decoration: underline;
    }
  </style>
</head>

<body>
 
 <div class="ad-banner">
    <a href="advertise.html" target="_blank">
      <img src="assets/ad-placeholder.png" alt="Advertise Here">
    </a>
  </div>

 <header>
    <img src="MetroFeedPortlandLogo.png" alt="MetroFeed Portland">
  </header>

  <div class="disclaimer" style="margin: 1rem auto 0.5rem; max-width: 600px; font-size: 0.8rem; color: #bbb; text-align: center; padding: 0.5rem 1rem; background-color: #111; border: 1px dashed #444; border-radius: 6px;">
    ⚠️ This is a Beta program, work in progress. Please REPORT bugs and pretend to be impressed.
  </div>
  <div class="disclaimer" style="margin: 0 auto 1rem; max-width: 600px; font-size: 0.75rem; color: #888; text-align: center; padding: 0.25rem 1rem;">
    This tool is not affiliated with or endorsed by TriMet. For official schedules and service alerts, visit <a href="https://trimet.org" style="color:#4dd0e1;">trimet.org</a>.
  </div>

  <div style="margin: 2rem 0; text-align: center;">
    <button class="back-button" onclick="history.back()">Back</button>
  </div>

  <h1>Route 4 - To St Johns</h1>

  <div class="content-box">
    <div id="map"></div>
    <div style="text-align:right; font-size: 0.7rem; color: #777; margin-top: 0.5rem;">
      Data courtesy of TriMet.
    </div>
  </div>

  <script>
    if (document.referrer === "" && performance.navigation.type === 0) {
      window.location.href = "/index.html";
    }

    const apiKey = "2C4447D4A42083BCD84DE3B8E";
    const routeNumber = 4;
    const direction = parseInt(0);

    // Initialize map
    const map = L.map('map', {
      center: [45.6, -122.7],
      zoom: 12,
      minZoom: 12,
      maxZoom: 18,
      maxBounds: [[45.3, -123.1], [45.9, -122.3]],
      maxBoundsViscosity: 1.0
    });
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);

    // Injected shape & stop data
    const shapeOutbound = [
  [45.514747, -122.679568],
  [45.514768, -122.679648],
  [45.51479, -122.67973],
  [45.514799, -122.679765],
  [45.514821, -122.679848],
  [45.515038, -122.680662],
  [45.515057, -122.680734],
  [45.515072, -122.68079],
  [45.515744, -122.680426],
  [45.515808, -122.680391],
  [45.516359, -122.680124],
  [45.516423, -122.680091],
  [45.516492, -122.680049],
  [45.516963, -122.679796],
  [45.517036, -122.679756],
  [45.517087, -122.67973],
  [45.517171, -122.679685],
  [45.517691, -122.679401],
  [45.51775, -122.679367],
  [45.517829, -122.679321],
  [45.518361, -122.679025],
  [45.518406, -122.679004],
  [45.518432, -122.678987],
  [45.518466, -122.67897],
  [45.519024, -122.67868],
  [45.51907, -122.678655],
  [45.519096, -122.678641],
  [45.519151, -122.678611],
  [45.519656, -122.678345],
  [45.519751, -122.678297],
  [45.519811, -122.678266],
  [45.520283, -122.678006],
  [45.520361, -122.677963],
  [45.520421, -122.677932],
  [45.520477, -122.677904],
  [45.521016, -122.677604],
  [45.521084, -122.677569],
  [45.521685, -122.677242],
  [45.521751, -122.677205],
  [45.521828, -122.677162],
  [45.522399, -122.676848],
  [45.522446, -122.676775],
  [45.52291, -122.676527],
  [45.522939, -122.676511],
  [45.523003, -122.676486],
  [45.523068, -122.676468],
  [45.523122, -122.676459],
  [45.52319, -122.676451],
  [45.523722, -122.676473],
  [45.523777, -122.676474],
  [45.523839, -122.676474],
  [45.524491, -122.676497],
  [45.525135, -122.676527],
  [45.525203, -122.676534],
  [45.525206, -122.676508],
  [45.525222, -122.675623],
  [45.525224, -122.675507],
  [45.525224, -122.675481],
  [45.525242, -122.674483],
  [45.52526, -122.673462],
  [45.525261, -122.673355],
  [45.525275, -122.672598],
  [45.525275, -122.672572],
  [45.525276, -122.672471],
  [45.525277, -122.672349],
  [45.525287, -122.67187],
  [45.525294, -122.671672],
  [45.525301, -122.671576],
  [45.525314, -122.671457],
  [45.525324, -122.671403],
  [45.525343, -122.671324],
  [45.525365, -122.671238],
  [45.525392, -122.671156],
  [45.525407, -122.671111],
  [45.525427, -122.671063],
  [45.52545, -122.671014],
  [45.525482, -122.670958],
  [45.525515, -122.670909],
  [45.525554, -122.67086],
  [45.525582, -122.670829],
  [45.525619, -122.670794],
  [45.52566, -122.670759],
  [45.525729, -122.67071],
  [45.525774, -122.670689],
  [45.525825, -122.670674],
  [45.525884, -122.670662],
  [45.525945, -122.670655],
  [45.526016, -122.670656],
  [45.52607, -122.670663],
  [45.526291, -122.670722],
  [45.526372, -122.670752],
  [45.526407, -122.670758],
  [45.52645, -122.67076],
  [45.526493, -122.67076],
  [45.526536, -122.670756],
  [45.526604, -122.670734],
  [45.526638, -122.67072],
  [45.526671, -122.670702],
  [45.526716, -122.67067],
  [45.52675, -122.670644],
  [45.526785, -122.67061],
  [45.526829, -122.670557],
  [45.526873, -122.670494],
  [45.526904, -122.670434],
  [45.527335, -122.669479],
  [45.527667, -122.66877],
  [45.527963, -122.668126],
  [45.52806, -122.667916],
  [45.528164, -122.667724],
  [45.52834, -122.667407],
  [45.528488, -122.667091],
  [45.528534, -122.666987],
  [45.528559, -122.666926],
  [45.528585, -122.666845],
  [45.528614, -122.666741],
  [45.528627, -122.666676],
  [45.528639, -122.666585],
  [45.52865, -122.66648],
  [45.528655, -122.666408],
  [45.528657, -122.666372],
  [45.528661, -122.666257],
  [45.528662, -122.666015],
  [45.52866, -122.665857],
  [45.528661, -122.665755],
  [45.528741, -122.665758],
  [45.528992, -122.665759],
  [45.529088, -122.665767],
  [45.529148, -122.66578],
  [45.529192, -122.665794],
  [45.529239, -122.665819],
  [45.529314, -122.665836],
  [45.529388, -122.665864],
  [45.529436, -122.665896],
  [45.529483, -122.665837],
  [45.529518, -122.665801],
  [45.529572, -122.665766],
  [45.529666, -122.665741],
  [45.529794, -122.665729],
  [45.529881, -122.66573],
  [45.53002, -122.665731],
  [45.530089, -122.665732],
  [45.530161, -122.665732],
  [45.530204, -122.665732],
  [45.530255, -122.665732],
  [45.530669, -122.665728],
  [45.530704, -122.665728],
  [45.530794, -122.665782],
  [45.530903, -122.665785],
  [45.531704, -122.665782],
  [45.531788, -122.665785],
  [45.531836, -122.665789],
  [45.531894, -122.665798],
  [45.531959, -122.66581],
  [45.53204, -122.665837],
  [45.532111, -122.665862],
  [45.532185, -122.665906],
  [45.532254, -122.665948],
  [45.532328, -122.665994],
  [45.532413, -122.666056],
  [45.532476, -122.66611],
  [45.532547, -122.666177],
  [45.532614, -122.666252],
  [45.532689, -122.666342],
  [45.532904, -122.66661],
  [45.533051, -122.666744],
  [45.533322, -122.666746],
  [45.534239, -122.666736],
  [45.534301, -122.666736],
  [45.534382, -122.666741],
  [45.534415, -122.666743],
  [45.534449, -122.666746],
  [45.534648, -122.666752],
  [45.535016, -122.666748],
  [45.535076, -122.666748],
  [45.535101, -122.666749],
  [45.53516, -122.666732],
  [45.535172, -122.666729],
  [45.535618, -122.66673],
  [45.53581, -122.666727],
  [45.536154, -122.666721],
  [45.536427, -122.666718],
  [45.536513, -122.666722],
  [45.536597, -122.666726],
  [45.537077, -122.66672],
  [45.538048, -122.666713],
  [45.538333, -122.666711],
  [45.539003, -122.666707],
  [45.539588, -122.666702],
  [45.539968, -122.6667],
  [45.540437, -122.666697],
  [45.540548, -122.666697],
  [45.540981, -122.666694],
  [45.541056, -122.666694],
  [45.541358, -122.666692],
  [45.541899, -122.666688],
  [45.542312, -122.666684],
  [45.542413, -122.66666],
  [45.542568, -122.66664],
  [45.542733, -122.666638],
  [45.54276, -122.666638],
  [45.542859, -122.666635],
  [45.54308, -122.66664],
  [45.543198, -122.666657],
  [45.543273, -122.66668],
  [45.543707, -122.666678],
  [45.543789, -122.666676],
  [45.543928, -122.666672],
  [45.544439, -122.666669],
  [45.544633, -122.666668],
  [45.544703, -122.666668],
  [45.545355, -122.66667],
  [45.546069, -122.666672],
  [45.546789, -122.666678],
  [45.546977, -122.666678],
  [45.547459, -122.666677],
  [45.547501, -122.666678],
  [45.548171, -122.666686],
  [45.54819, -122.666686],
  [45.548261, -122.666686],
  [45.548261, -122.666773],
  [45.54826, -122.667282],
  [45.548258, -122.667931],
  [45.548258, -122.668052],
  [45.548261, -122.668884],
  [45.548261, -122.668909],
  [45.54826, -122.669057],
  [45.54826, -122.669738],
  [45.548261, -122.670146],
  [45.548261, -122.670727],
  [45.548262, -122.671242],
  [45.548262, -122.671794],
  [45.548262, -122.672045],
  [45.548262, -122.67206],
  [45.548262, -122.672166],
  [45.548261, -122.67223],
  [45.548249, -122.672344],
  [45.548241, -122.6725],
  [45.548239, -122.672884],
  [45.548238, -122.673273],
  [45.548235, -122.673338],
  [45.548225, -122.67339],
  [45.548219, -122.673429],
  [45.548196, -122.673488],
  [45.548172, -122.673543],
  [45.547995, -122.673849],
  [45.547952, -122.673931],
  [45.547916, -122.674012],
  [45.547895, -122.674074],
  [45.547871, -122.674163],
  [45.547854, -122.674249],
  [45.547842, -122.674321],
  [45.547832, -122.674399],
  [45.547826, -122.674515],
  [45.547825, -122.67459],
  [45.547826, -122.674675],
  [45.547825, -122.674786],
  [45.547825, -122.675028],
  [45.547825, -122.67557],
  [45.547901, -122.675569],
  [45.548221, -122.675565],
  [45.549465, -122.675556],
  [45.549517, -122.675555],
  [45.549585, -122.675554],
  [45.549642, -122.675553],
  [45.550009, -122.675551],
  [45.550728, -122.675545],
  [45.550771, -122.675544],
  [45.550842, -122.675544],
  [45.550904, -122.675544],
  [45.551274, -122.675542],
  [45.552101, -122.675536],
  [45.553366, -122.675526],
  [45.55369, -122.675523],
  [45.554623, -122.675515],
  [45.554695, -122.675516],
  [45.554842, -122.675514],
  [45.555109, -122.675512],
  [45.555188, -122.675469],
  [45.555336, -122.675468],
  [45.555387, -122.67546],
  [45.555423, -122.675442],
  [45.555473, -122.675411],
  [45.555496, -122.675386],
  [45.555544, -122.675326],
  [45.555742, -122.675045],
  [45.555797, -122.674973],
  [45.555831, -122.674941],
  [45.555877, -122.674917],
  [45.555999, -122.674918],
  [45.556109, -122.674955],
  [45.556885, -122.674947],
  [45.557071, -122.674946],
  [45.558187, -122.674939],
  [45.558214, -122.67494],
  [45.558236, -122.674946],
  [45.558303, -122.674993],
  [45.558341, -122.675008],
  [45.558381, -122.675014],
  [45.55843, -122.675015],
  [45.558896, -122.67501],
  [45.559006, -122.675009],
  [45.559073, -122.675008],
  [45.559722, -122.675003],
  [45.560437, -122.674996],
  [45.561147, -122.674989],
  [45.561874, -122.674981],
  [45.56261, -122.674975],
  [45.562681, -122.674972],
  [45.562759, -122.674968],
  [45.562957, -122.674964],
  [45.563105, -122.674961],
  [45.56329, -122.674961],
  [45.56342, -122.674956],
  [45.563515, -122.674958],
  [45.563629, -122.674957],
  [45.564114, -122.674946],
  [45.564804, -122.67494],
  [45.565536, -122.674931],
  [45.566128, -122.674925],
  [45.56618, -122.674921],
  [45.566251, -122.674908],
  [45.566284, -122.674906],
  [45.566325, -122.674907],
  [45.566413, -122.674918],
  [45.566508, -122.674929],
  [45.566579, -122.674925],
  [45.566636, -122.674919],
  [45.566663, -122.674916],
  [45.567583, -122.674906],
  [45.568442, -122.674895],
  [45.569077, -122.674887],
  [45.569826, -122.674879],
  [45.569924, -122.674878],
  [45.570041, -122.674876],
  [45.570319, -122.674873],
  [45.570954, -122.674867],
  [45.571672, -122.67486],
  [45.571749, -122.674859],
  [45.572157, -122.674855],
  [45.573296, -122.674838],
  [45.573385, -122.674837],
  [45.573921, -122.674835],
  [45.574436, -122.674824],
  [45.574816, -122.674823],
  [45.575048, -122.67482],
  [45.575121, -122.674819],
  [45.575583, -122.674814],
  [45.575807, -122.674808],
  [45.576494, -122.674801],
  [45.57687, -122.674798],
  [45.577208, -122.674795],
  [45.577207, -122.674902],
  [45.577207, -122.676183],
  [45.577207, -122.676336],
  [45.577208, -122.677042],
  [45.577208, -122.677508],
  [45.577208, -122.678207],
  [45.577199, -122.679041],
  [45.577185, -122.679738],
  [45.577181, -122.679821],
  [45.577176, -122.679985],
  [45.57717, -122.680219],
  [45.577208, -122.680323],
  [45.577195, -122.680832],
  [45.577184, -122.681257],
  [45.577181, -122.681387],
  [45.577176, -122.681628],
  [45.577171, -122.681856],
  [45.57713, -122.681979],
  [45.577129, -122.68207],
  [45.577129, -122.682126],
  [45.577128, -122.682207],
  [45.577127, -122.682308],
  [45.577126, -122.682692],
  [45.577126, -122.682701],
  [45.577125, -122.683217],
  [45.577113, -122.684227],
  [45.577113, -122.684744],
  [45.577113, -122.684828],
  [45.577117, -122.685248],
  [45.577118, -122.685371],
  [45.577124, -122.685797],
  [45.577125, -122.686285],
  [45.577126, -122.686583],
  [45.577126, -122.686766],
  [45.577125, -122.686908],
  [45.577161, -122.686897],
  [45.577207, -122.686891],
  [45.578035, -122.686891],
  [45.578113, -122.686891],
  [45.578826, -122.686889],
  [45.579538, -122.686891],
  [45.580251, -122.686892],
  [45.580963, -122.686896],
  [45.581031, -122.686897],
  [45.581185, -122.686896],
  [45.581674, -122.686896],
  [45.582316, -122.686897],
  [45.582389, -122.686896],
  [45.582389, -122.687028],
  [45.58239, -122.687298],
  [45.582393, -122.687788],
  [45.582398, -122.68887],
  [45.582399, -122.689044],
  [45.582406, -122.692094],
  [45.582644, -122.692357],
  [45.582695, -122.692428],
  [45.582704, -122.694814],
  [45.582708, -122.696988],
  [45.582708, -122.697119],
  [45.582668, -122.697226],
  [45.582806, -122.697221],
  [45.582868, -122.697216],
  [45.582923, -122.697212],
  [45.583123, -122.697211],
  [45.583325, -122.697211],
  [45.583786, -122.697207],
  [45.583997, -122.697205],
  [45.583998, -122.697644],
  [45.583998, -122.697869],
  [45.583999, -122.698484],
  [45.584, -122.699465],
  [45.584033, -122.699577],
  [45.584037, -122.699901],
  [45.584038, -122.700028],
  [45.584033, -122.700324],
  [45.584032, -122.700336],
  [45.584003, -122.70044],
  [45.584004, -122.701416],
  [45.584006, -122.701857],
  [45.584007, -122.702395],
  [45.584006, -122.702658],
  [45.584006, -122.702763],
  [45.584006, -122.703287],
  [45.584006, -122.70337],
  [45.584007, -122.703456],
  [45.584007, -122.704342],
  [45.584008, -122.705342],
  [45.584008, -122.705596],
  [45.584009, -122.706168],
  [45.58401, -122.706589],
  [45.584012, -122.707],
  [45.584012, -122.707182],
  [45.584014, -122.70766],
  [45.584015, -122.707922],
  [45.584142, -122.707927],
  [45.584419, -122.707921],
  [45.584512, -122.707919],
  [45.584697, -122.707912],
  [45.584768, -122.707902],
  [45.584848, -122.70789],
  [45.584919, -122.707877],
  [45.584945, -122.707869],
  [45.584989, -122.707854],
  [45.585074, -122.70782],
  [45.585156, -122.70778],
  [45.585203, -122.707751],
  [45.585317, -122.707666],
  [45.585399, -122.707592],
  [45.585482, -122.7075],
  [45.58556, -122.707405],
  [45.585871, -122.706958],
  [45.585933, -122.70687],
  [45.58646, -122.706102],
  [45.5866, -122.70591],
  [45.586672, -122.705822],
  [45.586735, -122.705756],
  [45.586808, -122.705688],
  [45.58689, -122.705616],
  [45.586982, -122.705553],
  [45.587071, -122.7055],
  [45.587161, -122.70546],
  [45.587216, -122.70544],
  [45.58729, -122.705418],
  [45.587387, -122.705398],
  [45.587472, -122.705394],
  [45.587708, -122.70538],
  [45.58774, -122.705378],
  [45.587803, -122.705385],
  [45.587812, -122.707035],
  [45.587814, -122.707734],
  [45.587815, -122.707878],
  [45.587818, -122.708668],
  [45.587818, -122.708699],
  [45.58782, -122.709209],
  [45.587824, -122.7101],
  [45.587824, -122.710217],
  [45.587825, -122.710268],
  [45.587831, -122.710363],
  [45.587846, -122.710459],
  [45.587867, -122.71054],
  [45.587892, -122.710625],
  [45.587911, -122.710675],
  [45.587924, -122.710704],
  [45.587959, -122.71077],
  [45.587993, -122.710823],
  [45.588038, -122.710888],
  [45.588282, -122.711168],
  [45.588575, -122.711474],
  [45.588604, -122.711514],
  [45.588624, -122.711553],
  [45.588634, -122.711599],
  [45.588638, -122.711654],
  [45.588637, -122.711883],
  [45.588636, -122.712335],
  [45.588635, -122.712615],
  [45.588646, -122.713299],
  [45.588649, -122.713415],
  [45.588651, -122.713519],
  [45.58866, -122.714486],
  [45.588659, -122.715479],
  [45.588659, -122.715524],
  [45.58866, -122.715627],
  [45.58867, -122.716881],
  [45.588817, -122.716879],
  [45.58966, -122.71687],
  [45.591192, -122.716851],
  [45.591197, -122.717508],
  [45.591199, -122.717755],
  [45.5912, -122.717895],
  [45.591203, -122.718996],
  [45.591208, -122.720006],
  [45.591215, -122.720875],
  [45.591215, -122.720894],
  [45.591221, -122.721055],
  [45.591226, -122.721222],
  [45.591229, -122.722106],
  [45.591235, -122.723015],
  [45.591236, -122.723131],
  [45.591241, -122.72414],
  [45.591241, -122.724199],
  [45.591241, -122.724256],
  [45.591247, -122.725272],
  [45.591249, -122.725758],
  [45.591251, -122.726242],
  [45.591258, -122.726332],
  [45.591267, -122.726405],
  [45.591282, -122.726478],
  [45.591346, -122.72673],
  [45.591445, -122.72712],
  [45.591479, -122.727258],
  [45.591626, -122.727843],
  [45.591685, -122.728107],
  [45.591709, -122.728211],
  [45.591832, -122.728734],
  [45.591997, -122.729389],
  [45.59224, -122.730353],
  [45.592355, -122.7308],
  [45.592361, -122.730822],
  [45.59251, -122.731407],
  [45.59266, -122.732002],
  [45.592786, -122.73248],
  [45.592836, -122.732693],
  [45.59289, -122.732919],
  [45.59326, -122.734334],
  [45.593415, -122.734938],
  [45.593494, -122.735271],
  [45.59353, -122.735424],
  [45.593757, -122.736377],
  [45.593989, -122.737346],
  [45.594189, -122.738191],
  [45.594216, -122.738306],
  [45.594236, -122.738392],
  [45.594438, -122.739273],
  [45.59466, -122.740234],
  [45.594846, -122.741012],
  [45.59489, -122.741199],
  [45.595121, -122.742181],
  [45.595346, -122.743125],
  [45.595551, -122.743978],
  [45.595578, -122.744095],
  [45.595804, -122.745048],
  [45.595918, -122.745529],
  [45.596031, -122.74601],
  [45.596163, -122.746558],
  [45.596234, -122.746856],
  [45.596263, -122.746976],
  [45.59649, -122.747934],
  [45.596618, -122.748479],
  [45.596644, -122.748608],
  [45.59666, -122.748695],
  [45.596675, -122.74881],
  [45.596687, -122.748933],
  [45.596692, -122.74902],
  [45.596693, -122.749046],
  [45.596697, -122.749172],
  [45.596696, -122.749297],
  [45.596689, -122.749403],
  [45.596675, -122.749541],
  [45.596657, -122.749684],
  [45.596635, -122.749806],
  [45.596608, -122.749924],
  [45.596571, -122.750064],
  [45.596534, -122.750178],
  [45.596498, -122.750277],
  [45.59646, -122.750367],
  [45.596372, -122.750556],
  [45.595933, -122.751458],
  [45.595869, -122.751589],
  [45.59578, -122.751772],
  [45.595397, -122.752562],
  [45.595148, -122.753071],
  [45.594969, -122.753438],
  [45.594951, -122.753474],
  [45.594464, -122.754473],
  [45.594449, -122.754505],
  [45.593981, -122.755467],
  [45.593739, -122.755965],
  [45.593348, -122.756767],
  [45.593153, -122.757168],
  [45.592989, -122.757498],
  [45.592937, -122.757572],
  [45.592853, -122.757493],
  [45.592793, -122.757435],
  [45.592411, -122.757065],
  [45.592329, -122.756986],
  [45.591838, -122.756512],
  [45.591719, -122.756397],
  [45.591525, -122.756206],
  [45.591318, -122.756008],
  [45.591137, -122.755834],
  [45.590541, -122.755248],
  [45.590348, -122.755072],
  [45.590309, -122.755026],
  [45.590282, -122.754987],
  [45.590251, -122.754922],
  [45.590229, -122.754865],
  [45.590195, -122.754762],
  [45.590175, -122.7547],
  [45.590109, -122.754499],
  [45.590083, -122.754423],
  [45.589899, -122.753847],
  [45.589604, -122.752926],
  [45.589306, -122.752002],
  [45.58925, -122.751816],
  [45.589212, -122.751768],
  [45.589201, -122.751753],
  [45.589016, -122.751173],
  [45.588992, -122.751063],
  [45.588943, -122.751098],
  [45.588757, -122.751223],
  [45.588596, -122.751322],
  [45.588533, -122.751352],
  [45.588419, -122.751421],
  [45.588345, -122.75147],
  [45.588203, -122.751565],
  [45.587985, -122.751721],
  [45.587862, -122.751804]
];

const stopNames = {
  "43": "N Alaska &amp; Chautauqua Pl",
  "45": "N Alaska &amp; University Park",
  "71": "N Albina &amp; Ainsworth",
  "73": "N Albina &amp; Alberta",
  "76": "N Albina &amp; Blandena",
  "78": "N Albina &amp; Bryant",
  "80": "N Albina &amp; Buffalo",
  "82": "N Albina &amp; Dekum",
  "88": "N Albina &amp; Killingsworth",
  "91": "N Albina &amp; Rosa Parks Way",
  "93": "N Albina &amp; Lombard St",
  "1045": "N Chautauqua &amp; Washburne",
  "1047": "N Chautauqua &amp; Alaska",
  "1097": "Rose Quarter Transit Center",
  "1303": "N Denver &amp; Watts",
  "1612": "NW Everett &amp; 2nd",
  "1698": "N Fessenden &amp; Allegheny",
  "1700": "N Fessenden &amp; Berkeley",
  "1704": "N Fessenden &amp; Burr",
  "1711": "Fessenden &amp; Macrum",
  "1713": "N Fessenden &amp; Midway",
  "1715": "N Fessenden &amp; Richmond",
  "1718": "N Fessenden &amp; Tioga",
  "1719": "N Fessenden &amp; Portsmouth",
  "1721": "N Fessenden &amp; Van Houten",
  "1723": "N Fessenden &amp; Wall",
  "1841": "N Fremont &amp; Gantenbein",
  "1843": "N Fremont &amp; Albina",
  "2315": "N Halleck &amp; Delaware",
  "2317": "N Halleck &amp; Peninsular",
  "3218": "N Kilpatrick &amp; Brandon",
  "3221": "N Kilpatrick &amp; Denver",
  "3465": "N Lombard &amp; Burlington",
  "3474": "N Lombard &amp; Charleston",
  "3485": "N Lombard &amp; Denver",
  "3507": "N Lombard Transit Center",
  "3521": "N Lombard &amp; Mississippi",
  "3955": "N Mississippi &amp; Beech",
  "3958": "N Mississippi &amp; Failing",
  "3966": "N Mississippi &amp; Mason",
  "3976": "N Mississippi &amp; Skidmore",
  "4818": "N Richmond &amp; Syracuse",
  "5374": "N St Louis &amp; Seneca",
  "5375": "N St Louis &amp; Smith",
  "5862": "N Trenton &amp; Alaska",
  "6354": "N Williams &amp; NE Russell",
  "6357": "N Williams &amp; NE Broadway",
  "6359": "N Williams &amp; NE Cook",
  "6362": "N Williams &amp; NE Graham",
  "6364": "N Williams &amp; NE Morris",
  "6370": "N Williams &amp; NE Tillamook",
  "6373": "N Willis &amp; Bayard",
  "6378": "N Willis &amp; Wabash",
  "6384": "N Willis &amp; Peninsular",
  "6387": "N Willis &amp; Washburne",
  "7751": "SW 6th &amp; W Burnside",
  "7789": "SW 6th &amp; Salmon",
  "7803": "SW 6th &amp; Washington",
  "8886": "NW Everett &amp; 5th",
  "9505": "N Lombard &amp; New York",
  "10611": "N Willis &amp; Chautauqua",
  "10650": "N Fremont &amp; Kerby",
  "11480": "N Williams &amp; NE Weidler",
  "12725": "N Fessenden &amp; Haven",
  "12727": "N Trenton &amp; Newman",
  "12791": "SW Jefferson &amp; 5th",
  "13479": "N Fessenden &amp; Iris Way"
};

const stops = [
  { stop_id: "12791", name: "SW Jefferson &amp; 5th", lat: 45.514806, lon: -122.679535, times: ["6:10 AM", "6:25 AM", "6:40 AM", "6:55 AM", "7:10 AM", "7:25 AM", "7:40 AM", "7:55 AM"] },
  { stop_id: "7789", name: "SW 6th &amp; Salmon", lat: 45.516934, lon: -122.679687, times: ["6:12 AM", "6:27 AM", "6:42 AM", "6:57 AM", "7:12 AM", "7:27 AM", "7:42 AM", "7:57 AM"] },
  { stop_id: "7803", name: "SW 6th &amp; Washington", lat: 45.520244, lon: -122.677859, times: ["6:13 AM", "6:28 AM", "6:43 AM", "6:58 AM", "7:13 AM", "7:28 AM", "7:43 AM", "7:58 AM"] },
  { stop_id: "7751", name: "SW 6th &amp; W Burnside", lat: 45.52288, lon: -122.676415, times: ["5:59 AM", "6:14 AM", "6:30 AM", "6:45 AM", "7:00 AM", "7:15 AM", "7:30 AM", "7:45 AM"] },
  { stop_id: "8886", name: "NW Everett &amp; 5th", lat: 45.525182, lon: -122.675622, times: ["6:01 AM", "6:16 AM", "6:31 AM", "6:46 AM", "7:01 AM", "7:16 AM", "7:31 AM", "7:46 AM"] },
  { stop_id: "1612", name: "NW Everett &amp; 2nd", lat: 45.525237, lon: -122.672587, times: ["6:02 AM", "6:17 AM", "6:32 AM", "6:47 AM", "7:02 AM", "7:17 AM", "7:32 AM", "7:47 AM"] },
  { stop_id: "1097", name: "Rose Quarter Transit Center", lat: 45.530669, lon: -122.665646, times: ["6:06 AM", "6:21 AM", "6:37 AM", "6:52 AM", "7:07 AM", "7:22 AM", "7:37 AM", "7:52 AM"] },
  { stop_id: "11480", name: "N Williams &amp; NE Weidler", lat: 45.534238, lon: -122.666586, times: ["6:07 AM", "6:22 AM", "6:38 AM", "6:53 AM", "7:08 AM", "7:23 AM", "7:38 AM", "7:53 AM"] },
  { stop_id: "6357", name: "N Williams &amp; NE Broadway", lat: 45.535809, lon: -122.666638, times: ["6:07 AM", "6:22 AM", "6:38 AM", "6:53 AM", "7:08 AM", "7:23 AM", "7:38 AM", "7:53 AM"] },
  { stop_id: "6370", name: "N Williams &amp; NE Tillamook", lat: 45.538333, lon: -122.666614, times: ["6:08 AM", "6:23 AM", "6:39 AM", "6:54 AM", "7:09 AM", "7:24 AM", "7:39 AM", "7:54 AM"] },
  { stop_id: "6354", name: "N Williams &amp; NE Russell", lat: 45.541358, lon: -122.666587, times: ["6:09 AM", "6:24 AM", "6:40 AM", "6:55 AM", "7:10 AM", "7:25 AM", "7:40 AM", "7:55 AM"] },
  { stop_id: "6362", name: "N Williams &amp; NE Graham", lat: 45.542733, lon: -122.666571, times: ["6:10 AM", "6:25 AM", "6:41 AM", "6:56 AM", "7:11 AM", "7:26 AM", "7:41 AM", "7:56 AM"] },
  { stop_id: "6364", name: "N Williams &amp; NE Morris", lat: 45.544439, lon: -122.666542, times: ["6:10 AM", "6:25 AM", "6:41 AM", "6:56 AM", "7:11 AM", "7:26 AM", "7:41 AM", "7:56 AM"] },
  { stop_id: "6359", name: "N Williams &amp; NE Cook", lat: 45.546972, lon: -122.666597, times: ["6:11 AM", "6:26 AM", "6:42 AM", "6:57 AM", "7:12 AM", "7:27 AM", "7:42 AM", "7:57 AM"] },
  { stop_id: "1841", name: "N Fremont &amp; Gantenbein", lat: 45.548311, lon: -122.668909, times: ["6:12 AM", "6:27 AM", "6:43 AM", "6:58 AM", "7:13 AM", "7:28 AM", "7:43 AM", "7:58 AM"] },
  { stop_id: "10650", name: "N Fremont &amp; Kerby", lat: 45.548323, lon: -122.67206, times: ["6:13 AM", "6:28 AM", "6:44 AM", "6:59 AM", "7:14 AM", "7:29 AM", "7:44 AM", "7:59 AM"] },
  { stop_id: "1843", name: "N Fremont &amp; Albina", lat: 45.547886, lon: -122.674787, times: ["6:13 AM", "6:28 AM", "6:44 AM", "6:59 AM", "7:15 AM", "7:30 AM", "7:45 AM", "8:00 AM"] },
  { stop_id: "3955", name: "N Mississippi &amp; Beech", lat: 45.549466, lon: -122.675464, times: ["6:14 AM", "6:29 AM", "6:45 AM", "7:00 AM", "7:16 AM", "7:31 AM", "7:46 AM", "8:01 AM"] },
  { stop_id: "3958", name: "N Mississippi &amp; Failing", lat: 45.550727, lon: -122.675444, times: ["6:14 AM", "6:29 AM", "6:45 AM", "7:00 AM", "7:16 AM", "7:31 AM", "7:46 AM", "8:01 AM"] },
  { stop_id: "3966", name: "N Mississippi &amp; Mason", lat: 45.553686, lon: -122.675446, times: ["6:15 AM", "6:30 AM", "6:46 AM", "7:01 AM", "7:17 AM", "7:32 AM", "7:47 AM", "8:02 AM"] },
  { stop_id: "3976", name: "N Mississippi &amp; Skidmore", lat: 45.554842, lon: -122.675423, times: ["6:16 AM", "6:31 AM", "6:47 AM", "7:02 AM", "7:18 AM", "7:33 AM", "7:48 AM", "8:03 AM"] },
  { stop_id: "76", name: "N Albina &amp; Blandena", lat: 45.557073, lon: -122.674851, times: ["6:17 AM", "6:32 AM", "6:48 AM", "7:03 AM", "7:18 AM", "7:33 AM", "7:48 AM", "8:03 AM"] },
  { stop_id: "73", name: "N Albina &amp; Alberta", lat: 45.558897, lon: -122.674919, times: ["6:17 AM", "6:32 AM", "6:48 AM", "7:03 AM", "7:19 AM", "7:34 AM", "7:49 AM", "8:04 AM"] },
  { stop_id: "88", name: "N Albina &amp; Killingsworth", lat: 45.562956, lon: -122.674874, times: ["6:19 AM", "6:34 AM", "6:50 AM", "7:05 AM", "7:21 AM", "7:36 AM", "7:51 AM", "8:06 AM"] },
  { stop_id: "71", name: "N Albina &amp; Ainsworth", lat: 45.566631, lon: -122.674812, times: ["6:00 AM", "6:20 AM", "6:35 AM", "6:51 AM", "7:06 AM", "7:22 AM", "7:37 AM", "7:52 AM"] },
  { stop_id: "91", name: "N Albina &amp; Rosa Parks Way", lat: 45.570318, lon: -122.674768, times: ["6:01 AM", "6:21 AM", "6:36 AM", "6:52 AM", "7:07 AM", "7:23 AM", "7:38 AM", "7:53 AM"] },
  { stop_id: "82", name: "N Albina &amp; Dekum", lat: 45.571672, lon: -122.674756, times: ["6:01 AM", "6:21 AM", "6:36 AM", "6:52 AM", "7:07 AM", "7:23 AM", "7:38 AM", "7:53 AM"] },
  { stop_id: "78", name: "N Albina &amp; Bryant", lat: 45.573291, lon: -122.674735, times: ["6:02 AM", "6:22 AM", "6:37 AM", "6:53 AM", "7:08 AM", "7:24 AM", "7:39 AM", "7:54 AM"] },
  { stop_id: "80", name: "N Albina &amp; Buffalo", lat: 45.575048, lon: -122.674715, times: ["6:02 AM", "6:22 AM", "6:37 AM", "6:53 AM", "7:08 AM", "7:24 AM", "7:39 AM", "7:54 AM"] },
  { stop_id: "93", name: "N Albina &amp; Lombard St", lat: 45.576869, lon: -122.674693, times: ["6:03 AM", "6:23 AM", "6:38 AM", "6:54 AM", "7:09 AM", "7:25 AM", "7:40 AM", "7:55 AM"] },
  { stop_id: "3521", name: "N Lombard &amp; Mississippi", lat: 45.577282, lon: -122.676171, times: ["6:03 AM", "6:23 AM", "6:38 AM", "6:54 AM", "7:09 AM", "7:25 AM", "7:40 AM", "7:55 AM"] },
  { stop_id: "3507", name: "N Lombard Transit Center", lat: 45.577232, lon: -122.682701, times: ["6:05 AM", "6:25 AM", "6:40 AM", "6:56 AM", "7:11 AM", "7:27 AM", "7:42 AM", "7:57 AM"] },
  { stop_id: "3485", name: "N Lombard &amp; Denver", lat: 45.577202, lon: -122.686582, times: ["6:05 AM", "6:25 AM", "6:40 AM", "6:56 AM", "7:11 AM", "7:27 AM", "7:42 AM", "7:57 AM"] },
  { stop_id: "1303", name: "N Denver &amp; Watts", lat: 45.581185, lon: -122.686774, times: ["6:06 AM", "6:26 AM", "6:41 AM", "6:57 AM", "7:12 AM", "7:29 AM", "7:44 AM", "7:59 AM"] },
  { stop_id: "3221", name: "N Kilpatrick &amp; Denver", lat: 45.582447, lon: -122.687298, times: ["6:07 AM", "6:27 AM", "6:42 AM", "6:58 AM", "7:13 AM", "7:29 AM", "7:44 AM", "7:59 AM"] },
  { stop_id: "3218", name: "N Kilpatrick &amp; Brandon", lat: 45.582459, lon: -122.68887, times: ["6:07 AM", "6:27 AM", "6:42 AM", "6:58 AM", "7:13 AM", "7:29 AM", "7:45 AM", "8:00 AM"] },
  { stop_id: "2315", name: "N Halleck &amp; Delaware", lat: 45.582691, lon: -122.692288, times: ["6:08 AM", "6:28 AM", "6:43 AM", "6:59 AM", "7:14 AM", "7:30 AM", "7:45 AM", "8:00 AM"] },
  { stop_id: "2317", name: "N Halleck &amp; Peninsular", lat: 45.582772, lon: -122.696988, times: ["6:09 AM", "6:29 AM", "6:44 AM", "7:00 AM", "7:15 AM", "7:31 AM", "7:46 AM", "8:01 AM"] },
  { stop_id: "6384", name: "N Willis &amp; Peninsular", lat: 45.584058, lon: -122.697643, times: ["6:09 AM", "6:29 AM", "6:44 AM", "7:00 AM", "7:15 AM", "7:32 AM", "7:47 AM", "8:02 AM"] },
  { stop_id: "6373", name: "N Willis &amp; Bayard", lat: 45.584085, lon: -122.700326, times: ["6:10 AM", "6:30 AM", "6:45 AM", "7:01 AM", "7:16 AM", "7:32 AM", "7:48 AM", "8:03 AM"] },
  { stop_id: "6378", name: "N Willis &amp; Wabash", lat: 45.584067, lon: -122.702762, times: ["6:10 AM", "6:30 AM", "6:45 AM", "7:01 AM", "7:16 AM", "7:33 AM", "7:48 AM", "8:03 AM"] },
  { stop_id: "6387", name: "N Willis &amp; Washburne", lat: 45.584071, lon: -122.705598, times: ["6:11 AM", "6:31 AM", "6:46 AM", "7:02 AM", "7:17 AM", "7:33 AM", "7:49 AM", "8:04 AM"] },
  { stop_id: "10611", name: "N Willis &amp; Chautauqua", lat: 45.584101, lon: -122.707659, times: ["6:11 AM", "6:31 AM", "6:46 AM", "7:02 AM", "7:17 AM", "7:34 AM", "7:49 AM", "8:04 AM"] },
  { stop_id: "1045", name: "N Chautauqua &amp; Washburne", lat: 45.585828, lon: -122.706898, times: ["6:12 AM", "6:32 AM", "6:47 AM", "7:03 AM", "7:18 AM", "7:35 AM", "7:50 AM", "8:05 AM"] },
  { stop_id: "1047", name: "N Chautauqua &amp; Alaska", lat: 45.587706, lon: -122.705298, times: ["6:13 AM", "6:33 AM", "6:48 AM", "7:04 AM", "7:19 AM", "7:35 AM", "7:51 AM", "8:06 AM"] },
  { stop_id: "43", name: "N Alaska &amp; Chautauqua Pl", lat: 45.587877, lon: -122.707734, times: ["6:13 AM", "6:33 AM", "6:48 AM", "7:04 AM", "7:19 AM", "7:36 AM", "7:51 AM", "8:06 AM"] },
  { stop_id: "45", name: "N Alaska &amp; University Park", lat: 45.587885, lon: -122.710217, times: ["6:14 AM", "6:34 AM", "6:49 AM", "7:05 AM", "7:20 AM", "7:36 AM", "7:52 AM", "8:07 AM"] },
  { stop_id: "5862", name: "N Trenton &amp; Alaska", lat: 45.588698, lon: -122.711875, times: ["6:14 AM", "6:34 AM", "6:49 AM", "7:05 AM", "7:20 AM", "7:37 AM", "7:52 AM", "8:07 AM"] },
  { stop_id: "12727", name: "N Trenton &amp; Newman", lat: 45.588703, lon: -122.71548, times: ["6:15 AM", "6:35 AM", "6:50 AM", "7:06 AM", "7:21 AM", "7:37 AM", "7:53 AM", "8:08 AM"] },
  { stop_id: "12725", name: "N Fessenden &amp; Haven", lat: 45.591233, lon: -122.717753, times: ["6:16 AM", "6:36 AM", "6:51 AM", "7:07 AM", "7:22 AM", "7:39 AM", "7:55 AM", "8:10 AM"] },
  { stop_id: "1719", name: "N Fessenden &amp; Portsmouth", lat: 45.591274, lon: -122.720873, times: ["6:16 AM", "6:36 AM", "6:51 AM", "7:07 AM", "7:22 AM", "7:39 AM", "7:55 AM", "8:10 AM"] },
  { stop_id: "1721", name: "N Fessenden &amp; Van Houten", lat: 45.59129, lon: -122.723014, times: ["6:17 AM", "6:37 AM", "6:52 AM", "7:08 AM", "7:23 AM", "7:40 AM", "7:56 AM", "8:11 AM"] },
  { stop_id: "1700", name: "N Fessenden &amp; Berkeley", lat: 45.591315, lon: -122.725758, times: ["6:17 AM", "6:37 AM", "6:52 AM", "7:08 AM", "7:23 AM", "7:40 AM", "7:56 AM", "8:11 AM"] },
  { stop_id: "1723", name: "N Fessenden &amp; Wall", lat: 45.591743, lon: -122.728081, times: ["6:18 AM", "6:38 AM", "6:53 AM", "7:09 AM", "7:24 AM", "7:41 AM", "7:57 AM", "8:12 AM"] },
  { stop_id: "1711", name: "Fessenden &amp; Macrum", lat: 45.592433, lon: -122.730802, times: ["6:19 AM", "6:39 AM", "6:54 AM", "7:10 AM", "7:25 AM", "7:42 AM", "7:58 AM", "8:13 AM"] },
  { stop_id: "1713", name: "N Fessenden &amp; Midway", lat: 45.593574, lon: -122.735233, times: ["6:20 AM", "6:40 AM", "6:55 AM", "7:11 AM", "7:26 AM", "7:43 AM", "7:59 AM", "8:14 AM"] },
  { stop_id: "1704", name: "N Fessenden &amp; Burr", lat: 45.594261, lon: -122.738157, times: ["6:20 AM", "6:40 AM", "6:55 AM", "7:11 AM", "7:26 AM", "7:43 AM", "7:59 AM", "8:14 AM"] },
  { stop_id: "1718", name: "N Fessenden &amp; Tioga", lat: 45.594926, lon: -122.740973, times: ["6:21 AM", "6:41 AM", "6:56 AM", "7:12 AM", "7:27 AM", "7:44 AM", "8:00 AM", "8:15 AM"] },
  { stop_id: "1698", name: "N Fessenden &amp; Allegheny", lat: 45.595632, lon: -122.743941, times: ["6:22 AM", "6:42 AM", "6:57 AM", "7:13 AM", "7:28 AM", "7:45 AM", "8:01 AM", "8:16 AM"] },
  { stop_id: "1715", name: "N Fessenden &amp; Richmond", lat: 45.596299, lon: -122.746822, times: ["6:22 AM", "6:42 AM", "6:58 AM", "7:14 AM", "7:29 AM", "7:46 AM", "8:02 AM", "8:17 AM"] },
  { stop_id: "13479", name: "N Fessenden &amp; Iris Way", lat: 45.596766, lon: -122.749011, times: ["6:23 AM", "6:43 AM", "6:58 AM", "7:14 AM", "7:29 AM", "7:46 AM", "8:02 AM", "8:17 AM"] },
  { stop_id: "5374", name: "N St Louis &amp; Seneca", lat: 45.595995, lon: -122.751518, times: ["6:23 AM", "6:43 AM", "6:59 AM", "7:15 AM", "7:30 AM", "7:47 AM", "8:03 AM", "8:18 AM"] },
  { stop_id: "5375", name: "N St Louis &amp; Smith", lat: 45.595023, lon: -122.753491, times: ["6:24 AM", "6:44 AM", "7:00 AM", "7:16 AM", "7:31 AM", "7:48 AM", "8:04 AM", "8:19 AM"] },
  { stop_id: "9505", name: "N Lombard &amp; New York", lat: 45.592384, lon: -122.757122, times: ["6:25 AM", "6:45 AM", "7:01 AM", "7:17 AM", "7:32 AM", "7:49 AM", "8:05 AM", "8:20 AM"] },
  { stop_id: "3465", name: "N Lombard &amp; Burlington", lat: 45.590115, lon: -122.754721, times: ["6:26 AM", "6:46 AM", "7:02 AM", "7:18 AM", "7:33 AM", "7:50 AM", "8:06 AM", "8:21 AM"] },
  { stop_id: "3474", name: "N Lombard &amp; Charleston", lat: 45.589194, lon: -122.7518, times: ["6:27 AM", "6:47 AM", "7:03 AM", "7:19 AM", "7:34 AM", "7:51 AM", "8:07 AM", "8:22 AM"] },
  { stop_id: "4818", name: "N Richmond &amp; Syracuse", lat: 45.587889, lon: -122.751884, times: ["6:28 AM", "6:48 AM", "7:04 AM", "7:20 AM", "7:35 AM", "7:52 AM", "8:08 AM", "8:23 AM"] },
]

    // Draw route polyline
    const polylineOut = L.polyline(shapeOutbound, { color: 'blue', weight: 4, opacity: 0.7 }).addTo(map);
    map.fitBounds(polylineOut.getBounds());

    // 1. Get current time in PT
    const nowPT = new Date(new Date().toLocaleString('en-US', { timeZone: 'America/Los_Angeles' }));
    const datePT = nowPT.toDateString();

    // 2. Add stops with highlighted next time
    stops.forEach(stop => {
      const stamps = stop.times.map(t => new Date(`${datePT} ${t}`));
      const nextIdx = stamps.findIndex(ts => ts > nowPT);
      const timesHtml = stamps.slice(0, 8).map((ts, i) => {
        const lbl = ts.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        return i === nextIdx ? `<strong>${lbl}</strong>` : lbl;
      }).join('<br>');

      L.circleMarker([stop.lat, stop.lon], {
        radius: 6,
        color: '#4dd0e1',
        fillColor: '#4dd0e1',
        fillOpacity: 0.9,
        weight: 1
      })
      .bindPopup(`<strong>${stop.name}</strong><br>${timesHtml || 'No scheduled times'}`)
      .addTo(map);
    });

    // Bus markers fetch
    let busMarkers = {};
    async function fetchAndDisplay() {
      const res = await fetch(`https://developer.trimet.org/ws/v2/vehicles?route=${routeNumber}&appID=${apiKey}&json=true`);
      const data = await res.json();
      const buses = (data.resultSet.vehicle || []).filter(v => v.routeNumber == routeNumber && v.direction == direction);

      Object.values(busMarkers).forEach(m => map.removeLayer(m));
      busMarkers = {};
      if (!buses.length) return;

      buses.forEach(bus => {
        if (!bus.latitude || !bus.longitude || !bus.blockID) return;
        const icon = L.divIcon({    
           className: '',
	   html: `
            <div style="text-align:center;">
              <div style="background:#0071CE;color:#fff;padding:2px 6px;border-radius:6px;font-weight:bold;">${bus.vehicleID}</div>
              <div style="width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-top:10px solid #00bfff;margin:auto;"></div>
            </div>
          `,
          iconSize: [40, 30], iconAnchor: [20, 30]
        });
        const marker = L.marker([bus.latitude, bus.longitude], { icon }).addTo(map);
        busMarkers[bus.vehicleID] = marker;
      });
    }
    fetchAndDisplay();
    setInterval(fetchAndDisplay, 15000);
  </script>

  <footer class="site-footer">
    <a href="terms.html">Terms of Use</a> &nbsp;|&nbsp;
    <a href="contact.html">Contact Us</a> &nbsp;|&nbsp;
    <a href="report.html">Report a Problem</a> &nbsp;|&nbsp;
    <a href="privacy.html">Privacy Policy</a>
  </footer>

  <script>
    if (!localStorage.getItem('cookieConsent')) {
      document.write(`
        <div id="cookie-banner" style="position: fixed; bottom: 0; left: 0; right: 0; background: #333; color: #fff; padding: 1rem; z-index: 1000; font-size: 0.9rem; line-height: 1.4; text-align: center; box-sizing: border-box;">
          📢 We use cookies to improve functionality and analyze traffic.
          By using MetroFeed, you agree to our 
          <a href='privacy.html' style='color: #4dd0e1; text-decoration: underline;'>Privacy Policy</a>.<br>
          <button onclick='localStorage.setItem("cookieConsent", "true"); document.getElementById("cookie-banner").remove();' style='margin-top: 0.5rem; background: #4dd0e1; color: #000; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer; font-weight: bold;'>OK</button>
        </div>
      `);
    }
  </script>
</body>
</html>