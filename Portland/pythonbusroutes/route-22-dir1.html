<!DOCTYPE html>
<html lang="en">
<head>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EL337T4JX4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-EL337T4JX4');
</script>

<meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Route 22 - To Gateway Transit Center | MetroFeed Portland</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #0d0d0d;
      color: #cccccc;
      overflow-y: auto;
    }

    .home-button {
      position: fixed;
      top: 120px;
      left: 10px;
      background-color: #4dd0e1;
      color: #0d0d0d;
      padding: 0.5rem 1rem;
      font-weight: bold;
      border-radius: 8px;
      text-decoration: none;
      z-index: 1001;
      box-shadow: 0 0 10px #4dd0e1;
    }

    .home-button:hover {
      background-color: #00bcd4;
      color: #ffffff;
    }

    header {
      background-color: #0d0d0d;
      border-top: 4px solid #4dd0e1;
      border-bottom: 3px solid #4dd0e1;
      padding: 1rem;
      text-align: center;
    }

    header img {
      max-height: 60px;
    }

    h1 {
      text-align: center;
      margin: 1rem 0;
      font-size: 2rem;
      color: #f0f0f0;
    }

    .content-box {
      border-radius: 12px;
      padding: 0;
      margin: 0;
      background-color: #1e1e1e;
    }

    #map {
      width: 100%;
      height: 85vh;
      border: none;
      margin: 0 auto;
      display: block;
      border-radius: 8px;
    }

    .button-bar {
      display: flex;
      justify-content: center;
      margin: 1rem 0;
    }

    .button-bar a, .back-button {
      background: #4dd0e1;
      color: #0d0d0d;
      padding: 0.6rem 1.2rem;
      text-decoration: none;
      border-radius: 8px;
      font-weight: bold;
      border: none;
      cursor: pointer;
      box-shadow: 0 0 10px #4dd0e1;
    }

    .back-button:hover {
      background-color: #35c0d6;
    }

    .site-footer {
      text-align: center;
      margin-top: 3rem;
      margin-bottom: 120px;
      font-size: 0.85rem;
      color: #aaa;
    }

    .site-footer a {
      color: #00BFFF;
      text-decoration: none;
    }

    .site-footer a:hover {
      text-decoration: underline;
    }

    
    }
  </style>
</head>

<body>
  

  <header>
    <img src="MetroFeedPortlandLogo.png" alt="MetroFeed Portland">
  </header>

  <div class="disclaimer" style="margin: 1rem auto 0.5rem; max-width: 600px; font-size: 0.8rem; color: #bbb; text-align: center; padding: 0.5rem 1rem; background-color: #111; border: 1px dashed #444; border-radius: 6px;">
    ⚠️ This is a Beta program, work in progress. Please REPORT bugs and pretend to be impressed.
  </div>
  <div class="disclaimer" style="margin: 0 auto 1rem; max-width: 600px; font-size: 0.75rem; color: #888; text-align: center; padding: 0.25rem 1rem;">
    This tool is not affiliated with or endorsed by TriMet. For official schedules and service alerts, visit <a href="https://trimet.org" style="color:#4dd0e1;">trimet.org</a>.
  </div>

  <div style="margin: 2rem 0; text-align: center;">
    <button class="back-button" onclick="history.back()">Back</button>
  </div>

  <h1>Route 22 - To Gateway Transit Center</h1>

  <div class="content-box">
    <div id="map"></div>
    <div style="text-align:right; font-size: 0.7rem; color: #777; margin-top: 0.5rem;">
      Data courtesy of TriMet.
    </div>
  </div>

  <script>
    if (document.referrer === "" && performance.navigation.type === 0) {
      window.location.href = "/index.html";
    }

    const apiKey = "2C4447D4A42083BCD84DE3B8E";
    const routeNumber = 22;
    const direction = parseInt(1);

    const map = L.map('map', {
      center: [45.6, -122.7],
      zoom: 12,
      minZoom: 12,
      maxZoom: 18,
      maxBounds: [[45.3, -123.1], [45.9, -122.3]],
      maxBoundsViscosity: 1.0
    });
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);

    const shapeOutbound = [
  [45.551216, -122.519305],
  [45.550431, -122.518198],
  [45.550259, -122.518007],
  [45.550186, -122.517937],
  [45.550114, -122.517889],
  [45.550035, -122.51784],
  [45.549907, -122.517796],
  [45.549776, -122.517765],
  [45.549578, -122.51776],
  [45.549476, -122.517759],
  [45.548796, -122.517754],
  [45.548347, -122.517751],
  [45.547925, -122.517771],
  [45.547843, -122.517774],
  [45.547846, -122.517895],
  [45.547839, -122.519298],
  [45.547829, -122.520725],
  [45.547841, -122.521128],
  [45.547842, -122.521163],
  [45.547851, -122.521415],
  [45.547876, -122.521776],
  [45.547901, -122.522047],
  [45.547925, -122.522289],
  [45.547957, -122.52258],
  [45.548058, -122.523277],
  [45.548077, -122.523436],
  [45.548094, -122.523588],
  [45.548001, -122.523598],
  [45.547818, -122.523633],
  [45.547724, -122.523664],
  [45.547624, -122.523697],
  [45.546843, -122.52394],
  [45.54678, -122.523952],
  [45.546624, -122.523956],
  [45.54647, -122.523942],
  [45.546293, -122.523899],
  [45.546151, -122.523853],
  [45.546005, -122.523773],
  [45.545873, -122.523687],
  [45.545765, -122.523602],
  [45.545695, -122.523545],
  [45.545688, -122.52354],
  [45.545641, -122.52349],
  [45.54554, -122.523377],
  [45.545425, -122.523228],
  [45.545361, -122.523125],
  [45.545223, -122.522863],
  [45.545149, -122.522679],
  [45.545104, -122.522558],
  [45.545028, -122.522308],
  [45.544977, -122.522043],
  [45.544956, -122.521856],
  [45.544942, -122.521738],
  [45.544612, -122.518855],
  [45.544554, -122.518426],
  [45.544548, -122.518335],
  [45.54455, -122.518245],
  [45.544557, -122.518154],
  [45.544572, -122.518067],
  [45.544655, -122.517792],
  [45.544685, -122.517691],
  [45.544601, -122.517613],
  [45.544541, -122.517549],
  [45.544489, -122.517472],
  [45.544446, -122.517386],
  [45.544413, -122.517292],
  [45.544391, -122.517188],
  [45.544295, -122.515976],
  [45.544282, -122.515805],
  [45.544819, -122.515713],
  [45.545579, -122.515709],
  [45.546486, -122.515698],
  [45.546578, -122.515675],
  [45.546653, -122.515631],
  [45.54675, -122.515548],
  [45.546781, -122.515502],
  [45.546841, -122.515415],
  [45.546689, -122.515201],
  [45.546586, -122.515011],
  [45.546515, -122.514847],
  [45.546443, -122.514646],
  [45.546401, -122.514506],
  [45.546348, -122.514267],
  [45.546325, -122.514087],
  [45.546317, -122.514001],
  [45.546305, -122.513869],
  [45.546466, -122.513825],
  [45.546533, -122.513789],
  [45.546634, -122.513722],
  [45.546739, -122.513626],
  [45.546887, -122.513513],
  [45.547012, -122.513457],
  [45.547157, -122.513424],
  [45.547505, -122.513417],
  [45.547606, -122.513415],
  [45.547604, -122.514241],
  [45.54761, -122.514558],
  [45.547629, -122.515021],
  [45.547648, -122.515326],
  [45.547676, -122.515661],
  [45.547708, -122.51595],
  [45.547752, -122.516324],
  [45.54778, -122.516606],
  [45.547804, -122.516889],
  [45.547822, -122.517186],
  [45.547831, -122.517353],
  [45.547836, -122.517486],
  [45.547839, -122.517632],
  [45.547843, -122.517774],
  [45.548347, -122.517751],
  [45.548796, -122.517754],
  [45.549063, -122.517756],
  [45.549578, -122.51776],
  [45.549776, -122.517765],
  [45.549907, -122.517796],
  [45.550035, -122.51784],
  [45.550114, -122.517889],
  [45.550186, -122.517937],
  [45.550259, -122.518007],
  [45.550431, -122.518198],
  [45.551245, -122.519346],
  [45.551371, -122.519524],
  [45.551476, -122.519639],
  [45.55148, -122.519644],
  [45.551539, -122.519697],
  [45.5516, -122.519744],
  [45.551663, -122.519784],
  [45.551732, -122.519822],
  [45.551796, -122.519843],
  [45.551863, -122.519868],
  [45.551932, -122.519883],
  [45.552115, -122.519908],
  [45.552277, -122.519898],
  [45.552421, -122.519877],
  [45.552433, -122.520111],
  [45.552428, -122.520248],
  [45.552374, -122.520759],
  [45.552373, -122.520818],
  [45.552371, -122.520918],
  [45.552386, -122.521095],
  [45.552411, -122.52131],
  [45.552528, -122.522063],
  [45.55271, -122.523154],
  [45.552749, -122.523395],
  [45.552775, -122.523635],
  [45.552774, -122.523819],
  [45.552754, -122.524055],
  [45.552717, -122.524267],
  [45.552698, -122.524341],
  [45.552555, -122.524887],
  [45.552464, -122.525302],
  [45.552455, -122.525341],
  [45.552364, -122.525819],
  [45.552852, -122.525976],
  [45.553029, -122.526015],
  [45.553217, -122.526036],
  [45.55347, -122.526046],
  [45.553729, -122.526024],
  [45.55409, -122.52595],
  [45.554222, -122.526702],
  [45.55425, -122.526864],
  [45.55442, -122.527805],
  [45.554522, -122.528335],
  [45.55455, -122.528659],
  [45.55456, -122.528723],
  [45.554598, -122.528963],
  [45.554655, -122.529316],
  [45.554751, -122.529833],
  [45.5549, -122.530676],
  [45.554917, -122.530771],
  [45.555117, -122.531896],
  [45.555125, -122.532038],
  [45.555115, -122.532189],
  [45.555085, -122.532335],
  [45.554951, -122.532765],
  [45.554892, -122.532953],
  [45.554747, -122.532869],
  [45.554576, -122.532819],
  [45.554386, -122.532783],
  [45.553749, -122.532786],
  [45.553579, -122.532834],
  [45.553447, -122.532902],
  [45.553335, -122.533025],
  [45.553254, -122.533149],
  [45.553183, -122.533288],
  [45.553138, -122.533458],
  [45.553129, -122.533501],
  [45.553035, -122.533949],
  [45.552968, -122.534152],
  [45.552924, -122.534243],
  [45.552872, -122.534326],
  [45.552813, -122.534399],
  [45.552748, -122.534463],
  [45.552679, -122.534515],
  [45.552605, -122.534556],
  [45.552528, -122.534583],
  [45.552449, -122.534598],
  [45.551935, -122.534629],
  [45.551791, -122.534637],
  [45.551775, -122.535118],
  [45.551722, -122.536407],
  [45.5517, -122.536921],
  [45.551695, -122.53704],
  [45.55169, -122.537246],
  [45.551687, -122.53742],
  [45.551689, -122.538004],
  [45.551689, -122.538158],
  [45.55169, -122.538328],
  [45.551697, -122.538467],
  [45.551705, -122.538572],
  [45.551712, -122.538658],
  [45.551726, -122.538791],
  [45.551742, -122.53897],
  [45.551754, -122.539148],
  [45.551756, -122.539192],
  [45.551759, -122.539264],
  [45.55176, -122.539407],
  [45.55176, -122.540342],
  [45.551761, -122.540982],
  [45.551762, -122.541185],
  [45.551762, -122.542409],
  [45.551762, -122.542942],
  [45.551761, -122.543939],
  [45.551761, -122.544082],
  [45.551765, -122.545231],
  [45.551771, -122.546359],
  [45.55177, -122.547406],
  [45.55177, -122.54753],
  [45.551766, -122.550557],
  [45.551766, -122.550666],
  [45.55177, -122.55164],
  [45.551767, -122.552635],
  [45.551767, -122.553352],
  [45.551766, -122.554602],
  [45.551766, -122.554733],
  [45.551776, -122.556761],
  [45.551777, -122.557575],
  [45.551778, -122.5578],
  [45.551199, -122.557806],
  [45.550803, -122.55781],
  [45.550476, -122.557812],
  [45.550399, -122.557812],
  [45.549956, -122.557816],
  [45.549602, -122.557818],
  [45.549318, -122.557816],
  [45.549064, -122.557809],
  [45.548668, -122.557783],
  [45.548523, -122.557777],
  [45.548491, -122.557776],
  [45.548252, -122.557775],
  [45.54818, -122.557775],
  [45.548106, -122.557775],
  [45.547966, -122.55778],
  [45.54767, -122.557785],
  [45.545945, -122.557816],
  [45.544909, -122.557834],
  [45.544145, -122.55784],
  [45.543576, -122.55785],
  [45.543308, -122.557854],
  [45.542857, -122.557862],
  [45.542676, -122.557868],
  [45.542398, -122.557889],
  [45.542206, -122.557905],
  [45.541996, -122.557923],
  [45.54189, -122.557931],
  [45.541679, -122.557941],
  [45.541384, -122.557948],
  [45.541081, -122.557952],
  [45.540701, -122.557958],
  [45.540254, -122.557964],
  [45.539929, -122.55797],
  [45.539663, -122.557974],
  [45.539476, -122.557977],
  [45.538933, -122.557985],
  [45.538566, -122.557989],
  [45.538325, -122.557993],
  [45.538068, -122.557997],
  [45.537838, -122.558001],
  [45.537808, -122.558001],
  [45.537695, -122.558002],
  [45.537615, -122.558003],
  [45.536848, -122.558015],
  [45.536606, -122.558019],
  [45.536297, -122.558023],
  [45.53546, -122.558036],
  [45.535261, -122.558039],
  [45.534403, -122.558056],
  [45.534206, -122.558058],
  [45.534131, -122.55806],
  [45.533903, -122.558063],
  [45.533629, -122.558066],
  [45.533538, -122.558063],
  [45.533186, -122.558066],
  [45.533121, -122.558067],
  [45.53309, -122.558067],
  [45.533005, -122.558068],
  [45.532947, -122.558069],
  [45.532791, -122.558072],
  [45.532051, -122.558083],
  [45.531766, -122.558086],
  [45.531407, -122.558089],
  [45.531357, -122.55809],
  [45.531275, -122.558091],
  [45.530888, -122.558096],
  [45.530683, -122.558098],
  [45.530643, -122.558099],
  [45.529991, -122.55811],
  [45.529903, -122.558111],
  [45.529679, -122.558113],
  [45.529486, -122.558114],
  [45.529487, -122.558267],
  [45.529484, -122.559244],
  [45.529483, -122.560035],
  [45.529482, -122.560464],
  [45.529481, -122.561113],
  [45.529488, -122.561828],
  [45.529477, -122.561942],
  [45.52947, -122.562054],
  [45.529468, -122.562594],
  [45.529467, -122.562813],
  [45.529466, -122.563],
  [45.529533, -122.563066],
  [45.529537, -122.563312],
  [45.529537, -122.563337],
  [45.529538, -122.563394],
  [45.529547, -122.563465],
  [45.529549, -122.563479],
  [45.529567, -122.563548],
  [45.529588, -122.563598],
  [45.529653, -122.563654],
  [45.529748, -122.56368],
  [45.529938, -122.563661],
  [45.530105, -122.56369],
  [45.530556, -122.563858]
];

const stopNames = {
  "1853": "NE Fremont &amp; 138th",
  "1919": "NE Fremont Ct &amp; 145th",
  "4288": "10000 Block NE Pacific St",
  "4773": "NE Prescott Dr &amp; 125th Pl",
  "4775": "NE Prescott Dr &amp; 129th Pl",
  "4777": "NE Prescott Dr &amp; 131st Pl",
  "4778": "NE Prescott Dr &amp; 132nd Pl",
  "4955": "13600 Block NE Rose Parkway",
  "4958": "NE Rose Parkway &amp; 141st",
  "4960": "NE Rose Parkway &amp; 143rd",
  "5225": "NE Shaver &amp; 102nd",
  "5227": "NE Shaver &amp; 105th",
  "5229": "NE Shaver &amp; 109th",
  "5231": "NE Shaver &amp; 112th",
  "5235": "NE Shaver &amp; 122nd",
  "5236": "NE Shaver &amp; 134th",
  "5237": "NE Shaver &amp; 135th",
  "5238": "NE Shaver &amp; 138th",
  "6505": "NE 102nd &amp; Alton",
  "6507": "NE 102nd &amp; Bell",
  "6509": "NE 102nd &amp; Brazee",
  "6513": "NE 102nd &amp; Clackamas",
  "6515": "NE 102nd &amp; Fremont",
  "6520": "NE 102nd &amp; Morris St",
  "6523": "1200 Block NE 102nd",
  "6525": "NE 102nd &amp; Pacific",
  "6720": "NE 135th &amp; Fremont",
  "6722": "NE 135th &amp; Rose Parkway",
  "6746": "NE 141st &amp; Failing",
  "6747": "NE 141st &amp; Beech",
  "6748": "NE 141st &amp; Failing",
  "6749": "NE 141st &amp; Fremont",
  "6750": "NE 141st &amp; Milton Ct",
  "6755": "NE 143rd &amp; Fremont Ct",
  "6765": "NE 145th &amp; Fremont",
  "8194": "Gateway TC (drop off only stop)",
  "8321": "NE Pacific St &amp; The Oregon Clinic",
  "9959": "NE Shaver &amp; Parkrose HS",
  "13116": "NE Shaver &amp; 115th",
  "13117": "NE 125th Pl &amp; Shaver",
  "13118": "4200 Block NE 125th Pl"
};

const stops = [
  { stop_id: "6748", name: "NE 141st &amp; Failing", lat: 45.551175, lon: -122.519367, times: ["10:40 AM", "11:10 AM", "11:41 AM", "12:12 PM", "12:42 PM", "1:12 PM", "1:42 PM", "2:12 PM"] },
  { stop_id: "6747", name: "NE 141st &amp; Beech", lat: 45.549472, lon: -122.517839, times: ["10:10 AM", "10:40 AM", "11:10 AM", "11:41 AM", "12:12 PM", "12:42 PM", "1:12 PM", "1:42 PM"] },
  { stop_id: "6749", name: "NE 141st &amp; Fremont", lat: 45.547925, lon: -122.517858, times: ["10:11 AM", "10:41 AM", "11:11 AM", "11:42 AM", "12:13 PM", "12:43 PM", "1:13 PM", "1:43 PM"] },
  { stop_id: "1853", name: "NE Fremont &amp; 138th", lat: 45.5479, lon: -122.521158, times: ["10:11 AM", "10:41 AM", "11:11 AM", "11:42 AM", "12:13 PM", "12:43 PM", "1:13 PM", "1:43 PM"] },
  { stop_id: "6720", name: "NE 135th &amp; Fremont", lat: 45.547732, lon: -122.523712, times: ["10:12 AM", "10:42 AM", "11:12 AM", "11:43 AM", "12:14 PM", "12:44 PM", "1:14 PM", "1:44 PM"] },
  { stop_id: "6722", name: "NE 135th &amp; Rose Parkway", lat: 45.545671, lon: -122.523602, times: ["10:12 AM", "10:42 AM", "11:12 AM", "11:43 AM", "12:14 PM", "12:44 PM", "1:14 PM", "1:44 PM"] },
  { stop_id: "4955", name: "13600 Block NE Rose Parkway", lat: 45.544874, lon: -122.521752, times: ["10:13 AM", "10:43 AM", "11:13 AM", "11:44 AM", "12:15 PM", "12:45 PM", "1:15 PM", "1:45 PM"] },
  { stop_id: "4958", name: "NE Rose Parkway &amp; 141st", lat: 45.544573, lon: -122.517746, times: ["10:14 AM", "10:44 AM", "11:14 AM", "11:45 AM", "12:16 PM", "12:46 PM", "1:16 PM", "1:46 PM"] },
  { stop_id: "4960", name: "NE Rose Parkway &amp; 143rd", lat: 45.544248, lon: -122.515984, times: ["10:14 AM", "10:44 AM", "11:14 AM", "11:45 AM", "12:16 PM", "12:46 PM", "1:16 PM", "1:46 PM"] },
  { stop_id: "6755", name: "NE 143rd &amp; Fremont Ct", lat: 45.546733, lon: -122.515439, times: ["10:15 AM", "10:45 AM", "11:15 AM", "11:46 AM", "12:17 PM", "12:47 PM", "1:17 PM", "1:47 PM"] },
  { stop_id: "1919", name: "NE Fremont Ct &amp; 145th", lat: 45.546272, lon: -122.514011, times: ["10:15 AM", "10:45 AM", "11:15 AM", "11:46 AM", "12:17 PM", "12:47 PM", "1:17 PM", "1:47 PM"] },
  { stop_id: "6765", name: "NE 145th &amp; Fremont", lat: 45.547505, lon: -122.513353, times: ["10:15 AM", "10:45 AM", "11:15 AM", "11:46 AM", "12:17 PM", "12:47 PM", "1:17 PM", "1:47 PM"] },
  { stop_id: "6750", name: "NE 141st &amp; Milton Ct", lat: 45.549065, lon: -122.517677, times: ["10:17 AM", "10:47 AM", "11:17 AM", "11:48 AM", "12:19 PM", "12:49 PM", "1:19 PM", "1:49 PM"] },
  { stop_id: "6746", name: "NE 141st &amp; Failing", lat: 45.551514, lon: -122.519565, times: ["10:18 AM", "10:48 AM", "11:18 AM", "11:49 AM", "12:20 PM", "12:50 PM", "1:20 PM", "1:50 PM"] },
  { stop_id: "5238", name: "NE Shaver &amp; 138th", lat: 45.55246, lon: -122.520819, times: ["10:18 AM", "10:48 AM", "11:18 AM", "11:49 AM", "12:20 PM", "12:50 PM", "1:20 PM", "1:50 PM"] },
  { stop_id: "5237", name: "NE Shaver &amp; 135th", lat: 45.55275, lon: -122.524371, times: ["10:19 AM", "10:49 AM", "11:19 AM", "11:50 AM", "12:21 PM", "12:51 PM", "1:21 PM", "1:51 PM"] },
  { stop_id: "5236", name: "NE Shaver &amp; 134th", lat: 45.552516, lon: -122.525326, times: ["10:19 AM", "10:49 AM", "11:19 AM", "11:50 AM", "12:21 PM", "12:51 PM", "1:21 PM", "1:51 PM"] },
  { stop_id: "4778", name: "NE Prescott Dr &amp; 132nd Pl", lat: 45.554281, lon: -122.526682, times: ["10:20 AM", "10:50 AM", "11:20 AM", "11:51 AM", "12:22 PM", "12:52 PM", "1:22 PM", "1:52 PM"] },
  { stop_id: "4777", name: "NE Prescott Dr &amp; 131st Pl", lat: 45.55463, lon: -122.528701, times: ["10:21 AM", "10:51 AM", "11:21 AM", "11:52 AM", "12:23 PM", "12:53 PM", "1:23 PM", "1:53 PM"] },
  { stop_id: "4775", name: "NE Prescott Dr &amp; 129th Pl", lat: 45.554973, lon: -122.530676, times: ["10:21 AM", "10:51 AM", "11:21 AM", "11:52 AM", "12:23 PM", "12:53 PM", "1:23 PM", "1:53 PM"] },
  { stop_id: "4773", name: "NE Prescott Dr &amp; 125th Pl", lat: 45.555, lon: -122.532799, times: ["10:22 AM", "10:52 AM", "11:22 AM", "11:53 AM", "12:24 PM", "12:54 PM", "1:24 PM", "1:54 PM"] },
  { stop_id: "13118", name: "4200 Block NE 125th Pl", lat: 45.553154, lon: -122.533513, times: ["10:22 AM", "10:52 AM", "11:22 AM", "11:53 AM", "12:24 PM", "12:54 PM", "1:24 PM", "1:54 PM"] },
  { stop_id: "13117", name: "NE 125th Pl &amp; Shaver", lat: 45.551934, lon: -122.53471, times: ["10:23 AM", "10:53 AM", "11:23 AM", "11:54 AM", "12:25 PM", "12:55 PM", "1:25 PM", "1:55 PM"] },
  { stop_id: "5235", name: "NE Shaver &amp; 122nd", lat: 45.551772, lon: -122.536928, times: ["10:24 AM", "10:54 AM", "11:24 AM", "11:55 AM", "12:26 PM", "12:56 PM", "1:26 PM", "1:56 PM"] },
  { stop_id: "9959", name: "NE Shaver &amp; Parkrose HS", lat: 45.551821, lon: -122.539187, times: ["10:24 AM", "10:54 AM", "11:24 AM", "11:55 AM", "12:26 PM", "12:56 PM", "1:26 PM", "1:56 PM"] },
  { stop_id: "13116", name: "NE Shaver &amp; 115th", lat: 45.551836, lon: -122.543937, times: ["10:25 AM", "10:55 AM", "11:25 AM", "11:56 AM", "12:27 PM", "12:57 PM", "1:27 PM", "1:57 PM"] },
  { stop_id: "5231", name: "NE Shaver &amp; 112th", lat: 45.55182, lon: -122.547408, times: ["10:26 AM", "10:56 AM", "11:26 AM", "11:57 AM", "12:28 PM", "12:58 PM", "1:28 PM", "1:58 PM"] },
  { stop_id: "5229", name: "NE Shaver &amp; 109th", lat: 45.551817, lon: -122.550556, times: ["10:26 AM", "10:56 AM", "11:26 AM", "11:57 AM", "12:28 PM", "12:58 PM", "1:28 PM", "1:58 PM"] },
  { stop_id: "5227", name: "NE Shaver &amp; 105th", lat: 45.5518, lon: -122.554603, times: ["10:27 AM", "10:57 AM", "11:27 AM", "11:58 AM", "12:29 PM", "12:59 PM", "1:29 PM", "1:59 PM"] },
  { stop_id: "5225", name: "NE Shaver &amp; 102nd", lat: 45.551817, lon: -122.557574, times: ["10:28 AM", "10:58 AM", "11:28 AM", "11:59 AM", "12:30 PM", "1:00 PM", "1:30 PM", "2:00 PM"] },
  { stop_id: "6505", name: "NE 102nd &amp; Alton", lat: 45.550476, lon: -122.557945, times: ["10:28 AM", "10:58 AM", "11:28 AM", "11:59 AM", "12:30 PM", "1:00 PM", "1:30 PM", "2:00 PM"] },
  { stop_id: "6515", name: "NE 102nd &amp; Fremont", lat: 45.548252, lon: -122.557903, times: ["10:29 AM", "10:59 AM", "11:29 AM", "12:00 PM", "12:31 PM", "1:01 PM", "1:31 PM", "2:01 PM"] },
  { stop_id: "6520", name: "NE 102nd &amp; Morris St", lat: 45.543309, lon: -122.557986, times: ["10:30 AM", "11:00 AM", "11:30 AM", "12:01 PM", "12:32 PM", "1:02 PM", "1:32 PM", "2:02 PM"] },
  { stop_id: "6509", name: "NE 102nd &amp; Brazee", lat: 45.53993, lon: -122.558078, times: ["10:31 AM", "11:01 AM", "11:31 AM", "12:02 PM", "12:33 PM", "1:03 PM", "1:33 PM", "2:03 PM"] },
  { stop_id: "6507", name: "NE 102nd &amp; Bell", lat: 45.536608, lon: -122.558133, times: ["10:32 AM", "11:02 AM", "11:32 AM", "12:03 PM", "12:34 PM", "1:04 PM", "1:34 PM", "2:04 PM"] },
  { stop_id: "6513", name: "NE 102nd &amp; Clackamas", lat: 45.533122, lon: -122.558203, times: ["10:33 AM", "11:03 AM", "11:33 AM", "12:04 PM", "12:35 PM", "1:05 PM", "1:35 PM", "2:05 PM"] },
  { stop_id: "6523", name: "1200 Block NE 102nd", lat: 45.531407, lon: -122.558228, times: ["10:34 AM", "11:04 AM", "11:34 AM", "12:05 PM", "12:36 PM", "1:06 PM", "1:36 PM", "2:06 PM"] },
  { stop_id: "6525", name: "NE 102nd &amp; Pacific", lat: 45.52968, lon: -122.558243, times: ["10:34 AM", "11:04 AM", "11:34 AM", "12:05 PM", "12:36 PM", "1:06 PM", "1:36 PM", "2:06 PM"] },
  { stop_id: "4288", name: "10000 Block NE Pacific St", lat: 45.529563, lon: -122.560465, times: ["10:35 AM", "11:05 AM", "11:35 AM", "12:06 PM", "12:37 PM", "1:07 PM", "1:37 PM", "2:07 PM"] },
  { stop_id: "8321", name: "NE Pacific St &amp; The Oregon Clinic", lat: 45.529559, lon: -122.562812, times: ["10:35 AM", "11:05 AM", "11:35 AM", "12:06 PM", "12:37 PM", "1:07 PM", "1:37 PM", "2:07 PM"] },
  { stop_id: "8194", name: "Gateway TC (drop off only stop)", lat: 45.530568, lon: -122.563773, times: ["10:36 AM", "11:06 AM", "11:36 AM", "12:07 PM", "12:38 PM", "1:08 PM", "1:38 PM", "2:08 PM"] },
]

    const polylineOut = L.polyline(shapeOutbound, { color: 'blue', weight: 4, opacity: 0.7 }).addTo(map);
    map.fitBounds(polylineOut.getBounds());

    const nowPT = new Date(new Date().toLocaleString('en-US', { timeZone: 'America/Los_Angeles' }));
    const nowMins = nowPT.getHours() * 60 + nowPT.getMinutes();

    stops.forEach(stop => {
      let highlightedTimes = [];
      let foundNext = false;
      stop.times.forEach(timeStr => {
        let cleanTime = timeStr.trim();
        let [h, m] = cleanTime.split(":");
        let schedMins = parseInt(h, 10) * 60 + parseInt(m, 10);
        if (schedMins < nowMins && nowMins - schedMins > 720) {
          schedMins += 1440;
        }
        if (!foundNext && schedMins >= nowMins) {
          highlightedTimes.push(`<span style="background:#4dd0e1; color:#000; padding:2px 6px; border-radius:6px; font-weight:bold;">${cleanTime}</span>`);
          foundNext = true;
        } else {
          highlightedTimes.push(cleanTime);
        }
      });

      L.circleMarker([stop.lat, stop.lon], {
        radius: 6,
        color: '#4dd0e1',
        fillColor: '#4dd0e1',
        fillOpacity: 0.9,
        weight: 1
      })
      .bindPopup(`<strong>${stop.name}</strong><br>${highlightedTimes.join("<br>") || 'No scheduled times'}`)
      .addTo(map);
    });

    let busMarkers = {};
    async function fetchAndDisplay() {
      const res = await fetch(`https://developer.trimet.org/ws/v2/vehicles?route=${routeNumber}&appID=${apiKey}&json=true`);
      const data = await res.json();
      const buses = (data.resultSet.vehicle || []).filter(v => v.routeNumber == routeNumber && v.direction == direction);

      Object.values(busMarkers).forEach(m => map.removeLayer(m));
      busMarkers = {};
      if (!buses.length) return;

      buses.forEach(bus => {
        if (!bus.latitude || !bus.longitude || !bus.blockID) return;
        const icon = L.divIcon({    
           className: '',
           html: `
            <div style="text-align:center;">
              <div style="background:#0071CE;color:#fff;padding:2px 6px;border-radius:6px;font-weight:bold;">${bus.vehicleID}</div>
              <div style="width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-top:10px solid #00bfff;margin:auto;"></div>
            </div>
          `,
          iconSize: [40, 30], iconAnchor: [20, 30]
        });
        const marker = L.marker([bus.latitude, bus.longitude], { icon }).addTo(map);
        busMarkers[bus.vehicleID] = marker;
      });
    }
    fetchAndDisplay();
    setInterval(fetchAndDisplay, 15000);
  </script>

  <footer class="site-footer">
    <a href="terms.html">Terms of Use</a> &nbsp;|&nbsp;
    <a href="contact.html">Contact Us</a> &nbsp;|&nbsp;
    <a href="report.html">Report a Problem</a> &nbsp;|&nbsp;
    <a href="dmca.html">DMCA</a> &nbsp;|&nbsp;
    <a href="privacy.html">Privacy Policy</a>
  </footer>

  <script>
    if (!localStorage.getItem('cookieConsent')) {
      document.write(`
        <div id="cookie-banner" style="position: fixed; bottom: 0; left: 0; right: 0; background: #333; color: #fff; padding: 1rem; z-index: 1000; font-size: 0.9rem; line-height: 1.4; text-align: center; box-sizing: border-box;">
          📢 We use cookies to improve functionality and analyze traffic.
          By using MetroFeed, you agree to our 
          <a href='privacy.html' style='color: #4dd0e1; text-decoration: underline;'>Privacy Policy</a>.<br>
          <button onclick='localStorage.setItem("cookieConsent", "true"); document.getElementById("cookie-banner").remove();' style='margin-top: 0.5rem; background: #4dd0e1; color: #000; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer; font-weight: bold;'>OK</button>
        </div>
      `);
    }
  </script>
</body>
</html>