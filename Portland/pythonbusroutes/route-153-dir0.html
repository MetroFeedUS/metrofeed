<!DOCTYPE html>
<html lang="en">
<head>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EL337T4JX4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-EL337T4JX4');
</script>

<meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Route 153 - To Willamette | MetroFeed Portland</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #0d0d0d;
      color: #cccccc;
      overflow-y: auto;
    }

    .home-button {
      position: fixed;
      top: 120px;
      left: 10px;
      background-color: #4dd0e1;
      color: #0d0d0d;
      padding: 0.5rem 1rem;
      font-weight: bold;
      border-radius: 8px;
      text-decoration: none;
      z-index: 1001;
      box-shadow: 0 0 10px #4dd0e1;
    }

    .home-button:hover {
      background-color: #00bcd4;
      color: #ffffff;
    }

    header {
      background-color: #0d0d0d;
      border-top: 4px solid #4dd0e1;
      border-bottom: 3px solid #4dd0e1;
      padding: 1rem;
      text-align: center;
    }

    header img {
      max-height: 60px;
    }

    h1 {
      text-align: center;
      margin: 1rem 0;
      font-size: 2rem;
      color: #f0f0f0;
    }

    .content-box {
      border-radius: 12px;
      padding: 0;
      margin: 0;
      background-color: #1e1e1e;
    }

    #map {
      width: 100%;
      height: 85vh;
      border: none;
      margin: 0 auto;
      display: block;
      border-radius: 8px;
    }

    .button-bar {
      display: flex;
      justify-content: center;
      margin: 1rem 0;
    }

    .button-bar a, .back-button {
      background: #4dd0e1;
      color: #0d0d0d;
      padding: 0.6rem 1.2rem;
      text-decoration: none;
      border-radius: 8px;
      font-weight: bold;
      border: none;
      cursor: pointer;
      box-shadow: 0 0 10px #4dd0e1;
    }

    .back-button:hover {
      background-color: #35c0d6;
    }

    .site-footer {
      text-align: center;
      margin-top: 3rem;
      margin-bottom: 120px;
      font-size: 0.85rem;
      color: #aaa;
    }

    .site-footer a {
      color: #00BFFF;
      text-decoration: none;
    }

    .site-footer a:hover {
      text-decoration: underline;
    }

    
    }
  </style>
</head>

<body>
  

  <header>
    <img src="MetroFeedPortlandLogo.png" alt="MetroFeed Portland">
  </header>

  <div class="disclaimer" style="margin: 1rem auto 0.5rem; max-width: 600px; font-size: 0.8rem; color: #bbb; text-align: center; padding: 0.5rem 1rem; background-color: #111; border: 1px dashed #444; border-radius: 6px;">
    ‚ö†Ô∏è This is a Beta program, work in progress. Please REPORT bugs and pretend to be impressed.
  </div>
  <div class="disclaimer" style="margin: 0 auto 1rem; max-width: 600px; font-size: 0.75rem; color: #888; text-align: center; padding: 0.25rem 1rem;">
    This tool is not affiliated with or endorsed by TriMet. For official schedules and service alerts, visit <a href="https://trimet.org" style="color:#4dd0e1;">trimet.org</a>.
  </div>

  <div style="margin: 2rem 0; text-align: center;">
    <button class="back-button" onclick="history.back()">Back</button>
  </div>

  <h1>Route 153 - To Willamette</h1>

  <div class="content-box">
    <div id="map"></div>
    <div style="text-align:right; font-size: 0.7rem; color: #777; margin-top: 0.5rem;">
      Data courtesy of TriMet.
    </div>
  </div>

  <script>
    if (document.referrer === "" && performance.navigation.type === 0) {
      window.location.href = "/index.html";
    }

    const apiKey = "2C4447D4A42083BCD84DE3B8E";
    const routeNumber = 153;
    const direction = parseInt(0);

    const map = L.map('map', {
      center: [45.6, -122.7],
      zoom: 12,
      minZoom: 12,
      maxZoom: 18,
      maxBounds: [[45.3, -123.1], [45.9, -122.3]],
      maxBoundsViscosity: 1.0
    });
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);

    const shapeOutbound = [
  [45.421121, -122.668092],
  [45.4211, -122.667896],
  [45.421076, -122.667683],
  [45.420963, -122.667709],
  [45.42062, -122.667785],
  [45.420506, -122.667811],
  [45.419783, -122.667972],
  [45.419723, -122.667883],
  [45.419665, -122.667362],
  [45.419637, -122.667099],
  [45.4196, -122.666756],
  [45.419552, -122.666307],
  [45.419498, -122.665803],
  [45.419468, -122.665522],
  [45.419428, -122.665158],
  [45.419379, -122.664722],
  [45.419364, -122.664614],
  [45.419311, -122.664256],
  [45.419256, -122.663766],
  [45.419204, -122.663346],
  [45.419185, -122.663217],
  [45.419162, -122.663137],
  [45.419136, -122.663071],
  [45.419076, -122.662956],
  [45.418787, -122.663022],
  [45.418613, -122.663062],
  [45.418538, -122.66314],
  [45.418221, -122.663215],
  [45.418069, -122.663249],
  [45.417998, -122.663203],
  [45.417746, -122.663255],
  [45.417538, -122.663298],
  [45.417493, -122.663307],
  [45.417423, -122.663321],
  [45.417352, -122.6634],
  [45.417304, -122.663413],
  [45.417068, -122.663466],
  [45.417006, -122.663419],
  [45.416382, -122.663555],
  [45.416045, -122.663632],
  [45.415946, -122.663652],
  [45.415748, -122.663692],
  [45.415701, -122.663701],
  [45.415561, -122.663735],
  [45.415475, -122.663755],
  [45.41525, -122.663806],
  [45.414878, -122.66389],
  [45.414806, -122.663964],
  [45.414197, -122.664102],
  [45.414123, -122.664055],
  [45.413758, -122.664132],
  [45.413691, -122.664211],
  [45.41337, -122.664282],
  [45.413289, -122.664241],
  [45.413145, -122.664271],
  [45.413117, -122.664277],
  [45.413038, -122.664293],
  [45.412761, -122.664351],
  [45.412669, -122.664371],
  [45.412278, -122.664454],
  [45.412209, -122.664469],
  [45.412152, -122.664536],
  [45.412014, -122.664563],
  [45.411944, -122.664575],
  [45.411865, -122.664534],
  [45.411782, -122.664551],
  [45.411562, -122.664596],
  [45.411446, -122.66462],
  [45.411341, -122.664747],
  [45.411315, -122.664773],
  [45.41125, -122.664805],
  [45.411171, -122.664854],
  [45.41112, -122.664897],
  [45.411076, -122.664945],
  [45.41103, -122.665011],
  [45.410994, -122.66507],
  [45.410876, -122.665305],
  [45.410819, -122.665612],
  [45.410802, -122.665707],
  [45.410722, -122.666138],
  [45.410655, -122.666496],
  [45.410618, -122.666699],
  [45.410597, -122.666788],
  [45.410576, -122.666859],
  [45.410516, -122.667013],
  [45.410481, -122.66709],
  [45.41039, -122.667257],
  [45.41017, -122.667653],
  [45.410127, -122.667733],
  [45.41006, -122.667867],
  [45.410017, -122.667965],
  [45.409969, -122.668083],
  [45.409926, -122.668205],
  [45.409826, -122.668525],
  [45.409667, -122.66905],
  [45.409615, -122.66921],
  [45.409283, -122.670301],
  [45.40903, -122.671154],
  [45.408759, -122.672037],
  [45.408703, -122.672221],
  [45.408582, -122.672614],
  [45.408453, -122.673121],
  [45.408295, -122.673758],
  [45.408193, -122.674214],
  [45.408164, -122.67432],
  [45.408126, -122.674486],
  [45.40808, -122.674634],
  [45.408029, -122.674779],
  [45.40798, -122.674879],
  [45.407929, -122.674974],
  [45.407668, -122.675393],
  [45.407411, -122.675803],
  [45.407328, -122.675936],
  [45.407201, -122.676161],
  [45.407193, -122.676175],
  [45.407165, -122.67623],
  [45.407117, -122.676322],
  [45.407042, -122.676466],
  [45.406858, -122.676856],
  [45.406836, -122.676944],
  [45.406828, -122.676976],
  [45.406702, -122.677258],
  [45.406636, -122.677406],
  [45.406574, -122.67754],
  [45.406507, -122.677662],
  [45.406421, -122.677791],
  [45.406337, -122.677889],
  [45.406289, -122.677938],
  [45.406219, -122.678003],
  [45.406125, -122.678067],
  [45.406004, -122.67814],
  [45.40576, -122.678273],
  [45.405655, -122.678289],
  [45.405365, -122.678452],
  [45.405127, -122.678581],
  [45.404963, -122.678667],
  [45.404768, -122.678769],
  [45.404642, -122.678838],
  [45.404507, -122.678922],
  [45.404404, -122.679],
  [45.404326, -122.679066],
  [45.404257, -122.679134],
  [45.404195, -122.679199],
  [45.404109, -122.679296],
  [45.403814, -122.679648],
  [45.403629, -122.679871],
  [45.403287, -122.680292],
  [45.403031, -122.680618],
  [45.40273, -122.681016],
  [45.402582, -122.681208],
  [45.402382, -122.681452],
  [45.402121, -122.681765],
  [45.401901, -122.682035],
  [45.40169, -122.682278],
  [45.401593, -122.682396],
  [45.401342, -122.6827],
  [45.401021, -122.683076],
  [45.400927, -122.683187],
  [45.400786, -122.683357],
  [45.400582, -122.683602],
  [45.400404, -122.683815],
  [45.400117, -122.684155],
  [45.399729, -122.68462],
  [45.399517, -122.684871],
  [45.399278, -122.685158],
  [45.398986, -122.68551],
  [45.398797, -122.685741],
  [45.398443, -122.686183],
  [45.398204, -122.686486],
  [45.397907, -122.686856],
  [45.397762, -122.687034],
  [45.397649, -122.687164],
  [45.397457, -122.687408],
  [45.397178, -122.687758],
  [45.397049, -122.687903],
  [45.396896, -122.688053],
  [45.396801, -122.688137],
  [45.396687, -122.688231],
  [45.3965, -122.688366],
  [45.396406, -122.688431],
  [45.396296, -122.6885],
  [45.396016, -122.688658],
  [45.395803, -122.688774],
  [45.395597, -122.688898],
  [45.395378, -122.689033],
  [45.394979, -122.689253],
  [45.394758, -122.689369],
  [45.394195, -122.689672],
  [45.393642, -122.689961],
  [45.393575, -122.69004],
  [45.393394, -122.690137],
  [45.393345, -122.690168],
  [45.393327, -122.690181],
  [45.393284, -122.690215],
  [45.393252, -122.690258],
  [45.393216, -122.690335],
  [45.393195, -122.69041],
  [45.393167, -122.690463],
  [45.393135, -122.690501],
  [45.393103, -122.690525],
  [45.393063, -122.690542],
  [45.393014, -122.690545],
  [45.392978, -122.690536],
  [45.392936, -122.69051],
  [45.392912, -122.690488],
  [45.39289, -122.69046],
  [45.39287, -122.690423],
  [45.392854, -122.690379],
  [45.392842, -122.690319],
  [45.392839, -122.690269],
  [45.392845, -122.690209],
  [45.39286, -122.690149],
  [45.392891, -122.690088],
  [45.392899, -122.690024],
  [45.392901, -122.689971],
  [45.39289, -122.689891],
  [45.39288, -122.689835],
  [45.392814, -122.689538],
  [45.392798, -122.689374],
  [45.392788, -122.689336],
  [45.392472, -122.688163],
  [45.39213, -122.68688],
  [45.391836, -122.685756],
  [45.391756, -122.685457],
  [45.391677, -122.685149],
  [45.391595, -122.684837],
  [45.391557, -122.684686],
  [45.391523, -122.684541],
  [45.391501, -122.684439],
  [45.39148, -122.684327],
  [45.391469, -122.684244],
  [45.391459, -122.684162],
  [45.391447, -122.684041],
  [45.391443, -122.683985],
  [45.391442, -122.683926],
  [45.391439, -122.683788],
  [45.391431, -122.682449],
  [45.391426, -122.681655],
  [45.391422, -122.681145],
  [45.391418, -122.680919],
  [45.391413, -122.680809],
  [45.391409, -122.680739],
  [45.391405, -122.680683],
  [45.391399, -122.68063],
  [45.391393, -122.680581],
  [45.391383, -122.680524],
  [45.391369, -122.680454],
  [45.391351, -122.680386],
  [45.391319, -122.680282],
  [45.3913, -122.680229],
  [45.391278, -122.680174],
  [45.391259, -122.68013],
  [45.391235, -122.680082],
  [45.391206, -122.680029],
  [45.391183, -122.67999],
  [45.391153, -122.679942],
  [45.390963, -122.679674],
  [45.390842, -122.679514],
  [45.390665, -122.679287],
  [45.390411, -122.678951],
  [45.390104, -122.678518],
  [45.389988, -122.678336],
  [45.389922, -122.678226],
  [45.389897, -122.678184],
  [45.389784, -122.677985],
  [45.389673, -122.677778],
  [45.389367, -122.677173],
  [45.389298, -122.677037],
  [45.388973, -122.676391],
  [45.387889, -122.674223],
  [45.387723, -122.673884],
  [45.387565, -122.673553],
  [45.387375, -122.673165],
  [45.387189, -122.672779],
  [45.386892, -122.672172],
  [45.386816, -122.672023],
  [45.386737, -122.671871],
  [45.386707, -122.671817],
  [45.386637, -122.671695],
  [45.38658, -122.671599],
  [45.386536, -122.671527],
  [45.386484, -122.67145],
  [45.386389, -122.671304],
  [45.386077, -122.670848],
  [45.385961, -122.670687],
  [45.385724, -122.670348],
  [45.385641, -122.670235],
  [45.385552, -122.670119],
  [45.385369, -122.669885],
  [45.385257, -122.669754],
  [45.38514, -122.669614],
  [45.384906, -122.66934],
  [45.384841, -122.669262],
  [45.384776, -122.669181],
  [45.384676, -122.669042],
  [45.384635, -122.668983],
  [45.38459, -122.668911],
  [45.384563, -122.668867],
  [45.384506, -122.668769],
  [45.384145, -122.668123],
  [45.383737, -122.667373],
  [45.382921, -122.665847],
  [45.382694, -122.665417],
  [45.382607, -122.66525],
  [45.382553, -122.66514],
  [45.382504, -122.665033],
  [45.38246, -122.664934],
  [45.382416, -122.664833],
  [45.382332, -122.664631],
  [45.382309, -122.664576],
  [45.382286, -122.664511],
  [45.382209, -122.664297],
  [45.382062, -122.663873],
  [45.381866, -122.663304],
  [45.381809, -122.663129],
  [45.381732, -122.662911],
  [45.381658, -122.662699],
  [45.381579, -122.662475],
  [45.381502, -122.662267],
  [45.381419, -122.662054],
  [45.381252, -122.661624],
  [45.380949, -122.660879],
  [45.380648, -122.660147],
  [45.380453, -122.659688],
  [45.380411, -122.659589],
  [45.380381, -122.659527],
  [45.38034, -122.659447],
  [45.380303, -122.659377],
  [45.380272, -122.659322],
  [45.380229, -122.659253],
  [45.380137, -122.659116],
  [45.379941, -122.658853],
  [45.379899, -122.6588],
  [45.379853, -122.658737],
  [45.379608, -122.65842],
  [45.379485, -122.658261],
  [45.379365, -122.658112],
  [45.379289, -122.658026],
  [45.379207, -122.657938],
  [45.379078, -122.657807],
  [45.378978, -122.657714],
  [45.378894, -122.657641],
  [45.378793, -122.657557],
  [45.378711, -122.657493],
  [45.378623, -122.657426],
  [45.378562, -122.657383],
  [45.378499, -122.657339],
  [45.378359, -122.657253],
  [45.37821, -122.657162],
  [45.377671, -122.65684],
  [45.37757, -122.656783],
  [45.377394, -122.656677],
  [45.377226, -122.65657],
  [45.377132, -122.656508],
  [45.377045, -122.656447],
  [45.376678, -122.656173],
  [45.37628, -122.655817],
  [45.376354, -122.65574],
  [45.376375, -122.655686],
  [45.376552, -122.655244],
  [45.376734, -122.65477],
  [45.376925, -122.654282],
  [45.377003, -122.654083],
  [45.377036, -122.653997],
  [45.377085, -122.65386],
  [45.377123, -122.653729],
  [45.377159, -122.653583],
  [45.377187, -122.653404],
  [45.3772, -122.653261],
  [45.377207, -122.653121],
  [45.377208, -122.65294],
  [45.377199, -122.652252],
  [45.377184, -122.650851],
  [45.377166, -122.648729],
  [45.377165, -122.648351],
  [45.377162, -122.64822],
  [45.377061, -122.648272],
  [45.37671, -122.648279],
  [45.376554, -122.648284],
  [45.376412, -122.648284],
  [45.376312, -122.648271],
  [45.376263, -122.64826],
  [45.376183, -122.648241],
  [45.376045, -122.64819],
  [45.376005, -122.648164],
  [45.375958, -122.648141],
  [45.375867, -122.648087],
  [45.375785, -122.648026],
  [45.375688, -122.647952],
  [45.375564, -122.647854],
  [45.375471, -122.647786],
  [45.375255, -122.647618],
  [45.375166, -122.647551],
  [45.375064, -122.647469],
  [45.374838, -122.647294],
  [45.374583, -122.647097],
  [45.374254, -122.646846],
  [45.374084, -122.646717],
  [45.374004, -122.646643],
  [45.373923, -122.64659],
  [45.373884, -122.64656],
  [45.373701, -122.646418],
  [45.373465, -122.646237],
  [45.373285, -122.646099],
  [45.373063, -122.645926],
  [45.372756, -122.645685],
  [45.372709, -122.645652],
  [45.372609, -122.645583],
  [45.372553, -122.64555],
  [45.372495, -122.64552],
  [45.372432, -122.64549],
  [45.372364, -122.64546],
  [45.372297, -122.645433],
  [45.37224, -122.645417],
  [45.372103, -122.645382],
  [45.371914, -122.645358],
  [45.371846, -122.6453],
  [45.371774, -122.645302],
  [45.3717, -122.645307],
  [45.371632, -122.645317],
  [45.37161, -122.645321],
  [45.371415, -122.645365],
  [45.37136, -122.645386],
  [45.371282, -122.645423],
  [45.371123, -122.645503],
  [45.371047, -122.645551],
  [45.370978, -122.645599],
  [45.370907, -122.645652],
  [45.370851, -122.645698],
  [45.370808, -122.645735],
  [45.370513, -122.64603],
  [45.370459, -122.646081],
  [45.370364, -122.646155],
  [45.370308, -122.64619],
  [45.370258, -122.646217],
  [45.370199, -122.646246],
  [45.370004, -122.64632],
  [45.369976, -122.646329],
  [45.369824, -122.646381],
  [45.369635, -122.64645],
  [45.369541, -122.646488],
  [45.369456, -122.646528],
  [45.369386, -122.646571],
  [45.369297, -122.646627],
  [45.369211, -122.646677],
  [45.369147, -122.646716],
  [45.369115, -122.646794],
  [45.369015, -122.646837],
  [45.368949, -122.646861],
  [45.368921, -122.646872],
  [45.368807, -122.646908],
  [45.368741, -122.646879],
  [45.368628, -122.646914],
  [45.368358, -122.647005],
  [45.368239, -122.647045],
  [45.368158, -122.647135],
  [45.368042, -122.647175],
  [45.367941, -122.647202],
  [45.36778, -122.647257],
  [45.367709, -122.647276],
  [45.367574, -122.647302],
  [45.367458, -122.647321],
  [45.367372, -122.647281],
  [45.367294, -122.647305],
  [45.367215, -122.647336],
  [45.36712, -122.647382],
  [45.367025, -122.647436],
  [45.366944, -122.64749],
  [45.366744, -122.647651],
  [45.366695, -122.647753],
  [45.366619, -122.647804],
  [45.366554, -122.647841],
  [45.366399, -122.647919],
  [45.366318, -122.647948],
  [45.366248, -122.647969],
  [45.366112, -122.647999],
  [45.365935, -122.648023],
  [45.365874, -122.648035],
  [45.365791, -122.648059],
  [45.36573, -122.648078],
  [45.36535, -122.648229],
  [45.365221, -122.648211],
  [45.365115, -122.648253],
  [45.364855, -122.648351],
  [45.364667, -122.648421],
  [45.364611, -122.648442],
  [45.364338, -122.648551],
  [45.364262, -122.648582],
  [45.364206, -122.648672],
  [45.363735, -122.648858],
  [45.363531, -122.64894],
  [45.363421, -122.648981],
  [45.36335, -122.649002],
  [45.36327, -122.649024],
  [45.363169, -122.649045],
  [45.36308, -122.649053],
  [45.363002, -122.649059],
  [45.362918, -122.649055],
  [45.362848, -122.64905],
  [45.362826, -122.649047],
  [45.362765, -122.649039],
  [45.362682, -122.648998],
  [45.362524, -122.648951],
  [45.362415, -122.648908],
  [45.362342, -122.648869],
  [45.362277, -122.648833],
  [45.362189, -122.648776],
  [45.362063, -122.648679],
  [45.361978, -122.648605],
  [45.361906, -122.648533],
  [45.361828, -122.64844],
  [45.361762, -122.648356],
  [45.36168, -122.648241],
  [45.361591, -122.648099],
  [45.361386, -122.647781],
  [45.361328, -122.647702],
  [45.361273, -122.64763],
  [45.361226, -122.647573],
  [45.361119, -122.647454],
  [45.360896, -122.647255],
  [45.360847, -122.647208],
  [45.360443, -122.646831],
  [45.360234, -122.646638],
  [45.360113, -122.646522],
  [45.360031, -122.646446],
  [45.359979, -122.646401],
  [45.359909, -122.646347],
  [45.359852, -122.646306],
  [45.359794, -122.64627],
  [45.359743, -122.64624],
  [45.35965, -122.646206],
  [45.359551, -122.646172],
  [45.359461, -122.646145],
  [45.359411, -122.646133],
  [45.35935, -122.646124],
  [45.359276, -122.646119],
  [45.359199, -122.646121],
  [45.359132, -122.646124],
  [45.359031, -122.64614],
  [45.358967, -122.646159],
  [45.358893, -122.646181],
  [45.358803, -122.646221],
  [45.358704, -122.646267],
  [45.358679, -122.646282],
  [45.358607, -122.646326],
  [45.358566, -122.646355],
  [45.358472, -122.646412],
  [45.358397, -122.646452],
  [45.358301, -122.646494],
  [45.35823, -122.646516],
  [45.358187, -122.646532],
  [45.358137, -122.646543],
  [45.358032, -122.646562],
  [45.357932, -122.646568],
  [45.357867, -122.646566],
  [45.357799, -122.646561],
  [45.357724, -122.64655],
  [45.357657, -122.646535],
  [45.357554, -122.646507],
  [45.357457, -122.646472],
  [45.357357, -122.646414],
  [45.35726, -122.646353],
  [45.357254, -122.646348],
  [45.357183, -122.646295],
  [45.35711, -122.646234],
  [45.357033, -122.646162],
  [45.356916, -122.646038],
  [45.356569, -122.645657],
  [45.356146, -122.6452],
  [45.355915, -122.644949],
  [45.355831, -122.644858],
  [45.355624, -122.644636],
  [45.355509, -122.64452],
  [45.35545, -122.644468],
  [45.355321, -122.64437],
  [45.355143, -122.644271],
  [45.355092, -122.644247],
  [45.354952, -122.644178],
  [45.354755, -122.644121],
  [45.354008, -122.643896],
  [45.353574, -122.643768],
  [45.353361, -122.643704],
  [45.352989, -122.643596],
  [45.352629, -122.643486],
  [45.352444, -122.643435],
  [45.352232, -122.643377],
  [45.352171, -122.643363],
  [45.352108, -122.643352],
  [45.352055, -122.643347],
  [45.351945, -122.643338],
  [45.351883, -122.643349],
  [45.351818, -122.643364],
  [45.351799, -122.643369],
  [45.351749, -122.643382],
  [45.351666, -122.643411],
  [45.3516, -122.643443],
  [45.351534, -122.643479],
  [45.35147, -122.64352],
  [45.351397, -122.643579],
  [45.351307, -122.643661],
  [45.351231, -122.643672],
  [45.351059, -122.643833],
  [45.350986, -122.643904],
  [45.350916, -122.643974],
  [45.350677, -122.644217],
  [45.350348, -122.644565],
  [45.349954, -122.64497],
  [45.349654, -122.645293],
  [45.349583, -122.645375],
  [45.349538, -122.645431],
  [45.349497, -122.645489],
  [45.349428, -122.645593],
  [45.349381, -122.645675],
  [45.349347, -122.64574],
  [45.349317, -122.645801],
  [45.349276, -122.645902],
  [45.349247, -122.645982],
  [45.349226, -122.64605],
  [45.349203, -122.646129],
  [45.349185, -122.646201],
  [45.349167, -122.64628],
  [45.349133, -122.646441],
  [45.348984, -122.647177],
  [45.348877, -122.647729],
  [45.348738, -122.648427],
  [45.348616, -122.649048],
  [45.348577, -122.649281],
  [45.348567, -122.649344],
  [45.348558, -122.649409],
  [45.348548, -122.649492],
  [45.34854, -122.649576],
  [45.348533, -122.64965],
  [45.348529, -122.649727],
  [45.348524, -122.649821],
  [45.348523, -122.649922],
  [45.348524, -122.649999],
  [45.348526, -122.650072],
  [45.348531, -122.650176],
  [45.348543, -122.650316],
  [45.348558, -122.650446],
  [45.348574, -122.650536],
  [45.348632, -122.650841],
  [45.34866, -122.650947],
  [45.348678, -122.651016],
  [45.348736, -122.651181],
  [45.348862, -122.651492],
  [45.348982, -122.65175],
  [45.349279, -122.652372],
  [45.349451, -122.652752],
  [45.349481, -122.652818],
  [45.349786, -122.653468],
  [45.349974, -122.653886],
  [45.350021, -122.653989],
  [45.350411, -122.654819],
  [45.350559, -122.655135],
  [45.350742, -122.655502],
  [45.350856, -122.655714],
  [45.350908, -122.655818],
  [45.351071, -122.656117],
  [45.351383, -122.65679],
  [45.35144, -122.656915],
  [45.351509, -122.657047],
  [45.351716, -122.657459],
  [45.351853, -122.657732],
  [45.351886, -122.657811],
  [45.351916, -122.657902],
  [45.351936, -122.657991],
  [45.351957, -122.658114],
  [45.351967, -122.65821],
  [45.351971, -122.658318],
  [45.351971, -122.658325],
  [45.35197, -122.658495],
  [45.35195, -122.658796],
  [45.351904, -122.65944],
  [45.351883, -122.659685],
  [45.351847, -122.660068],
  [45.351789, -122.660663],
  [45.351749, -122.661033],
  [45.351708, -122.661467],
  [45.351701, -122.661643],
  [45.351693, -122.661947],
  [45.351682, -122.66212],
  [45.351667, -122.662238],
  [45.351648, -122.662358],
  [45.35161, -122.662547],
  [45.351524, -122.662846],
  [45.351513, -122.662875],
  [45.351477, -122.662981],
  [45.351446, -122.663066],
  [45.351414, -122.663192],
  [45.351407, -122.663251],
  [45.351399, -122.663429],
  [45.351372, -122.664666],
  [45.351328, -122.666425],
  [45.351323, -122.666627],
  [45.351315, -122.666949],
  [45.351124, -122.666962],
  [45.350498, -122.666966],
  [45.349833, -122.666966],
  [45.349603, -122.66697],
  [45.34898, -122.666973],
  [45.348914, -122.666973],
  [45.348176, -122.666973],
  [45.347819, -122.666965],
  [45.347729, -122.666963],
  [45.347632, -122.666962],
  [45.347556, -122.666961],
  [45.345897, -122.666961],
  [45.345392, -122.666963],
  [45.344526, -122.666966],
  [45.34431, -122.666967],
  [45.344145, -122.666424],
  [45.34395, -122.665791],
  [45.343862, -122.665498],
  [45.343816, -122.665327],
  [45.343792, -122.665217],
  [45.343755, -122.665047],
  [45.343679, -122.664578],
  [45.343458, -122.663267],
  [45.343442, -122.663174],
  [45.343057, -122.660906],
  [45.342999, -122.66055],
  [45.342982, -122.660412],
  [45.34297, -122.660293],
  [45.342968, -122.660233],
  [45.342962, -122.660111],
  [45.342961, -122.659977],
  [45.342971, -122.659821],
  [45.342987, -122.659666],
  [45.343008, -122.659517],
  [45.343037, -122.659377],
  [45.34307, -122.659221],
  [45.343117, -122.659034],
  [45.343392, -122.658095],
  [45.343424, -122.657982],
  [45.343476, -122.657799],
  [45.343697, -122.657011],
  [45.343757, -122.656797],
  [45.344454, -122.657211],
  [45.344906, -122.655611],
  [45.345073, -122.655039]
];

const stopNames = {
  "3": "A Ave &amp; Second St",
  "3812": "600 Block McVey",
  "3813": "McVey &amp; Cornell",
  "5510": "N State &amp; Foothills",
  "5511": "S State &amp; Middlecrest",
  "5513": "N State &amp; North Shore Rd",
  "8208": "Lake Oswego Transit Center ",
  "9270": "Blankenship &amp; Virginia Lane",
  "9276": "Blankenship &amp; 19th St",
  "9277": "Blankenship &amp; Ostman",
  "9279": "Ostman &amp; Dollar",
  "9284": "Willamette Falls Dr &amp; 19th St",
  "9297": "Blankenship &amp; Tannler Dr",
  "10519": "Salamo &amp; Day Rd",
  "10522": "Salamo &amp; Barrington Dr",
  "10523": "Ostman &amp; Willamette Falls Dr",
  "10548": "Blankenship &amp; Debok",
  "14485": "8th Ave &amp; 13th St",
  "14487": "McVey &amp; Laurel St",
  "14488": "Stafford &amp; Bergis",
  "14489": "Hidden Springs &amp; Suncrest Dr",
  "14490": "Santa Anita &amp; Pimlico",
  "14491": "Santa Anita &amp; Churchill Downs",
  "14492": "Salamo &amp; Rosemont",
  "14493": "Salamo &amp; Bland Circle"
};

const stops = [
  { stop_id: "8208", name: "Lake Oswego Transit Center ", lat: 45.420627, lon: -122.66788, times: ["12:51 PM", "1:47 PM", "2:44 PM", "3:41 PM", "4:44 PM", "5:53 AM", "6:50 AM", "7:51 AM"] },
  { stop_id: "3", name: "A Ave &amp; Second St", lat: 45.419388, lon: -122.665197, times: ["12:51 PM", "1:47 PM", "2:44 PM", "3:41 PM", "4:44 PM", "5:53 AM", "6:50 AM", "7:51 AM"] },
  { stop_id: "5510", name: "N State &amp; Foothills", lat: 45.417547, lon: -122.663423, times: ["12:52 PM", "1:48 PM", "2:45 PM", "3:42 PM", "4:45 PM", "5:54 AM", "6:51 AM", "7:52 AM"] },
  { stop_id: "5513", name: "N State &amp; North Shore Rd", lat: 45.415755, lon: -122.663813, times: ["12:52 PM", "1:48 PM", "2:45 PM", "3:43 PM", "4:46 PM", "5:54 AM", "6:51 AM", "7:52 AM"] },
  { stop_id: "5511", name: "S State &amp; Middlecrest", lat: 45.413169, lon: -122.66441, times: ["12:53 PM", "1:49 PM", "2:46 PM", "3:44 PM", "4:47 PM", "5:55 AM", "6:52 AM", "7:53 AM"] },
  { stop_id: "3812", name: "600 Block McVey", lat: 45.410804, lon: -122.666168, times: ["12:54 PM", "1:50 PM", "2:47 PM", "3:44 PM", "4:47 PM", "5:56 AM", "6:53 AM", "7:54 AM"] },
  { stop_id: "3813", name: "McVey &amp; Cornell", lat: 45.408805, lon: -122.672066, times: ["12:55 PM", "1:51 PM", "2:48 PM", "3:46 PM", "4:49 PM", "5:57 AM", "6:54 AM", "7:55 AM"] },
  { stop_id: "14487", name: "McVey &amp; Laurel St", lat: 45.407258, lon: -122.676241, times: ["12:56 PM", "1:52 PM", "2:49 PM", "3:47 PM", "4:50 PM", "5:58 AM", "6:55 AM", "7:56 AM"] },
  { stop_id: "14488", name: "Stafford &amp; Bergis", lat: 45.400816, lon: -122.683401, times: ["12:57 PM", "1:53 PM", "2:50 PM", "3:48 PM", "4:51 PM", "5:59 AM", "6:56 AM", "7:57 AM"] },
  { stop_id: "14489", name: "Hidden Springs &amp; Suncrest Dr", lat: 45.37686, lon: -122.654226, times: ["1:04 PM", "2:01 PM", "2:58 PM", "3:56 PM", "4:59 PM", "6:06 AM", "7:03 AM", "8:05 AM"] },
  { stop_id: "14490", name: "Santa Anita &amp; Pimlico", lat: 45.373869, lon: -122.6466, times: ["1:05 PM", "2:02 PM", "2:59 PM", "3:57 PM", "5:00 PM", "6:07 AM", "7:04 AM", "8:06 AM"] },
  { stop_id: "14491", name: "Santa Anita &amp; Churchill Downs", lat: 45.371622, lon: -122.645423, times: ["1:06 PM", "2:03 PM", "3:00 PM", "3:58 PM", "5:01 PM", "6:08 AM", "7:05 AM", "8:07 AM"] },
  { stop_id: "14492", name: "Salamo &amp; Rosemont", lat: 45.368957, lon: -122.646901, times: ["1:06 PM", "2:03 PM", "3:00 PM", "3:58 PM", "5:01 PM", "6:08 AM", "7:05 AM", "8:07 AM"] },
  { stop_id: "10519", name: "Salamo &amp; Day Rd", lat: 45.362824, lon: -122.649117, times: ["1:08 PM", "2:05 PM", "3:02 PM", "4:00 PM", "5:03 PM", "6:10 AM", "7:07 AM", "8:09 AM"] },
  { stop_id: "14493", name: "Salamo &amp; Bland Circle", lat: 45.357237, lon: -122.646394, times: ["1:09 PM", "2:06 PM", "3:03 PM", "4:01 PM", "5:04 PM", "6:11 AM", "7:08 AM", "8:10 AM"] },
  { stop_id: "10522", name: "Salamo &amp; Barrington Dr", lat: 45.351809, lon: -122.64343, times: ["12:10 PM", "1:10 PM", "2:07 PM", "3:04 PM", "4:02 PM", "5:05 PM", "6:12 AM", "7:09 AM"] },
  { stop_id: "9297", name: "Blankenship &amp; Tannler Dr", lat: 45.350054, lon: -122.653809, times: ["12:13 PM", "1:13 PM", "2:10 PM", "3:07 PM", "4:05 PM", "5:08 PM", "6:15 AM", "7:12 AM"] },
  { stop_id: "9270", name: "Blankenship &amp; Virginia Lane", lat: 45.351431, lon: -122.656745, times: ["12:13 PM", "1:13 PM", "2:10 PM", "3:07 PM", "4:05 PM", "5:08 PM", "6:15 AM", "7:12 AM"] },
  { stop_id: "10548", name: "Blankenship &amp; Debok", lat: 45.352038, lon: -122.658313, times: ["12:13 PM", "1:13 PM", "2:10 PM", "3:07 PM", "4:05 PM", "5:08 PM", "6:15 AM", "7:12 AM"] },
  { stop_id: "9276", name: "Blankenship &amp; 19th St", lat: 45.35156, lon: -122.662909, times: ["12:14 PM", "1:14 PM", "2:11 PM", "3:08 PM", "4:06 PM", "5:09 PM", "6:16 AM", "7:13 AM"] },
  { stop_id: "9277", name: "Blankenship &amp; Ostman", lat: 45.351394, lon: -122.66663, times: ["12:15 PM", "1:15 PM", "2:12 PM", "3:09 PM", "4:07 PM", "5:10 PM", "6:17 AM", "7:14 AM"] },
  { stop_id: "9279", name: "Ostman &amp; Dollar", lat: 45.347831, lon: -122.667069, times: ["12:16 PM", "1:16 PM", "2:13 PM", "3:10 PM", "4:08 PM", "5:11 PM", "6:18 AM", "7:15 AM"] },
  { stop_id: "10523", name: "Ostman &amp; Willamette Falls Dr", lat: 45.344527, lon: -122.667062, times: ["12:17 PM", "1:17 PM", "2:14 PM", "3:11 PM", "4:09 PM", "5:12 PM", "6:19 AM", "7:16 AM"] },
  { stop_id: "9284", name: "Willamette Falls Dr &amp; 19th St", lat: 45.343419, lon: -122.663277, times: ["12:18 PM", "1:18 PM", "2:15 PM", "3:12 PM", "4:10 PM", "5:13 PM", "6:20 AM", "7:17 AM"] },
  { stop_id: "14485", name: "8th Ave &amp; 13th St", lat: 45.345032, lon: -122.655013, times: ["12:20 PM", "1:20 PM", "2:17 PM", "3:14 PM", "4:12 PM", "5:15 PM", "6:22 AM", "7:19 AM"] },
]

    const polylineOut = L.polyline(shapeOutbound, { color: 'blue', weight: 4, opacity: 0.7 }).addTo(map);
    map.fitBounds(polylineOut.getBounds());

    const nowPT = new Date(new Date().toLocaleString('en-US', { timeZone: 'America/Los_Angeles' }));
    const nowMins = nowPT.getHours() * 60 + nowPT.getMinutes();

    stops.forEach(stop => {
      let highlightedTimes = [];
      let foundNext = false;
      stop.times.forEach(timeStr => {
        let cleanTime = timeStr.trim();
        let [h, m] = cleanTime.split(":");
        let schedMins = parseInt(h, 10) * 60 + parseInt(m, 10);
        if (schedMins < nowMins && nowMins - schedMins > 720) {
          schedMins += 1440;
        }
        if (!foundNext && schedMins >= nowMins) {
          highlightedTimes.push(`<span style="background:#4dd0e1; color:#000; padding:2px 6px; border-radius:6px; font-weight:bold;">${cleanTime}</span>`);
          foundNext = true;
        } else {
          highlightedTimes.push(cleanTime);
        }
      });

      L.circleMarker([stop.lat, stop.lon], {
        radius: 6,
        color: '#4dd0e1',
        fillColor: '#4dd0e1',
        fillOpacity: 0.9,
        weight: 1
      })
      .bindPopup(`<strong>${stop.name}</strong><br>${highlightedTimes.join("<br>") || 'No scheduled times'}`)
      .addTo(map);
    });

    let busMarkers = {};
    async function fetchAndDisplay() {
      const res = await fetch(`https://developer.trimet.org/ws/v2/vehicles?route=${routeNumber}&appID=${apiKey}&json=true`);
      const data = await res.json();
      const buses = (data.resultSet.vehicle || []).filter(v => v.routeNumber == routeNumber && v.direction == direction);

      Object.values(busMarkers).forEach(m => map.removeLayer(m));
      busMarkers = {};
      if (!buses.length) return;

      buses.forEach(bus => {
        if (!bus.latitude || !bus.longitude || !bus.blockID) return;
        const icon = L.divIcon({    
           className: '',
           html: `
            <div style="text-align:center;">
              <div style="background:#0071CE;color:#fff;padding:2px 6px;border-radius:6px;font-weight:bold;">${bus.vehicleID}</div>
              <div style="width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-top:10px solid #00bfff;margin:auto;"></div>
            </div>
          `,
          iconSize: [40, 30], iconAnchor: [20, 30]
        });
        const marker = L.marker([bus.latitude, bus.longitude], { icon }).addTo(map);
        busMarkers[bus.vehicleID] = marker;
      });
    }
    fetchAndDisplay();
    setInterval(fetchAndDisplay, 15000);
  </script>

  <footer class="site-footer">
    <a href="terms.html">Terms of Use</a> &nbsp;|&nbsp;
    <a href="contact.html">Contact Us</a> &nbsp;|&nbsp;
    <a href="report.html">Report a Problem</a> &nbsp;|&nbsp;
    <a href="dmca.html">DMCA</a> &nbsp;|&nbsp;
    <a href="privacy.html">Privacy Policy</a>
  </footer>

  <script>
    if (!localStorage.getItem('cookieConsent')) {
      document.write(`
        <div id="cookie-banner" style="position: fixed; bottom: 0; left: 0; right: 0; background: #333; color: #fff; padding: 1rem; z-index: 1000; font-size: 0.9rem; line-height: 1.4; text-align: center; box-sizing: border-box;">
          üì¢ We use cookies to improve functionality and analyze traffic.
          By using MetroFeed, you agree to our 
          <a href='privacy.html' style='color: #4dd0e1; text-decoration: underline;'>Privacy Policy</a>.<br>
          <button onclick='localStorage.setItem("cookieConsent", "true"); document.getElementById("cookie-banner").remove();' style='margin-top: 0.5rem; background: #4dd0e1; color: #000; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer; font-weight: bold;'>OK</button>
        </div>
      `);
    }
  </script>
</body>
</html>