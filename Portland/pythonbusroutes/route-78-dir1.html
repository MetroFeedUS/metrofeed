<!DOCTYPE html>
<html lang="en">
<head>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EL337T4JX4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-EL337T4JX4');
</script>

<meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Route 78 - To Beaverton Transit Center | MetroFeed Portland</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #0d0d0d;
      color: #cccccc;
      overflow-y: auto;
    }

    body {
      padding-top: 120px;
    }

    .ad-banner {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: #222;
      padding: 0;
      z-index: 1000;
      box-shadow: 0 2px 2px rgba(0,0,0,0.5);
      text-align: center;
    }

    .ad-banner img {
      width: 100%;
      max-width: 728px;
      max-height: 120px;
      display: block;
      margin: 0 auto;
    }
    .home-button {
      position: fixed;
      top: 120px;
      left: 10px;
      background-color: #4dd0e1;
      color: #0d0d0d;
      padding: 0.5rem 1rem;
      font-weight: bold;
      border-radius: 8px;
      text-decoration: none;
      z-index: 1001;
      box-shadow: 0 0 10px #4dd0e1;
    }

    .home-button:hover {
      background-color: #00bcd4;
      color: #ffffff;
    }

    header {
      background-color: #0d0d0d;
      border-top: 4px solid #4dd0e1;
      border-bottom: 3px solid #4dd0e1;
      padding: 1rem;
      text-align: center;
    }

    header img {
      max-height: 60px;
    }

    h1 {
      text-align: center;
      margin: 1rem 0;
      font-size: 2rem;
      color: #f0f0f0;
    }

    .content-box {
      border-radius: 12px;
      padding: 0;
      margin: 0;
      background-color: #1e1e1e;
    }

    #map {
      width: 100%;
      height: 85vh;
      border: none;
      margin: 0 auto;
      display: block;
      border-radius: 8px;
    }

    .button-bar {
      display: flex;
      justify-content: center;
      margin: 1rem 0;
    }

    .button-bar a, .back-button {
      background: #4dd0e1;
      color: #0d0d0d;
      padding: 0.6rem 1.2rem;
      text-decoration: none;
      border-radius: 8px;
      font-weight: bold;
      border: none;
      cursor: pointer;
      box-shadow: 0 0 10px #4dd0e1;
    }

    .back-button:hover {
      background-color: #35c0d6;
    }

    .site-footer {
      text-align: center;
      margin-top: 3rem;
      margin-bottom: 120px;
      font-size: 0.85rem;
      color: #aaa;
    }

    .site-footer a {
      color: #00BFFF;
      text-decoration: none;
    }

    .site-footer a:hover {
      text-decoration: underline;
    }

    @media (max-width: 600px) {
      .ad-banner {
        padding-top: 1rem;
        padding-bottom: 0rem;
      }
    }
  </style>
</head>

<body>
  <div class="ad-banner">
    <iframe src="https://metrofeedus.com/portland/Ads/route-78-dir1-ad.html" style="border:none; width:100%; max-width: 728px; height:90px;"></iframe>
  </div>

  <header>
    <img src="MetroFeedPortlandLogo.png" alt="MetroFeed Portland">
  </header>

  <div class="disclaimer" style="margin: 1rem auto 0.5rem; max-width: 600px; font-size: 0.8rem; color: #bbb; text-align: center; padding: 0.5rem 1rem; background-color: #111; border: 1px dashed #444; border-radius: 6px;">
    ‚ö†Ô∏è This is a Beta program, work in progress. Please REPORT bugs and pretend to be impressed.
  </div>
  <div class="disclaimer" style="margin: 0 auto 1rem; max-width: 600px; font-size: 0.75rem; color: #888; text-align: center; padding: 0.25rem 1rem;">
    This tool is not affiliated with or endorsed by TriMet. For official schedules and service alerts, visit <a href="https://trimet.org" style="color:#4dd0e1;">trimet.org</a>.
  </div>

  <div style="margin: 2rem 0; text-align: center;">
    <button class="back-button" onclick="history.back()">Back</button>
  </div>

  <h1>Route 78 - To Beaverton Transit Center</h1>

  <div class="content-box">
    <div id="map"></div>
    <div style="text-align:right; font-size: 0.7rem; color: #777; margin-top: 0.5rem;">
      Data courtesy of TriMet.
    </div>
  </div>

  <script>
    if (document.referrer === "" && performance.navigation.type === 0) {
      window.location.href = "/index.html";
    }

    const apiKey = "2C4447D4A42083BCD84DE3B8E";
    const routeNumber = 78;
    const direction = parseInt(1);

    const map = L.map('map', {
      center: [45.6, -122.7],
      zoom: 12,
      minZoom: 12,
      maxZoom: 18,
      maxBounds: [[45.3, -123.1], [45.9, -122.3]],
      maxBoundsViscosity: 1.0
    });
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);

    const shapeOutbound = [
  [45.430215, -122.769472],
  [45.430173, -122.769413],
  [45.430089, -122.769295],
  [45.430051, -122.769209],
  [45.430041, -122.769153],
  [45.430033, -122.769094],
  [45.430041, -122.769036],
  [45.430096, -122.768939],
  [45.43021, -122.768764],
  [45.43025, -122.768821],
  [45.430433, -122.769078],
  [45.43067, -122.769411],
  [45.430758, -122.769537],
  [45.430876, -122.769707],
  [45.431162, -122.770118],
  [45.431214, -122.770187],
  [45.431329, -122.770003],
  [45.4315, -122.769731],
  [45.431566, -122.769624],
  [45.431608, -122.769557],
  [45.431705, -122.769403],
  [45.43181, -122.769235],
  [45.431832, -122.769199],
  [45.431857, -122.769157],
  [45.431939, -122.769025],
  [45.432048, -122.768849],
  [45.432211, -122.768583],
  [45.432247, -122.768525],
  [45.432297, -122.768449],
  [45.432326, -122.76834],
  [45.43242, -122.768167],
  [45.432482, -122.76802],
  [45.432527, -122.767877],
  [45.432556, -122.76775],
  [45.432581, -122.767597],
  [45.432605, -122.767391],
  [45.43261, -122.767343],
  [45.432631, -122.767257],
  [45.432668, -122.767177],
  [45.432699, -122.767132],
  [45.432769, -122.767071],
  [45.432852, -122.767033],
  [45.432919, -122.767014],
  [45.432976, -122.767015],
  [45.433012, -122.767024],
  [45.433054, -122.767042],
  [45.433114, -122.767167],
  [45.433221, -122.767291],
  [45.433292, -122.767383],
  [45.433408, -122.767556],
  [45.433428, -122.767585],
  [45.433476, -122.767651],
  [45.433616, -122.767848],
  [45.43367, -122.76792],
  [45.43371, -122.767972],
  [45.433864, -122.768189],
  [45.433896, -122.768232],
  [45.433898, -122.768235],
  [45.433937, -122.768286],
  [45.43404, -122.768436],
  [45.434185, -122.768647],
  [45.4342, -122.768667],
  [45.434263, -122.76876],
  [45.434399, -122.768957],
  [45.434579, -122.769218],
  [45.434599, -122.769247],
  [45.434638, -122.769303],
  [45.434706, -122.769413],
  [45.43478, -122.769536],
  [45.434876, -122.769707],
  [45.435069, -122.770049],
  [45.435135, -122.770168],
  [45.435485, -122.770794],
  [45.435533, -122.770885],
  [45.43563, -122.771079],
  [45.435817, -122.77148],
  [45.436204, -122.772307],
  [45.436355, -122.772636],
  [45.436433, -122.772831],
  [45.436486, -122.772992],
  [45.436532, -122.773131],
  [45.436617, -122.773441],
  [45.436631, -122.773492],
  [45.436867, -122.774369],
  [45.436899, -122.774507],
  [45.436917, -122.774624],
  [45.437062, -122.77567],
  [45.437067, -122.775707],
  [45.437106, -122.775999],
  [45.437132, -122.776192],
  [45.437167, -122.776376],
  [45.437186, -122.776471],
  [45.437252, -122.77674],
  [45.437262, -122.77678],
  [45.437417, -122.777444],
  [45.437526, -122.777906],
  [45.437586, -122.778151],
  [45.437614, -122.778258],
  [45.437647, -122.77837],
  [45.437685, -122.778471],
  [45.437738, -122.778594],
  [45.437792, -122.778692],
  [45.43784, -122.778773],
  [45.437928, -122.77889],
  [45.437956, -122.778929],
  [45.438075, -122.77904],
  [45.438143, -122.779097],
  [45.438214, -122.779148],
  [45.43827, -122.779179],
  [45.438551, -122.779308],
  [45.438608, -122.779335],
  [45.438793, -122.779422],
  [45.438855, -122.77945],
  [45.439013, -122.779525],
  [45.43929, -122.779662],
  [45.439401, -122.779717],
  [45.439448, -122.779736],
  [45.439644, -122.779812],
  [45.439735, -122.779835],
  [45.439767, -122.779843],
  [45.439876, -122.779861],
  [45.439981, -122.779874],
  [45.440061, -122.779878],
  [45.440152, -122.779879],
  [45.440257, -122.779865],
  [45.440426, -122.779831],
  [45.440473, -122.77982],
  [45.440527, -122.779806],
  [45.440588, -122.779785],
  [45.440652, -122.779764],
  [45.440798, -122.779698],
  [45.440852, -122.779667],
  [45.440901, -122.77964],
  [45.440997, -122.779575],
  [45.441104, -122.779495],
  [45.441247, -122.779372],
  [45.441312, -122.779303],
  [45.441344, -122.779268],
  [45.441374, -122.779234],
  [45.441431, -122.779168],
  [45.441471, -122.779122],
  [45.44171, -122.778848],
  [45.441911, -122.77862],
  [45.441937, -122.778594],
  [45.442042, -122.778485],
  [45.442162, -122.77836],
  [45.442316, -122.778197],
  [45.442558, -122.777937],
  [45.442716, -122.777791],
  [45.442904, -122.777658],
  [45.442997, -122.777607],
  [45.443169, -122.777526],
  [45.443363, -122.777431],
  [45.443926, -122.777198],
  [45.444023, -122.777156],
  [45.444126, -122.777116],
  [45.444265, -122.777078],
  [45.44434, -122.77695],
  [45.44437, -122.776932],
  [45.444615, -122.776831],
  [45.444702, -122.776883],
  [45.444804, -122.776845],
  [45.445447, -122.776606],
  [45.445887, -122.776442],
  [45.445997, -122.776396],
  [45.446233, -122.776285],
  [45.446292, -122.776257],
  [45.446413, -122.776131],
  [45.446781, -122.775965],
  [45.446873, -122.776004],
  [45.446846, -122.775892],
  [45.44684, -122.775848],
  [45.446847, -122.775038],
  [45.446854, -122.774333],
  [45.446857, -122.773732],
  [45.446861, -122.773145],
  [45.446865, -122.772376],
  [45.446866, -122.77195],
  [45.446867, -122.771806],
  [45.44687, -122.771586],
  [45.446885, -122.769645],
  [45.446887, -122.76936],
  [45.446894, -122.768485],
  [45.446891, -122.768218],
  [45.446883, -122.768049],
  [45.446869, -122.767952],
  [45.446845, -122.767825],
  [45.446773, -122.767591],
  [45.446717, -122.767414],
  [45.446658, -122.767216],
  [45.446631, -122.767094],
  [45.446607, -122.766942],
  [45.4466, -122.766846],
  [45.446598, -122.766814],
  [45.446596, -122.766635],
  [45.446594, -122.766367],
  [45.446593, -122.766256],
  [45.446593, -122.766172],
  [45.446594, -122.765993],
  [45.446595, -122.765763],
  [45.446596, -122.76563],
  [45.446694, -122.765634],
  [45.447001, -122.765628],
  [45.447111, -122.765627],
  [45.44722, -122.765623],
  [45.447397, -122.765616],
  [45.447513, -122.765595],
  [45.447636, -122.765557],
  [45.447708, -122.765531],
  [45.447779, -122.765496],
  [45.447855, -122.765457],
  [45.448046, -122.765347],
  [45.448137, -122.76529],
  [45.448263, -122.765208],
  [45.448442, -122.765075],
  [45.448551, -122.765],
  [45.448671, -122.764909],
  [45.448741, -122.764856],
  [45.449132, -122.764563],
  [45.449226, -122.764505],
  [45.449293, -122.764477],
  [45.449357, -122.764451],
  [45.449446, -122.764429],
  [45.449503, -122.764421],
  [45.44956, -122.76442],
  [45.449687, -122.76443],
  [45.44979, -122.764468],
  [45.449851, -122.764504],
  [45.449919, -122.764547],
  [45.449975, -122.764598],
  [45.450046, -122.764675],
  [45.450105, -122.764755],
  [45.450124, -122.764784],
  [45.450159, -122.764843],
  [45.450207, -122.764938],
  [45.450234, -122.765003],
  [45.450332, -122.76524],
  [45.45043, -122.765477],
  [45.450661, -122.766086],
  [45.450815, -122.76648],
  [45.450858, -122.766593],
  [45.4509, -122.766708],
  [45.450976, -122.76693],
  [45.451242, -122.767834],
  [45.451372, -122.768269],
  [45.451401, -122.768363],
  [45.45167, -122.769259],
  [45.451861, -122.769904],
  [45.452078, -122.770596],
  [45.452132, -122.770757],
  [45.452461, -122.771728],
  [45.452584, -122.772092],
  [45.452773, -122.772643],
  [45.452813, -122.772763],
  [45.45307, -122.773526],
  [45.453167, -122.773816],
  [45.453221, -122.773976],
  [45.45328, -122.774167],
  [45.453327, -122.774319],
  [45.453479, -122.774783],
  [45.453559, -122.775029],
  [45.453618, -122.775209],
  [45.453737, -122.775561],
  [45.453768, -122.775659],
  [45.453968, -122.776282],
  [45.453854, -122.776349],
  [45.4538, -122.776377],
  [45.453749, -122.77639],
  [45.453703, -122.776397],
  [45.453458, -122.776401],
  [45.453169, -122.776409],
  [45.452995, -122.776413],
  [45.452873, -122.776415],
  [45.452869, -122.776914],
  [45.452868, -122.776963],
  [45.452863, -122.777437],
  [45.452861, -122.777635],
  [45.452859, -122.77784],
  [45.452857, -122.778035],
  [45.452854, -122.778231],
  [45.452852, -122.778443],
  [45.452853, -122.778642],
  [45.452855, -122.778731],
  [45.452257, -122.778725],
  [45.452181, -122.77871],
  [45.452141, -122.778712],
  [45.452113, -122.778733],
  [45.452095, -122.778792],
  [45.452095, -122.77884],
  [45.452111, -122.778897],
  [45.452128, -122.77893],
  [45.452164, -122.778957],
  [45.45221, -122.778961],
  [45.452256, -122.77894],
  [45.452331, -122.778897],
  [45.452398, -122.778897],
  [45.452537, -122.778895],
  [45.452696, -122.778895],
  [45.45279, -122.778894],
  [45.452859, -122.778892],
  [45.452865, -122.77906],
  [45.452876, -122.779268],
  [45.452887, -122.779468],
  [45.45289, -122.779519],
  [45.452904, -122.77968],
  [45.452926, -122.779837],
  [45.452929, -122.779929],
  [45.452932, -122.780172],
  [45.452942, -122.780237],
  [45.452954, -122.780286],
  [45.452978, -122.780338],
  [45.453018, -122.780406],
  [45.453082, -122.780488],
  [45.453158, -122.780569],
  [45.453221, -122.780645],
  [45.453313, -122.780552],
  [45.453367, -122.780528],
  [45.453914, -122.780433],
  [45.45406, -122.78042],
  [45.454175, -122.780419],
  [45.45443, -122.780422],
  [45.454728, -122.780422],
  [45.45493, -122.780422],
  [45.454989, -122.780379],
  [45.455066, -122.780381],
  [45.455161, -122.780382],
  [45.455241, -122.780433],
  [45.455523, -122.780429],
  [45.455581, -122.780421],
  [45.455612, -122.780412],
  [45.455641, -122.780393],
  [45.455694, -122.780351],
  [45.455794, -122.780258],
  [45.45587, -122.78038],
  [45.455935, -122.780485],
  [45.455991, -122.780587],
  [45.456046, -122.780693],
  [45.456105, -122.780817],
  [45.456245, -122.781128],
  [45.456343, -122.781347],
  [45.456608, -122.781934],
  [45.456742, -122.782231],
  [45.456765, -122.782283],
  [45.456833, -122.782436],
  [45.456958, -122.782371],
  [45.45728, -122.782198],
  [45.457485, -122.782088],
  [45.457737, -122.781953],
  [45.457831, -122.781902],
  [45.457863, -122.781885],
  [45.458416, -122.781585],
  [45.458728, -122.781416],
  [45.459205, -122.78115],
  [45.460115, -122.780659],
  [45.460349, -122.780532],
  [45.46054, -122.78043],
  [45.460551, -122.780424],
  [45.460805, -122.780286],
  [45.461097, -122.78013],
  [45.46208, -122.779604],
  [45.462156, -122.779568],
  [45.462399, -122.779451],
  [45.462537, -122.779383],
  [45.462988, -122.779153],
  [45.463144, -122.779076],
  [45.463488, -122.778902],
  [45.463831, -122.778711],
  [45.464489, -122.778345],
  [45.464511, -122.778326],
  [45.464548, -122.778312],
  [45.464963, -122.778079],
  [45.464991, -122.778067],
  [45.465015, -122.778056],
  [45.465866, -122.777603],
  [45.466431, -122.777308],
  [45.467024, -122.777008],
  [45.467485, -122.776781],
  [45.467554, -122.776744],
  [45.467637, -122.776705],
  [45.467915, -122.776566],
  [45.46798, -122.776533],
  [45.468354, -122.776346],
  [45.468661, -122.776192],
  [45.46897, -122.77604],
  [45.469285, -122.775885],
  [45.469356, -122.775848],
  [45.46937, -122.775981],
  [45.469372, -122.776224],
  [45.469365, -122.776786],
  [45.469362, -122.776983],
  [45.469356, -122.777378],
  [45.469347, -122.77763],
  [45.469343, -122.777758],
  [45.469337, -122.778077],
  [45.469335, -122.778373],
  [45.469336, -122.778718],
  [45.469338, -122.779096],
  [45.469339, -122.779322],
  [45.469344, -122.779888],
  [45.469344, -122.779891],
  [45.469346, -122.780257],
  [45.469349, -122.780694],
  [45.469355, -122.781237],
  [45.469362, -122.781946],
  [45.469363, -122.782202],
  [45.469365, -122.782487],
  [45.469372, -122.783743],
  [45.469372, -122.783848],
  [45.469373, -122.784357],
  [45.469374, -122.784605],
  [45.469375, -122.784746],
  [45.469378, -122.785165],
  [45.46938, -122.785407],
  [45.46938, -122.78565],
  [45.469381, -122.786238],
  [45.469382, -122.786399],
  [45.469383, -122.787109],
  [45.469359, -122.788004],
  [45.469356, -122.788586],
  [45.469353, -122.78883],
  [45.469348, -122.789449],
  [45.469346, -122.78991],
  [45.469345, -122.790099],
  [45.469345, -122.790127],
  [45.469379, -122.790231],
  [45.469379, -122.790293],
  [45.469377, -122.790381],
  [45.469342, -122.790476],
  [45.469341, -122.790515],
  [45.469341, -122.790528],
  [45.46934, -122.790883],
  [45.469336, -122.791204],
  [45.469336, -122.791263],
  [45.469335, -122.791438],
  [45.469334, -122.791555],
  [45.469333, -122.791616],
  [45.469331, -122.791853],
  [45.469325, -122.792923],
  [45.46932, -122.793715],
  [45.469317, -122.794024],
  [45.469317, -122.79415],
  [45.469315, -122.794323],
  [45.469313, -122.794607],
  [45.469314, -122.794729],
  [45.469322, -122.795257],
  [45.469321, -122.795611],
  [45.469319, -122.79597],
  [45.469311, -122.796291],
  [45.469303, -122.796531],
  [45.46929, -122.79689],
  [45.469281, -122.797153],
  [45.469268, -122.797688],
  [45.469261, -122.798419],
  [45.469257, -122.798773],
  [45.469253, -122.799346],
  [45.469251, -122.799489],
  [45.46925, -122.799877],
  [45.469248, -122.800334],
  [45.469898, -122.800328],
  [45.470085, -122.800326],
  [45.470745, -122.800329],
  [45.471474, -122.80033],
  [45.472626, -122.800335],
  [45.472759, -122.800335],
  [45.473447, -122.800338],
  [45.473769, -122.800339],
  [45.474146, -122.80034],
  [45.474331, -122.800341],
  [45.474351, -122.800341],
  [45.474777, -122.800343],
  [45.475047, -122.800344],
  [45.475141, -122.800345],
  [45.475463, -122.800346],
  [45.475519, -122.800346],
  [45.475713, -122.800346],
  [45.475902, -122.800347],
  [45.4761, -122.800347],
  [45.47641, -122.800348],
  [45.476525, -122.800345],
  [45.476936, -122.800346],
  [45.476995, -122.800347],
  [45.477122, -122.800347],
  [45.477512, -122.800346],
  [45.477882, -122.800346],
  [45.478471, -122.800344],
  [45.478566, -122.800344],
  [45.478824, -122.800346],
  [45.479217, -122.800344],
  [45.479541, -122.800342],
  [45.479692, -122.800341],
  [45.480029, -122.800341],
  [45.480428, -122.800341],
  [45.480474, -122.800341],
  [45.480751, -122.80034],
  [45.48171, -122.800338],
  [45.481728, -122.800338],
  [45.481955, -122.800339],
  [45.482019, -122.80034],
  [45.4826, -122.800337],
  [45.482801, -122.800335],
  [45.482928, -122.800335],
  [45.483477, -122.800339],
  [45.483492, -122.80034],
  [45.483603, -122.800341],
  [45.48388, -122.800335],
  [45.48394, -122.800334],
  [45.484284, -122.800337],
  [45.484478, -122.800337],
  [45.484927, -122.800335],
  [45.485075, -122.800335],
  [45.485499, -122.800336],
  [45.485587, -122.800334],
  [45.485713, -122.800329],
  [45.48581, -122.800329],
  [45.485993, -122.800329],
  [45.486042, -122.800329],
  [45.48611, -122.800274],
  [45.48642, -122.800271],
  [45.486508, -122.800323],
  [45.486603, -122.800327],
  [45.486614, -122.800327],
  [45.486791, -122.800331],
  [45.486912, -122.800331],
  [45.486966, -122.800337],
  [45.487032, -122.800352],
  [45.487117, -122.80038],
  [45.48722, -122.800421],
  [45.487286, -122.800462],
  [45.487376, -122.80053],
  [45.487692, -122.800757],
  [45.487763, -122.800811],
  [45.487782, -122.800825],
  [45.487934, -122.800937],
  [45.488017, -122.801019],
  [45.488118, -122.801027],
  [45.488416, -122.801135],
  [45.488597, -122.801199],
  [45.488746, -122.801235],
  [45.488873, -122.801261],
  [45.48902, -122.801293],
  [45.489283, -122.801356],
  [45.489338, -122.80137],
  [45.489697, -122.801464],
  [45.489764, -122.801547],
  [45.489938, -122.801628],
  [45.49005, -122.801694],
  [45.490093, -122.801723],
  [45.49014, -122.801757],
  [45.490192, -122.801799],
  [45.490257, -122.801851],
  [45.49034, -122.801631],
  [45.490357, -122.801601],
  [45.490373, -122.801571],
  [45.490406, -122.801536],
  [45.490457, -122.801506],
  [45.490564, -122.801393],
  [45.49074, -122.801229],
  [45.491005, -122.800981],
  [45.491068, -122.800924],
  [45.491124, -122.800829],
  [45.491342, -122.800632],
  [45.491388, -122.80061],
  [45.491436, -122.800603],
  [45.491494, -122.800617],
  [45.491548, -122.800646],
  [45.491599, -122.800689],
  [45.491649, -122.800746],
  [45.491658, -122.800811],
  [45.491653, -122.800869],
  [45.491631, -122.800932],
  [45.491483, -122.801072],
  [45.491366, -122.801182],
  [45.491344, -122.801203]
];

const stopNames = {
  "4": "A Ave &amp; 10th St",
  "7": "A Ave &amp; 8th St",
  "1122": "SW Commercial &amp; Hall",
  "1219": "700 Block Country Club",
  "1220": "Country Club &amp; Boones Ferry Rd",
  "1221": "Country Club &amp; Iron Mtn",
  "1223": "Country Club &amp; Knaus Rd",
  "1226": "Country Club &amp; Hazel Road",
  "1227": "Country Club &amp; Redwood",
  "1229": "Country Club &amp; Sundeleaf",
  "1231": "Country Club &amp; Uplands",
  "1233": "Country Club &amp; Wembley Park",
  "2232": "SW Greenburg &amp; Center",
  "2264": "9800 Block SW Hall",
  "2287": "SW Hall &amp; Hemlock",
  "2295": "SW Hall &amp; Scholls Ferry",
  "2298": "SW Hall &amp; Washington",
  "2307": "SW Hall &amp; 88th",
  "2311": "SW Hall &amp; 91st",
  "2810": "7500 Block SW Hunziker",
  "2811": "8000 Block SW Hunziker",
  "2816": "SW Hunziker &amp; Knoll",
  "2817": "SW Hunziker &amp; 72nd",
  "3126": "50 Block Kerr Parkway",
  "3129": "Kerr &amp; Independence",
  "3132": "Kerr &amp; Jefferson Pkwy",
  "3133": "Kerr &amp; McNary",
  "3135": "Kerr &amp; Tanglewood",
  "3138": "Kerr &amp; The Grotto",
  "3363": "Lake Oswego Transit Center",
  "3388": "12000 Block SW Lesser",
  "3389": "SW Lesser &amp; Haines",
  "3392": "SW Lesser &amp; 60th",
  "3455": "SW Lombard &amp; Allen",
  "3580": "SW Lombard &amp; 12th",
  "3582": "SW Lombard &amp; 2nd",
  "3583": "SW Lombard &amp; 5th",
  "3585": "SW Lombard &amp; 9th",
  "4431": "PCC Sylvania Main Stop",
  "5160": "8600 Block SW Scholls Ferry",
  "5168": "SW Scholls Ferry &amp; Crestwood",
  "5170": "SW Scholls Ferry &amp; Crystal",
  "5173": "SW Scholls Ferry &amp; Eagle",
  "5175": "SW Scholls Ferry &amp; Heather",
  "5181": "SW Scholls Ferry &amp; Marjorie",
  "6175": "SW Eliander &amp; One Embassy Centre",
  "7579": "SW 49th &amp; Hidalgo",
  "7846": "SW 68th &amp; Clinton",
  "7848": "SW 68th &amp; Franklin",
  "8209": "Tigard Transit Center",
  "9545": "Lake Oswego Transit Center",
  "9650": "Washington Square Transit Center ",
  "9654": "Beaverton Transit Center",
  "9781": "SW Denney &amp; King",
  "9782": "SW Lombard &amp; Camden",
  "9985": "Beaverton Transit Center",
  "10305": "Kerr &amp; Touchstone",
  "12402": "SW Hall &amp; Greenburg",
  "12403": "SW Greenburg &amp; Washington Square Rd",
  "12944": "SW Lombard &amp; Broadway",
  "12959": "PCC Lower Drive (G St) &amp; H St",
  "13210": "SW 68th &amp; Atlanta",
  "13582": "SW Blum &amp; Palmblad",
  "13736": "SW Beveland &amp; 69th",
  "13937": "SW Denney &amp; 111th",
  "13938": "SW Lombard &amp; Cheshire",
  "14158": "SW Denney &amp; 100th Ter",
  "14409": "SW Main between Commercial and Scoffins",
  "14467": "SW Locust &amp; 87th"
};

const stops = [
  { stop_id: "9545", name: "Lake Oswego Transit Center", lat: 45.421057, lon: -122.668105, times: ["2:29 PM", "3:29 PM", "4:29 PM", "5:29 PM", "6:28 PM", "7:28 PM", "5:57 AM", "7:09 AM"] },
  { stop_id: "3363", name: "Lake Oswego Transit Center", lat: 45.42004, lon: -122.668009, times: ["2:29 PM", "3:29 PM", "4:29 PM", "5:29 PM", "6:28 PM", "7:28 PM", "5:57 AM", "7:09 AM"] },
  { stop_id: "7", name: "A Ave &amp; 8th St", lat: 45.420411, lon: -122.67268, times: ["2:30 PM", "3:30 PM", "4:30 PM", "5:30 PM", "6:29 PM", "7:29 PM", "5:58 AM", "7:10 AM"] },
  { stop_id: "4", name: "A Ave &amp; 10th St", lat: 45.420703, lon: -122.675152, times: ["2:30 PM", "3:30 PM", "4:30 PM", "5:30 PM", "6:29 PM", "7:29 PM", "5:58 AM", "7:10 AM"] },
  { stop_id: "1221", name: "Country Club &amp; Iron Mtn", lat: 45.423077, lon: -122.679181, times: ["2:31 PM", "3:31 PM", "4:31 PM", "5:31 PM", "6:30 PM", "7:30 PM", "5:59 AM", "7:11 AM"] },
  { stop_id: "1219", name: "700 Block Country Club", lat: 45.423077, lon: -122.683216, times: ["2:31 PM", "3:31 PM", "4:31 PM", "5:32 PM", "6:31 PM", "7:31 PM", "6:00 AM", "7:12 AM"] },
  { stop_id: "1223", name: "Country Club &amp; Knaus Rd", lat: 45.423181, lon: -122.688846, times: ["2:32 PM", "3:32 PM", "4:32 PM", "5:33 PM", "6:32 PM", "7:32 PM", "6:00 AM", "7:13 AM"] },
  { stop_id: "1227", name: "Country Club &amp; Redwood", lat: 45.423198, lon: -122.692891, times: ["2:33 PM", "3:33 PM", "4:33 PM", "5:33 PM", "6:32 PM", "7:32 PM", "6:01 AM", "7:13 AM"] },
  { stop_id: "1231", name: "Country Club &amp; Uplands", lat: 45.423292, lon: -122.695308, times: ["2:33 PM", "3:33 PM", "4:33 PM", "5:34 PM", "6:33 PM", "7:33 PM", "6:02 AM", "7:14 AM"] },
  { stop_id: "1233", name: "Country Club &amp; Wembley Park", lat: 45.423845, lon: -122.697652, times: ["2:34 PM", "3:34 PM", "4:34 PM", "5:34 PM", "6:33 PM", "7:33 PM", "6:02 AM", "7:14 AM"] },
  { stop_id: "1226", name: "Country Club &amp; Hazel Road", lat: 45.425159, lon: -122.702545, times: ["2:34 PM", "3:34 PM", "4:34 PM", "5:35 PM", "6:34 PM", "7:34 PM", "6:03 AM", "7:15 AM"] },
  { stop_id: "1229", name: "Country Club &amp; Sundeleaf", lat: 45.425235, lon: -122.704815, times: ["2:35 PM", "3:35 PM", "4:35 PM", "5:36 PM", "6:35 PM", "7:34 PM", "6:03 AM", "7:15 AM"] },
  { stop_id: "1220", name: "Country Club &amp; Boones Ferry Rd", lat: 45.424526, lon: -122.707607, times: ["2:35 PM", "3:35 PM", "4:35 PM", "5:36 PM", "6:35 PM", "7:35 PM", "6:04 AM", "7:16 AM"] },
  { stop_id: "3138", name: "Kerr &amp; The Grotto", lat: 45.426287, lon: -122.707138, times: ["2:36 PM", "3:36 PM", "4:36 PM", "5:37 PM", "6:36 PM", "7:35 PM", "6:04 AM", "7:16 AM"] },
  { stop_id: "3133", name: "Kerr &amp; McNary", lat: 45.428517, lon: -122.707192, times: ["2:36 PM", "3:36 PM", "4:36 PM", "5:37 PM", "6:36 PM", "7:36 PM", "6:05 AM", "7:17 AM"] },
  { stop_id: "3135", name: "Kerr &amp; Tanglewood", lat: 45.42836, lon: -122.712318, times: ["2:37 PM", "3:37 PM", "4:37 PM", "5:39 PM", "6:38 PM", "7:37 PM", "6:06 AM", "7:18 AM"] },
  { stop_id: "10305", name: "Kerr &amp; Touchstone", lat: 45.42813, lon: -122.714739, times: ["2:37 PM", "3:37 PM", "4:37 PM", "5:39 PM", "6:38 PM", "7:38 PM", "6:06 AM", "7:19 AM"] },
  { stop_id: "3129", name: "Kerr &amp; Independence", lat: 45.428803, lon: -122.716104, times: ["2:38 PM", "3:38 PM", "4:38 PM", "5:39 PM", "6:38 PM", "7:38 PM", "6:06 AM", "7:19 AM"] },
  { stop_id: "3132", name: "Kerr &amp; Jefferson Pkwy", lat: 45.431167, lon: -122.718248, times: ["2:38 PM", "3:38 PM", "4:38 PM", "5:40 PM", "6:39 PM", "7:39 PM", "6:07 AM", "7:20 AM"] },
  { stop_id: "3126", name: "50 Block Kerr Parkway", lat: 45.434202, lon: -122.719357, times: ["2:39 PM", "3:39 PM", "4:39 PM", "5:41 PM", "6:40 PM", "7:39 PM", "6:08 AM", "7:20 AM"] },
  { stop_id: "4431", name: "PCC Sylvania Main Stop", lat: 45.437955, lon: -122.730177, times: ["2:42 PM", "3:42 PM", "4:42 PM", "8:41 AM", "9:41 AM", "10:41 AM", "11:40 AM", "12:42 PM"] },
  { stop_id: "12959", name: "PCC Lower Drive (G St) &amp; H St", lat: 45.441394, lon: -122.733741, times: ["2:44 PM", "3:44 PM", "4:44 PM", "8:43 AM", "9:43 AM", "10:43 AM", "11:42 AM", "12:44 PM"] },
  { stop_id: "3392", name: "SW Lesser &amp; 60th", lat: 45.440183, lon: -122.73925, times: ["2:45 PM", "3:45 PM", "4:45 PM", "5:47 PM", "6:46 PM", "7:45 PM", "6:14 AM", "7:26 AM"] },
  { stop_id: "3388", name: "12000 Block SW Lesser", lat: 45.438343, lon: -122.741204, times: ["2:46 PM", "3:46 PM", "4:46 PM", "5:47 PM", "6:46 PM", "7:46 PM", "6:14 AM", "7:27 AM"] },
  { stop_id: "3389", name: "SW Lesser &amp; Haines", lat: 45.436982, lon: -122.741192, times: ["2:46 PM", "3:46 PM", "4:46 PM", "5:48 PM", "6:47 PM", "7:46 PM", "6:14 AM", "7:27 AM"] },
  { stop_id: "13210", name: "SW 68th &amp; Atlanta", lat: 45.436339, lon: -122.746764, times: ["2:48 PM", "3:48 PM", "4:48 PM", "5:49 PM", "6:48 PM", "7:47 PM", "6:15 AM", "7:28 AM"] },
  { stop_id: "7846", name: "SW 68th &amp; Clinton", lat: 45.434409, lon: -122.74687, times: ["2:48 PM", "3:48 PM", "4:48 PM", "5:49 PM", "6:48 PM", "7:48 PM", "6:16 AM", "7:29 AM"] },
  { stop_id: "7848", name: "SW 68th &amp; Franklin", lat: 45.430404, lon: -122.746911, times: ["2:49 PM", "3:49 PM", "4:49 PM", "5:50 PM", "6:49 PM", "7:49 PM", "6:17 AM", "7:30 AM"] },
  { stop_id: "13736", name: "SW Beveland &amp; 69th", lat: 45.429572, lon: -122.748152, times: ["2:50 PM", "3:50 PM", "4:50 PM", "5:51 PM", "6:50 PM", "7:49 PM", "6:17 AM", "7:30 AM"] },
  { stop_id: "2817", name: "SW Hunziker &amp; 72nd", lat: 45.42586, lon: -122.752266, times: ["2:52 PM", "3:52 PM", "4:52 PM", "5:53 PM", "6:52 PM", "7:51 PM", "6:19 AM", "7:32 AM"] },
  { stop_id: "2810", name: "7500 Block SW Hunziker", lat: 45.427027, lon: -122.755008, times: ["2:53 PM", "3:53 PM", "4:53 PM", "5:53 PM", "6:52 PM", "7:51 PM", "6:19 AM", "7:32 AM"] },
  { stop_id: "2811", name: "8000 Block SW Hunziker", lat: 45.427974, lon: -122.758756, times: ["2:53 PM", "3:53 PM", "4:53 PM", "5:54 PM", "6:53 PM", "7:52 PM", "6:20 AM", "7:33 AM"] },
  { stop_id: "2816", name: "SW Hunziker &amp; Knoll", lat: 45.429792, lon: -122.763478, times: ["2:55 PM", "3:55 PM", "4:55 PM", "5:55 PM", "6:54 PM", "7:53 PM", "6:21 AM", "7:34 AM"] },
  { stop_id: "1122", name: "SW Commercial &amp; Hall", lat: 45.428655, lon: -122.766448, times: ["2:56 PM", "3:56 PM", "4:56 PM", "5:56 PM", "6:55 PM", "7:54 PM", "6:22 AM", "7:35 AM"] },
  { stop_id: "8209", name: "Tigard Transit Center", lat: 45.430182, lon: -122.769513, times: ["2:24 PM", "2:57 PM", "3:25 PM", "3:57 PM", "4:25 PM", "4:57 PM", "5:25 PM", "5:57 PM"] },
  { stop_id: "14409", name: "SW Main between Commercial and Scoffins", lat: 45.431827, lon: -122.769177, times: ["2:24 PM", "2:57 PM", "3:25 PM", "3:57 PM", "4:25 PM", "4:57 PM", "5:25 PM", "5:57 PM"] },
  { stop_id: "2232", name: "SW Greenburg &amp; Center", lat: 45.433958, lon: -122.768136, times: ["2:25 PM", "2:58 PM", "3:26 PM", "3:58 PM", "4:26 PM", "4:58 PM", "5:26 PM", "5:58 PM"] },
  { stop_id: "12403", name: "SW Greenburg &amp; Washington Square Rd", lat: 45.446196, lon: -122.776126, times: ["2:30 PM", "3:03 PM", "3:31 PM", "4:03 PM", "4:31 PM", "5:03 PM", "5:31 PM", "6:03 PM"] },
  { stop_id: "14467", name: "SW Locust &amp; 87th", lat: 45.446534, lon: -122.766856, times: ["2:32 PM", "3:05 PM", "3:33 PM", "4:05 PM", "4:33 PM", "5:05 PM", "5:33 PM", "6:05 PM"] },
  { stop_id: "2264", name: "9800 Block SW Hall", lat: 45.448692, lon: -122.764734, times: ["2:33 PM", "3:06 PM", "3:34 PM", "4:06 PM", "4:34 PM", "5:06 PM", "5:34 PM", "6:06 PM"] },
  { stop_id: "2287", name: "SW Hall &amp; Hemlock", lat: 45.450184, lon: -122.764711, times: ["2:34 PM", "3:07 PM", "3:35 PM", "4:07 PM", "4:35 PM", "5:07 PM", "5:35 PM", "6:07 PM"] },
  { stop_id: "2298", name: "SW Hall &amp; Washington", lat: 45.450928, lon: -122.766538, times: ["2:34 PM", "3:07 PM", "3:35 PM", "4:07 PM", "4:35 PM", "5:07 PM", "5:35 PM", "6:07 PM"] },
  { stop_id: "2307", name: "SW Hall &amp; 88th", lat: 45.451448, lon: -122.76822, times: ["2:35 PM", "3:08 PM", "3:36 PM", "4:08 PM", "4:36 PM", "5:08 PM", "5:36 PM", "6:08 PM"] },
  { stop_id: "2311", name: "SW Hall &amp; 91st", lat: 45.452204, lon: -122.770708, times: ["2:35 PM", "3:08 PM", "3:36 PM", "4:08 PM", "4:36 PM", "5:08 PM", "5:36 PM", "6:08 PM"] },
  { stop_id: "12402", name: "SW Hall &amp; Greenburg", lat: 45.453287, lon: -122.773732, times: ["2:36 PM", "3:09 PM", "3:37 PM", "4:09 PM", "4:37 PM", "5:09 PM", "5:37 PM", "6:09 PM"] },
  { stop_id: "13582", name: "SW Blum &amp; Palmblad", lat: 45.452912, lon: -122.776915, times: ["2:37 PM", "3:10 PM", "3:38 PM", "4:10 PM", "4:38 PM", "5:10 PM", "5:38 PM", "6:10 PM"] },
  { stop_id: "9650", name: "Washington Square Transit Center ", lat: 45.4527, lon: -122.77881, times: ["2:11 PM", "2:38 PM", "3:11 PM", "3:39 PM", "4:11 PM", "4:39 PM", "5:11 PM", "5:39 PM"] },
  { stop_id: "6175", name: "SW Eliander &amp; One Embassy Centre", lat: 45.454727, lon: -122.780345, times: ["2:11 PM", "2:38 PM", "3:11 PM", "3:39 PM", "4:11 PM", "4:39 PM", "5:11 PM", "5:39 PM"] },
  { stop_id: "2295", name: "SW Hall &amp; Scholls Ferry", lat: 45.456837, lon: -122.78214, times: ["2:12 PM", "2:39 PM", "3:12 PM", "3:40 PM", "4:12 PM", "4:40 PM", "5:12 PM", "5:40 PM"] },
  { stop_id: "5160", name: "8600 Block SW Scholls Ferry", lat: 45.457787, lon: -122.781737, times: ["2:12 PM", "2:39 PM", "3:12 PM", "3:40 PM", "4:12 PM", "4:40 PM", "5:12 PM", "5:40 PM"] },
  { stop_id: "5168", name: "SW Scholls Ferry &amp; Crestwood", lat: 45.460513, lon: -122.780326, times: ["2:13 PM", "2:40 PM", "3:13 PM", "3:41 PM", "4:13 PM", "4:41 PM", "5:13 PM", "5:41 PM"] },
  { stop_id: "5170", name: "SW Scholls Ferry &amp; Crystal", lat: 45.462128, lon: -122.779451, times: ["2:13 PM", "2:40 PM", "3:13 PM", "3:41 PM", "4:13 PM", "4:41 PM", "5:13 PM", "5:41 PM"] },
  { stop_id: "5173", name: "SW Scholls Ferry &amp; Eagle", lat: 45.463791, lon: -122.778584, times: ["2:14 PM", "2:41 PM", "3:14 PM", "3:42 PM", "4:14 PM", "4:42 PM", "5:14 PM", "5:41 PM"] },
  { stop_id: "5181", name: "SW Scholls Ferry &amp; Marjorie", lat: 45.464957, lon: -122.777934, times: ["2:14 PM", "2:41 PM", "3:14 PM", "3:42 PM", "4:14 PM", "4:42 PM", "5:14 PM", "5:42 PM"] },
  { stop_id: "5175", name: "SW Scholls Ferry &amp; Heather", lat: 45.467946, lon: -122.776409, times: ["2:15 PM", "2:42 PM", "3:15 PM", "3:43 PM", "4:15 PM", "4:43 PM", "5:15 PM", "5:42 PM"] },
  { stop_id: "14158", name: "SW Denney &amp; 100th Ter", lat: 45.469391, lon: -122.77989, times: ["2:16 PM", "2:43 PM", "3:16 PM", "3:44 PM", "4:16 PM", "4:44 PM", "5:16 PM", "5:43 PM"] },
  { stop_id: "13937", name: "SW Denney &amp; 111th", lat: 45.469412, lon: -122.790516, times: ["2:18 PM", "2:45 PM", "3:18 PM", "3:46 PM", "4:18 PM", "4:46 PM", "5:17 PM", "5:45 PM"] },
  { stop_id: "9781", name: "SW Denney &amp; King", lat: 45.469375, lon: -122.794151, times: ["2:18 PM", "2:45 PM", "3:18 PM", "3:46 PM", "4:18 PM", "4:46 PM", "5:18 PM", "5:45 PM"] },
  { stop_id: "9782", name: "SW Lombard &amp; Camden", lat: 45.469897, lon: -122.800213, times: ["2:19 PM", "2:46 PM", "3:19 PM", "3:47 PM", "4:19 PM", "4:47 PM", "5:19 PM", "5:47 PM"] },
  { stop_id: "13938", name: "SW Lombard &amp; Cheshire", lat: 45.473769, lon: -122.800209, times: ["2:20 PM", "2:47 PM", "3:20 PM", "3:48 PM", "4:20 PM", "4:48 PM", "5:20 PM", "5:47 PM"] },
  { stop_id: "3455", name: "SW Lombard &amp; Allen", lat: 45.476992, lon: -122.800197, times: ["2:21 PM", "2:48 PM", "3:21 PM", "3:49 PM", "4:21 PM", "4:49 PM", "5:21 PM", "5:48 PM"] },
  { stop_id: "3580", name: "SW Lombard &amp; 12th", lat: 45.478466, lon: -122.800249, times: ["2:21 PM", "2:48 PM", "3:21 PM", "3:49 PM", "4:21 PM", "4:49 PM", "5:21 PM", "5:48 PM"] },
  { stop_id: "3585", name: "SW Lombard &amp; 9th", lat: 45.480428, lon: -122.800217, times: ["2:22 PM", "2:49 PM", "3:22 PM", "3:50 PM", "4:22 PM", "4:50 PM", "5:21 PM", "5:49 PM"] },
  { stop_id: "3583", name: "SW Lombard &amp; 5th", lat: 45.482796, lon: -122.80022, times: ["2:23 PM", "2:50 PM", "3:23 PM", "3:51 PM", "4:23 PM", "4:51 PM", "5:22 PM", "5:49 PM"] },
  { stop_id: "3582", name: "SW Lombard &amp; 2nd", lat: 45.484921, lon: -122.800245, times: ["2:23 PM", "2:50 PM", "3:23 PM", "3:51 PM", "4:23 PM", "4:51 PM", "5:22 PM", "5:50 PM"] },
  { stop_id: "12944", name: "SW Lombard &amp; Broadway", lat: 45.487818, lon: -122.800725, times: ["2:26 PM", "2:53 PM", "3:26 PM", "3:54 PM", "4:26 PM", "4:54 PM", "5:25 PM", "5:52 PM"] },
  { stop_id: "9985", name: "Beaverton Transit Center", lat: 45.491385, lon: -122.801308, times: ["2:31 PM", "2:58 PM", "3:31 PM", "3:59 PM", "4:31 PM", "4:59 PM", "5:30 PM", "5:57 PM"] },
  { stop_id: "7579", name: "SW 49th &amp; Hidalgo", lat: 45.439958, lon: -122.726933, times: ["5:43 PM", "6:42 PM", "7:42 PM", "6:10 AM", "7:23 AM"] },
  { stop_id: "9654", name: "Beaverton Transit Center", lat: 45.491269, lon: -122.800864, times: ["6:29 PM"] },
]

    const polylineOut = L.polyline(shapeOutbound, { color: 'blue', weight: 4, opacity: 0.7 }).addTo(map);
    map.fitBounds(polylineOut.getBounds());

    const nowPT = new Date(new Date().toLocaleString('en-US', { timeZone: 'America/Los_Angeles' }));
    const nowMins = nowPT.getHours() * 60 + nowPT.getMinutes();

    stops.forEach(stop => {
      let highlightedTimes = [];
      let foundNext = false;
      stop.times.forEach(timeStr => {
        let cleanTime = timeStr.trim();
        let [h, m] = cleanTime.split(":");
        let schedMins = parseInt(h, 10) * 60 + parseInt(m, 10);
        if (schedMins < nowMins && nowMins - schedMins > 720) {
          schedMins += 1440;
        }
        if (!foundNext && schedMins >= nowMins) {
          highlightedTimes.push(`<span style="background:#4dd0e1; color:#000; padding:2px 6px; border-radius:6px; font-weight:bold;">${cleanTime}</span>`);
          foundNext = true;
        } else {
          highlightedTimes.push(cleanTime);
        }
      });

      L.circleMarker([stop.lat, stop.lon], {
        radius: 6,
        color: '#4dd0e1',
        fillColor: '#4dd0e1',
        fillOpacity: 0.9,
        weight: 1
      })
      .bindPopup(`<strong>${stop.name}</strong><br>${highlightedTimes.join("<br>") || 'No scheduled times'}`)
      .addTo(map);
    });

    let busMarkers = {};
    async function fetchAndDisplay() {
      const res = await fetch(`https://developer.trimet.org/ws/v2/vehicles?route=${routeNumber}&appID=${apiKey}&json=true`);
      const data = await res.json();
      const buses = (data.resultSet.vehicle || []).filter(v => v.routeNumber == routeNumber && v.direction == direction);

      Object.values(busMarkers).forEach(m => map.removeLayer(m));
      busMarkers = {};
      if (!buses.length) return;

      buses.forEach(bus => {
        if (!bus.latitude || !bus.longitude || !bus.blockID) return;
        const icon = L.divIcon({    
           className: '',
           html: `
            <div style="text-align:center;">
              <div style="background:#0071CE;color:#fff;padding:2px 6px;border-radius:6px;font-weight:bold;">${bus.vehicleID}</div>
              <div style="width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-top:10px solid #00bfff;margin:auto;"></div>
            </div>
          `,
          iconSize: [40, 30], iconAnchor: [20, 30]
        });
        const marker = L.marker([bus.latitude, bus.longitude], { icon }).addTo(map);
        busMarkers[bus.vehicleID] = marker;
      });
    }
    fetchAndDisplay();
    setInterval(fetchAndDisplay, 15000);
  </script>

  <footer class="site-footer">
    <a href="terms.html">Terms of Use</a> &nbsp;|&nbsp;
    <a href="contact.html">Contact Us</a> &nbsp;|&nbsp;
    <a href="report.html">Report a Problem</a> &nbsp;|&nbsp;
    <a href="dmca.html">DMCA</a> &nbsp;|&nbsp;
    <a href="privacy.html">Privacy Policy</a>
  </footer>

  <script>
    if (!localStorage.getItem('cookieConsent')) {
      document.write(`
        <div id="cookie-banner" style="position: fixed; bottom: 0; left: 0; right: 0; background: #333; color: #fff; padding: 1rem; z-index: 1000; font-size: 0.9rem; line-height: 1.4; text-align: center; box-sizing: border-box;">
          üì¢ We use cookies to improve functionality and analyze traffic.
          By using MetroFeed, you agree to our 
          <a href='privacy.html' style='color: #4dd0e1; text-decoration: underline;'>Privacy Policy</a>.<br>
          <button onclick='localStorage.setItem("cookieConsent", "true"); document.getElementById("cookie-banner").remove();' style='margin-top: 0.5rem; background: #4dd0e1; color: #000; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer; font-weight: bold;'>OK</button>
        </div>
      `);
    }
  </script>
</body>
</html>