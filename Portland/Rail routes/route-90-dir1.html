<!DOCTYPE html>
<html lang="en">
<head>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EL337T4JX4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-EL337T4JX4');
</script>

<meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Route 90 - To Hillsboro | MetroFeed Portland</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #0d0d0d;
      color: #cccccc;
      overflow-y: auto;
    }

    body {
      padding-top: 120px;
    }

    .ad-banner {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: #222;
      padding: 0;
      z-index: 1000;
      box-shadow: 0 2px 2px rgba(0,0,0,0.5);
      text-align: center;
    }

    .ad-banner img {
      width: 100%;
      max-width: 728px;
      max-height: 120px;
      display: block;
      margin: 0 auto;
    }
    .home-button {
      position: fixed;
      top: 120px;
      left: 10px;
      background-color: #4dd0e1;
      color: #0d0d0d;
      padding: 0.5rem 1rem;
      font-weight: bold;
      border-radius: 8px;
      text-decoration: none;
      z-index: 1001;
      box-shadow: 0 0 10px #4dd0e1;
    }

    .home-button:hover {
      background-color: #00bcd4;
      color: #ffffff;
    }

    header {
      background-color: #0d0d0d;
      border-top: 4px solid #4dd0e1;
      border-bottom: 3px solid #4dd0e1;
      padding: 1rem;
      text-align: center;
    }

    header img {
      max-height: 60px;
    }

    h1 {
      text-align: center;
      margin: 1rem 0;
      font-size: 2rem;
      color: #f0f0f0;
    }

    .content-box {
      border-radius: 12px;
      padding: 0;
      margin: 0;
      background-color: #1e1e1e;
    }

    #map {
      width: 100%;
      height: 85vh;
      border: none;
      margin: 0 auto;
      display: block;
      border-radius: 8px;
    }

    .button-bar {
      display: flex;
      justify-content: center;
      margin: 1rem 0;
    }

    .button-bar a, .back-button {
      background: #4dd0e1;
      color: #0d0d0d;
      padding: 0.6rem 1.2rem;
      text-decoration: none;
      border-radius: 8px;
      font-weight: bold;
      border: none;
      cursor: pointer;
      box-shadow: 0 0 10px #4dd0e1;
    }

    .back-button:hover {
      background-color: #35c0d6;
    }

    .site-footer {
      text-align: center;
      margin-top: 3rem;
      margin-bottom: 120px;
      font-size: 0.85rem;
      color: #aaa;
    }

    .site-footer a {
      color: #00BFFF;
      text-decoration: none;
    }

    .site-footer a:hover {
      text-decoration: underline;
    }

    @media (max-width: 600px) {
      .ad-banner {
        padding-top: 1rem;
        padding-bottom: 0rem;
      }
    }
  </style>
</head>

<body>
  <div class="ad-banner">
    <iframe src="https://metrofeedus.com/portland/Ads/route-90-dir1-ad.html" style="border:none; width:100%; max-width: 728px; height:90px;"></iframe>
  </div>

  <header>
    <img src="MetroFeedPortlandLogo.png" alt="MetroFeed Portland">
  </header>

  <div class="disclaimer" style="margin: 1rem auto 0.5rem; max-width: 600px; font-size: 0.8rem; color: #bbb; text-align: center; padding: 0.5rem 1rem; background-color: #111; border: 1px dashed #444; border-radius: 6px;">
    ⚠️ This is a Beta program, work in progress. Please REPORT bugs and pretend to be impressed.
  </div>
  <div class="disclaimer" style="margin: 0 auto 1rem; max-width: 600px; font-size: 0.75rem; color: #888; text-align: center; padding: 0.25rem 1rem;">
    This tool is not affiliated with or endorsed by TriMet. For official schedules and service alerts, visit <a href="https://trimet.org" style="color:#4dd0e1;">trimet.org</a>.
  </div>

  <div style="margin: 2rem 0; text-align: center;">
    <button class="back-button" onclick="history.back()">Back</button>
  </div>

  <h1>Route 90 - To Hillsboro</h1>

  <div class="content-box">
    <div id="map"></div>
    <div style="text-align:right; font-size: 0.7rem; color: #777; margin-top: 0.5rem;">
      Data courtesy of TriMet.
    </div>
  </div>

  <script>
    if (document.referrer === "" && performance.navigation.type === 0) {
      window.location.href = "/index.html";
    }

    const apiKey = "2C4447D4A42083BCD84DE3B8E";
    const routeNumber = 90;
    const direction = parseInt(1);

    const map = L.map('map', {
      center: [45.6, -122.7],
      zoom: 12,
      minZoom: 12,
      maxZoom: 18,
      maxBounds: [[45.3, -123.1], [45.9, -122.3]],
      maxBoundsViscosity: 1.0
    });
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);

    const shapeOutbound = [
  [45.530074, -122.661908],
  [45.530074, -122.661848],
  [45.530074, -122.661978],
  [45.530077, -122.662736],
  [45.530079, -122.663619],
  [45.53008, -122.663719],
  [45.530081, -122.663827],
  [45.530082, -122.663921],
  [45.530104, -122.664087],
  [45.530107, -122.664106],
  [45.53014, -122.664345],
  [45.530142, -122.664383],
  [45.530152, -122.664454],
  [45.530159, -122.664495],
  [45.53016, -122.664518],
  [45.530162, -122.66455],
  [45.53016, -122.664634],
  [45.530159, -122.664733],
  [45.530158, -122.664875],
  [45.530159, -122.66524],
  [45.53016, -122.665667],
  [45.530161, -122.665732],
  [45.530162, -122.665786],
  [45.530163, -122.665846],
  [45.530158, -122.6659],
  [45.530151, -122.66594],
  [45.530138, -122.665986],
  [45.530123, -122.666025],
  [45.530105, -122.666066],
  [45.530026, -122.666226],
  [45.529996, -122.66627],
  [45.52993, -122.666366],
  [45.529842, -122.666484],
  [45.529797, -122.666544],
  [45.529774, -122.666575],
  [45.529737, -122.666616],
  [45.529701, -122.666656],
  [45.529668, -122.666689],
  [45.529629, -122.66672],
  [45.529594, -122.666746],
  [45.529562, -122.666769],
  [45.529493, -122.666811],
  [45.529268, -122.666904],
  [45.529129, -122.666958],
  [45.529, -122.667008],
  [45.528878, -122.667063],
  [45.528817, -122.667095],
  [45.528756, -122.667132],
  [45.528704, -122.667168],
  [45.528645, -122.667217],
  [45.528597, -122.667259],
  [45.528542, -122.667313],
  [45.528464, -122.667399],
  [45.528436, -122.667434],
  [45.52839, -122.667486],
  [45.528343, -122.667552],
  [45.528299, -122.667628],
  [45.528249, -122.667718],
  [45.528203, -122.667816],
  [45.528082, -122.66808],
  [45.527738, -122.66884],
  [45.527417, -122.669551],
  [45.527237, -122.669951],
  [45.527056, -122.670349],
  [45.526975, -122.670516],
  [45.526916, -122.670636],
  [45.526848, -122.670753],
  [45.526776, -122.670864],
  [45.526736, -122.670914],
  [45.526706, -122.670955],
  [45.526681, -122.670986],
  [45.526651, -122.671016],
  [45.526615, -122.671058],
  [45.526558, -122.671115],
  [45.526486, -122.671184],
  [45.526435, -122.671225],
  [45.526395, -122.671254],
  [45.526349, -122.671281],
  [45.52624, -122.671345],
  [45.526186, -122.671369],
  [45.526143, -122.671388],
  [45.526106, -122.671402],
  [45.526075, -122.671413],
  [45.526014, -122.671433],
  [45.52596, -122.671446],
  [45.525887, -122.67146],
  [45.525827, -122.67147],
  [45.525762, -122.671473],
  [45.525393, -122.67146],
  [45.525314, -122.671457],
  [45.525262, -122.671455],
  [45.52522, -122.671453],
  [45.524696, -122.671439]
];

const stopNames = {
  "8341": "Convention Center MAX Station",
  "8347": "Gateway/NE 99th Ave TC MAX Station",
  "8378": "Old Town/Chinatown MAX Station",
  "8379": "Skidmore Fountain MAX Station",
  "8380": "Oak/ SW 1st Ave MAX Station",
  "8381": "Morrison/SW 3rd Ave MAX Station",
  "8383": "Pioneer Square North MAX Station",
  "8384": "Galleria/SW 10th Ave MAX Station",
  "9624": "Sunset TC MAX Station",
  "9757": "Providence Park MAX Station",
  "9818": "Beaverton TC MAX Station",
  "9819": "Beaverton Creek MAX Station",
  "9821": "Beaverton TC MAX Station",
  "9823": "Beaverton Central MAX Station",
  "9825": "Millikan Way MAX Station",
  "9827": "Merlo Rd/SW 158th Ave MAX Station",
  "9829": "Elmonica/SW 170th Ave MAX Station",
  "9832": "Willow Creek/SW 185th Ave TC MAX Station",
  "9833": "Quatama MAX Station",
  "9836": "Orenco MAX Station",
  "9837": "Hillsboro Airport/Fairgrounds MAX Stn",
  "9840": "Hawthorn Farm MAX Station",
  "10117": "Goose Hollow/SW Jefferson St MAX Station",
  "10121": "Washington Park MAX Station",
  "10573": "Parkrose/Sumner TC MAX Station",
  "10575": "Cascades MAX Station",
  "10577": "Mt Hood Ave MAX Station",
  "10579": "Portland Int&#x27;l Airport MAX Station",
  "14250": "Gateway North MAX Station"
};

const stops = [
  { stop_id: "8341", name: "Convention Center MAX Station", lat: 45.530052, lon: -122.661908, times: ["4:05 AM", "4:35 AM", "5:05 AM", "5:35 AM", "6:05 AM", "6:35 AM", "7:05 AM", "7:35 AM"] },
  { stop_id: "8378", name: "Old Town/Chinatown MAX Station", lat: 45.524695, lon: -122.671467, times: ["4:12 AM", "4:14 AM", "4:42 AM", "4:43 AM", "5:12 AM", "5:13 AM", "5:42 AM", "5:43 AM"] },
  { stop_id: "8379", name: "Skidmore Fountain MAX Station", lat: 45.522873, lon: -122.67139, times: ["4:15 AM", "4:43 AM", "5:13 AM", "5:43 AM", "6:13 AM", "6:43 AM", "7:13 AM", "7:43 AM"] },
  { stop_id: "8380", name: "Oak/ SW 1st Ave MAX Station", lat: 45.51986, lon: -122.672523, times: ["4:16 AM", "4:45 AM", "5:15 AM", "5:45 AM", "6:15 AM", "6:45 AM", "7:15 AM", "7:45 AM"] },
  { stop_id: "8381", name: "Morrison/SW 3rd Ave MAX Station", lat: 45.518181, lon: -122.675386, times: ["4:18 AM", "4:47 AM", "5:17 AM", "5:47 AM", "6:17 AM", "6:47 AM", "7:17 AM", "7:47 AM"] },
  { stop_id: "8383", name: "Pioneer Square North MAX Station", lat: 45.519253, lon: -122.679475, times: ["4:20 AM", "4:49 AM", "5:19 AM", "5:49 AM", "6:19 AM", "6:49 AM", "7:19 AM", "7:49 AM"] },
  { stop_id: "8384", name: "Galleria/SW 10th Ave MAX Station", lat: 45.51991, lon: -122.681919, times: ["4:22 AM", "4:50 AM", "5:20 AM", "5:50 AM", "6:20 AM", "6:50 AM", "7:20 AM", "7:50 AM"] },
  { stop_id: "9757", name: "Providence Park MAX Station", lat: 45.521833, lon: -122.689816, times: ["4:24 AM", "4:53 AM", "5:23 AM", "5:53 AM", "6:23 AM", "6:53 AM", "7:23 AM", "7:53 AM"] },
  { stop_id: "10117", name: "Goose Hollow/SW Jefferson St MAX Station", lat: 45.518236, lon: -122.694089, times: ["4:27 AM", "4:56 AM", "5:26 AM", "5:56 AM", "6:26 AM", "6:56 AM", "7:26 AM", "7:56 AM"] },
  { stop_id: "10121", name: "Washington Park MAX Station", lat: 45.510661, lon: -122.717244, times: ["4:32 AM", "4:59 AM", "5:29 AM", "5:59 AM", "6:29 AM", "6:59 AM", "7:29 AM", "7:59 AM"] },
  { stop_id: "9624", name: "Sunset TC MAX Station", lat: 45.510383, lon: -122.781299, times: ["4:39 AM", "5:05 AM", "5:35 AM", "6:05 AM", "6:35 AM", "7:05 AM", "7:35 AM", "8:05 AM"] },
  { stop_id: "9818", name: "Beaverton TC MAX Station", lat: 45.49133, lon: -122.801723, times: ["5:09 AM", "5:39 AM", "6:09 AM", "6:39 AM", "7:09 AM", "7:39 AM", "8:09 AM", "8:39 AM"] },
  { stop_id: "9823", name: "Beaverton Central MAX Station", lat: 45.490425, lon: -122.807441, times: ["4:45 AM", "5:11 AM", "5:41 AM", "6:11 AM", "6:41 AM", "7:11 AM", "7:41 AM", "8:11 AM"] },
  { stop_id: "9825", name: "Millikan Way MAX Station", lat: 45.495421, lon: -122.821806, times: ["4:47 AM", "5:14 AM", "5:44 AM", "6:14 AM", "6:44 AM", "7:14 AM", "7:44 AM", "8:14 AM"] },
  { stop_id: "9819", name: "Beaverton Creek MAX Station", lat: 45.500584, lon: -122.833325, times: ["4:49 AM", "5:15 AM", "5:45 AM", "6:15 AM", "6:45 AM", "7:15 AM", "7:45 AM", "8:15 AM"] },
  { stop_id: "9827", name: "Merlo Rd/SW 158th Ave MAX Station", lat: 45.505399, lon: -122.842424, times: ["4:50 AM", "5:17 AM", "5:47 AM", "6:17 AM", "6:47 AM", "7:17 AM", "7:47 AM", "8:17 AM"] },
  { stop_id: "9829", name: "Elmonica/SW 170th Ave MAX Station", lat: 45.510134, lon: -122.851732, times: ["4:51 AM", "5:19 AM", "5:49 AM", "6:19 AM", "6:49 AM", "7:19 AM", "7:49 AM", "8:19 AM"] },
  { stop_id: "9832", name: "Willow Creek/SW 185th Ave TC MAX Station", lat: 45.517375, lon: -122.870518, times: ["4:53 AM", "5:22 AM", "5:52 AM", "6:22 AM", "6:52 AM", "7:22 AM", "7:52 AM", "8:22 AM"] },
  { stop_id: "9833", name: "Quatama MAX Station", lat: 45.523319, lon: -122.889131, times: ["4:55 AM", "5:24 AM", "5:54 AM", "6:24 AM", "6:54 AM", "7:24 AM", "7:54 AM", "8:24 AM"] },
  { stop_id: "9836", name: "Orenco MAX Station", lat: 45.530298, lon: -122.916198, times: ["4:58 AM", "5:27 AM", "5:57 AM", "6:27 AM", "6:57 AM", "7:27 AM", "7:57 AM", "8:27 AM"] },
  { stop_id: "9840", name: "Hawthorn Farm MAX Station", lat: 45.529921, lon: -122.93112, times: ["4:59 AM", "5:29 AM", "5:59 AM", "6:29 AM", "6:59 AM", "7:29 AM", "7:59 AM", "8:29 AM"] },
  { stop_id: "9837", name: "Hillsboro Airport/Fairgrounds MAX Stn", lat: 45.526924, lon: -122.946499, times: ["5:01 AM", "5:31 AM", "6:01 AM", "6:31 AM", "7:01 AM", "7:31 AM", "8:01 AM", "8:31 AM"] },
  { stop_id: "9821", name: "Beaverton TC MAX Station", lat: 45.491696, lon: -122.8012, times: ["4:44 AM"] },
  { stop_id: "10579", name: "Portland Int&#x27;l Airport MAX Station", lat: 45.587584, lon: -122.5931, times: ["4:16 AM", "4:38 AM", "4:58 AM", "5:18 AM", "5:38 AM", "5:58 AM", "6:18 AM", "6:38 AM"] },
  { stop_id: "10577", name: "Mt Hood Ave MAX Station", lat: 45.576861, lon: -122.567141, times: ["4:20 AM", "4:41 AM", "5:01 AM", "5:21 AM", "5:41 AM", "6:01 AM", "6:21 AM", "6:41 AM"] },
  { stop_id: "10575", name: "Cascades MAX Station", lat: 45.572075, lon: -122.5577, times: ["4:22 AM", "4:43 AM", "5:03 AM", "5:23 AM", "5:43 AM", "6:03 AM", "6:23 AM", "6:43 AM"] },
  { stop_id: "10573", name: "Parkrose/Sumner TC MAX Station", lat: 45.558829, lon: -122.565861, times: ["4:24 AM", "4:46 AM", "5:06 AM", "5:26 AM", "5:46 AM", "6:06 AM", "6:26 AM", "6:46 AM"] },
  { stop_id: "14250", name: "Gateway North MAX Station", lat: 45.532194, lon: -122.563742, times: ["4:27 AM", "4:49 AM", "5:09 AM", "5:29 AM", "5:49 AM", "6:09 AM", "6:29 AM", "6:49 AM"] },
  { stop_id: "8347", name: "Gateway/NE 99th Ave TC MAX Station", lat: 45.530269, lon: -122.563578, times: ["4:28 AM", "4:50 AM", "5:10 AM", "5:30 AM", "5:50 AM", "6:10 AM", "6:30 AM", "6:50 AM"] },
]

    const polylineOut = L.polyline(shapeOutbound, { color: 'blue', weight: 4, opacity: 0.7 }).addTo(map);
    map.fitBounds(polylineOut.getBounds());

    const nowPT = new Date(new Date().toLocaleString('en-US', { timeZone: 'America/Los_Angeles' }));
    const nowMins = nowPT.getHours() * 60 + nowPT.getMinutes();

    stops.forEach(stop => {
      let highlightedTimes = [];
      let foundNext = false;
      stop.times.forEach(timeStr => {
        let cleanTime = timeStr.trim();
        let [h, m] = cleanTime.split(":");
        let schedMins = parseInt(h, 10) * 60 + parseInt(m, 10);
        if (schedMins < nowMins && nowMins - schedMins > 720) {
          schedMins += 1440;
        }
        if (!foundNext && schedMins >= nowMins) {
          highlightedTimes.push(`<span style="background:#4dd0e1; color:#000; padding:2px 6px; border-radius:6px; font-weight:bold;">${cleanTime}</span>`);
          foundNext = true;
        } else {
          highlightedTimes.push(cleanTime);
        }
      });

      L.circleMarker([stop.lat, stop.lon], {
        radius: 6,
        color: '#4dd0e1',
        fillColor: '#4dd0e1',
        fillOpacity: 0.9,
        weight: 1
      })
      .bindPopup(`<strong>${stop.name}</strong><br>${highlightedTimes.join("<br>") || 'No scheduled times'}`)
      .addTo(map);
    });

    let busMarkers = {};
    async function fetchAndDisplay() {
      const res = await fetch(`https://developer.trimet.org/ws/v2/vehicles?route=${routeNumber}&appID=${apiKey}&json=true`);
      const data = await res.json();
      const buses = (data.resultSet.vehicle || []).filter(v => v.routeNumber == routeNumber && v.direction == direction);

      Object.values(busMarkers).forEach(m => map.removeLayer(m));
      busMarkers = {};
      if (!buses.length) return;

      buses.forEach(bus => {
        if (!bus.latitude || !bus.longitude || !bus.blockID) return;
        const icon = L.divIcon({    
           className: '',
           html: `
            <div style="text-align:center;">
              <div style="background:#0071CE;color:#fff;padding:2px 6px;border-radius:6px;font-weight:bold;">${bus.vehicleID}</div>
              <div style="width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-top:10px solid #00bfff;margin:auto;"></div>
            </div>
          `,
          iconSize: [40, 30], iconAnchor: [20, 30]
        });
        const marker = L.marker([bus.latitude, bus.longitude], { icon }).addTo(map);
        busMarkers[bus.vehicleID] = marker;
      });
    }
    fetchAndDisplay();
    setInterval(fetchAndDisplay, 15000);
  </script>

  <footer class="site-footer">
    <a href="terms.html">Terms of Use</a> &nbsp;|&nbsp;
    <a href="contact.html">Contact Us</a> &nbsp;|&nbsp;
    <a href="report.html">Report a Problem</a> &nbsp;|&nbsp;
    <a href="dmca.html">DMCA</a> &nbsp;|&nbsp;
    <a href="privacy.html">Privacy Policy</a>
  </footer>

  <script>
    if (!localStorage.getItem('cookieConsent')) {
      document.write(`
        <div id="cookie-banner" style="position: fixed; bottom: 0; left: 0; right: 0; background: #333; color: #fff; padding: 1rem; z-index: 1000; font-size: 0.9rem; line-height: 1.4; text-align: center; box-sizing: border-box;">
          📢 We use cookies to improve functionality and analyze traffic.
          By using MetroFeed, you agree to our 
          <a href='privacy.html' style='color: #4dd0e1; text-decoration: underline;'>Privacy Policy</a>.<br>
          <button onclick='localStorage.setItem("cookieConsent", "true"); document.getElementById("cookie-banner").remove();' style='margin-top: 0.5rem; background: #4dd0e1; color: #000; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer; font-weight: bold;'>OK</button>
        </div>
      `);
    }
  </script>
</body>
</html>